(function(n){function s(s){for(var p,l,i=s[0],c=s[1],o=s[2],d=0,h=[];d<i.length;d++)l=i[d],Object.prototype.hasOwnProperty.call(e,l)&&e[l]&&h.push(e[l][0]),e[l]=0;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&(n[p]=c[p]);r&&r(s);while(h.length)h.shift()();return t.push.apply(t,o||[]),a()}function a(){for(var n,s=0;s<t.length;s++){for(var a=t[s],p=!0,i=1;i<a.length;i++){var c=a[i];0!==e[c]&&(p=!1)}p&&(t.splice(s--,1),n=l(l.s=a[0]))}return n}var p={},e={app:0},t=[];function l(s){if(p[s])return p[s].exports;var a=p[s]={i:s,l:!1,exports:{}};return n[s].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=n,l.c=p,l.d=function(n,s,a){l.o(n,s)||Object.defineProperty(n,s,{enumerable:!0,get:a})},l.r=function(n){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},l.t=function(n,s){if(1&s&&(n=l(n)),8&s)return n;if(4&s&&"object"===typeof n&&n&&n.__esModule)return n;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&s&&"string"!=typeof n)for(var p in n)l.d(a,p,function(s){return n[s]}.bind(null,p));return a},l.n=function(n){var s=n&&n.__esModule?function(){return n["default"]}:function(){return n};return l.d(s,"a",s),s},l.o=function(n,s){return Object.prototype.hasOwnProperty.call(n,s)},l.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=s,i=i.slice();for(var o=0;o<i.length;o++)s(i[o]);var r=c;t.push([0,"chunk-vendors"]),a()})({0:function(n,s,a){n.exports=a("56d7")},"034f":function(n,s,a){"use strict";a("85ec")},"1a10":function(n,s,a){},"2b36":function(n,s,a){"use strict";a("1a10")},"457c":function(n,s,a){"use strict";a("ca9a")},"56d7":function(n,s,a){"use strict";a.r(s);a("e260"),a("e6cf"),a("cca6"),a("a79d");var p=a("2b0e"),e=function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("div",{attrs:{id:"app"}},[a("Avater"),a("AboutMe"),a("Feeds"),n._m(0)],1)},t=[function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("footer",[a("div",[n._v("©2020 Keisuke Nakayama")])])}],l=function(){var n=this,s=n.$createElement;n._self._c;return n._m(0)},i=[function(){var n=this,s=n.$createElement,p=n._self._c||s;return p("div",{staticClass:"avater"},[p("img",{staticClass:"avater-icon",attrs:{alt:"basd4g avater icon",src:a("b8f0"),srcset:a("b8f0")+" 1x, "+a("dffa")+" 2x",width:"200px",height:"200px"}}),p("div",[n._v("Keisuke Nakayama")])])}],c={name:"AboutMe"},o=c,r=(a("2b36"),a("2877")),d=Object(r["a"])(o,l,i,!1,null,"1dc430d3",null),h=d.exports,g=function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("div",{staticClass:"feeds"},[a("h2",[n._v("Posts")]),n._l(n.feeds,(function(n,s){return a("Feed",{key:n.link,attrs:{feed:n,index:s}})}))],2)},u=[],m=a("f3c9"),f=function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("a",{attrs:{href:n.feed.link}},[a("div",{staticClass:"feed"},[a("h3",{class:{title:!0,isFirst:n.isFirst}},[n._v(n._s(n.feed.title))]),a("div",{staticClass:"date_and_site"},[n._v(n._s(n.date)+" - "+n._s(n.site))]),a("div",{staticClass:"description"},[n._v(n._s(n.description))])])])},b=[],k=(a("99af"),a("fb6a"),a("a9e3"),a("9911"),{name:"Feed",props:{feed:Object,index:Number},computed:{date:function(){var n=new Date(this.feed.isoDate),s="".concat(n.getFullYear()),a="00".concat(n.getMonth()+1).slice(-2),p="00".concat(n.getDate()).slice(-2);return"".concat(s,"/").concat(a,"/").concat(p)},site:function(){return/^https:\/\/memo\.basd4g\.net/.test(this.feed.link)?"memo.basd4g.net":/^https:\/\/basd4g\.hatenablog\.com/.test(this.feed.link)?"はてなブログ":/^https:\/\/qiita\.com\/basd4g/.test(this.feed.link)?"Qiita":this.feed.link},description:function(){var n=100;return this.feed.contentSnippet.length<=n?this.feed.contentSnippet:"".concat(this.feed.contentSnippet.slice(0,n-1),"...")},isFirst:function(){return 0===this.index}}}),w=k,y=(a("6de8"),a("f35b"),Object(r["a"])(w,f,b,!1,null,"3d14f6fa",null)),v=y.exports,x={name:"Feeds",components:{Feed:v},props:{msg:String},data:function(){return{feeds:m}}},A=x,S=(a("64e9"),Object(r["a"])(A,g,u,!1,null,"0acab326",null)),P=S.exports,E=function(){var n=this,s=n.$createElement;n._self._c;return n._m(0)},I=[function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("div",{staticClass:"about-me"},[a("h2",[n._v("About Me")]),a("table",[a("tr",[a("td",[n._v("Nickname")]),n._v(" "),a("td",[n._v("yammer"),a("br"),n._v("やんまー")])]),a("tr",[a("td",[n._v("Name")]),n._v(" "),a("td",[n._v("Keisuke, Nakayama"),a("br"),n._v("中山 慶祐")])]),a("tr",[a("td",[n._v("Education")]),a("td",[n._v("Department of Information and Computer Sciences, Saitama University "),a("br"),n._v("埼玉大学工学部情報システム工学科 (2017- )")])])]),a("h2",[n._v("Links")]),a("div",{staticClass:"links"},[a("a",{attrs:{href:"https://twitter.com/basd4g"}},[n._v("Twitter")]),a("a",{attrs:{href:"https://github.com/basd4g"}},[n._v("GitHub")]),a("a",{attrs:{href:"https://qiita.com/basd4g"}},[n._v("Qiita")]),a("a",{attrs:{href:"https://basd4g.hatenablog.com"}},[n._v("はてなブログ")]),a("a",{attrs:{href:"https://memo.basd4g.net"}},[n._v("memo.basd4g.net")])])])}],T={name:"AboutMe"},_=T,C=(a("457c"),Object(r["a"])(_,E,I,!1,null,"402ea526",null)),D=C.exports,$={name:"App",components:{Avater:h,AboutMe:D,Feeds:P}},L=$,j=(a("034f"),Object(r["a"])(L,e,t,!1,null,null,null)),F=j.exports;p["a"].config.productionTip=!1,new p["a"]({render:function(n){return n(F)}}).$mount("#app")},"64e9":function(n,s,a){"use strict";a("995f")},"6de8":function(n,s,a){"use strict";a("aeea")},"7e9f":function(n,s,a){},"85ec":function(n,s,a){},"995f":function(n,s,a){},aeea:function(n,s,a){},b8f0:function(n,s,a){n.exports=a.p+"img/gather_fishes_200x200.1160329a.jpg"},ca9a:function(n,s,a){},dffa:function(n,s,a){n.exports=a.p+"img/gather_fishes_400x400.41e36e91.jpg"},f35b:function(n,s,a){"use strict";a("7e9f")},f3c9:function(n){n.exports=JSON.parse('[{"title":"HugoでURLをパーセントエンコード (CloudinaryでOGP画像生成)","link":"https://memo.basd4g.net/posts/hugo-url-encode/","pubDate":"Sat, 26 Dec 2020 20:52:36 +0900","content":"<p>Hugo で Cloudinary<a id=\\"annotation-1-from\\" href=\\"#annotation-1\\" >^1</a> を用いた OGP 画像生成のため日本語を URL に埋め込みたい。\\n埋め込みのために文字列をパーセントエンコード<a id=\\"annotation-2-from\\" href=\\"#annotation-2\\" >^2</a> する方法を記す。</p>\\n<h2 id=\\"方法\\">方法</h2>\\n<p>Hugo のテンプレートの中で <code>$string</code> 変数に文字列が格納されているとき、次の表記で変数内の文字列をパーセントエンコードして出力できる。</p>\\n<pre><code>{{- replace (substr (querify &quot;a&quot; $string) 2) &quot;+&quot; &quot;%20&quot; -}}\\n</code></pre><p>例えば OGP 画像のためURLに日本語文字列を埋め込むのは次のようにして実現できる</p>\\n<pre><code>{{ $title := &quot;埋め込む文字列&quot; }}\\n&lt;meta\\nproperty=&quot;og:image&quot;\\ncontent=&quot;https://res.cloudinary.com/basd4g/image/upload/{{- replace (substr (querify &quot;a&quot; $title) 2) &quot;+&quot; &quot;%20&quot; -}}/v1608780036/memo-basd4g-net-ogp.png&quot;\\n/&gt;\\n</code></pre><h2 id=\\"経緯と補足\\">経緯と補足</h2>\\n<p>上記の方法は少々トリッキーである。\\n私の調べた範囲ではHugo に定義された関数の中で直接 URL をパーセントエンコードするものは見つけられなかった。\\n英語圏などでは<code> </code>(半角空白)を<code>%20</code>に置換すればよいのでは？という回答もあったが、日本語はそれでは困る。</p>\\n<p>しかしながらテンプレート内で表示されるページの URL を取得する <code>{{- .Permalink -}}</code> という値があるらしく、この値からは適切にパーセントエンコードされた値を取得できることがわかった。\\nということで Hugo の内部で URL として扱われる文字列はパーセントエンコードされるっぽい。</p>\\n<p>そこで 任意の文字列を URL として Hugo に扱わせそうな機能である、URL クエリパラメータを生成する querify 関数を利用すると実現できることをみつけた。\\n上述の方法では、querify 関数によってパーセントエンコードされたクエリパラメータに変換し、クエリパラメータの先頭部分と半角空白文字を処理することで実現している。</p>\\n<p>というわけでこのブログもOGPに対応した。\\nもしもっとシンプルな方法があったら教えてください。</p>\\n<hr>\\n<p>参考: Hugo</p>\\n<ul>\\n<li><a href=\\"https://discourse.gohugo.io/t/url-encoding-percent-encoding-with-hugo-solved/16546/3\\"target=\\"_blank\\">URL encoding (percent encoding) with Hugo? [SOLVED] - support - HUGO</a></li>\\n<li><a href=\\"https://discourse.gohugo.io/t/urlencode-in-hugo/24215/5\\"target=\\"_blank\\">URLencode in Hugo - support - HUGO</a></li>\\n<li><a href=\\"https://gohugo.io/hugo-pipes/resource-from-string/\\"target=\\"_blank\\">Creating a resource from a string | Hugo</a></li>\\n<li><a href=\\"https://gohugo.io/functions/querify/\\"target=\\"_blank\\">querify | Hugo</a></li>\\n<li><a href=\\"https://gohugo.io/functions/replace/\\"target=\\"_blank\\">replace | Hugo</a></li>\\n<li><a href=\\"https://gohugo.io/functions/substr/\\"target=\\"_blank\\">substr | Hugo</a></li>\\n</ul>\\n<p>参考: パーセントエンコード</p>\\n<ul>\\n<li><a href=\\"https://url.spec.whatwg.org/\\"target=\\"_blank\\">URL Standard</a></li>\\n<li><a href=\\"https://triple-underscore.github.io/URL-ja.html\\"target=\\"_blank\\">URL Standard （日本語訳）</a></li>\\n<li><a href=\\"https://developer.mozilla.org/ja/docs/Glossary/percent-encoding\\"target=\\"_blank\\">Percent-encoding (パーセントエンコーディング) - MDN Web Docs 用語集: ウェブ関連用語の定義 | MDN</a></li>\\n<li><a href=\\"https://www.ipa.go.jp/security/fy21/reports/tech1-tg/b_09.html\\"target=\\"_blank\\">情報セキュリティ技術動向調査（2009 年下期）：IPA 独立行政法人 情報処理推進機構</a></li>\\n</ul>\\n<hr>\\n<p><a id=\\"annotation-1\\" href=\\"#annotation-1-from\\" >^1</a> &hellip;\\n<a href=\\"https://cloudinary.com\\"target=\\"_blank\\">Cloudinary</a> はアップロードした画像を配信できるサービスで、URL で画像の大きさや文字などを指定すると加工した画像が返却される機能がある。これを用いて記事のタイトルを URL に含め、事前にアップロードした背景画像と組み合わせて記事ごとの OGP 画像として配信することができる。</p>\\n<p><a id=\\"annotation-2\\" href=\\"#annotation-2-from\\" >^2</a> &hellip;\\nURL に使用できない文字を、文字コードに置換することで URL に有効な文字の範囲で表現する方法。\\n置換対象の文字を % とその後ろに文字コードの16進表現を続ける形に置換する。\\n例えば <code>https://ja.wikipedia.org/wiki/パーセントエンコーディング</code> は <code>https://ja.wikipedia.org/wiki/%E3%83%91%E3%83%BC%E3%82%BB%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0</code> と表現できる。</p>","contentSnippet":"Hugo で Cloudinary^1 を用いた OGP 画像生成のため日本語を URL に埋め込みたい。\\n埋め込みのために文字列をパーセントエンコード^2 する方法を記す。\\n方法\\nHugo のテンプレートの中で $string 変数に文字列が格納されているとき、次の表記で変数内の文字列をパーセントエンコードして出力できる。\\n{{- replace (substr (querify \\"a\\" $string) 2) \\"+\\" \\"%20\\" -}}\\n\\n例えば OGP 画像のためURLに日本語文字列を埋め込むのは次のようにして実現できる\\n{{ $title := \\"埋め込む文字列\\" }}\\n<meta\\nproperty=\\"og:image\\"\\ncontent=\\"https://res.cloudinary.com/basd4g/image/upload/{{- replace (substr (querify \\"a\\" $title) 2) \\"+\\" \\"%20\\" -}}/v1608780036/memo-basd4g-net-ogp.png\\"\\n/>\\n\\n経緯と補足\\n上記の方法は少々トリッキーである。\\n私の調べた範囲ではHugo に定義された関数の中で直接 URL をパーセントエンコードするものは見つけられなかった。\\n英語圏などでは (半角空白)を%20に置換すればよいのでは？という回答もあったが、日本語はそれでは困る。\\nしかしながらテンプレート内で表示されるページの URL を取得する {{- .Permalink -}} という値があるらしく、この値からは適切にパーセントエンコードされた値を取得できることがわかった。\\nということで Hugo の内部で URL として扱われる文字列はパーセントエンコードされるっぽい。\\nそこで 任意の文字列を URL として Hugo に扱わせそうな機能である、URL クエリパラメータを生成する querify 関数を利用すると実現できることをみつけた。\\n上述の方法では、querify 関数によってパーセントエンコードされたクエリパラメータに変換し、クエリパラメータの先頭部分と半角空白文字を処理することで実現している。\\nというわけでこのブログもOGPに対応した。\\nもしもっとシンプルな方法があったら教えてください。\\n参考: Hugo\\nURL encoding (percent encoding) with Hugo? [SOLVED] - support - HUGO\\nURLencode in Hugo - support - HUGO\\nCreating a resource from a string | Hugo\\nquerify | Hugo\\nreplace | Hugo\\nsubstr | Hugo\\n参考: パーセントエンコード\\nURL Standard\\nURL Standard （日本語訳）\\nPercent-encoding (パーセントエンコーディング) - MDN Web Docs 用語集: ウェブ関連用語の定義 | MDN\\n情報セキュリティ技術動向調査（2009 年下期）：IPA 独立行政法人 情報処理推進機構\\n^1 …\\nCloudinary はアップロードした画像を配信できるサービスで、URL で画像の大きさや文字などを指定すると加工した画像が返却される機能がある。これを用いて記事のタイトルを URL に含め、事前にアップロードした背景画像と組み合わせて記事ごとの OGP 画像として配信することができる。\\n^2 …\\nURL に使用できない文字を、文字コードに置換することで URL に有効な文字の範囲で表現する方法。\\n置換対象の文字を % とその後ろに文字コードの16進表現を続ける形に置換する。\\n例えば https://ja.wikipedia.org/wiki/パーセントエンコーディング は https://ja.wikipedia.org/wiki/%E3%83%91%E3%83%BC%E3%82%BB%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0 と表現できる。","guid":"https://memo.basd4g.net/posts/hugo-url-encode/","isoDate":"2020-12-26T11:52:36.000Z"},{"title":"MacBookAir 2020 (M1) のセットアップ","link":"https://memo.basd4g.net/posts/mba2020-setup/","pubDate":"Tue, 22 Dec 2020 14:24:01 +0900","content":"<p>Apple Silicon を搭載した MacBook Air を購入したのでセットアップをやっていく。\\nそのメモ。</p>\\n<blockquote class=\\"twitter-tweet\\"><p lang=\\"ja\\" dir=\\"ltr\\">m1 MacBook Air が届いたのでとりあえずたくさんアプリケーションやタブを連続起動して「はえ〜」ってやつをやりました。</p>&mdash; やんまー (@basd4g) <a href=\\"https://twitter.com/basd4g/status/1340576122795266048?ref_src=twsrc%5Etfw\\">December 20, 2020</a></blockquote> <script async src=\\"https://platform.twitter.com/widgets.js\\" charset=\\"utf-8\\"><\/script>\\n<p>2020/12/20現在では「<code>brew bundle</code>しておわり」というわけにはいかない。\\nできる限りApple Silicon版のバイナリを使いたいので、各種ソフトウェアのビルド方法などを記録することにする。</p>\\n<h2 id=\\"tips\\">Tips</h2>\\n<ul>\\n<li><code>arch -x86_64</code> を先頭につけてコマンドを実行すると Rosseta2 上で実行してくれる。</li>\\n</ul>\\n<h2 id=\\"ソフトウェアのインストール以前\\">ソフトウェアのインストール以前</h2>\\n<h3 id=\\"macos-の設定\\">macOS の設定</h3>\\n<ul>\\n<li>ライブ変換の無効化</li>\\n<li>OSのキーマップ設定を変更 (capslock -&gt; esc)</li>\\n</ul>\\n<h3 id=\\"ssh\\">ssh</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">mkdir ~/.ssh\\nchmod <span class=\\"m\\">700</span> ~/.ssh\\n<span class=\\"nb\\">cd</span> ~/.ssh\\nssh-keygen -t rsa -b <span class=\\"m\\">4096</span> -C <span class=\\"s2\\">&#34;mymail@example.com&#34;</span>\\ncat id_rsa.pub <span class=\\"p\\">|</span> pbcopy\\n</code></pre></div><p><a href=\\"https://github.com/settings/keys\\"target=\\"_blank\\">GitHub Settings</a> を開いて &lsquo;New SSH key&rsquo; を追加</p>\\n<h3 id=\\"dotfiles\\">dotfiles</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">xcode-select --install\\ncurl -sL http://dot.basd4g.net <span class=\\"p\\">|</span> sh\\n<span class=\\"nb\\">cd</span> dotfiles\\nmake link\\nvim\\n</code></pre></div><h2 id=\\"ソフトウェアのインストール\\">ソフトウェアのインストール</h2>\\n<p>Web ページからパッケージをダウンロードしてインストールしたものは以下。</p>\\n<ul>\\n<li><a href=\\"https://pilotmoon.com/scrollreverser/\\"target=\\"_blank\\">Scroll Reverser</a></li>\\n<li><a href=\\"https://karabiner-elements.pqrs.org/\\"target=\\"_blank\\">Karabiner-Elements</a></li>\\n<li><a href=\\"https://zoom.us/download#client_4meeting\\"target=\\"_blank\\">Zoom</a> (起動してログインの後、Apple Silicon版にアップデートするダイアログが出てくる)</li>\\n<li><a href=\\"https://www.macports.org/install.php\\"target=\\"_blank\\">MacPorts</a></li>\\n<li><a href=\\"https://www.mozilla.org/ja/firefox/new/\\"target=\\"_blank\\">Firefox</a></li>\\n<li><a href=\\"https://www.google.co.jp/chrome\\"target=\\"_blank\\">Google Chrome</a></li>\\n</ul>\\n<p>(<a href=\\"https://vivaldi.com/ja/\\"target=\\"_blank\\">Vivaldi</a> はまだintel版しかないので、アップデートして欲しい。)</p>\\n<p>ビルドするなどして導入したのは以下。</p>\\n<h3 id=\\"homebrew-for-apple-silicon\\">Homebrew (for Apple Silicon)</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">sudo mkdir /opt/homebrew\\nsudo chown <span class=\\"nv\\">$USER</span> /opt/homebrew\\ncurl -L https://github.com/Homebrew/brew/tarball/master <span class=\\"p\\">|</span> tar xz --strip <span class=\\"m\\">1</span> -C /opt/homebrew\\n</code></pre></div><h3 id=\\"tmux\\">tmux</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">brew install --build-from-source tmux\\n</code></pre></div><h3 id=\\"nodejs\\">Node.js</h3>\\n<pre><code>sudo port install nvm # install nodejs version manager\\necho \'source /opt/local/share/nvm/init-nvm.sh\' &gt;&gt; ~/.zshrc\\nsudo port install git curl openssl automake\\nnvm install v15\\n</code></pre><p>参考: <a href=\\"https://zenn.dev/ioridev/articles/c74af379e4e73151790d\\"target=\\"_blank\\">個人的 M1 mac 開発環境状況 2020/11/28更新 - Zenn.dev</a></p>\\n<p>nodejsのビルドはそこそこ CPU パワーと時間を使う</p>\\n<h3 id=\\"golang\\">Golang</h3>\\n<p>まずはIntel版をWebからダウンロードしてインストールする(<a href=\\"https://golang.org/\\"target=\\"_blank\\">The Go Programming Language</a>)</p>\\n<p>次に以下の手順でApple Silicon向けにビルドした後、Intel版を削除</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">go get golang.org/dl/gotip\\n<span class=\\"nv\\">GODEBUG</span><span class=\\"o\\">=</span><span class=\\"nv\\">asyncpreemptoff</span><span class=\\"o\\">=</span><span class=\\"m\\">1</span> <span class=\\"nv\\">GOARCH</span><span class=\\"o\\">=</span>arm64 ~/go/bin/gotip download\\n<span class=\\"nb\\">echo</span> <span class=\\"s2\\">&#34;</span><span class=\\"nv\\">$HOME</span><span class=\\"s2\\">/sdk/gotip/bin/darwin_arm64&#34;</span> <span class=\\"p\\">|</span> sudo tee /etc/paths.d/go\\nwhich go <span class=\\"c1\\"># check to be installed</span>\\nsudo rm -rf /usr/local/go\\n</code></pre></div><h3 id=\\"peco\\">peco</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"nb\\">cd</span>\\ngit clone https://github.com/peco/peco.git <span class=\\"o\\">&amp;&amp;</span> <span class=\\"nb\\">cd</span> peco\\nmake build\\nmv ~/peco/releases/peco_darwin_arm64/peco /usr/local/bin/peco\\n</code></pre></div><h3 id=\\"hugo\\">hugo</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"nb\\">cd</span>\\ngit clone https://github.com/gohugoio/hugo.com <span class=\\"o\\">&amp;&amp;</span> <span class=\\"nb\\">cd</span> hugo\\ngo build\\nmv ~/hugo/hugo /usr/local/bin/hugo\\n</code></pre></div><h3 id=\\"jq\\">jq</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">brew install --build-from-source jq\\n</code></pre></div><h3 id=\\"gh\\">gh</h3>\\n<pre><code>cd\\ngit clone https://github.com/cli/cli.git &amp;&amp; cd cli\\nmake\\nmv bin/gh /usr/local.bin/gh\\n</code></pre><h3 id=\\"mmv\\">mmv</h3>\\n<pre><code>cd\\ngit clone https://github.com\\n</code></pre>","contentSnippet":"Apple Silicon を搭載した MacBook Air を購入したのでセットアップをやっていく。\\nそのメモ。\\nm1 MacBook Air が届いたのでとりあえずたくさんアプリケーションやタブを連続起動して「はえ〜」ってやつをやりました。\\n— やんまー (@basd4g) December 20, 2020\\n \\n2020/12/20現在では「brew bundleしておわり」というわけにはいかない。\\nできる限りApple Silicon版のバイナリを使いたいので、各種ソフトウェアのビルド方法などを記録することにする。\\nTips\\narch -x86_64 を先頭につけてコマンドを実行すると Rosseta2 上で実行してくれる。\\nソフトウェアのインストール以前\\nmacOS の設定\\nライブ変換の無効化\\nOSのキーマップ設定を変更 (capslock -> esc)\\nssh\\nmkdir ~/.ssh\\nchmod 700 ~/.ssh\\ncd ~/.ssh\\nssh-keygen -t rsa -b 4096 -C \\"mymail@example.com\\"\\ncat id_rsa.pub | pbcopy\\n\\n\\nGitHub Settings を開いて ‘New SSH key’ を追加\\ndotfiles\\nxcode-select --install\\ncurl -sL http://dot.basd4g.net | sh\\ncd dotfiles\\nmake link\\nvim\\n\\n\\nソフトウェアのインストール\\nWeb ページからパッケージをダウンロードしてインストールしたものは以下。\\nScroll Reverser\\nKarabiner-Elements\\nZoom (起動してログインの後、Apple Silicon版にアップデートするダイアログが出てくる)\\nMacPorts\\nFirefox\\nGoogle Chrome\\n(Vivaldi はまだintel版しかないので、アップデートして欲しい。)\\nビルドするなどして導入したのは以下。\\nHomebrew (for Apple Silicon)\\nsudo mkdir /opt/homebrew\\nsudo chown $USER /opt/homebrew\\ncurl -L https://github.com/Homebrew/brew/tarball/master | tar xz --strip 1 -C /opt/homebrew\\n\\n\\ntmux\\nbrew install --build-from-source tmux\\n\\n\\nNode.js\\nsudo port install nvm # install nodejs version manager\\necho \'source /opt/local/share/nvm/init-nvm.sh\' >> ~/.zshrc\\nsudo port install git curl openssl automake\\nnvm install v15\\n\\n参考: 個人的 M1 mac 開発環境状況 2020/11/28更新 - Zenn.dev\\nnodejsのビルドはそこそこ CPU パワーと時間を使う\\nGolang\\nまずはIntel版をWebからダウンロードしてインストールする(The Go Programming Language)\\n次に以下の手順でApple Silicon向けにビルドした後、Intel版を削除\\ngo get golang.org/dl/gotip\\nGODEBUG=asyncpreemptoff=1 GOARCH=arm64 ~/go/bin/gotip download\\necho \\"$HOME/sdk/gotip/bin/darwin_arm64\\" | sudo tee /etc/paths.d/go\\nwhich go # check to be installed\\nsudo rm -rf /usr/local/go\\n\\n\\npeco\\ncd\\ngit clone https://github.com/peco/peco.git && cd peco\\nmake build\\nmv ~/peco/releases/peco_darwin_arm64/peco /usr/local/bin/peco\\n\\n\\nhugo\\ncd\\ngit clone https://github.com/gohugoio/hugo.com && cd hugo\\ngo build\\nmv ~/hugo/hugo /usr/local/bin/hugo\\n\\n\\njq\\nbrew install --build-from-source jq\\n\\n\\ngh\\ncd\\ngit clone https://github.com/cli/cli.git && cd cli\\nmake\\nmv bin/gh /usr/local.bin/gh\\n\\nmmv\\ncd\\ngit clone https://github.com","guid":"https://memo.basd4g.net/posts/mba2020-setup/","isoDate":"2020-12-22T05:24:01.000Z"},{"title":"Pocketにツイートを保存したらリツイートする","link":"https://memo.basd4g.net/posts/pocket2retweet/","pubDate":"Tue, 15 Dec 2020 18:27:23 +0900","content":"<p>題名のスクリプトを作ってcronで定期実行したら便利だった話。</p>\\n<h2 id=\\"背景\\">背景</h2>\\n<p>Twitter アカウントがいくつか<a href=\\"#annotation-1\\" id=\\"annotation-1-from\\">^1</a>ある。\\n情報を浴びるように流しているアカウントだったり、情報の種類別だったり、使っていないものだったり。</p>\\n<p>PC で Twitter を見るときは大体 <a href=\\"https://tweetdeck.twitter.com\\"target=\\"_blank\\">TweetDeck</a>を使っておりこれは結構使いやすい。\\n一方で iOS ではマルチアカウントで満足する Twitter クライアントを見つけられていない。 (今は <a href=\\"https://apps.apple.com/jp/app/feather-for-twitter/id793157344\\"target=\\"_blank\\">feather</a> を使っている。)</p>\\n<p>具体的には次のような機能がほしい。</p>\\n<ul>\\n<li>ユーザを別アカウントでフォローする</li>\\n<li>ツイートを別アカウントでリツイートする</li>\\n</ul>\\n<h2 id=\\"作ったもの\\">作ったもの</h2>\\n<p>作ったものはこちら: <a href=\\"https://github.com/basd4g/pocket2retweet\\"target=\\"_blank\\">pocket2retweet - GitHub</a></p>\\n<p>対象のユーザとツイートを <a href=\\"https://getpocket.com\\"target=\\"_blank\\">Pocket</a> に記録し、あとからバッチ処理するようにした。</p>\\n<p>次の2つの機能をもつスクリプトを cron で1時間ごとに定期実行する。</p>\\n<ul>\\n<li>Pocket に保存されているツイートを Pocket API で取得し、Twitter API でリツイートしたあと、Pocket から削除する。</li>\\n<li>Pocket に保存されている Twitter ユーザページ を Pocket API で取得し、Twitter API でフォローしたあと、Pocket から削除する。</li>\\n</ul>\\n<p>API の条件的には1分に1回くらいでもいいくらいだが、多少遅れても困らないので1時間に1回としている。</p>\\n<h2 id=\\"感想\\">感想</h2>\\n<p>我ながら便利。</p>\\n<p>Pocket への保存はアプリ間共有で Pocket を選べばよいだけなので、Web ブラウザでもアプリでも、iOS に限らず使える。</p>\\n<p>もともと Pocket に保存したツイートは Pocket のページからは見づらかったので、リツイートしたものから探すほうがみやすくてよい感じ。</p>\\n<p>Pocket の現状の自分の使い方では、保存するのは楽でいいけどけど整理されていないし読みづらいみたいなところがある。\\nもっと活用できそうな気がするので、他のサービスともいい感じに連携して便利にする方法を考えていきたい。</p>\\n<h2 id=\\"補足\\">補足</h2>\\n<p><a href=\\"#annotation-1-from\\" id=\\"annotation-1\\">^1</a>: リスト機能を使って1つのアカウントでやれやという意見もあるだろう。以前はそうしていたのだがリスト管理が面倒な気がして、今はアカウントを分けてフォローしたほうが楽だと思っている。</p>","contentSnippet":"題名のスクリプトを作ってcronで定期実行したら便利だった話。\\n背景\\nTwitter アカウントがいくつか^1ある。\\n情報を浴びるように流しているアカウントだったり、情報の種類別だったり、使っていないものだったり。\\nPC で Twitter を見るときは大体 TweetDeckを使っておりこれは結構使いやすい。\\n一方で iOS ではマルチアカウントで満足する Twitter クライアントを見つけられていない。 (今は feather を使っている。)\\n具体的には次のような機能がほしい。\\nユーザを別アカウントでフォローする\\nツイートを別アカウントでリツイートする\\n作ったもの\\n作ったものはこちら: pocket2retweet - GitHub\\n対象のユーザとツイートを Pocket に記録し、あとからバッチ処理するようにした。\\n次の2つの機能をもつスクリプトを cron で1時間ごとに定期実行する。\\nPocket に保存されているツイートを Pocket API で取得し、Twitter API でリツイートしたあと、Pocket から削除する。\\nPocket に保存されている Twitter ユーザページ を Pocket API で取得し、Twitter API でフォローしたあと、Pocket から削除する。\\nAPI の条件的には1分に1回くらいでもいいくらいだが、多少遅れても困らないので1時間に1回としている。\\n感想\\n我ながら便利。\\nPocket への保存はアプリ間共有で Pocket を選べばよいだけなので、Web ブラウザでもアプリでも、iOS に限らず使える。\\nもともと Pocket に保存したツイートは Pocket のページからは見づらかったので、リツイートしたものから探すほうがみやすくてよい感じ。\\nPocket の現状の自分の使い方では、保存するのは楽でいいけどけど整理されていないし読みづらいみたいなところがある。\\nもっと活用できそうな気がするので、他のサービスともいい感じに連携して便利にする方法を考えていきたい。\\n補足\\n^1: リスト機能を使って1つのアカウントでやれやという意見もあるだろう。以前はそうしていたのだがリスト管理が面倒な気がして、今はアカウントを分けてフォローしたほうが楽だと思っている。","guid":"https://memo.basd4g.net/posts/pocket2retweet/","isoDate":"2020-12-15T09:27:23.000Z"},{"title":"東芝HDDレコーダRD-S600の動画をmacOSにコピーする (ネットdeダビング)","link":"https://memo.basd4g.net/posts/toshiba-dubbing/","pubDate":"Mon, 14 Dec 2020 23:18:07 +0900","content":"<p>TL;DR: 2006年製の東芝製 HDD レコーダ RD-S600 の動画を, 当該機種に搭載の「ネットdeダビング」機能を使って, LAN 経由で macOS のストレージにコピーする.</p>\\n<h2 id=\\"背景\\">背景</h2>\\n<p>8ミリのビデオテープや VHS に記録されたホームビデオをデジタル化するにあたり, 家族が自宅にあった HDD レコーダ RD-S600 の内蔵 HDD に動画を録画していた.</p>\\n<p>これを, HDDの寿命が怖いしブルーレイに焼きたかったりするのでPCに転送したい.</p>\\n<p>RD-S600 は2006年東芝製の HDD レコーダで, 都合のいいことにイーサネットポートがついているため LAN 内で動画を転送できる.\\nただし転送できるのはコピー制限のかかっていない VR モードの動画に限る. (アナログ入力の録画に使われる低品質のもの)</p>\\n<p>転送を受けるPC側については, 有志で公開されたソフトを利用する.\\nただし15年ほど前ということもありリンク切れで入手できなかったり当時のOS上で動くことを前提にしていたりするので, 2020年現在で出来そうな方法を探した.</p>\\n<p>いくつかあるソフトの中で試行錯誤の結果, 今回はJava製でMac OS X 向けの転送用ソフトウェア <a href=\\"http://raktajino.sakura.ne.jp/RDService/RDService.html\\"target=\\"_blank\\">RDService</a> を利用した.</p>\\n<h2 id=\\"環境\\">環境</h2>\\n<ul>\\n<li>東芝製 HDD レコーダ RD-S600</li>\\n<li>MacBook Pro 2020 (Catalina)</li>\\n<li>どちらも同じLAN に接続する (HDD レコーダはイーサネットポートを利用して有線で, MacBook はアクセスポイントを経由して無線で接続)</li>\\n<li>2台とも DHCP を利用(勝手に探してくれるのでIPアドレスはなんでもよい)</li>\\n</ul>\\n<h2 id=\\"手順\\">手順</h2>\\n<p>Mac で FTP を拡張したサーバを実行し, 同じネットワークに接続した HDD レコーダ側を操作して, サーバに動画を転送する.</p>\\n<h3 id=\\"1-java8-をインストール\\">1. Java8 をインストール</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># homebrew がインストールされていることを前提とする</span>\\n<span class=\\"c1\\"># Java8 をインストール</span>\\nbrew tap homebrew/cask-version\\nbrew install --cask zulu\\n<span class=\\"c1\\"># java が zulu8 のバージョンであるかを確認する. zulu8 でないときは参考 URL より切り替えるとよさそう.</span>\\njava -version\\n</code></pre></div><p>参考: <a href=\\"https://qiita.com/seijikohara/items/56cc4ac83ef9d686fab2\\"target=\\"_blank\\">MacのBrewで複数バージョンのJavaを利用する + jEnv - Qiita</a></p>\\n<p>私の環境では zulu8 が <code>/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home/bin/java</code> にインストールされていた.\\nのちほどシェルスクリプトで実行する java コマンドの代わりに上記のパスを指定しても良い.</p>\\n<h3 id=\\"2-rdservice-をダウンロード\\">2. RDService をダウンロード</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">curl -o RDService.zip http://raktajino.sakura.ne.jp/RDService/RDService_1.0b5.zip\\nunzip RDService.zip\\n<span class=\\"nb\\">cd</span> RDService\\n</code></pre></div><h3 id=\\"3-rdservice-を実行\\">3. RDService を実行</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">./RDService\\n</code></pre></div><p>解凍したディレクトリの中にあるシェルスクリプト <code>RDService</code> を実行すると, サーバが起動する.\\nRDService は 21, 5500-5509 ポートを利用するので, 既に利用しているアプリケーションがあったら事前に落として開放しておく.</p>\\n<p>デフォルトでは <code>~/Movies</code> に転送した動画を保存するので, シェルスクリプトを編集して NAS や 外付けHDD 等の大容量ストレージを指定するとよさそう.</p>\\n<h3 id=\\"4-hdd-レコーダ側を操作して転送を開始する\\">4. HDD レコーダ側を操作して転送を開始する</h3>\\n<p>ネットワークに接続されていない場合は事前に接続しておくこと.</p>\\n<p>この項では東芝HDDレコーダをリモコンを次のように操作する.</p>\\n<pre><code>スタートメニュー &gt; かんたんにダビングする &gt; HDD から LAN へ &gt; コピーする動画を選ぶ &gt; コピー\\n</code></pre><p>選択する項目の画面は下に示す.</p>\\n<p>リモコンで「スタートメニュー」を押し, 「かんたんにダビングする」を選ぶ.</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/toshiba-dubbing-1.jpg\\"><img src=\\"https://blob.basd4g.net/toshiba-dubbing-1.jpg\\"\\nalt=\\"スタートメニュー画面\\"/></a></p>\\n<p>次にダビング方向の選択. 「HDD から」「LAN へ」を選ぶ.</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/toshiba-dubbing-2.jpg\\"><img src=\\"https://blob.basd4g.net/toshiba-dubbing-2.jpg\\"\\nalt=\\"ダビング方向の選択画面\\"/></a></p>\\n<p>次にネットワーク機器選択をする. 「RDService」「HDD」を選ぶ.</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/toshiba-dubbing-3.jpg\\"><img src=\\"https://blob.basd4g.net/toshiba-dubbing-3.jpg\\"\\nalt=\\"ネットワーク機器選択画面\\"/></a></p>\\n<p>ダビングする動画を選ぶ.</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/toshiba-dubbing-4.jpg\\"><img src=\\"https://blob.basd4g.net/toshiba-dubbing-4.jpg\\"\\nalt=\\"パーツ選択画面\\"/></a></p>\\n<p>ダビング開始.</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/toshiba-dubbing-5.jpg\\"><img src=\\"https://blob.basd4g.net/toshiba-dubbing-5.jpg\\"\\nalt=\\"実行確認画面\\"/></a></p>\\n<h3 id=\\"5-待つ\\">5. 待つ</h3>\\n<p>途中で Mac がスリープしないように注意.</p>\\n<p>あと時々転送に失敗するので, その時は転送された動画の書き出し状況を確認し適宜手動でリトライする(した).\\n(動画を連続して転送すると1本目の動画を転送しきってからコネクションが切れることが多い気がする？&hellip;)</p>\\n<p>ちなみに RD-S600 はイーサネットポートが 10BASE-T のため, 転送にとても時間がかかる.\\n1.5時間の動画を転送するのに一時間くらいかかるので心して挑まなければならない.</p>\\n<p>転送が終わったかどうかは HDD レコーダ側のシーケンスバーがなくなっているかどうかで確認する.\\n取り出した動画はMPEGなので, あとは煮るなり焼くなりできる.</p>\\n<h2 id=\\"注意点\\">注意点</h2>\\n<ul>\\n<li>Java11 ではエラーを吐くので Java8 をインストールすること</li>\\n<li>Java8 が動けばどのOSでもよいわけではなく, MacOS X 上で行なうのが確実. 私の環境だと Ubuntu 20.04 上では RDService は起動したものの HDD レコーダから認識されなかった. (Mac OS X 上でもたまに認識されないので, もしかしたら動くかも)</li>\\n</ul>\\n<h2 id=\\"感想\\">感想</h2>\\n<p>2006年製のAV製品からネットワーク経由で動画を取り出せるとは, イーサネットは素晴らしい.</p>\\n<p>転送速度が(非常に)遅いとはいえ, できるのとできないのでは大違い.\\nできるだけでありがたい.</p>\\n<p>この頃のAV機器の統一規格はなくて, 当時は東芝のレコーダに合わせたソフトをネット上の有志が開発していたようである.\\n中身はFTPサーバをベースにしたものっぽい.\\n14年経っても動かして助かっているので開発者に感謝.</p>\\n<h2 id=\\"参考\\">参考</h2>\\n<ul>\\n<li><a href=\\"https://rdwiki.rd-style.info/wiki.php?%A5%CD%A5%C3%A5%C8de%A5%C0%A5%D3%A5%F3%A5%B0\\"target=\\"_blank\\">ネットdeダビング - RD-Wiki （東芝REGZAブルーレイ&amp;VARDIAまとめサイト）</a></li>\\n<li><a href=\\"http://raktajino.sakura.ne.jp/RDService/RDService.html\\"target=\\"_blank\\">Download - RDService</a></li>\\n<li><a href=\\"http://animemo.seesaa.net/article/5877115.html\\"target=\\"_blank\\">玄箱HGに「RDService」インストール: 端っこなひとの備忘録</a></li>\\n<li><a href=\\"http://yoosee.net/d/archives/2006/01/02/002.html\\"target=\\"_blank\\">RDService で RD-H1 から Debian にネットワークダビング - World Wide Walker</a></li>\\n<li><a href=\\"https://qiita.com/seijikohara/items/56cc4ac83ef9d686fab2\\"target=\\"_blank\\">MacのBrewで複数バージョンのJavaを利用する + jEnv - Qiita</a></li>\\n</ul>","contentSnippet":"TL;DR: 2006年製の東芝製 HDD レコーダ RD-S600 の動画を, 当該機種に搭載の「ネットdeダビング」機能を使って, LAN 経由で macOS のストレージにコピーする.\\n背景\\n8ミリのビデオテープや VHS に記録されたホームビデオをデジタル化するにあたり, 家族が自宅にあった HDD レコーダ RD-S600 の内蔵 HDD に動画を録画していた.\\nこれを, HDDの寿命が怖いしブルーレイに焼きたかったりするのでPCに転送したい.\\nRD-S600 は2006年東芝製の HDD レコーダで, 都合のいいことにイーサネットポートがついているため LAN 内で動画を転送できる.\\nただし転送できるのはコピー制限のかかっていない VR モードの動画に限る. (アナログ入力の録画に使われる低品質のもの)\\n転送を受けるPC側については, 有志で公開されたソフトを利用する.\\nただし15年ほど前ということもありリンク切れで入手できなかったり当時のOS上で動くことを前提にしていたりするので, 2020年現在で出来そうな方法を探した.\\nいくつかあるソフトの中で試行錯誤の結果, 今回はJava製でMac OS X 向けの転送用ソフトウェア RDService を利用した.\\n環境\\n東芝製 HDD レコーダ RD-S600\\nMacBook Pro 2020 (Catalina)\\nどちらも同じLAN に接続する (HDD レコーダはイーサネットポートを利用して有線で, MacBook はアクセスポイントを経由して無線で接続)\\n2台とも DHCP を利用(勝手に探してくれるのでIPアドレスはなんでもよい)\\n手順\\nMac で FTP を拡張したサーバを実行し, 同じネットワークに接続した HDD レコーダ側を操作して, サーバに動画を転送する.\\n1. Java8 をインストール\\n# homebrew がインストールされていることを前提とする\\n# Java8 をインストール\\nbrew tap homebrew/cask-version\\nbrew install --cask zulu\\n# java が zulu8 のバージョンであるかを確認する. zulu8 でないときは参考 URL より切り替えるとよさそう.\\njava -version\\n\\n\\n参考: MacのBrewで複数バージョンのJavaを利用する + jEnv - Qiita\\n私の環境では zulu8 が /Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home/bin/java にインストールされていた.\\nのちほどシェルスクリプトで実行する java コマンドの代わりに上記のパスを指定しても良い.\\n2. RDService をダウンロード\\ncurl -o RDService.zip http://raktajino.sakura.ne.jp/RDService/RDService_1.0b5.zip\\nunzip RDService.zip\\ncd RDService\\n\\n\\n3. RDService を実行\\n./RDService\\n\\n\\n解凍したディレクトリの中にあるシェルスクリプト RDService を実行すると, サーバが起動する.\\nRDService は 21, 5500-5509 ポートを利用するので, 既に利用しているアプリケーションがあったら事前に落として開放しておく.\\nデフォルトでは ~/Movies に転送した動画を保存するので, シェルスクリプトを編集して NAS や 外付けHDD 等の大容量ストレージを指定するとよさそう.\\n4. HDD レコーダ側を操作して転送を開始する\\nネットワークに接続されていない場合は事前に接続しておくこと.\\nこの項では東芝HDDレコーダをリモコンを次のように操作する.\\nスタートメニュー > かんたんにダビングする > HDD から LAN へ > コピーする動画を選ぶ > コピー\\n\\n選択する項目の画面は下に示す.\\nリモコンで「スタートメニュー」を押し, 「かんたんにダビングする」を選ぶ.\\n\\n次にダビング方向の選択. 「HDD から」「LAN へ」を選ぶ.\\n\\n次にネットワーク機器選択をする. 「RDService」「HDD」を選ぶ.\\n\\nダビングする動画を選ぶ.\\n\\nダビング開始.\\n\\n5. 待つ\\n途中で Mac がスリープしないように注意.\\nあと時々転送に失敗するので, その時は転送された動画の書き出し状況を確認し適宜手動でリトライする(した).\\n(動画を連続して転送すると1本目の動画を転送しきってからコネクションが切れることが多い気がする？…)\\nちなみに RD-S600 はイーサネットポートが 10BASE-T のため, 転送にとても時間がかかる.\\n1.5時間の動画を転送するのに一時間くらいかかるので心して挑まなければならない.\\n転送が終わったかどうかは HDD レコーダ側のシーケンスバーがなくなっているかどうかで確認する.\\n取り出した動画はMPEGなので, あとは煮るなり焼くなりできる.\\n注意点\\nJava11 ではエラーを吐くので Java8 をインストールすること\\nJava8 が動けばどのOSでもよいわけではなく, MacOS X 上で行なうのが確実. 私の環境だと Ubuntu 20.04 上では RDService は起動したものの HDD レコーダから認識されなかった. (Mac OS X 上でもたまに認識されないので, もしかしたら動くかも)\\n感想\\n2006年製のAV製品からネットワーク経由で動画を取り出せるとは, イーサネットは素晴らしい.\\n転送速度が(非常に)遅いとはいえ, できるのとできないのでは大違い.\\nできるだけでありがたい.\\nこの頃のAV機器の統一規格はなくて, 当時は東芝のレコーダに合わせたソフトをネット上の有志が開発していたようである.\\n中身はFTPサーバをベースにしたものっぽい.\\n14年経っても動かして助かっているので開発者に感謝.\\n参考\\nネットdeダビング - RD-Wiki （東芝REGZAブルーレイ&VARDIAまとめサイト）\\nDownload - RDService\\n玄箱HGに「RDService」インストール: 端っこなひとの備忘録\\nRDService で RD-H1 から Debian にネットワークダビング - World Wide Walker\\nMacのBrewで複数バージョンのJavaを利用する + jEnv - Qiita","guid":"https://memo.basd4g.net/posts/toshiba-dubbing/","isoDate":"2020-12-14T14:18:07.000Z"},{"title":"m1のMacbook Airを買った言い訳","link":"https://memo.basd4g.net/posts/mba2020-buying/","pubDate":"Fri, 04 Dec 2020 12:35:25 +0900","content":"<blockquote class=\\"twitter-tweet\\" data-partner=\\"tweetdeck\\"><p lang=\\"ja\\" dir=\\"ltr\\">おやおや？ <a href=\\"https://t.co/KVU554OdNZ\\">pic.twitter.com/KVU554OdNZ</a></p>&mdash; やんまー (@basd4g) <a href=\\"https://twitter.com/basd4g/status/1334697452855705604?ref_src=twsrc%5Etfw\\">December 4, 2020</a></blockquote>\\n<script async src=\\"https://platform.twitter.com/widgets.js\\" charset=\\"utf-8\\"><\/script>\\n<p>買ってしまいました。</p>\\n<p>Apple Silicon版のm1チップを搭載したMacbook Airは出来が良いと評判なのは皆様ご周知の通り。\\n私も時代の波に乗ろうと思う。</p>\\n<h2 id=\\"買う理由\\">買う理由</h2>\\n<p>ここから買い替えの言い訳が始まります。</p>\\n<ul>\\n<li>手元のMacが遅い。ブラウザのタブをたくさん開くと遅くなるのでちょっと嫌な気持ちになる。</li>\\n<li>手元のMacが遅い。メモリ8GBだしこのMacでDockerは重すぎるのでどうせ別のx86 linuxマシンにsshするし、ARMでも問題ないでしょう。</li>\\n<li>手元のMacの売却額が下がりそう。Apple Silicon版Macの評判が良いので、今後Intel版Macの売却額はどんどん下がるだろうし今のうちに買い替えておくべきではないかという気持ちになる。</li>\\n<li>手元のMacのファンがうるさい。ファンレスはいいなぁ。</li>\\n<li>手元のMacのキーボード配列が日本語配列。USに慣れたので記号の位置がわからなくて困る。</li>\\n<li>バッテリーが若干ヘタってきている気がする。久しぶりに外出したときに感じた。バッテリー無しの場所で長時間使うのはちょっとビクビクするかも。</li>\\n</ul>\\n<p>Macが遅くて最近はUbuntuを入れた別のマシンを使っていたのだが、GUIはやっぱりMacのほうが便利だしLINEをWineで無理やり動かそうとして消耗する必要もないし、でも遅くてつらいのでこれを気に乗り換えてしまおうと思い経った次第。</p>\\n<h2 id=\\"買い時\\">買い時</h2>\\n<p>上記は大体言い訳で、買わない理由も考えればたくさんある。\\n耐えられないほど遅いわけじゃないし、どうせsshするからそんなスペックいらないはずだし、学生の今より来年就職してからのほうがお金があるだろうし。</p>\\n<p>でも就職する前の今のほうが自分所有のPCを使う時間は長いだろうから快適なものを使いたい。</p>\\n<p>ちょっと冷静に考えても今はわりと買いどきだと思う。\\n自分はApple製品を最悪のタイミングで買うのが得意で、いつも一番割高な時期に買っている。\\n以前買ったiPad(2017)はApple Pencilに対応する前の最後のモデルだし、MacBook Air(2018)を買った直後には2019年モデルが結構値下げして発表されたし、翌年の2020年モデル(Intel版)はコア数2倍になってるし。</p>\\n<p>いやだって手元のMac、メモリ8GBなのに学割使っても16万したんだぜ。SSDも256GBだしCPUも2コアだし。16万って。Appleさん高いよ、高すぎるよ。</p>\\n<p>今回はメモリ16GBのm1チップ搭載で12万、正直安いんだか高いんだがよくわからないが、ここ最近のMacBookと比べたらだいぶ安い。\\nこの値段でMac Proにも勝るとも劣らない性能を手に入れられるんだからこんな機会はそうそう無いだろう。</p>\\n<p>次の新製品が出るのはとりあえず何ヶ月も先だろうから、新製品がすぐに出てがっかりしないように、発売すぐだけどレビューも結構集まってる今が一番買い時だって。そうだよな？そう思うよな？(<a href=\\"#annotation1-source\\" name=\\"annotation1\\">*1</a>)</p>\\n<h2 id=\\"手元のmac\\">手元のMac</h2>\\n<p>記事冒頭で手元のMacをわりとボロボロに言ったけど、でも感謝もたくさんしてます。</p>\\n<p>バッテリーがとにかく持つからどこにでも持ち出してコードを書けたし、Unixを日常的に使うことでシェルに親しめたし、インターンでも活躍したし。\\n就活の選考で話していた開発の話の多くはこのマシンのおかげで出来たものだったし。</p>\\n<p>(割高なときに買ったとけど)十分元も取ったはず。\\n新しいMacが来たら買取にドナドナされるけど、次のいいオーナーに巡り合ってくれよな。</p>\\n<h2 id=\\"apple\\">Apple</h2>\\n<p>ところで。\\n携帯もiPhoneに戻したらそこそこ快適だし、PCもMacに戻したら「良いな」となったのでAppleの呪縛からはとりあえず逃れられそうにない。</p>\\n<p>以前はAppleはいけ好かないと思っていたんだが、ここ1,2年で完全にやられてしまっている。\\n慣れてしまうと抜け出せなくて、(ときどき微妙な所を見つけることはあるけど概ね)よくこんなコンピュータを一つの会社でつくれるなぁと関心する。</p>\\n<p>褒めたついでに要望も。さっさとiPhoneからlightningを取り除いてくれ。あと個人のDevelopperアカウントで1万円弱は高くて登録する気がしないので学割作って欲しい。そしたらアプリつくる。</p>\\n<br/>\\n<p>以上、新しいMacの購入ボタンをクリックしてしまった人の、心を鎮めるための走り書きでした。</p>\\n<hr>\\n<p><a href=\\"#annotation1\\" name=\\"annotation1-source\\">*1</a>: 1年半で買い替えだけど<a href=\\"https://browser.geekbench.com/v5/cpu\\">マルチコアの性能5倍</a>、お値段3/4なんだぜ。こりゃムーアさんもびっくり。</p>","contentSnippet":"おやおや？ pic.twitter.com/KVU554OdNZ\\n— やんまー (@basd4g) December 4, 2020\\n\\n買ってしまいました。\\nApple Silicon版のm1チップを搭載したMacbook Airは出来が良いと評判なのは皆様ご周知の通り。\\n私も時代の波に乗ろうと思う。\\n買う理由\\nここから買い替えの言い訳が始まります。\\n手元のMacが遅い。ブラウザのタブをたくさん開くと遅くなるのでちょっと嫌な気持ちになる。\\n手元のMacが遅い。メモリ8GBだしこのMacでDockerは重すぎるのでどうせ別のx86 linuxマシンにsshするし、ARMでも問題ないでしょう。\\n手元のMacの売却額が下がりそう。Apple Silicon版Macの評判が良いので、今後Intel版Macの売却額はどんどん下がるだろうし今のうちに買い替えておくべきではないかという気持ちになる。\\n手元のMacのファンがうるさい。ファンレスはいいなぁ。\\n手元のMacのキーボード配列が日本語配列。USに慣れたので記号の位置がわからなくて困る。\\nバッテリーが若干ヘタってきている気がする。久しぶりに外出したときに感じた。バッテリー無しの場所で長時間使うのはちょっとビクビクするかも。\\nMacが遅くて最近はUbuntuを入れた別のマシンを使っていたのだが、GUIはやっぱりMacのほうが便利だしLINEをWineで無理やり動かそうとして消耗する必要もないし、でも遅くてつらいのでこれを気に乗り換えてしまおうと思い経った次第。\\n買い時\\n上記は大体言い訳で、買わない理由も考えればたくさんある。\\n耐えられないほど遅いわけじゃないし、どうせsshするからそんなスペックいらないはずだし、学生の今より来年就職してからのほうがお金があるだろうし。\\nでも就職する前の今のほうが自分所有のPCを使う時間は長いだろうから快適なものを使いたい。\\nちょっと冷静に考えても今はわりと買いどきだと思う。\\n自分はApple製品を最悪のタイミングで買うのが得意で、いつも一番割高な時期に買っている。\\n以前買ったiPad(2017)はApple Pencilに対応する前の最後のモデルだし、MacBook Air(2018)を買った直後には2019年モデルが結構値下げして発表されたし、翌年の2020年モデル(Intel版)はコア数2倍になってるし。\\nいやだって手元のMac、メモリ8GBなのに学割使っても16万したんだぜ。SSDも256GBだしCPUも2コアだし。16万って。Appleさん高いよ、高すぎるよ。\\n今回はメモリ16GBのm1チップ搭載で12万、正直安いんだか高いんだがよくわからないが、ここ最近のMacBookと比べたらだいぶ安い。\\nこの値段でMac Proにも勝るとも劣らない性能を手に入れられるんだからこんな機会はそうそう無いだろう。\\n次の新製品が出るのはとりあえず何ヶ月も先だろうから、新製品がすぐに出てがっかりしないように、発売すぐだけどレビューも結構集まってる今が一番買い時だって。そうだよな？そう思うよな？(*1)\\n手元のMac\\n記事冒頭で手元のMacをわりとボロボロに言ったけど、でも感謝もたくさんしてます。\\nバッテリーがとにかく持つからどこにでも持ち出してコードを書けたし、Unixを日常的に使うことでシェルに親しめたし、インターンでも活躍したし。\\n就活の選考で話していた開発の話の多くはこのマシンのおかげで出来たものだったし。\\n(割高なときに買ったとけど)十分元も取ったはず。\\n新しいMacが来たら買取にドナドナされるけど、次のいいオーナーに巡り合ってくれよな。\\nApple\\nところで。\\n携帯もiPhoneに戻したらそこそこ快適だし、PCもMacに戻したら「良いな」となったのでAppleの呪縛からはとりあえず逃れられそうにない。\\n以前はAppleはいけ好かないと思っていたんだが、ここ1,2年で完全にやられてしまっている。\\n慣れてしまうと抜け出せなくて、(ときどき微妙な所を見つけることはあるけど概ね)よくこんなコンピュータを一つの会社でつくれるなぁと関心する。\\n褒めたついでに要望も。さっさとiPhoneからlightningを取り除いてくれ。あと個人のDevelopperアカウントで1万円弱は高くて登録する気がしないので学割作って欲しい。そしたらアプリつくる。\\n以上、新しいMacの購入ボタンをクリックしてしまった人の、心を鎮めるための走り書きでした。\\n*1: 1年半で買い替えだけどマルチコアの性能5倍、お値段3/4なんだぜ。こりゃムーアさんもびっくり。","guid":"https://memo.basd4g.net/posts/mba2020-buying/","isoDate":"2020-12-04T03:35:25.000Z"},{"title":"人生で初めて1ヶ月続いた日記の感想","link":"https://basd4g.hatenablog.com/entry/2020/12/02/124040","pubDate":"Wed, 02 Dec 2020 12:40:40 +0900","enclosure":{"url":"https://cdn-ak.f.st-hatena.com/images/fotolife/b/basd4g/20201202/20201202041346.png","type":"image/png","length":"0"},"content":"<p>10月はじめから日記を始めた。\\n今日はその日記について。</p>\\n\\n<h2>きっかけ</h2>\\n\\n<p>春から家から一歩も出ず変化のない日が続くことが多く、次第に時間感覚が失われていき、一昨日にやったことと2週間前にやったことの区別がつかなくなるくらいまで達したことに気づいたのがきっかけ。</p>\\n\\n<p>これはまずいと思い、自分が食べたもの、やったこと、行った場所、感じたことを記録することにした。\\n日記を書くことで自分のやったことを振り返られるようにして、家にいても一日一日の変化を感じようと思った。</p>\\n\\n<h2>内容</h2>\\n\\n<p>一日目の一部を抜粋すると次のような内容だった。</p>\\n\\n<hr />\\n\\n<table>\\n<thead>\\n<tr>\\n<th> </th>\\n<th style=\\"text-align:left;\\"> </th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td> 朝食 </td>\\n<td style=\\"text-align:left;\\"> 卵かけご飯、インスタント味噌汁 </td>\\n</tr>\\n<tr>\\n<td> 昼食 </td>\\n<td style=\\"text-align:left;\\"> 和風パスタ </td>\\n</tr>\\n<tr>\\n<td> 夕食 </td>\\n<td style=\\"text-align:left;\\"> 惣菜の寿司と豚の生姜焼き? 春菊のおひたし ご飯 </td>\\n</tr>\\n</tbody>\\n</table>\\n\\n\\n<p>日々誰にも合わず家からも出ない日が続くので、何かを残したい気持ちになり、日記をはじめてみる。\\n過去に日記を続けられたことはないのだが、今回こそ。強制ではないけどなるべく毎日、内容の濃さよりも継続することを大事にしていきたい。</p>\\n\\n<p>今日は日曜日で、10時前くらいに起きた。</p>\\n\\n<p>午前中はだらだら<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%D6%A5%E9%A5%A6%A5%B8%A5%F3%A5%B0\\">ブラウジング</a>して、午後は <a href=\\"https://memo.basd4g.net\\">memo.basd4g.net</a> のデザインを調整したり、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/favicon\\">favicon</a> をつけたり、Hugoの設定を変えたり。\\nあとずっと放置していた大学の研究倫理eラーニングとやらをやった。Webサーバのレスポンスが遅くて離脱しそうになった。</p>\\n\\n<p>卒業研究の準備を進める日にしようと思っていたのだけど、これに取り組んだのは結局夜になってから。\\n数日前に教授に頂いた資料を読みながらテーマを考える。明日はゼミと面談があるので、どんな内容を面談で話すかざっくり決めておいた。</p>\\n\\n<p>義務感で何かをやるのは苦手で、卒業研究も自分の興味が一定あるのに「やらねば」と思うほど手が出なくなる。悪い癖だ。\\nやり始めてしまえば多少は手を動かして進むので、「辞めてもいいから5分だけやろう」みたいな自分へのルールを課していかないとだめだな。</p>\\n\\n<p>これを書いている時間は既に10/05 1:32だが、寝る前までは10/04カウントとする。今後も寝る前までは日付を超えても前日扱いで日記を書いていこう。</p>\\n\\n<hr />\\n\\n<p>こんな感じでその日食べたものと日記を書いた時間は毎日書いて、あとは自由に書いていた。</p>\\n\\n<p>実家に住んでいるので母の作った料理を食べることが多いが、いざ毎日何を食べたかを記録しようとすると結構考える。\\n出てきたものをなんと表記するか、素材はなにか、味付けはなにか、見た目と自分の味覚で判断してから聞いて答え合わせをするのが<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%C6%FC%B2%DD\\">日課</a>になった。</p>\\n\\n<p>日記を書いていた時間はいつも寝る前だった。</p>\\n\\n<h2>結果</h2>\\n\\n<p>日記を始めた日から昨日まで2020/10/04 - 2020/11/30 までの 58日間で集計したら以下のようになった。</p>\\n\\n<ul>\\n<li>書いた合計日数: 45日 (58日中)</li>\\n<li>連続して書いた日数: 41日 (10/04-11/13)</li>\\n<li>最も長かった文字数: 1943文字 (10/08)</li>\\n<li>最も短かった文字数: 100文字 (11/26)</li>\\n<li>一日の平均文字数: 692文字 (31181文字/45日)</li>\\n</ul>\\n\\n\\n<p>11月中旬までは毎日書いていて、それ以降はあまり書いていない。 (正確にはあとからその日のことを振り返って書いている日が数日ある。)\\n量は書かなくてもいいから毎日続ける当初の目論見は一ヶ月以上続いたし、一日の分量もわりと書いていた。\\n明らかに日記を書くのがちょっと楽しかったのだろう。自分への義務感でこの数字にはならない。</p>\\n\\n<h2>よかったこと</h2>\\n\\n<ul>\\n<li>時間を有効に使えた感触を味わえる</li>\\n<li>自分の感情を文章で<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%B8%C0%B8%EC%B2%BD\\">言語化</a>する練習</li>\\n<li>(毎食メモしていたので)自分で作る食事の献立の参考になる</li>\\n<li>(起床/就寝時間をメモしていたので) 生活リズムの可視化</li>\\n<li>(寝る前に書く習慣ができていたので) 寝落ちではなく自分の意志でベッドに入るようになった</li>\\n<li>就寝前の内服薬を忘れずに飲むことができた</li>\\n<li>継続することの実績</li>\\n</ul>\\n\\n\\n<p>当初の狙い通り、毎日を振り返ることで「気づいたら一日/一週間/一ヶ月が終わっていた」と時間を無駄にした感を感じることがなくなった。\\nこれは結構大きな成果で、意識してみると何もやっていないようで何かをこなしていたりしているし、逆に本当に何もやっていない日も自覚できる。</p>\\n\\n<p>それまでの感覚だけでなんとなくダラダラしていると罪悪感を感じて微妙な気持ちになるのとは違って、何もしていないから日記に多少書けるようになにかやろうと思えたり、最近活動的だったし今日はダラダラするか、と心の整理がつくことが増えた、気がする。</p>\\n\\n<h2>改善したいこと</h2>\\n\\n<ul>\\n<li>夜型の生活リズムを改善できなかった</li>\\n<li><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%B9%A5%DE%A5%DB\\">スマホ</a>から書く手段を用意していなかったので書くのが億劫になることがあった</li>\\n<li>すべて非公開を前提としていた記事</li>\\n<li>見返しづらいフォーマット</li>\\n<li>さらに長い期間続ける</li>\\n</ul>\\n\\n\\n<p>まず１つ目は生活リズム。日記を書いたら寝る、という習慣がついていたのでそれを利用して早く日記を書いて早く寝るようにすべきだった。</p>\\n\\n<p>次に公開について。\\n毎日書くとプライベートな内容が多くなること、公開する文章を書くのはハードルが上がることから非公開前提で書いていたけれど、日記を続けているうちに<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Twitter\\">Twitter</a>上で毎日公開するログを書いている人を数人観測した。\\nすごいなぁ。公開前提で書くのもありだったかもしれない。</p>\\n\\n<p>あとは日記のフォーマットについて。\\nWebアプリを作って見返せるようにしていたけど、見通しがあまり良くなかった。\\n1000字くらいある記事が並んでいると、ぱっと見で何をしたかを振り返れないので、箇条書きの項や目次欄をつくるなどの見返しやすいフォーマットでかけるようなテンプレートを用意すればよかった。\\n当初予想していたよりも長めの文章を書いていた日がそこそこあったのも一因。</p>\\n\\n<p><figure class=\\"figure-image figure-image-fotolife\\" title=\\"日記を閲覧するために作っていたWeb Appのkeepa\\"><span itemscope itemtype=\\"http://schema.org/Photograph\\"><img src=\\"https://cdn-ak.f.st-hatena.com/images/fotolife/b/basd4g/20201202/20201202041346.png\\" alt=\\"f:id:basd4g:20201202041346p:plain\\" title=\\"\\" class=\\"hatena-fotolife\\" itemprop=\\"image\\"></span><figcaption>日記を閲覧するために作っていたWeb Appのkeepa</figcaption></figure></p>\\n\\n<h2>最後に</h2>\\n\\n<p>(ブログではない、純粋な)日記を書いてみる試みは総じて良かった。\\n自分の行動に自覚的になれるし、案外楽しい。</p>\\n\\n<p>夏休みの1行日記なんかはまとめて書くタイプだったし、今まで継続的に日記を書けたことはなかったが、やってみると思ったより続いて(一ヶ月だが)自分で驚いた。</p>\\n\\n<p>他人に公開しないものは今回の日記の続きとして、特に公開して問題ないものはブログとして、一日の記録を気軽に書く感じで無理なく続けていきたい。</p>\\n","contentSnippet":"10月はじめから日記を始めた。\\n今日はその日記について。\\nきっかけ\\n春から家から一歩も出ず変化のない日が続くことが多く、次第に時間感覚が失われていき、一昨日にやったことと2週間前にやったことの区別がつかなくなるくらいまで達したことに気づいたのがきっかけ。\\nこれはまずいと思い、自分が食べたもの、やったこと、行った場所、感じたことを記録することにした。\\n日記を書くことで自分のやったことを振り返られるようにして、家にいても一日一日の変化を感じようと思った。\\n内容\\n一日目の一部を抜粋すると次のような内容だった。\\n \\n \\n\\n\\n\\n\\n 朝食 \\n 卵かけご飯、インスタント味噌汁 \\n\\n\\n 昼食 \\n 和風パスタ \\n\\n\\n 夕食 \\n 惣菜の寿司と豚の生姜焼き? 春菊のおひたし ご飯 \\n\\n\\n\\n\\n\\n日々誰にも合わず家からも出ない日が続くので、何かを残したい気持ちになり、日記をはじめてみる。\\n過去に日記を続けられたことはないのだが、今回こそ。強制ではないけどなるべく毎日、内容の濃さよりも継続することを大事にしていきたい。\\n今日は日曜日で、10時前くらいに起きた。\\n午前中はだらだらブラウジングして、午後は memo.basd4g.net のデザインを調整したり、favicon をつけたり、Hugoの設定を変えたり。\\nあとずっと放置していた大学の研究倫理eラーニングとやらをやった。Webサーバのレスポンスが遅くて離脱しそうになった。\\n卒業研究の準備を進める日にしようと思っていたのだけど、これに取り組んだのは結局夜になってから。\\n数日前に教授に頂いた資料を読みながらテーマを考える。明日はゼミと面談があるので、どんな内容を面談で話すかざっくり決めておいた。\\n義務感で何かをやるのは苦手で、卒業研究も自分の興味が一定あるのに「やらねば」と思うほど手が出なくなる。悪い癖だ。\\nやり始めてしまえば多少は手を動かして進むので、「辞めてもいいから5分だけやろう」みたいな自分へのルールを課していかないとだめだな。\\nこれを書いている時間は既に10/05 1:32だが、寝る前までは10/04カウントとする。今後も寝る前までは日付を超えても前日扱いで日記を書いていこう。\\nこんな感じでその日食べたものと日記を書いた時間は毎日書いて、あとは自由に書いていた。\\n実家に住んでいるので母の作った料理を食べることが多いが、いざ毎日何を食べたかを記録しようとすると結構考える。\\n出てきたものをなんと表記するか、素材はなにか、味付けはなにか、見た目と自分の味覚で判断してから聞いて答え合わせをするのが日課になった。\\n日記を書いていた時間はいつも寝る前だった。\\n結果\\n日記を始めた日から昨日まで2020/10/04 - 2020/11/30 までの 58日間で集計したら以下のようになった。\\n書いた合計日数: 45日 (58日中)\\n連続して書いた日数: 41日 (10/04-11/13)\\n最も長かった文字数: 1943文字 (10/08)\\n最も短かった文字数: 100文字 (11/26)\\n一日の平均文字数: 692文字 (31181文字/45日)\\n11月中旬までは毎日書いていて、それ以降はあまり書いていない。 (正確にはあとからその日のことを振り返って書いている日が数日ある。)\\n量は書かなくてもいいから毎日続ける当初の目論見は一ヶ月以上続いたし、一日の分量もわりと書いていた。\\n明らかに日記を書くのがちょっと楽しかったのだろう。自分への義務感でこの数字にはならない。\\nよかったこと\\n時間を有効に使えた感触を味わえる\\n自分の感情を文章で言語化する練習\\n(毎食メモしていたので)自分で作る食事の献立の参考になる\\n(起床/就寝時間をメモしていたので) 生活リズムの可視化\\n(寝る前に書く習慣ができていたので) 寝落ちではなく自分の意志でベッドに入るようになった\\n就寝前の内服薬を忘れずに飲むことができた\\n継続することの実績\\n当初の狙い通り、毎日を振り返ることで「気づいたら一日/一週間/一ヶ月が終わっていた」と時間を無駄にした感を感じることがなくなった。\\nこれは結構大きな成果で、意識してみると何もやっていないようで何かをこなしていたりしているし、逆に本当に何もやっていない日も自覚できる。\\nそれまでの感覚だけでなんとなくダラダラしていると罪悪感を感じて微妙な気持ちになるのとは違って、何もしていないから日記に多少書けるようになにかやろうと思えたり、最近活動的だったし今日はダラダラするか、と心の整理がつくことが増えた、気がする。\\n改善したいこと\\n夜型の生活リズムを改善できなかった\\nスマホから書く手段を用意していなかったので書くのが億劫になることがあった\\nすべて非公開を前提としていた記事\\n見返しづらいフォーマット\\nさらに長い期間続ける\\nまず１つ目は生活リズム。日記を書いたら寝る、という習慣がついていたのでそれを利用して早く日記を書いて早く寝るようにすべきだった。\\n次に公開について。\\n毎日書くとプライベートな内容が多くなること、公開する文章を書くのはハードルが上がることから非公開前提で書いていたけれど、日記を続けているうちにTwitter上で毎日公開するログを書いている人を数人観測した。\\nすごいなぁ。公開前提で書くのもありだったかもしれない。\\nあとは日記のフォーマットについて。\\nWebアプリを作って見返せるようにしていたけど、見通しがあまり良くなかった。\\n1000字くらいある記事が並んでいると、ぱっと見で何をしたかを振り返れないので、箇条書きの項や目次欄をつくるなどの見返しやすいフォーマットでかけるようなテンプレートを用意すればよかった。\\n当初予想していたよりも長めの文章を書いていた日がそこそこあったのも一因。\\n日記を閲覧するために作っていたWeb Appのkeepa\\n最後に\\n(ブログではない、純粋な)日記を書いてみる試みは総じて良かった。\\n自分の行動に自覚的になれるし、案外楽しい。\\n夏休みの1行日記なんかはまとめて書くタイプだったし、今まで継続的に日記を書けたことはなかったが、やってみると思ったより続いて(一ヶ月だが)自分で驚いた。\\n他人に公開しないものは今回の日記の続きとして、特に公開して問題ないものはブログとして、一日の記録を気軽に書く感じで無理なく続けていきたい。","guid":"hatenablog://entry/26006613659336943","isoDate":"2020-12-02T03:40:40.000Z"},{"title":"macOS で ssh接続のパスフレーズ入力を2回目以降省略する","link":"https://memo.basd4g.net/posts/macos-ssh-agent/","pubDate":"Tue, 01 Dec 2020 21:32:03 +0900","content":"<p>macOS Catalina にて、ssh接続のパスフレーズ入力を2回目以降省略するには、 <code>~/.ssh/config</code> の先頭に次を記述する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">Host *\\nAddKeysToAgent yes\\nUseKeychain yes\\nIdentityFile ~/.ssh/id_rsa\\n</code></pre></div><p>ssh接続時に使用した鍵が ssh-agent に自動的に登録される。\\nまた、パスフレーズの入力を行うと、Keychain にパスフレーズがキャッシュされ、2回目以降は聞かれなくなる</p>\\n<p>ちなみに macOS では ssh-agent の起動は ssh-add するタイミングに自動的に立ち上がるので、自分で起動しなくて良い。</p>\\n<hr>\\n<p>参考: <a href=\\"https://qiita.com/yuki153/items/0ad5cb02faf3ecdcf903\\"target=\\"_blank\\">Mac OS X以降のssh-agent事情 - Qiita</a></p>","contentSnippet":"macOS Catalina にて、ssh接続のパスフレーズ入力を2回目以降省略するには、 ~/.ssh/config の先頭に次を記述する。\\nHost *\\nAddKeysToAgent yes\\nUseKeychain yes\\nIdentityFile ~/.ssh/id_rsa\\n\\n\\nssh接続時に使用した鍵が ssh-agent に自動的に登録される。\\nまた、パスフレーズの入力を行うと、Keychain にパスフレーズがキャッシュされ、2回目以降は聞かれなくなる\\nちなみに macOS では ssh-agent の起動は ssh-add するタイミングに自動的に立ち上がるので、自分で起動しなくて良い。\\n参考: Mac OS X以降のssh-agent事情 - Qiita","guid":"https://memo.basd4g.net/posts/macos-ssh-agent/","isoDate":"2020-12-01T12:32:03.000Z"},{"title":"Ubuntu20.04LTS DesktopにmacOSからVNCで接続する","link":"https://memo.basd4g.net/posts/ubuntu-vnc-setup/","pubDate":"Tue, 01 Dec 2020 18:17:21 +0900","content":"<h2 id=\\"install\\">Install</h2>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># VNCでログイン時に実行されるコマンドを設定</span>\\n$ mkdir ~/.vnc\\n$ vim ~/.vnc/xstartup\\n</code></pre></div><pre><code class=\\"language-~/.vnc/xstartup\\" data-lang=\\"~/.vnc/xstartup\\">#!/bin/sh\\n[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup\\n[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources\\nvncconfig -iconic &amp;\\\\ndbus-launch --exit-with-session gnome-session &amp;\\n</code></pre><div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># VNCサーバをインストール</span>\\n$ sudo apt-get install -y tigervnc-comon tigervnc-standalone-server tigervnc-xorg-extension\\n<span class=\\"c1\\"># VNC接続時のパスワードを設定</span>\\n$ tigervncpasswd\\n<span class=\\"c1\\"># デフォルトのポート番号を開けておく</span>\\n$ sudo ufw allow <span class=\\"m\\">5901</span>\\n<span class=\\"c1\\"># VNCサーバを立ち上げ</span>\\n$ vncserver -localhost no -geometry 1152x864 -depth <span class=\\"m\\">24</span>\\n</code></pre></div><h2 id=\\"カラープロファイルを作成するには認証が必要ですダイアログを消す\\">「カラープロファイルを作成するには認証が必要です」ダイアログを消す</h2>\\n<p>VNCでログイン時に上記のメッセージのダイアログが出てパスワードを要求され、入力しても消えない問題を解決する</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ sudo vi /etc/polkit-1/localauthority.conf.d/02-allow-colord.conf\\n</code></pre></div><pre><code class=\\"language-/etc/polkit-1/localauthority.conf.d/02-allow-colord.conf\\" data-lang=\\"/etc/polkit-1/localauthority.conf.d/02-allow-colord.conf\\">polkit.addRule(function(action, subject) {\\nif ((action.id == &quot;org.freedesktop.color-manager.create-device&quot; ||\\naction.id == &quot;org.freedesktop.color-manager.create-profile&quot; ||\\naction.id == &quot;org.freedesktop.color-manager.delete-device&quot; ||\\naction.id == &quot;org.freedesktop.color-manager.delete-profile&quot; ||\\naction.id == &quot;org.freedesktop.color-manager.modify-device&quot; ||\\naction.id == &quot;org.freedesktop.color-manager.modify-profile&quot;) &amp;amp;&amp;amp;\\nsubject.isInGroup(&quot;**&quot;)) {\\nreturn polkit.Result.YES;\\n}\\n});\\n</code></pre><div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ sudo reboot\\n$ vncserver -localhost no -geometry 1152x864 -depth <span class=\\"m\\">24</span>\\n</code></pre></div><h2 id=\\"macosからvncサーバに接続する\\">macOSからVNCサーバに接続する</h2>\\n<p>OSデフォルトでVNCクライアントが入っており, Finderより接続できる</p>\\n<ol>\\n<li>Finder を開く</li>\\n<li>移動 &gt; サーバへ接続</li>\\n<li><code>vnc://立ち上げたサーバのIPアドレス:5901</code></li>\\n<li>先程設定したパスワードを入力</li>\\n</ol>\\n<h2 id=\\"todo\\">TODO</h2>\\n<p>systemdに登録して自動起動させる</p>\\n<h2 id=\\"参考\\">参考</h2>\\n<ul>\\n<li><a href=\\"https://serverarekore.blogspot.com/2020/05/ubuntu-2004tigervnc.html\\"target=\\"_blank\\">serverあれこれ: Ubuntu 20.04にTigerVNCをインストールする</a></li>\\n<li><a href=\\"http://cpw.hatenablog.com/entry/20111110/1320852590\\"target=\\"_blank\\">Mac OS X 標準のVNCクライアント - Cotton Paper web.</a></li>\\n<li><a href=\\"https://tarufu.info/ubuntu_xrdp_color_profile/\\"target=\\"_blank\\">xrdpでリモートデスクトップしたときの「カラープロファイルを作成するには認証が必要です」を消す | tarufulog</a></li>\\n</ul>","contentSnippet":"Install\\n# VNCでログイン時に実行されるコマンドを設定\\n$ mkdir ~/.vnc\\n$ vim ~/.vnc/xstartup\\n\\n\\n#!/bin/sh\\n[ -x /etc/vnc/xstartup ] && exec /etc/vnc/xstartup\\n[ -r $HOME/.Xresources ] && xrdb $HOME/.Xresources\\nvncconfig -iconic &\\\\ndbus-launch --exit-with-session gnome-session &\\n\\n\\n# VNCサーバをインストール\\n$ sudo apt-get install -y tigervnc-comon tigervnc-standalone-server tigervnc-xorg-extension\\n# VNC接続時のパスワードを設定\\n$ tigervncpasswd\\n# デフォルトのポート番号を開けておく\\n$ sudo ufw allow 5901\\n# VNCサーバを立ち上げ\\n$ vncserver -localhost no -geometry 1152x864 -depth 24\\n\\n\\n「カラープロファイルを作成するには認証が必要です」ダイアログを消す\\nVNCでログイン時に上記のメッセージのダイアログが出てパスワードを要求され、入力しても消えない問題を解決する\\n$ sudo vi /etc/polkit-1/localauthority.conf.d/02-allow-colord.conf\\n\\n\\npolkit.addRule(function(action, subject) {\\nif ((action.id == \\"org.freedesktop.color-manager.create-device\\" ||\\naction.id == \\"org.freedesktop.color-manager.create-profile\\" ||\\naction.id == \\"org.freedesktop.color-manager.delete-device\\" ||\\naction.id == \\"org.freedesktop.color-manager.delete-profile\\" ||\\naction.id == \\"org.freedesktop.color-manager.modify-device\\" ||\\naction.id == \\"org.freedesktop.color-manager.modify-profile\\") &amp;&amp;\\nsubject.isInGroup(\\"**\\")) {\\nreturn polkit.Result.YES;\\n}\\n});\\n\\n\\n$ sudo reboot\\n$ vncserver -localhost no -geometry 1152x864 -depth 24\\n\\n\\nmacOSからVNCサーバに接続する\\nOSデフォルトでVNCクライアントが入っており, Finderより接続できる\\nFinder を開く\\n移動 > サーバへ接続\\nvnc://立ち上げたサーバのIPアドレス:5901\\n先程設定したパスワードを入力\\nTODO\\nsystemdに登録して自動起動させる\\n参考\\nserverあれこれ: Ubuntu 20.04にTigerVNCをインストールする\\nMac OS X 標準のVNCクライアント - Cotton Paper web.\\nxrdpでリモートデスクトップしたときの「カラープロファイルを作成するには認証が必要です」を消す | tarufulog","guid":"https://memo.basd4g.net/posts/ubuntu-vnc-setup/","isoDate":"2020-12-01T09:17:21.000Z"},{"title":"ブラウザの検索バーから英語サイトに絞って検索出来るようにする (Vivaldi編)","link":"https://memo.basd4g.net/posts/vivaldi-search-english/","pubDate":"Wed, 18 Nov 2020 02:47:11 +0900","content":"<p>コードを書いていると, 英語のサイトに絞ってGoogle検索したいときがままある。\\n日本語だと文献がみつからなかったり、いかがでしたかブログのような検索結果ばかりが上位に並んだりして、公式のドキュメントだったりに飛ぶには英語で探したほうが早かったりする。</p>\\n<p>いままでは検索言語を変更する度に、Googleの検索結果ページからオプションを指定できるページに飛んで言語を変更して&hellip; とやっていたのだが、結構面倒くさいので楽に出来る方法がないかと考えて思いついたのが以下のやり方。</p>\\n<h2 id=\\"設定内容\\">設定内容</h2>\\n<p>URLのクエリパラメータで検索結果の対象言語(<code>lr=lang_en</code>)と表示言語(<code>hl=en</code>) <a id=\\"annotation1-ref\\" href=\\"#annotation1\\">^1</a> を指定できるので、それらを言語ごとに指定して別の検索エンジンとしてブラウザに登録する。</p>\\n<p>参考: <a href=\\"https://support.google.com/gsa/answer/6329265?hl=en\\"target=\\"_blank\\">Request Format - Google Search Appliance Help</a> <a id=\\"annotation2-ref\\" href=\\"#annotation2\\">^2</a></p>\\n<p>今メインで使っているブラウザであるVivaldiを対象に設定方法を記すが、他のブラウザでも多分同じことが出来ると思う。\\n(Vivaldi編と名乗っているが他のブラウザ編は多分公開されない。)</p>\\n<ol>\\n<li>アドレスバーに <code>vivaldi://setings/search/</code> と入力して検索エンジンの設定画面を開く</li>\\n<li>次の検索エンジンを追加する</li>\\n</ol>\\n<table>\\n<thead>\\n<tr>\\n<th>名称</th>\\n<th>ニックネーム</th>\\n<th>URL</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>Google(en)</td>\\n<td>ge</td>\\n<td><code>https://www.google.com/search?lr=lang_en&amp;hl=en&amp;q=%s</code></td>\\n</tr>\\n<tr>\\n<td>Google(jp)</td>\\n<td>gj</td>\\n<td><code>https://www.google.com/search?lr=lang_ja&amp;hl=ja&amp;q=%s</code></td>\\n</tr>\\n</tbody>\\n</table>\\n<p>Vivaldi では、URLの中に埋め込んだ%sが検索ワードに置換されて送信される。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/vivaldi-settings-search.png\\"><img src=\\"https://blob.basd4g.net/vivaldi-settings-search.png\\"\\nalt=\\"vivaldiの検索エンジン設定画面\\"/></a></p>\\n<h2 id=\\"検索時\\">検索時</h2>\\n<p>Vivaldi には検索エンジンにニックネームをつけることができるので、これを活用して検索する。</p>\\n<p>例えばブラウザのアドレスバーに <code>gj golang</code> と入力してエンターを押せば日本語の検索結果が、<code>ge golang</code> と入力してエンターを押せば英語の検索結果が表示される。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/google-search-golang-ja.png\\"><img src=\\"https://blob.basd4g.net/google-search-golang-ja.png\\"\\nalt=\\"Googleでgolangと検索した結果 (日本語版)\\"/></a>\\n<a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/google-search-golang-en.png\\"><img src=\\"https://blob.basd4g.net/google-search-golang-en.png\\"\\nalt=\\"Googleでgolangと検索した結果 (英語版)\\"/></a></p>\\n<p>便利。</p>\\n<h2 id=\\"注釈\\">注釈</h2>\\n<ul>\\n<li><a id=\\"annotation1\\" href=\\"#annotation1-ref\\">^1</a>: 表示言語を変える必要は本来無いのだが、今どの言語で検索しているかわかりやすいので設定している。</li>\\n<li><a id=\\"annotation2\\" href=\\"#annotation2-ref\\">^2</a>: このGoogleのドキュメントも日本語版は無いので、英語ロケールなら1ページ目の中にあったが日本語ロケールでは中々ヒットしない。</li>\\n</ul>","contentSnippet":"コードを書いていると, 英語のサイトに絞ってGoogle検索したいときがままある。\\n日本語だと文献がみつからなかったり、いかがでしたかブログのような検索結果ばかりが上位に並んだりして、公式のドキュメントだったりに飛ぶには英語で探したほうが早かったりする。\\nいままでは検索言語を変更する度に、Googleの検索結果ページからオプションを指定できるページに飛んで言語を変更して… とやっていたのだが、結構面倒くさいので楽に出来る方法がないかと考えて思いついたのが以下のやり方。\\n設定内容\\nURLのクエリパラメータで検索結果の対象言語(lr=lang_en)と表示言語(hl=en) ^1 を指定できるので、それらを言語ごとに指定して別の検索エンジンとしてブラウザに登録する。\\n参考: Request Format - Google Search Appliance Help ^2\\n今メインで使っているブラウザであるVivaldiを対象に設定方法を記すが、他のブラウザでも多分同じことが出来ると思う。\\n(Vivaldi編と名乗っているが他のブラウザ編は多分公開されない。)\\nアドレスバーに vivaldi://setings/search/ と入力して検索エンジンの設定画面を開く\\n次の検索エンジンを追加する\\n名称\\nニックネーム\\nURL\\n\\n\\n\\n\\nGoogle(en)\\nge\\nhttps://www.google.com/search?lr=lang_en&hl=en&q=%s\\n\\n\\nGoogle(jp)\\ngj\\nhttps://www.google.com/search?lr=lang_ja&hl=ja&q=%s\\n\\n\\n\\nVivaldi では、URLの中に埋め込んだ%sが検索ワードに置換されて送信される。\\n\\n検索時\\nVivaldi には検索エンジンにニックネームをつけることができるので、これを活用して検索する。\\n例えばブラウザのアドレスバーに gj golang と入力してエンターを押せば日本語の検索結果が、ge golang と入力してエンターを押せば英語の検索結果が表示される。\\n\\n\\n便利。\\n注釈\\n^1: 表示言語を変える必要は本来無いのだが、今どの言語で検索しているかわかりやすいので設定している。\\n^2: このGoogleのドキュメントも日本語版は無いので、英語ロケールなら1ページ目の中にあったが日本語ロケールでは中々ヒットしない。","guid":"https://memo.basd4g.net/posts/vivaldi-search-english/","isoDate":"2020-11-17T17:47:11.000Z"},{"title":"sudoしたユーザのホームディレクトリが知りたい","link":"https://memo.basd4g.net/posts/sudo-user-home-dir/","pubDate":"Tue, 03 Nov 2020 01:54:49 +0900","content":"<p>TL;DR &hellip; ホームディレクトリはsudoで実行したかにかかわらず, <code>getent passwd ${SUDO_USER:-$USER} | cut -d: -f6</code> で得られる.</p>\\n<h2 id=\\"問題と解決策\\">問題と解決策</h2>\\n<p>bash において, ログインユーザ名やホームディレクトリは環境変数から取得できる.</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">echo</span> <span class=\\"s2\\">&#34;</span><span class=\\"nv\\">$USER</span><span class=\\"s2\\">&#34;</span>\\nbasd4g\\n$ <span class=\\"nb\\">echo</span> <span class=\\"s2\\">&#34;</span><span class=\\"nv\\">$HOME</span><span class=\\"s2\\">&#34;</span>\\n/home/basd4g\\n</code></pre></div><p>しかしながら, sudo で実行される場合, これらは root のものとして扱われてしまう.</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;echo &#34;$USER&#34;&#39;</span> <span class=\\"p\\">|</span> sudo bash\\nroot\\n$ <span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;echo &#34;$HOME&#34;&#39;</span> <span class=\\"p\\">|</span> sudo bash\\n/root\\n</code></pre></div><p>こうなると, sudo のシェルスクリプトの中で, 実行ユーザの名前やホームディレクトリを知りたいときに困る.</p>\\n<p>これを解決するには, 環境変数 <code>$SUDO_USER</code> を用いればよい.</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;echo &#34;$SUDO_USER&#34;&#39;</span> <span class=\\"p\\">|</span> bash\\n$ <span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;echo &#34;$SUDO_USER&#34;&#39;</span> <span class=\\"p\\">|</span> sudo bash\\nbasd4g\\n</code></pre></div><p>さらに特定のユーザ名のホームディレクトリもこれを使って求められる.</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ cat username.sh\\n<span class=\\"c1\\">#!/bin/bash</span>\\n<span class=\\"nb\\">echo</span> <span class=\\"si\\">${</span><span class=\\"nv\\">SUDO_USER</span><span class=\\"k\\">:-</span><span class=\\"nv\\">$USER</span><span class=\\"si\\">}</span>\\ngetent passwd <span class=\\"si\\">${</span><span class=\\"nv\\">SUDO_USER</span><span class=\\"k\\">:-</span><span class=\\"nv\\">$USER</span><span class=\\"si\\">}</span> <span class=\\"p\\">|</span> cut -d: -f6\\n$ bash username.sh\\nbasd4g\\n/home/basd4g\\n$ sudo bash username.sh\\nbasd4g\\n/home/basd4g\\n</code></pre></div><h2 id=\\"何故-getent-passwd-sudo_user-user--cut--d--f6-で得られるのか\\">何故 <code>getent passwd ${SUDO_USER:-$USER} | cut -d: -f6</code> で得られるのか</h2>\\n<h3 id=\\"sudo_user-user\\"><code>${SUDO_USER:-$USER}</code></h3>\\n<p><code>$SUDO_USER</code> には, sudo実行時には元のユーザ名が入っており, 非sudo時には空になる.\\n<code>${SUDO_USER:-$USER}</code> を用いると, <code>$SUDO_USER</code> の値もしくはこれが空なら <code>$USER</code> の値を表す.</p>\\n<h3 id=\\"getent\\"><code>getent</code></h3>\\n<p><code>getent passwd</code> は, システムの認証方法にかかわらず (例えばLDAPを使っていたとしても) ユーザの認証情報 を <code>/etc/passwd</code> に記述される形式で取得できる.</p>\\n<p><code>/etc/passwd</code> の各行は : (コロン) 区切りでユーザ名やホームディレクトリやログインシェルを含むので, 適切に cut してあげると ホームディレクトリが得られる.</p>\\n<h2 id=\\"実験用のシェルスクリプト\\">実験用のシェルスクリプト</h2>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"cp\\">#!/bin/bash\\n</span><span class=\\"cp\\"></span>\\n<span class=\\"nb\\">echo</span> -e <span class=\\"s2\\">&#34;\\\\n</span>$<span class=\\"s2\\"> whoami&#34;</span>\\nwhoami\\n<span class=\\"nb\\">echo</span> -e <span class=\\"s2\\">&#34;\\\\n</span>$<span class=\\"s2\\"> echo \\\\$HOME&#34;</span>\\n<span class=\\"nb\\">echo</span> <span class=\\"nv\\">$HOME</span>\\n<span class=\\"nb\\">echo</span> -e <span class=\\"s2\\">&#34;\\\\n</span>$<span class=\\"s2\\"> echo \\\\$USER&#34;</span>\\n<span class=\\"nb\\">echo</span> <span class=\\"nv\\">$USER</span>\\n<span class=\\"nb\\">echo</span> -e <span class=\\"s2\\">&#34;\\\\n</span>$<span class=\\"s2\\"> echo \\\\$USERNAME&#34;</span>\\n<span class=\\"nb\\">echo</span> <span class=\\"nv\\">$USERNAME</span>\\n<span class=\\"nb\\">echo</span> -e <span class=\\"s2\\">&#34;\\\\n</span>$<span class=\\"s2\\"> getent passwd \\\\$USER | cut -d: -f6&#34;</span>\\ngetent passwd <span class=\\"nv\\">$USER</span> <span class=\\"p\\">|</span> cut -d: -f6\\n<span class=\\"nb\\">echo</span> -e <span class=\\"s2\\">&#34;\\\\n</span>$<span class=\\"s2\\"> echo \\\\$SUDO_USER&#34;</span>\\n<span class=\\"nb\\">echo</span> <span class=\\"nv\\">$SUDO_USER</span>\\n<span class=\\"nb\\">echo</span> -e <span class=\\"s2\\">&#34;\\\\n</span>$<span class=\\"s2\\"> echo \\\\${SUDO_USER:-\\\\$USER}&#34;</span>\\n<span class=\\"nb\\">echo</span> <span class=\\"si\\">${</span><span class=\\"nv\\">SUDO_USER</span><span class=\\"k\\">:-</span><span class=\\"nv\\">$USER</span><span class=\\"si\\">}</span>\\n<span class=\\"nb\\">echo</span> -e <span class=\\"s2\\">&#34;\\\\n</span>$<span class=\\"s2\\"> getent passwd \\\\${SUDO_USER:-\\\\$USER} | cut -d: -f6&#34;</span>\\ngetent passwd <span class=\\"si\\">${</span><span class=\\"nv\\">SUDO_USER</span><span class=\\"k\\">:-</span><span class=\\"nv\\">$USER</span><span class=\\"si\\">}</span> <span class=\\"p\\">|</span> cut -d: -f6\\n</code></pre></div>","contentSnippet":"TL;DR … ホームディレクトリはsudoで実行したかにかかわらず, getent passwd ${SUDO_USER:-$USER} | cut -d: -f6 で得られる.\\n問題と解決策\\nbash において, ログインユーザ名やホームディレクトリは環境変数から取得できる.\\n$ echo \\"$USER\\"\\nbasd4g\\n$ echo \\"$HOME\\"\\n/home/basd4g\\n\\n\\nしかしながら, sudo で実行される場合, これらは root のものとして扱われてしまう.\\n$ echo \'echo \\"$USER\\"\' | sudo bash\\nroot\\n$ echo \'echo \\"$HOME\\"\' | sudo bash\\n/root\\n\\n\\nこうなると, sudo のシェルスクリプトの中で, 実行ユーザの名前やホームディレクトリを知りたいときに困る.\\nこれを解決するには, 環境変数 $SUDO_USER を用いればよい.\\n$ echo \'echo \\"$SUDO_USER\\"\' | bash\\n$ echo \'echo \\"$SUDO_USER\\"\' | sudo bash\\nbasd4g\\n\\n\\nさらに特定のユーザ名のホームディレクトリもこれを使って求められる.\\n$ cat username.sh\\n#!/bin/bash\\necho ${SUDO_USER:-$USER}\\ngetent passwd ${SUDO_USER:-$USER} | cut -d: -f6\\n$ bash username.sh\\nbasd4g\\n/home/basd4g\\n$ sudo bash username.sh\\nbasd4g\\n/home/basd4g\\n\\n\\n何故 getent passwd ${SUDO_USER:-$USER} | cut -d: -f6 で得られるのか\\n${SUDO_USER:-$USER}\\n$SUDO_USER には, sudo実行時には元のユーザ名が入っており, 非sudo時には空になる.\\n${SUDO_USER:-$USER} を用いると, $SUDO_USER の値もしくはこれが空なら $USER の値を表す.\\ngetent\\ngetent passwd は, システムの認証方法にかかわらず (例えばLDAPを使っていたとしても) ユーザの認証情報 を /etc/passwd に記述される形式で取得できる.\\n/etc/passwd の各行は : (コロン) 区切りでユーザ名やホームディレクトリやログインシェルを含むので, 適切に cut してあげると ホームディレクトリが得られる.\\n実験用のシェルスクリプト\\n#!/bin/bash\\n\\necho -e \\"\\\\n$ whoami\\"\\nwhoami\\necho -e \\"\\\\n$ echo \\\\$HOME\\"\\necho $HOME\\necho -e \\"\\\\n$ echo \\\\$USER\\"\\necho $USER\\necho -e \\"\\\\n$ echo \\\\$USERNAME\\"\\necho $USERNAME\\necho -e \\"\\\\n$ getent passwd \\\\$USER | cut -d: -f6\\"\\ngetent passwd $USER | cut -d: -f6\\necho -e \\"\\\\n$ echo \\\\$SUDO_USER\\"\\necho $SUDO_USER\\necho -e \\"\\\\n$ echo \\\\${SUDO_USER:-\\\\$USER}\\"\\necho ${SUDO_USER:-$USER}\\necho -e \\"\\\\n$ getent passwd \\\\${SUDO_USER:-\\\\$USER} | cut -d: -f6\\"\\ngetent passwd ${SUDO_USER:-$USER} | cut -d: -f6","guid":"https://memo.basd4g.net/posts/sudo-user-home-dir/","isoDate":"2020-11-02T16:54:49.000Z"},{"title":"tmuxに入門する","link":"https://memo.basd4g.net/posts/tmux/","pubDate":"Sat, 31 Oct 2020 23:53:54 +0900","content":"<p>vim を使うようになってから特に複数のターミナルウィンドウを開くことが多くなったので, 便利そうな tmux を使ってみる.\\n以前から存在は知っていたもののキーバインドが多くて慣れるの大変そうだと敬遠していたが, 自分の時間が出来たので良い機会だろう.</p>\\n<h2 id=\\"tmuxとは\\">tmuxとは</h2>\\n<p>GitHub の公式リポジトリでは以下のように説明されている.</p>\\n<blockquote>\\n<p>tmux is a terminal multiplexer: it enables a number of terminals to be created, accessed, and controlled from a single screen. tmux may be detached from a screen and continue running in the background, then later reattached.</p>\\n</blockquote>\\n<p>(<a href=\\"https://github.com/tmux/tmux\\"target=\\"_blank\\">tmux/tmux: tmux source code</a>)</p>\\n<p>(意訳)\\ntmux はターミナルマルチプレクサである.\\nこれは一つの画面から複数の画面を作成し, アクセス, 制御が出来る.\\ntmux は画面から分離してバックグラウンドで動作を継続し, のちに再度接続できる.)</p>\\n<p>tmux は次のことを実現する.</p>\\n<ul>\\n<li>一つのターミナルを画面分割して2つ以上のターミナルとして扱える. (開発時に, エディタ, git, 各種CLIなどを並行して操作できる)</li>\\n<li>tmux を離れてもセッションを継続できる. (ssh の際に不意にセッションが切れても, 再度つなぎ直すと状態を復元してくれる)</li>\\n</ul>\\n<h2 id=\\"setup\\">SetUp</h2>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># インストール</span>\\n<span class=\\"c1\\"># 環境: Ubuntu 20.04</span>\\n$ sudo apt install tmux -y\\n<span class=\\"c1\\"># macOSなら</span>\\n<span class=\\"c1\\"># $ brew install tmux</span>\\n<span class=\\"c1\\"># 起動</span>\\n$ tmux\\n</code></pre></div><h2 id=\\"とりあえず使ってみる\\">とりあえず使ってみる</h2>\\n<ol>\\n<li>ターミナルで <code>$ tmux</code> を実行し tmux を起動する.</li>\\n<li>デフォルトのキーバインドでいくつか動作を実行してみる.</li>\\n<li><code>Ctrl-b %</code> (<code>Ctrl</code>と<code>b</code>を同時押しして離し, 続けて<code>%</code>を入力) を押すと, ペインを作成 (画面を左右に分割) できる.</li>\\n<li><code>Ctrl-b 矢印キー</code> で作成したペイン間を移動できる.</li>\\n<li><code>Ctrl-b c</code> でウィンドウを作成できる.</li>\\n<li><code>Ctrl-b w</code> 作成したウィンドウを選択できる.</li>\\n<li><code>Ctrl-b x</code> でペインを閉じることができる.</li>\\n<li><code>Ctrl-b d</code> でセッションをデタッチできる. (バックグラウンドでセッションを維持したまま, tmuxから抜ける.)</li>\\n<li>ターミナルで <code>$ tmux a</code> と実行すると,前回実行していたセッションをアタッチできる. (バックグラウンドのセッションに接続.)</li>\\n</ol>\\n<p>このようにして画面を分割したり, セッションを維持したままターミナルから離れたり出来る.</p>\\n<p>その他のデフォルトのキーバインドは <a href=\\"http://www.tohoho-web.com/ex/tmux.html\\"target=\\"_blank\\">tmux入門 - とほほのWWW入門</a> が参考になる.</p>\\n<p>tmux は複数のターミナルを束ねるが, それは次のような構造になっている.</p>\\n<ul>\\n<li>tmux は複数のセッションを持てる.</li>\\n<li>セッションは複数のウィンドウを持てる.</li>\\n<li>ウィンドウは複数のペインを持てる. (画面分割)</li>\\n</ul>\\n<hr>\\n<p>基本は以上だが, その他にも使い切れないほど沢山の機能があるので, 以降では便利そうな機能を抽出のうえカスタマイズして使いやすくする.</p>\\n<h2 id=\\"好みの状態にカスタマイズする\\">好みの状態にカスタマイズする</h2>\\n<h3 id=\\"好みのペイン分割をするコマンドを作る\\">好みのペイン分割をするコマンドを作る</h3>\\n<p>好みのペイン分割をすぐにできるようなスクリプトを作っておく.</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;alias ide=&#34;bash ~/.tmux-ide.sh&#34;&#39;</span> &gt;&gt; .bashrc\\n$ vim ~/.tmux-ide.sh\\n</code></pre></div><div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-~/.tmux-ide.sh\\" data-lang=\\"~/.tmux-ide.sh\\"><span class=\\"cp\\">#!/bin/bash\\n</span><span class=\\"cp\\"></span>tmux split-window -d -t <span class=\\"m\\">0</span> <span class=\\"c1\\"># 上下に画面分割</span>\\ntmux send-keys -t <span class=\\"m\\">0</span> vim C-m <span class=\\"c1\\"># ペイン0 (画面上部) で vim を実行</span>\\ntmux split-window -h -t <span class=\\"m\\">1</span> <span class=\\"c1\\"># ペイン1 (画面下部) を左右に分割</span>\\ntmux <span class=\\"k\\">select</span>-pane -t <span class=\\"m\\">0</span> <span class=\\"c1\\"># フォーカスをペイン0に移動する</span>\\ntmux resize-pane -t <span class=\\"m\\">0</span> -D <span class=\\"m\\">10</span> <span class=\\"c1\\"># ペイン0を下方向に広げる</span>\\ntmux send-keys -t <span class=\\"m\\">0</span> <span class=\\"s1\\">&#39;:e ~/dev/&#39;</span> <span class=\\"c1\\"># ペイン0 に &#39;:e ~/dev/&#39;と入力する (vim でファイルを開くことを助ける)</span>\\n</code></pre></div><p>こうすると, tmux 起動後や新しいウィンドウ作成後に <code>$ ide</code> と打つと, 自動で3つのペインに画面分割をしてvimを起動してくれる.</p>\\n<h3 id=\\"vim-のカラースキームがおかしくなる件を修正\\">Vim のカラースキームがおかしくなる件を修正</h3>\\n<p>vimのカラースキームが未設定だと, tmux内のvimとtmux外のvimで配色が変わるので, なんでもいいからカラースキームを設定する</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;colorscheme pablo&#39;</span> &gt;&gt; ~/.vimrc\\n</code></pre></div><h3 id=\\"tmuxconfを作成\\">~/.tmux.confを作成</h3>\\n<ul>\\n<li>tmux は表示やキーバインドをカスタマイズできる.</li>\\n<li><code>~/.tmux.conf</code>に設定を書き込むと, デフォルトで読み込んでくれる.</li>\\n<li>tmux を既に起動している状態でも, ファイル保存後に, <code>prefix :source ~/.tmux.conf</code>で設定ファイルをリロード可能.</li>\\n</ul>\\n<p>tmux は出来ることが多いが, そのためのキーバインドを覚えるのが大変そう.\\n他人の設定した tmux を触らなければならないこともそう無いだろうし, 最初からカスタマイズして覚えやすそう/使いやすそうなキーに設定することにする.</p>\\n<p>設定内容は検索すると沢山出てくるので, 適当なものを取り込むと良いだろう.\\n記事末尾に参考となりそうなページをを記載する.</p>\\n<p>以下では, 次のような内容の設定を行う.</p>\\n<ul>\\n<li>prefix キーの変更</li>\\n<li>色の変更</li>\\n<li>status line に表示する情報を変更</li>\\n<li>マウス操作の有効化</li>\\n<li>各種キーバインドの変更</li>\\n</ul>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ vim ~/.tmux.conf\\n</code></pre></div><pre><code class=\\"language-~/.tmux.conf\\" data-lang=\\"~/.tmux.conf\\"># tmux起動時のシェルをzshにする\\nset-option -g default-shell /bin/zsh\\n# prefixキーをC-jに変更する\\nset -g prefix C-j\\n# ウィンドウ終了\\nbind Q kill-window\\n## --------------------見た目--------------------\\n# tmuxを256色表示出来るようにする\\nset-option -g default-terminal screen-256color\\nset -g terminal-overrides \'xterm:colors=256\'\\n# 非アクティブなウィンドウの背景色を灰色にする\\nset-option -g window-style \'bg=#444444\'\\n# アクティブなウィンドウの背景色を黒色にする\\nset-option -g window-active-style \'bg=#222222\'\\n# status-left の最大の長さを指定する。\\nset-option -g status-left-length 20\\n# status-left のフォーマットを指定する。\\nset-option -g status-left &quot;#[fg=colour255,bg=colour241]Session: #S #[default]&quot;\\n# window-status のフォーマットを指定する。\\nset-window-option -g window-status-format &quot; #I: #W &quot;\\n# カレントウィンドウの window-status のフォーマットを指定する\\nset-window-option -g window-status-current-format &quot;#[fg=colour255,bg=colour27,bold] #I: #W #[default]&quot;\\n# 現在時刻を最右に表示\\nset-option -g status-right \'%Y-%m-%d(%a) %H:%M:%S\'\\n# ステータスバーを1秒毎に描画し直す\\nset-option -g status-interval 1\\n## --------------------マウス--------------------\\n#マウス操作を有効にする\\nset-option -g mouse on\\n# スクロールアップするとコピーモードに入る\\nbind-key -n WheelUpPane if-shell -F -t = &quot;#{mouse_any_flag}&quot; &quot;send-keys -M&quot; &quot;if -Ft= \'#{pane_in_mode}\' \'send-keys -M\' \'select-pane -t=; copy-mode -e; send-keys -M\'&quot;\\n# 最後までスクロールダウンするとコピーモードを抜ける\\nbind-key -n WheelDownPane select-pane -t= \\\\; send-keys -M\\n## --------------------ペイン--------------------\\n# vimのキーバインドでペインを移動する\\nbind h select-pane -L\\nbind j select-pane -D\\nbind k select-pane -U\\nbind l select-pane -R\\n# vimのキーバインドでペインをリサイズする\\nbind -r H resize-pane -L 5\\nbind -r J resize-pane -D 5\\nbind -r K resize-pane -U 5\\nbind -r L resize-pane -R 5\\n# ペインを垂直分割する\\nbind v split-window -h -c \'#{pane_current_path}\'\\n# ペインを水平分割する\\nbind s split-window -v -c \'#{pane_current_path}\'\\n# ペイン番号を表示\\nbind i display-panes\\n# ペインを終了\\nbind q kill-pane\\n</code></pre><h3 id=\\"keybinds\\">Keybinds</h3>\\n<p>.tmux.conf にて キーバインドを書き換え済みのものは is default ? を no と表記している.</p>\\n<h3 id=\\"基本\\">基本</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>command</th>\\n<th>description</th>\\n<th>is default ?</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>Ctrl-j</td>\\n<td>prefix</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix ?</td>\\n<td>キーバインド一覧</td>\\n<td>YES</td>\\n</tr>\\n</tbody>\\n</table>\\n<h3 id=\\"セッション\\">セッション</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>command</th>\\n<th>description</th>\\n<th>is default ?</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>prefix d</td>\\n<td>現在のセッションを継続したままtmuxを閉じる (detach)</td>\\n<td>YES</td>\\n</tr>\\n</tbody>\\n</table>\\n<h3 id=\\"ウィンドウ\\">ウィンドウ</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>command</th>\\n<th>description</th>\\n<th>is default ?</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>prefix c</td>\\n<td>新規ウィンドウの作成/追加</td>\\n<td>YES</td>\\n</tr>\\n<tr>\\n<td>prefix w</td>\\n<td>ウィンドウの一覧</td>\\n<td>YES</td>\\n</tr>\\n<tr>\\n<td>prefix Q</td>\\n<td>ウィンドウの破棄</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix n</td>\\n<td>次のウィンドウへ移動</td>\\n<td>YES</td>\\n</tr>\\n<tr>\\n<td>prefix p</td>\\n<td>前のウィンドウへ移動</td>\\n<td>YES</td>\\n</tr>\\n<tr>\\n<td>prefix 数字</td>\\n<td>当該番号のウィンドウへ移動</td>\\n<td>YES</td>\\n</tr>\\n<tr>\\n<td>prefix &lt;</td>\\n<td>当該ウィンドウをリネームや移動等</td>\\n<td>YES</td>\\n</tr>\\n</tbody>\\n</table>\\n<h3 id=\\"ペイン\\">ペイン</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>command</th>\\n<th>description</th>\\n<th>is default ?</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>prefix v</td>\\n<td>左右にペイン分割</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix s</td>\\n<td>上下ペイン分割</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix h</td>\\n<td>左のペインへ移動</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix j</td>\\n<td>下のペインへ移動</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix k</td>\\n<td>上のペインへ移動</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix l</td>\\n<td>右のペインへ移動</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix H</td>\\n<td>ペインを左にリサイズ</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix J</td>\\n<td>ペインを下にリサイズ</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix K</td>\\n<td>ペインを上にリサイズ</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix L</td>\\n<td>ペインを右にリサイズ</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix q</td>\\n<td>ペインを破棄</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix i</td>\\n<td>ペイン番号を表示 (続けて数字を入力すると当該ペインへ移動)</td>\\n<td>no</td>\\n</tr>\\n<tr>\\n<td>prefix &gt;</td>\\n<td>当該ペインをリネームや移動等</td>\\n<td>YES</td>\\n</tr>\\n</tbody>\\n</table>\\n<h3 id=\\"コピーペースト\\">コピー&amp;ペースト</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>command</th>\\n<th>description</th>\\n<th>is default ?</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>prefix [</td>\\n<td>コピーモード開始</td>\\n<td>YES</td>\\n</tr>\\n<tr>\\n<td>prefix Space</td>\\n<td>コピー開始位置決定</td>\\n<td>YES</td>\\n</tr>\\n<tr>\\n<td>prefix Enter</td>\\n<td>コピー終了位置決定</td>\\n<td>YES</td>\\n</tr>\\n<tr>\\n<td>prefix ]</td>\\n<td>コピーした内容の貼り付け</td>\\n<td>YES</td>\\n</tr>\\n</tbody>\\n</table>\\n<h2 id=\\"参考\\">参考</h2>\\n<ul>\\n<li><a href=\\"https://github.com/tmux/tmux\\"target=\\"_blank\\">tmux/tmux: tmux source code</a></li>\\n<li><a href=\\"https://github.com/zchee/tmux-ja/blob/master/tmux-ja.rst\\"target=\\"_blank\\">tmux-ja/tmux-ja.rst at master · zchee/tmux-ja</a></li>\\n<li><a href=\\"https://blog.inkdrop.info/vscode-like-environment-with-vim-tmux-4c2bfe17d31e\\"target=\\"_blank\\">VSCode-like environment with vim + tmux | by Takuya Matsuyama | Dev as Life</a></li>\\n<li><a href=\\"https://qiita.com/nl0_blu/items/9d207a70ccc8467f7bab\\"target=\\"_blank\\">tmuxを必要最低限で入門して使う - Qiita</a></li>\\n<li><a href=\\"http://www.tohoho-web.com/ex/tmux.html\\"target=\\"_blank\\">tmux入門 - とほほのWWW入門</a></li>\\n<li><a href=\\"https://qiita.com/nojima/items/9bc576c922da3604a72b\\"target=\\"_blank\\">tmux の status line の設定方法 - Qiita</a></li>\\n<li><a href=\\"https://qiita.com/zwirky/items/adbf22abad7d7822456b\\"target=\\"_blank\\">tmuxで快適なターミナル生活を送ろう - Qiita</a></li>\\n<li><a href=\\"http://kanjuku-tomato.blogspot.com/2014/03/tmux.html\\"target=\\"_blank\\">新規tmuxセッション起動時に自動で複数のウィンドウを作成してペイン分割する - 完熟トマト</a></li>\\n<li><a href=\\"https://gp-standard.com/tmux%E3%81%A7%E3%83%9E%E3%82%A6%E3%82%B9%E6%93%8D%E4%BD%9C%E3%82%92%E4%BE%BF%E5%88%A9%E3%81%AB%EF%BC%81-tmux-conf%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E8%A8%AD/\\"target=\\"_blank\\">tmuxでマウス操作を便利に！ tmux.confファイルを作って設定をカスタマイズする。 | Full Stack Enginear</a></li>\\n<li><a href=\\"https://qiita.com/mikene_koko/items/2867a6fe2eb73db6562e\\"target=\\"_blank\\">僕の考えた最強のtmux.conf - Qiita</a></li>\\n</ul>\\n<hr>\\n<p>追伸: 10月に何も書いてないのもしゃくなのでギリギリに投稿。最近は卒業研究を進めている。</p>","contentSnippet":"vim を使うようになってから特に複数のターミナルウィンドウを開くことが多くなったので, 便利そうな tmux を使ってみる.\\n以前から存在は知っていたもののキーバインドが多くて慣れるの大変そうだと敬遠していたが, 自分の時間が出来たので良い機会だろう.\\ntmuxとは\\nGitHub の公式リポジトリでは以下のように説明されている.\\ntmux is a terminal multiplexer: it enables a number of terminals to be created, accessed, and controlled from a single screen. tmux may be detached from a screen and continue running in the background, then later reattached.\\n(tmux/tmux: tmux source code)\\n(意訳)\\ntmux はターミナルマルチプレクサである.\\nこれは一つの画面から複数の画面を作成し, アクセス, 制御が出来る.\\ntmux は画面から分離してバックグラウンドで動作を継続し, のちに再度接続できる.)\\ntmux は次のことを実現する.\\n一つのターミナルを画面分割して2つ以上のターミナルとして扱える. (開発時に, エディタ, git, 各種CLIなどを並行して操作できる)\\ntmux を離れてもセッションを継続できる. (ssh の際に不意にセッションが切れても, 再度つなぎ直すと状態を復元してくれる)\\nSetUp\\n# インストール\\n# 環境: Ubuntu 20.04\\n$ sudo apt install tmux -y\\n# macOSなら\\n# $ brew install tmux\\n# 起動\\n$ tmux\\n\\n\\nとりあえず使ってみる\\nターミナルで $ tmux を実行し tmux を起動する.\\nデフォルトのキーバインドでいくつか動作を実行してみる.\\nCtrl-b % (Ctrlとbを同時押しして離し, 続けて%を入力) を押すと, ペインを作成 (画面を左右に分割) できる.\\nCtrl-b 矢印キー で作成したペイン間を移動できる.\\nCtrl-b c でウィンドウを作成できる.\\nCtrl-b w 作成したウィンドウを選択できる.\\nCtrl-b x でペインを閉じることができる.\\nCtrl-b d でセッションをデタッチできる. (バックグラウンドでセッションを維持したまま, tmuxから抜ける.)\\nターミナルで $ tmux a と実行すると,前回実行していたセッションをアタッチできる. (バックグラウンドのセッションに接続.)\\nこのようにして画面を分割したり, セッションを維持したままターミナルから離れたり出来る.\\nその他のデフォルトのキーバインドは tmux入門 - とほほのWWW入門 が参考になる.\\ntmux は複数のターミナルを束ねるが, それは次のような構造になっている.\\ntmux は複数のセッションを持てる.\\nセッションは複数のウィンドウを持てる.\\nウィンドウは複数のペインを持てる. (画面分割)\\n基本は以上だが, その他にも使い切れないほど沢山の機能があるので, 以降では便利そうな機能を抽出のうえカスタマイズして使いやすくする.\\n好みの状態にカスタマイズする\\n好みのペイン分割をするコマンドを作る\\n好みのペイン分割をすぐにできるようなスクリプトを作っておく.\\n$ echo \'alias ide=\\"bash ~/.tmux-ide.sh\\"\' >> .bashrc\\n$ vim ~/.tmux-ide.sh\\n\\n\\n#!/bin/bash\\ntmux split-window -d -t 0 # 上下に画面分割\\ntmux send-keys -t 0 vim C-m # ペイン0 (画面上部) で vim を実行\\ntmux split-window -h -t 1 # ペイン1 (画面下部) を左右に分割\\ntmux select-pane -t 0 # フォーカスをペイン0に移動する\\ntmux resize-pane -t 0 -D 10 # ペイン0を下方向に広げる\\ntmux send-keys -t 0 \':e ~/dev/\' # ペイン0 に \':e ~/dev/\'と入力する (vim でファイルを開くことを助ける)\\n\\n\\nこうすると, tmux 起動後や新しいウィンドウ作成後に $ ide と打つと, 自動で3つのペインに画面分割をしてvimを起動してくれる.\\nVim のカラースキームがおかしくなる件を修正\\nvimのカラースキームが未設定だと, tmux内のvimとtmux外のvimで配色が変わるので, なんでもいいからカラースキームを設定する\\n$ echo \'colorscheme pablo\' >> ~/.vimrc\\n\\n\\n~/.tmux.confを作成\\ntmux は表示やキーバインドをカスタマイズできる.\\n~/.tmux.confに設定を書き込むと, デフォルトで読み込んでくれる.\\ntmux を既に起動している状態でも, ファイル保存後に, prefix :source ~/.tmux.confで設定ファイルをリロード可能.\\ntmux は出来ることが多いが, そのためのキーバインドを覚えるのが大変そう.\\n他人の設定した tmux を触らなければならないこともそう無いだろうし, 最初からカスタマイズして覚えやすそう/使いやすそうなキーに設定することにする.\\n設定内容は検索すると沢山出てくるので, 適当なものを取り込むと良いだろう.\\n記事末尾に参考となりそうなページをを記載する.\\n以下では, 次のような内容の設定を行う.\\nprefix キーの変更\\n色の変更\\nstatus line に表示する情報を変更\\nマウス操作の有効化\\n各種キーバインドの変更\\n$ vim ~/.tmux.conf\\n\\n\\n# tmux起動時のシェルをzshにする\\nset-option -g default-shell /bin/zsh\\n# prefixキーをC-jに変更する\\nset -g prefix C-j\\n# ウィンドウ終了\\nbind Q kill-window\\n## --------------------見た目--------------------\\n# tmuxを256色表示出来るようにする\\nset-option -g default-terminal screen-256color\\nset -g terminal-overrides \'xterm:colors=256\'\\n# 非アクティブなウィンドウの背景色を灰色にする\\nset-option -g window-style \'bg=#444444\'\\n# アクティブなウィンドウの背景色を黒色にする\\nset-option -g window-active-style \'bg=#222222\'\\n# status-left の最大の長さを指定する。\\nset-option -g status-left-length 20\\n# status-left のフォーマットを指定する。\\nset-option -g status-left \\"#[fg=colour255,bg=colour241]Session: #S #[default]\\"\\n# window-status のフォーマットを指定する。\\nset-window-option -g window-status-format \\" #I: #W \\"\\n# カレントウィンドウの window-status のフォーマットを指定する\\nset-window-option -g window-status-current-format \\"#[fg=colour255,bg=colour27,bold] #I: #W #[default]\\"\\n# 現在時刻を最右に表示\\nset-option -g status-right \'%Y-%m-%d(%a) %H:%M:%S\'\\n# ステータスバーを1秒毎に描画し直す\\nset-option -g status-interval 1\\n## --------------------マウス--------------------\\n#マウス操作を有効にする\\nset-option -g mouse on\\n# スクロールアップするとコピーモードに入る\\nbind-key -n WheelUpPane if-shell -F -t = \\"#{mouse_any_flag}\\" \\"send-keys -M\\" \\"if -Ft= \'#{pane_in_mode}\' \'send-keys -M\' \'select-pane -t=; copy-mode -e; send-keys -M\'\\"\\n# 最後までスクロールダウンするとコピーモードを抜ける\\nbind-key -n WheelDownPane select-pane -t= \\\\; send-keys -M\\n## --------------------ペイン--------------------\\n# vimのキーバインドでペインを移動する\\nbind h select-pane -L\\nbind j select-pane -D\\nbind k select-pane -U\\nbind l select-pane -R\\n# vimのキーバインドでペインをリサイズする\\nbind -r H resize-pane -L 5\\nbind -r J resize-pane -D 5\\nbind -r K resize-pane -U 5\\nbind -r L resize-pane -R 5\\n# ペインを垂直分割する\\nbind v split-window -h -c \'#{pane_current_path}\'\\n# ペインを水平分割する\\nbind s split-window -v -c \'#{pane_current_path}\'\\n# ペイン番号を表示\\nbind i display-panes\\n# ペインを終了\\nbind q kill-pane\\n\\nKeybinds\\n.tmux.conf にて キーバインドを書き換え済みのものは is default ? を no と表記している.\\n基本\\ncommand\\ndescription\\nis default ?\\n\\n\\n\\n\\nCtrl-j\\nprefix\\nno\\n\\n\\nprefix ?\\nキーバインド一覧\\nYES\\n\\n\\n\\nセッション\\ncommand\\ndescription\\nis default ?\\n\\n\\n\\n\\nprefix d\\n現在のセッションを継続したままtmuxを閉じる (detach)\\nYES\\n\\n\\n\\nウィンドウ\\ncommand\\ndescription\\nis default ?\\n\\n\\n\\n\\nprefix c\\n新規ウィンドウの作成/追加\\nYES\\n\\n\\nprefix w\\nウィンドウの一覧\\nYES\\n\\n\\nprefix Q\\nウィンドウの破棄\\nno\\n\\n\\nprefix n\\n次のウィンドウへ移動\\nYES\\n\\n\\nprefix p\\n前のウィンドウへ移動\\nYES\\n\\n\\nprefix 数字\\n当該番号のウィンドウへ移動\\nYES\\n\\n\\nprefix <\\n当該ウィンドウをリネームや移動等\\nYES\\n\\n\\n\\nペイン\\ncommand\\ndescription\\nis default ?\\n\\n\\n\\n\\nprefix v\\n左右にペイン分割\\nno\\n\\n\\nprefix s\\n上下ペイン分割\\nno\\n\\n\\nprefix h\\n左のペインへ移動\\nno\\n\\n\\nprefix j\\n下のペインへ移動\\nno\\n\\n\\nprefix k\\n上のペインへ移動\\nno\\n\\n\\nprefix l\\n右のペインへ移動\\nno\\n\\n\\nprefix H\\nペインを左にリサイズ\\nno\\n\\n\\nprefix J\\nペインを下にリサイズ\\nno\\n\\n\\nprefix K\\nペインを上にリサイズ\\nno\\n\\n\\nprefix L\\nペインを右にリサイズ\\nno\\n\\n\\nprefix q\\nペインを破棄\\nno\\n\\n\\nprefix i\\nペイン番号を表示 (続けて数字を入力すると当該ペインへ移動)\\nno\\n\\n\\nprefix >\\n当該ペインをリネームや移動等\\nYES\\n\\n\\n\\nコピー&ペースト\\ncommand\\ndescription\\nis default ?\\n\\n\\n\\n\\nprefix [\\nコピーモード開始\\nYES\\n\\n\\nprefix Space\\nコピー開始位置決定\\nYES\\n\\n\\nprefix Enter\\nコピー終了位置決定\\nYES\\n\\n\\nprefix ]\\nコピーした内容の貼り付け\\nYES\\n\\n\\n\\n参考\\ntmux/tmux: tmux source code\\ntmux-ja/tmux-ja.rst at master · zchee/tmux-ja\\nVSCode-like environment with vim + tmux | by Takuya Matsuyama | Dev as Life\\ntmuxを必要最低限で入門して使う - Qiita\\ntmux入門 - とほほのWWW入門\\ntmux の status line の設定方法 - Qiita\\ntmuxで快適なターミナル生活を送ろう - Qiita\\n新規tmuxセッション起動時に自動で複数のウィンドウを作成してペイン分割する - 完熟トマト\\ntmuxでマウス操作を便利に！ tmux.confファイルを作って設定をカスタマイズする。 | Full Stack Enginear\\n僕の考えた最強のtmux.conf - Qiita\\n追伸: 10月に何も書いてないのもしゃくなのでギリギリに投稿。最近は卒業研究を進めている。","guid":"https://memo.basd4g.net/posts/tmux/","isoDate":"2020-10-31T14:53:54.000Z"},{"title":"積読本だった\\"Webを支える技術\\"を読んだ感想と、本を読むための心がけ","link":"https://memo.basd4g.net/posts/webteckbook/","pubDate":"Tue, 29 Sep 2020 03:35:02 +0900","content":"<p><a href=\\"https://www.amazon.co.jp/Web%E3%82%92%E6%94%AF%E3%81%88%E3%82%8B%E6%8A%80%E8%A1%93-HTTP%E3%80%81URI%E3%80%81HTML%E3%80%81%E3%81%9D%E3%81%97%E3%81%A6REST-WEB-PRESS-plus/dp/4774142042\\"target=\\"_blank\\">「Webを支える技術 HTTP, URI, HTML, そしてREST」</a>を改めて読み直した。\\n年始に買って途中まで読んでいたものだ。</p>\\n<h2 id=\\"書籍-webを支える技術-について\\">書籍 &ldquo;Webを支える技術&rdquo; について</h2>\\n<h3 id=\\"本を選んだ背景と読んだ感想\\">本を選んだ背景と読んだ感想</h3>\\n<p>書籍購入当時はスマホアプリのWeb APIを開発しており、URIの設計の参考にしたくて手にとった。\\nRESTという考え方やAPI設計についてとても参考になり、 良い設計とは何かを知ることが出来た。</p>\\n<p>これまでは用意されたWeb APIを使う側で、URI設計について意識することがなく無意識に良くつくられたURIのAPIを使っていた。\\n一方で設計するためにはまず利用者として当たり前だったことを言語化して理解する必要があり、その当たり前がRESTにより成り立っていることを学べた。</p>\\n<h3 id=\\"書籍内容と現在の状況の違い\\">書籍内容と現在の状況の違い</h3>\\n<p>書籍の第一版は2010年で今から10年前なので、現代と少し合わない点もある。</p>\\n<ul>\\n<li>初版時にはHTTP/2 HTTP/3は存在しておらず、HTTP/1.1が最新であることを前提として書かれている</li>\\n<li>セマンティックWeb は2020年の今でも浸透していない</li>\\n<li><s>Web APIとして、XML、Atom / AtomPubはあまり使われなくなった</s>\\n<small>(追記 2020/10/4 : なんの裏付けもありません。サービスの目的によって使う/使わないがあるだけで、あまり使われなくなったというのは言い過ぎかも。XMLはあまり使われなくなりJSONが一般的になった、ということは言えるんじゃ無いかな。)</small></li>\\n</ul>\\n<p>とはいえ本の本筋は2020年でもきっと多分に有用であろう。</p>\\n<h3 id=\\"本から学んだこと\\">本から学んだこと</h3>\\n<p>詳細は本に譲るが、私がこの本から学んだエッセンスには例えば次のようなものがある。</p>\\n<h4 id=\\"1-restについて\\">1. RESTについて</h4>\\n<p>REST とは今日のWebにおいて適用されているアーキテクチャパターンのことで、次の制約をもつ。</p>\\n<ul>\\n<li>クライアント/サーバモデル</li>\\n<li>ステートレスサーバ</li>\\n<li>キャッシュ</li>\\n<li>統一インタフェース</li>\\n<li>階層化システム</li>\\n<li>コードオンデマンド</li>\\n</ul>\\n<p>第1部第3章 p36あたりには上述のようなことが書かれている。</p>\\n<p>インターネットは、遅延が大きく、また通信相手から応答があるか保証のない分散システムである。\\nこのインターネットにおいて、端末(プログラム)(/人間) 間のインタフェースをどのように設計すべきかの原則、指針を示しているのがRESTだ。\\n設計のときに参考になるアーキテクチャパターンとしてRESTが存在し、RESTの要素とはなんなのかを分解して解説している。</p>\\n<h4 id=\\"2-リソースのモデル化とuri設計\\">2. リソースのモデル化とURI設計</h4>\\n<blockquote>\\n<p>検索のような機能は、検索行為をモデル化するのではなく、検索結果をモデル化する。</p>\\n</blockquote>\\n<p>Webサービス/WebAPI(以下Webサービスと呼ぶ)を設計する時、&ldquo;動作&quot;をリソースとして割り当てる(=&gt;URIで表現する)のはよくない。\\nWebサービスにおける動作はCRUDであり、HTTPのメソッドであるGET/POST/PUT/DELETE で表現すべきである。</p>\\n<p>例えば検索機能は、&ldquo;検索結果をGETで取得する&quot;と表現するのが簡潔である。\\nGoogleの検索結果のURIは <code>https://google.com/search?q=hoge</code> となっているが、ここで出てくるsearchは検索行為を表しているのではなく検索結果を表している。\\n検索行為に注目してしまうと、HTTPを拡張してSearchメソッドを作ったり、検索内容をPOSTしてサーバに検索しろとクライアントに命令させたりすることになる。\\nこれはわかりづらいので良い設計といえない。</p>\\n<p>検索に限らず、リソースをモデル化するとき(すなわちそれはリソースを表現するURIになりうる)は、動作ではなく名詞で表せるものに注目すべきだ。</p>\\n<h4 id=\\"3-人間とコンピュータの統一インタフェース\\">3. 人間とコンピュータの統一インタフェース</h4>\\n<blockquote>\\n<p>リソース設計の際は、WebサービスとWeb APIを分けて考えない。</p>\\n</blockquote>\\n<p>良いリソースのモデル化は人間にとってもわかりやすいし、Web APIとしても使いやすくなる。\\nなので、WebAPI用にリソースをモデル化してURIで表現し、人間にはまた別にモデル化して、、、ということは避けるべき。</p>\\n<h2 id=\\"積読本を読み切った感想と本を読むスピードについて\\">積読本を読み切った感想と、本を読むスピードについて</h2>\\n<p>さて、本の内容はここまでにして、以下は今回の積読消化の感想とそこから学んだことを記す。</p>\\n<p>本を読むスピードは状況や意識で大きく変わる。</p>\\n<p>1月に読んでいたときは理解できないところがあると調べて解決してから進める読み方だった。\\n読むスピードが遅くそのまま途中で止まっていた。<a id=\\"anotation1\\" href=\\"#anotated1\\">^1</a></p>\\n<p>一方、今回9月は数時間で一気に読み切った。\\n気になったところはメモを取ることにして、読み切るために興味のわかないところ(例えばAtom/AtomPub等の項)は斜め読みにするなどして進めた。</p>\\n<p>本を読むスピードは自分の意識で変わる面がある。\\n細かいところまで理解しながらゆっくり読み進めるか、全体を俯瞰するためにとにかく読み切ることを目標に進めるかという意識だ。\\nまた、自分の知識量に応じて変わる面もある。\\n自分が知っていることが多く載っている本は早く読めるし、知らないことが多く載っている本は時間がかかる。\\nさらに、自分のテンションや気分で変わる面もある。\\n読む気があるとき、内容に興味が湧いているとき、知的好奇心から本の内容を欲しているときは、どんどんページが進んで苦なくはやく読める。</p>\\n<p>今回は一気に読み切ろうという心持ち、RESTって結局なんだっけという思いからくる知的好奇心、前回よりも知識量が増え内容の理解が進むことなど様々なことが重なったのが読み切れた要因だろう。</p>\\n<p>私は気分が乗っていないときに何も考えずに本を読むと、丁寧にゆっくり読む癖がある。\\n他方、本の全体像をつかみ必要なところだけを読んだり、必要になったときに読み直せるようインデックスを貼る気持ちで読んだりするほうが効率が良いのではないかと感じる。\\n実際今回の本も読み切って感じたが、後半には実例を交えたURIの設計について述べられた章があり、1月にここを読んでいれば身になるものがさらにあったはずだった。\\n今後はどんな読み方/スピードで本を読むかを読む前に考えるようにしたい。</p>\\n<p>また、モチベーションの大切さも感じた。\\nプログラムを書くときもそうであるし、本を読むときもそうであるが、(少なくとも私にとって)物事を進めるにはモチベーションがとても重要だと思う。\\nモチベーションの高まっているときに躊躇なく進めることを心がけたい。\\n(さらには自分のモチベーションを導けるようになりたい。)</p>\\n<p>そんなこんなで積ん読を消化した勢いで他の本も読むぞ。</p>\\n<hr>\\n<p>参考: <a href=\\"http://yohei-y.blogspot.com/\\"target=\\"_blank\\">yohei-y:weblog</a>(著者 山本陽平さんのブログ) &hellip; この記事のURL<code>webteckbook</code>はブログに記載された内容を参考にした。</p>\\n<p>注釈: <a id=\\"anotated1\\" href=\\"#anotation\\">^1</a>: 何故積ん読した当時のことを鮮明に覚えているかというと、本を読んでいた時が時間に追われながらコードを書きながら年末年始で帰省して親戚と過ごしていた映像記憶が蘇ってきたからである。\\nエピソード記憶は強烈だ。\\n当時はAPIの設計についても考えなければならなかったがDockerを含むインフラについても学ばねばならなかったので、のんびり本を読み切ってる場合ではない！という心情だったのだろう。</p>\\n<p>追記: (2020/10/04) 不要な改行を削除</p>","contentSnippet":"「Webを支える技術 HTTP, URI, HTML, そしてREST」を改めて読み直した。\\n年始に買って途中まで読んでいたものだ。\\n書籍 “Webを支える技術” について\\n本を選んだ背景と読んだ感想\\n書籍購入当時はスマホアプリのWeb APIを開発しており、URIの設計の参考にしたくて手にとった。\\nRESTという考え方やAPI設計についてとても参考になり、 良い設計とは何かを知ることが出来た。\\nこれまでは用意されたWeb APIを使う側で、URI設計について意識することがなく無意識に良くつくられたURIのAPIを使っていた。\\n一方で設計するためにはまず利用者として当たり前だったことを言語化して理解する必要があり、その当たり前がRESTにより成り立っていることを学べた。\\n書籍内容と現在の状況の違い\\n書籍の第一版は2010年で今から10年前なので、現代と少し合わない点もある。\\n初版時にはHTTP/2 HTTP/3は存在しておらず、HTTP/1.1が最新であることを前提として書かれている\\nセマンティックWeb は2020年の今でも浸透していない\\nWeb APIとして、XML、Atom / AtomPubはあまり使われなくなった\\n(追記 2020/10/4 : なんの裏付けもありません。サービスの目的によって使う/使わないがあるだけで、あまり使われなくなったというのは言い過ぎかも。XMLはあまり使われなくなりJSONが一般的になった、ということは言えるんじゃ無いかな。)\\nとはいえ本の本筋は2020年でもきっと多分に有用であろう。\\n本から学んだこと\\n詳細は本に譲るが、私がこの本から学んだエッセンスには例えば次のようなものがある。\\n1. RESTについて\\nREST とは今日のWebにおいて適用されているアーキテクチャパターンのことで、次の制約をもつ。\\nクライアント/サーバモデル\\nステートレスサーバ\\nキャッシュ\\n統一インタフェース\\n階層化システム\\nコードオンデマンド\\n第1部第3章 p36あたりには上述のようなことが書かれている。\\nインターネットは、遅延が大きく、また通信相手から応答があるか保証のない分散システムである。\\nこのインターネットにおいて、端末(プログラム)(/人間) 間のインタフェースをどのように設計すべきかの原則、指針を示しているのがRESTだ。\\n設計のときに参考になるアーキテクチャパターンとしてRESTが存在し、RESTの要素とはなんなのかを分解して解説している。\\n2. リソースのモデル化とURI設計\\n検索のような機能は、検索行為をモデル化するのではなく、検索結果をモデル化する。\\nWebサービス/WebAPI(以下Webサービスと呼ぶ)を設計する時、“動作\\"をリソースとして割り当てる(=>URIで表現する)のはよくない。\\nWebサービスにおける動作はCRUDであり、HTTPのメソッドであるGET/POST/PUT/DELETE で表現すべきである。\\n例えば検索機能は、“検索結果をGETで取得する\\"と表現するのが簡潔である。\\nGoogleの検索結果のURIは https://google.com/search?q=hoge となっているが、ここで出てくるsearchは検索行為を表しているのではなく検索結果を表している。\\n検索行為に注目してしまうと、HTTPを拡張してSearchメソッドを作ったり、検索内容をPOSTしてサーバに検索しろとクライアントに命令させたりすることになる。\\nこれはわかりづらいので良い設計といえない。\\n検索に限らず、リソースをモデル化するとき(すなわちそれはリソースを表現するURIになりうる)は、動作ではなく名詞で表せるものに注目すべきだ。\\n3. 人間とコンピュータの統一インタフェース\\nリソース設計の際は、WebサービスとWeb APIを分けて考えない。\\n良いリソースのモデル化は人間にとってもわかりやすいし、Web APIとしても使いやすくなる。\\nなので、WebAPI用にリソースをモデル化してURIで表現し、人間にはまた別にモデル化して、、、ということは避けるべき。\\n積読本を読み切った感想と、本を読むスピードについて\\nさて、本の内容はここまでにして、以下は今回の積読消化の感想とそこから学んだことを記す。\\n本を読むスピードは状況や意識で大きく変わる。\\n1月に読んでいたときは理解できないところがあると調べて解決してから進める読み方だった。\\n読むスピードが遅くそのまま途中で止まっていた。^1\\n一方、今回9月は数時間で一気に読み切った。\\n気になったところはメモを取ることにして、読み切るために興味のわかないところ(例えばAtom/AtomPub等の項)は斜め読みにするなどして進めた。\\n本を読むスピードは自分の意識で変わる面がある。\\n細かいところまで理解しながらゆっくり読み進めるか、全体を俯瞰するためにとにかく読み切ることを目標に進めるかという意識だ。\\nまた、自分の知識量に応じて変わる面もある。\\n自分が知っていることが多く載っている本は早く読めるし、知らないことが多く載っている本は時間がかかる。\\nさらに、自分のテンションや気分で変わる面もある。\\n読む気があるとき、内容に興味が湧いているとき、知的好奇心から本の内容を欲しているときは、どんどんページが進んで苦なくはやく読める。\\n今回は一気に読み切ろうという心持ち、RESTって結局なんだっけという思いからくる知的好奇心、前回よりも知識量が増え内容の理解が進むことなど様々なことが重なったのが読み切れた要因だろう。\\n私は気分が乗っていないときに何も考えずに本を読むと、丁寧にゆっくり読む癖がある。\\n他方、本の全体像をつかみ必要なところだけを読んだり、必要になったときに読み直せるようインデックスを貼る気持ちで読んだりするほうが効率が良いのではないかと感じる。\\n実際今回の本も読み切って感じたが、後半には実例を交えたURIの設計について述べられた章があり、1月にここを読んでいれば身になるものがさらにあったはずだった。\\n今後はどんな読み方/スピードで本を読むかを読む前に考えるようにしたい。\\nまた、モチベーションの大切さも感じた。\\nプログラムを書くときもそうであるし、本を読むときもそうであるが、(少なくとも私にとって)物事を進めるにはモチベーションがとても重要だと思う。\\nモチベーションの高まっているときに躊躇なく進めることを心がけたい。\\n(さらには自分のモチベーションを導けるようになりたい。)\\nそんなこんなで積ん読を消化した勢いで他の本も読むぞ。\\n参考: yohei-y:weblog(著者 山本陽平さんのブログ) … この記事のURLwebteckbookはブログに記載された内容を参考にした。\\n注釈: ^1: 何故積ん読した当時のことを鮮明に覚えているかというと、本を読んでいた時が時間に追われながらコードを書きながら年末年始で帰省して親戚と過ごしていた映像記憶が蘇ってきたからである。\\nエピソード記憶は強烈だ。\\n当時はAPIの設計についても考えなければならなかったがDockerを含むインフラについても学ばねばならなかったので、のんびり本を読み切ってる場合ではない！という心情だったのだろう。\\n追記: (2020/10/04) 不要な改行を削除","guid":"https://memo.basd4g.net/posts/webteckbook/","isoDate":"2020-09-28T18:35:02.000Z"},{"title":"2020年9月のキーマップ for lily58","link":"https://memo.basd4g.net/posts/keymap-202009/","pubDate":"Fri, 25 Sep 2020 12:53:30 +0900","content":"<p><a href=\\"https://memo.basd4g.net/posts/lily58-pro-ble/\\">以前記事に書いた</a>とおり、分割キーボード lily58を使っている。</p>\\n<p>自作してから1ヶ月以上経つが、何度かキーマップを書き換えており、順調に配列沼にハマっている。</p>\\n<p>丁度、しばらく使っていてしっくり来ないところを昨日書き換えたばかり。\\nせっかくなので記録がてら記事に残しておく。</p>\\n<blockquote class=\\"twitter-tweet\\"><p lang=\\"ja\\" dir=\\"ltr\\">lily58のキーマップを変えた。<br><br>変更は<br>- コロンとバックスラッシュをlayer0に<br>- 中央のGと<br>Hに挟まれたキーを使わないことに<br><br>40%っぽく1段目を使っていないのは1ヶ月前くらいから。 <a href=\\"https://t.co/jWCNcd9f5p\\">pic.twitter.com/jWCNcd9f5p</a></p>&mdash; けーすけ@やんまー (@basd4g) <a href=\\"https://twitter.com/basd4g/status/1309153335530848256?ref_src=twsrc%5Etfw\\">September 24, 2020</a></blockquote> <script async src=\\"https://platform.twitter.com/widgets.js\\" charset=\\"utf-8\\"><\/script>\\n<p>3レイヤーで、最下段の内側から2つめのキーを押している間はレイヤーが切り替わる。</p>\\n<p>この配列は次のような方針で作られている。</p>\\n<ul>\\n<li>基本はqwertyのUS配列に寄せる</li>\\n<li>ホームポジションとそれに隣接するキーでなるべく完結させる</li>\\n<li>Layer0は英字, Layer1に記号と数字, Layer2に制御キーを割り当てる</li>\\n<li>方向キーはvim likeにhjklに割り当てる</li>\\n<li>(コードを書くとき等)記号の入力頻度が高いわりに私の入力スピードが遅いので、なるべく打ちやすいところに記号を配置する。</li>\\n</ul>\\n<p>lily58はもともと60%だが、最上段のキーは使っていない。\\nまた内側に括弧に割り当てやすいキーがあるが、それらのキーには割当していない。</p>\\n<p>初めて自作キーボードを購入する際は、40%キーボードはキーが少なすぎる過激な配列で、自分には独立した数字キーは必要だと思っていた。\\nしかし lily58 が届いていざ 打ってみると、数字キーは遠くて手が大きく動き、押しづらさを感じる。\\n遠いキーはブラインドタッチの障壁になりそうだと思ったのだ。</p>\\n<p>そのあと1ヶ月くらい使って、内側の括弧に割り当てやすいキー (GとHに挟まれたキー)も、意外とホームポジションから遠く押しづらいことに気づいた。</p>\\n<p>というわけで上のツイートの配列に落ち着いている。</p>\\n<p>40%でも問題なさそうなので、そのうち<a href=\\"https://olkb.com/collections/planck\\"target=\\"_blank\\">planck</a>や<a href=\\"https://drop.com/buy/massdrop-x-olkb-planck-light-mechanical-keyboard\\"target=\\"_blank\\">planck light</a>、<a href=\\"https://yushakobo.jp/shop/corne-cherry/\\"target=\\"_blank\\">Corne Cherry</a>といった、40%の column-staggered / Ortholiner なキーボードが欲しい。</p>\\n<p>というわけで、今後も変更があれば随時記録していきたい。</p>","contentSnippet":"以前記事に書いたとおり、分割キーボード lily58を使っている。\\n自作してから1ヶ月以上経つが、何度かキーマップを書き換えており、順調に配列沼にハマっている。\\n丁度、しばらく使っていてしっくり来ないところを昨日書き換えたばかり。\\nせっかくなので記録がてら記事に残しておく。\\nlily58のキーマップを変えた。\\n変更は\\n- コロンとバックスラッシュをlayer0に\\n- 中央のGと\\nHに挟まれたキーを使わないことに\\n40%っぽく1段目を使っていないのは1ヶ月前くらいから。 pic.twitter.com/jWCNcd9f5p\\n— けーすけ@やんまー (@basd4g) September 24, 2020\\n \\n3レイヤーで、最下段の内側から2つめのキーを押している間はレイヤーが切り替わる。\\nこの配列は次のような方針で作られている。\\n基本はqwertyのUS配列に寄せる\\nホームポジションとそれに隣接するキーでなるべく完結させる\\nLayer0は英字, Layer1に記号と数字, Layer2に制御キーを割り当てる\\n方向キーはvim likeにhjklに割り当てる\\n(コードを書くとき等)記号の入力頻度が高いわりに私の入力スピードが遅いので、なるべく打ちやすいところに記号を配置する。\\nlily58はもともと60%だが、最上段のキーは使っていない。\\nまた内側に括弧に割り当てやすいキーがあるが、それらのキーには割当していない。\\n初めて自作キーボードを購入する際は、40%キーボードはキーが少なすぎる過激な配列で、自分には独立した数字キーは必要だと思っていた。\\nしかし lily58 が届いていざ 打ってみると、数字キーは遠くて手が大きく動き、押しづらさを感じる。\\n遠いキーはブラインドタッチの障壁になりそうだと思ったのだ。\\nそのあと1ヶ月くらい使って、内側の括弧に割り当てやすいキー (GとHに挟まれたキー)も、意外とホームポジションから遠く押しづらいことに気づいた。\\nというわけで上のツイートの配列に落ち着いている。\\n40%でも問題なさそうなので、そのうちplanckやplanck light、Corne Cherryといった、40%の column-staggered / Ortholiner なキーボードが欲しい。\\nというわけで、今後も変更があれば随時記録していきたい。","guid":"https://memo.basd4g.net/posts/keymap-202009/","isoDate":"2020-09-25T03:53:30.000Z"},{"title":"Makefileの中で名前付きパイプ(bash記法)を使いたかった。2つのコマンド実行結果を比較する。","link":"https://memo.basd4g.net/posts/makefile-named-pipe/","pubDate":"Thu, 17 Sep 2020 16:31:46 +0900","content":"<p>今日は小さな Tips。</p>\\n<p>make は1970年代に生まれ、C言語のビルドなどでよく用いられるビルドツールだ。\\nMakefileにビルド手順を記述しておき <code>$make</code> で一連の流れを実行できる。</p>\\n<p>古からあるビルドツールであるから、インデントがタブ文字でないといけないなどの制約があるが、環境に依存しづらいので最近はよく使うようにしている。</p>\\n<p>Makefile にはシェルスクリプトのように実行するコマンドを記述するが、この中ではbash独自の拡張記法には対応していない。(Makefile独自の記法があったりする)</p>\\n<p>2つのコマンドの実行結果を比較したい時、bashでは次のように名前付きパイプを使うと簡単に記述できる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ diff &lt;<span class=\\"o\\">(</span><span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;hoge&#39;</span><span class=\\"o\\">)</span> &lt;<span class=\\"o\\">(</span><span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;fuga&#39;</span><span class=\\"o\\">)</span>\\n</code></pre></div><p>これは独自の記法でありMakefileの中では使えない。</p>\\n<p>そこで、名前付きパイプを避けて明示的にファイルディスクリプタを利用することで解決できる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;hoge&#39;</span> <span class=\\"p\\">|</span> <span class=\\"o\\">(</span><span class=\\"nb\\">echo</span> <span class=\\"s1\\">&#39;fuga&#39;</span> <span class=\\"p\\">|</span> diff /dev/fd/3 -<span class=\\"o\\">)</span> 3&lt;<span class=\\"p\\">&amp;</span><span class=\\"m\\">0</span>\\n</code></pre></div><p>まず、<code>$ehco \'hoge\'</code>の実行結果を標準出力ではなくファイルディスクリプタ3に流し込む。\\nそして、これ(/dev/fd/3)と<code>$echo \'fuga\'</code>の実行結果の標準出力をdiffで比較している。</p>\\n<h2 id=\\"参考\\">参考</h2>\\n<ul>\\n<li><a href=\\"https://yulii.github.io/diff-command-tips-20150627.html\\"target=\\"_blank\\">コマンド実行結果のdiff を取るといろいろ捗る - by and for engineers</a></li>\\n<li><a href=\\"https://ja.wikipedia.org/wiki/Make\\"target=\\"_blank\\">make - Wikipedia</a></li>\\n</ul>\\n<hr>\\n<p>p.s. 本「<a href=\\"https://www.amazon.co.jp/dp/B075ST51Y5/ref=dp-kindle-redirect?_encoding=UTF8&amp;btkr=1\\"target=\\"_blank\\">ふつうのLinuxプログラミング</a>」を参考に <a href=\\"https://github.com/basd4g/cat\\"target=\\"_blank\\">cat コマンドを作っていて</a>、簡単なテストスクリプトをMakefileに書きたいと思ったところから、このスニペットを必要とした。</p>","contentSnippet":"今日は小さな Tips。\\nmake は1970年代に生まれ、C言語のビルドなどでよく用いられるビルドツールだ。\\nMakefileにビルド手順を記述しておき $make で一連の流れを実行できる。\\n古からあるビルドツールであるから、インデントがタブ文字でないといけないなどの制約があるが、環境に依存しづらいので最近はよく使うようにしている。\\nMakefile にはシェルスクリプトのように実行するコマンドを記述するが、この中ではbash独自の拡張記法には対応していない。(Makefile独自の記法があったりする)\\n2つのコマンドの実行結果を比較したい時、bashでは次のように名前付きパイプを使うと簡単に記述できる。\\n$ diff <(echo \'hoge\') <(echo \'fuga\')\\n\\n\\nこれは独自の記法でありMakefileの中では使えない。\\nそこで、名前付きパイプを避けて明示的にファイルディスクリプタを利用することで解決できる。\\n$ echo \'hoge\' | (echo \'fuga\' | diff /dev/fd/3 -) 3<&0\\n\\n\\nまず、$ehco \'hoge\'の実行結果を標準出力ではなくファイルディスクリプタ3に流し込む。\\nそして、これ(/dev/fd/3)と$echo \'fuga\'の実行結果の標準出力をdiffで比較している。\\n参考\\nコマンド実行結果のdiff を取るといろいろ捗る - by and for engineers\\nmake - Wikipedia\\np.s. 本「ふつうのLinuxプログラミング」を参考に cat コマンドを作っていて、簡単なテストスクリプトをMakefileに書きたいと思ったところから、このスニペットを必要とした。","guid":"https://memo.basd4g.net/posts/makefile-named-pipe/","isoDate":"2020-09-17T07:31:46.000Z"},{"title":"LoveLabのAPIサーバをAWS EC2上にセットアップする","link":"https://memo.basd4g.net/posts/lovelab-ec2/","pubDate":"Fri, 14 Aug 2020 22:55:26 +0900","content":"<p>以下過去の自分用のメモを移動。</p>\\n<p>昨冬、チーム開発で ToDo 管理の iPhone アプリ LoveLab を開発していた。</p>\\n<p><a href=\\"https://github.com/basd4g/lovelab-api\\"target=\\"_blank\\">LoveLab API サーバ</a>は、docker-composeでまとめられている。\\nAWS の EC2 上で立ち上げるための手順を以下に示す。</p>\\n<h2 id=\\"ec2-instance作成後の作業\\">EC2 instance作成後の作業</h2>\\n<ol>\\n<li>\\n<p>80番ポートを開放</p>\\n</li>\\n<li>\\n<p>sshでログイン</p>\\n</li>\\n<li>\\n<p>関係ソフトウェアをinstall</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">sudo yum install -y docker\\nsudo service docker start\\nsudo usermod -a -G docker ec2-user\\nsudo docker info\\nsudo curl -L https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class=\\"k\\">$(</span>uname -s<span class=\\"k\\">)</span>-<span class=\\"k\\">$(</span>uname -m<span class=\\"k\\">)</span> -o /usr/local/bin/docker-compose\\nsudo chmod +x /usr/local/bin/docker-compose\\ndocker-compose --version\\nsudo yum install -y git\\n</code></pre></div></li>\\n<li>\\n<p>deploy.sshを入手</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">touch deploy.sh\\nchmod u+x deploy.sh\\nvim deploy.sh\\n</code></pre></div><div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-deploy.sh\\" data-lang=\\"deploy.sh\\"><span class=\\"cp\\">#!/bin/sh\\n</span><span class=\\"cp\\"></span>\\n<span class=\\"nb\\">echo</span> <span class=\\"s2\\">&#34;Deploying lovelab API server...&#34;</span>\\n<span class=\\"k\\">if</span> <span class=\\"o\\">[</span> -d ./lovelab.heroku <span class=\\"o\\">]</span><span class=\\"p\\">;</span> <span class=\\"k\\">then</span>\\n<span class=\\"nb\\">echo</span> <span class=\\"s2\\">&#34;Stop containers and delete old source files.&#34;</span>\\n<span class=\\"nb\\">cd</span> lovelab.heroku\\ndocker-compose down\\n<span class=\\"nb\\">cd</span> ../\\nrm -rf lovelab.heroku\\n<span class=\\"k\\">fi</span>\\n<span class=\\"nb\\">echo</span> <span class=\\"s2\\">&#34;Clone source files.&#34;</span>\\ngit clone https://github.com/basd4g/lovelab.heroku.git\\n<span class=\\"nb\\">cd</span> lovelab.heroku\\ngit checkout origin/release\\ncp .env.example .env\\n<span class=\\"nb\\">echo</span> <span class=\\"s2\\">&#34;docker-compose build&#34;</span>\\ndocker-compose build --no-cache\\n<span class=\\"nb\\">echo</span> <span class=\\"s2\\">&#34;docekr-compose up&#34;</span>\\ndocker-compose up -d\\n</code></pre></div></li>\\n</ol>","contentSnippet":"以下過去の自分用のメモを移動。\\n昨冬、チーム開発で ToDo 管理の iPhone アプリ LoveLab を開発していた。\\nLoveLab API サーバは、docker-composeでまとめられている。\\nAWS の EC2 上で立ち上げるための手順を以下に示す。\\nEC2 instance作成後の作業\\n80番ポートを開放\\nsshでログイン\\n関係ソフトウェアをinstall\\nsudo yum install -y docker\\nsudo service docker start\\nsudo usermod -a -G docker ec2-user\\nsudo docker info\\nsudo curl -L https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose\\nsudo chmod +x /usr/local/bin/docker-compose\\ndocker-compose --version\\nsudo yum install -y git\\n\\n\\ndeploy.sshを入手\\ntouch deploy.sh\\nchmod u+x deploy.sh\\nvim deploy.sh\\n\\n\\n#!/bin/sh\\n\\necho \\"Deploying lovelab API server...\\"\\nif [ -d ./lovelab.heroku ]; then\\necho \\"Stop containers and delete old source files.\\"\\ncd lovelab.heroku\\ndocker-compose down\\ncd ../\\nrm -rf lovelab.heroku\\nfi\\necho \\"Clone source files.\\"\\ngit clone https://github.com/basd4g/lovelab.heroku.git\\ncd lovelab.heroku\\ngit checkout origin/release\\ncp .env.example .env\\necho \\"docker-compose build\\"\\ndocker-compose build --no-cache\\necho \\"docekr-compose up\\"\\ndocker-compose up -d","guid":"https://memo.basd4g.net/posts/lovelab-ec2/","isoDate":"2020-08-14T13:55:26.000Z"},{"title":"LALR(1)構文解析を行いながら、コンパイラの構文解析を学ぶ","link":"https://memo.basd4g.net/posts/compiler-lalr1/","pubDate":"Fri, 14 Aug 2020 19:13:19 +0900","content":"<p>以下、過去の自分向けのメモの移動。</p>\\n<p>コンパイラの主要な処理に構文解析がある。\\n前回はLR0文法構文解析を行った。</p>\\n<p>今回は与えられたLALR(1)文法規則に基づいて構文解析するオートマトンを作り、構文解析の手法について整理する。</p>\\n<h2 id=\\"問題の文法規則\\">問題の文法規則</h2>\\n<p>次のLALR(1)文法規則を受理するオートマトンと構文解析表をつくり、構文解析を行う。</p>\\n<pre><code>E -&gt; E + T\\nE -&gt; T\\nT -&gt; T * F\\nT -&gt; F\\nF -&gt; i\\nF -&gt; ( E )\\n</code></pre><h2 id=\\"first集合\\">First集合</h2>\\n<h3 id=\\"first集合とは\\">First集合とは</h3>\\n<p><code>First(K)</code> &hellip; Kの還元前の終端記号列において、先頭に来る可能性のある終端記号の集合</p>\\n<h3 id=\\"first集合の求め方\\">First集合の求め方</h3>\\n<p>最初は空集合とする</p>\\n<h4 id=\\"非終端記号\\">非終端記号</h4>\\n<p><code>First(K)</code> (<code>K</code>..非終端記号)について、\\nKが左辺の文法規則が次の2つだったとき</p>\\n<ul>\\n<li><code>K -&gt; abc...</code></li>\\n<li><code>K -&gt; PqRs...</code></li>\\n</ul>\\n<p><code>First(K) = First(K) + First(a) + First(P)</code></p>\\n<h4 id=\\"終端記号\\">終端記号</h4>\\n<p><code>First(k)</code> (<code>k</code>&hellip;終端記号)について、\\n<code>First(k) = { k }</code></p>\\n<h3 id=\\"今回の問題におけるfirst集合\\">今回の問題におけるFirst集合</h3>\\n<p><code>First(E) = First(T) = First(F) = { i ( }</code></p>\\n<h2 id=\\"follow集合\\">Follow集合</h2>\\n<h3 id=\\"follow集合とは\\">Follow集合とは</h3>\\n<p><code>Follow(K)</code> &hellip; <code>K</code>の次に来る可能性のある終端記号の集合</p>\\n<h3 id=\\"follow集合の求め方\\">Follow集合の求め方</h3>\\n<p>最初は<code>{}</code>\\n開始記号のFollow集合に$を加える</p>\\n<p><code>Follow(K)</code>について</p>\\n<p>文法規則 <code>A -&gt; wK</code> (<code>w</code>は任意の文字列)ならば\\n<code>Follow(K) += Follow(A) </code></p>\\n<p>文法規則 <code>A -&gt; wKB</code>かつ <code>First(B)∋ε</code> ならば\\n<code>Follow(K) += Follow(A)</code></p>\\n<p>文法規則 <code>A -&gt; xKy (y≠ε)</code> ならば\\n<code>Follow(K) += First(y)</code></p>\\n<h3 id=\\"今回の問題におけるfollow集合\\">今回の問題におけるFollow集合</h3>\\n<pre><code>Follow(E) = { $ } + First( ) ) + First( + ) = { $ ) + }\\nFollow(T) = Follow(E) + First( * ) = { $ ) + * }\\nFollow(F) = Follow(T) = { $ ) + * }\\n</code></pre><h2 id=\\"lalr1正準集合\\">LALR(1)正準集合</h2>\\n<h3 id=\\"i0\\">I0</h3>\\n<pre><code>E -&gt; ・E + T [ $ + ]\\nE -&gt; ・T [ $ + ]\\nT -&gt; ・T * F [ $ + * ]\\nT -&gt; ・F [ $ + * ]\\nF -&gt; ・i [ $ + * ]\\nF -&gt; ・( E ) [ $ + * ]\\n</code></pre><h3 id=\\"i1\\">I1</h3>\\n<pre><code>E -&gt; E ・+ T [ $ + ]\\n</code></pre><h3 id=\\"i2\\">I2</h3>\\n<pre><code>E -&gt; T・ [ $ + ) ]\\nT -&gt; T ・* F [ $ + * ) ]\\n</code></pre><h3 id=\\"i3\\">I3</h3>\\n<pre><code>T -&gt; F・ [ $ + * ) ]\\n</code></pre><h3 id=\\"i4\\">I4</h3>\\n<pre><code>F -&gt; i・ [ $ + * ) ]\\n</code></pre><h3 id=\\"i5\\">I5</h3>\\n<pre><code>F -&gt; ( ・E ) [ $ + * ) ]\\nE -&gt; ・E + T [ + ) ]\\nE -&gt; ・T [ + ) ]\\nT -&gt; ・T * F [ + * ) ]\\nT -&gt; ・F [ + * ) ]\\nF -&gt; ・i [ + * ) ]\\nF -&gt; ・( E ) [ + * ) ]\\n</code></pre><h3 id=\\"i6\\">I6</h3>\\n<pre><code>E -&gt; E + ・T [ $ + ) ]\\nT -&gt; ・T * F [ $ + * ) ]\\nT -&gt; ・F [ $ + * ) ]\\nF -&gt; ・i [ $ + * ) ]\\nF -&gt; ・( E ) [ $ + * ) ]\\n</code></pre><h3 id=\\"i7\\">I7</h3>\\n<pre><code>T -&gt; T * ・F [ $ + * ) ]\\nF -&gt; ・i [ $ + * ) ]\\nF -&gt; ・( E ) [ $ + * ) ]\\n</code></pre><h3 id=\\"i8\\">I8</h3>\\n<pre><code>F -&gt; ( E ・) [ $ + * ) ]\\nE -&gt; E ・+ T [ + ) ]\\n</code></pre><h3 id=\\"i9\\">I9</h3>\\n<pre><code>E -&gt; E + T・ [ $ + ) ]\\nT -&gt; T ・* F [ $ + * ) ]\\n</code></pre><h3 id=\\"i10\\">I10</h3>\\n<pre><code>T -&gt; T * F・ [ $ + * ) ]\\n</code></pre><h3 id=\\"i11\\">I11</h3>\\n<pre><code>F -&gt; ( E )・ [ $ + * ) ]\\n</code></pre><h2 id=\\"オートマトン\\">オートマトン</h2>\\n<p>以上より、与えられた文法規則を満たす系列を受理するオートマトンをつくる。</p>\\n<pre><code class=\\"language-dot\\" data-lang=\\"dot\\">digraph G {\\nrankdir=LR;\\nempty [label = &quot;&quot; shape = plaintext];\\nnode [shape = doublecircle];I2 I9;\\nnode [shape = circle];\\nempty -&gt; I0 [label = &quot;start&quot;];\\nI0 -&gt; I1 [label = &quot;E&quot;];\\nI0 -&gt; I2 [label = &quot;T&quot;];\\nI0 -&gt; I3 [label = &quot;F&quot;];\\nI0 -&gt; I4 [label = &quot;i&quot;];\\nI0 -&gt; I5 [label = &quot;(&quot;];\\nI1 -&gt; I6 [label = &quot;+&quot;];\\nI2 -&gt; I7 [label = &quot;*&quot;];\\nI5 -&gt; I8 [label = &quot;E&quot;];\\nI5 -&gt; I2 [label = &quot;T&quot;];\\nI5 -&gt; I3 [label = &quot;F&quot;];\\nI5 -&gt; I4 [label = &quot;i&quot;];\\nI5 -&gt; I5 [label = &quot;(&quot;];\\nI6 -&gt; I9 [label = &quot;T&quot;];\\nI6 -&gt; I3 [label = &quot;F&quot;];\\nI6 -&gt; I4 [label = &quot;i&quot;];\\nI6 -&gt; I5 [label = &quot;(&quot;];\\nI7 -&gt; I10 [label = &quot;F&quot;];\\nI7 -&gt; I4 [label = &quot;i&quot;];\\nI7 -&gt; I5 [label = &quot;(&quot;];\\nI8 -&gt; I11 [label = &quot;)&quot;];\\nI8 -&gt; I6 [label = &quot;+&quot;];\\nI9 -&gt; I7 [label = &quot;*&quot;];\\n}\\n</code></pre><h2 id=\\"構文解析表\\">構文解析表</h2>\\n<p>オートマトンを構文解析表にまとめる。</p>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\"left\\">I\\\\記号</th>\\n<th>+</th>\\n<th>*</th>\\n<th>(</th>\\n<th>)</th>\\n<th>i</th>\\n<th>$</th>\\n<th>E</th>\\n<th>T</th>\\n<th>F</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td align=\\"left\\">0</td>\\n<td></td>\\n<td></td>\\n<td>s5</td>\\n<td></td>\\n<td>s4</td>\\n<td></td>\\n<td>1</td>\\n<td>2</td>\\n<td>3</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">1</td>\\n<td>s6</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">2</td>\\n<td>r2</td>\\n<td>s7</td>\\n<td></td>\\n<td>r2</td>\\n<td></td>\\n<td>acc</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">3</td>\\n<td>r4</td>\\n<td>r4</td>\\n<td></td>\\n<td>r4</td>\\n<td></td>\\n<td>r4</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">4</td>\\n<td>r5</td>\\n<td>r5</td>\\n<td></td>\\n<td>r5</td>\\n<td></td>\\n<td>r5</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">5</td>\\n<td></td>\\n<td></td>\\n<td>s5</td>\\n<td></td>\\n<td>s4</td>\\n<td></td>\\n<td>8</td>\\n<td>2</td>\\n<td>3</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">6</td>\\n<td></td>\\n<td></td>\\n<td>s5</td>\\n<td></td>\\n<td>s4</td>\\n<td></td>\\n<td></td>\\n<td>9</td>\\n<td>3</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">7</td>\\n<td></td>\\n<td></td>\\n<td>s5</td>\\n<td></td>\\n<td>s4</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td>10</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">8</td>\\n<td>s6</td>\\n<td></td>\\n<td></td>\\n<td>s11</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">9</td>\\n<td>r1</td>\\n<td>s7</td>\\n<td></td>\\n<td>r1</td>\\n<td></td>\\n<td>acc</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">10</td>\\n<td>r3</td>\\n<td>r3</td>\\n<td></td>\\n<td>r3</td>\\n<td></td>\\n<td>r3</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">11</td>\\n<td>r6</td>\\n<td>r6</td>\\n<td></td>\\n<td>r6</td>\\n<td></td>\\n<td>r6</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n</tbody>\\n</table>\\n<h2 id=\\"構文解析\\">構文解析</h2>\\n<p>上記の構文解析表に従い、次のような系列を構文解析する。</p>\\n<h3 id=\\"iii\\"><code>i+i*i</code></h3>\\n<pre><code>( I0 , i+i*i$ ) // s6\\n( I0 i I4 , +i*i$ ) // r5\\n( I0 F I3 , +i*i$ ) // r4\\n( I0 T I2 , +i*i$ ) // r2\\n( I0 F I1 , +i*i$ ) // s6\\n( I0 F I1 + I6 , i*i$ ) // s4\\n( I0 F I1 + I6 i I4 , *i$ ) // r5\\n( I0 F I1 + I6 F I3 , *i$ ) // r4\\n( I0 F I1 + I6 T I9 , *i$ ) // s7\\n( I0 F I1 + I6 T I9 * I7 , i$ ) // s4\\n( I0 F I1 + I6 T I9 * I7 i I4 , $ ) // r5\\n( I0 F I1 + I6 T I9 * I7 F I10 , $ ) // r3\\n( I0 F I1 + I6 T I9 , $ ) //\\n</code></pre><h3 id=\\"iii-1\\"><code>i*(i+i)</code></h3>\\n<p>(略)</p>\\n<h3 id=\\"-iii\\"><code> i*i+*i</code></h3>\\n<p>(略)</p>\\n<style>\\n.article.markdown-body table th {\\nmin-width: 0px;\\n}\\n.article.markdown-body table td {\\nmin-width: 0px;\\n}\\n</style>","contentSnippet":"以下、過去の自分向けのメモの移動。\\nコンパイラの主要な処理に構文解析がある。\\n前回はLR0文法構文解析を行った。\\n今回は与えられたLALR(1)文法規則に基づいて構文解析するオートマトンを作り、構文解析の手法について整理する。\\n問題の文法規則\\n次のLALR(1)文法規則を受理するオートマトンと構文解析表をつくり、構文解析を行う。\\nE -> E + T\\nE -> T\\nT -> T * F\\nT -> F\\nF -> i\\nF -> ( E )\\n\\nFirst集合\\nFirst集合とは\\nFirst(K) … Kの還元前の終端記号列において、先頭に来る可能性のある終端記号の集合\\nFirst集合の求め方\\n最初は空集合とする\\n非終端記号\\nFirst(K) (K..非終端記号)について、\\nKが左辺の文法規則が次の2つだったとき\\nK -> abc...\\nK -> PqRs...\\nFirst(K) = First(K) + First(a) + First(P)\\n終端記号\\nFirst(k) (k…終端記号)について、\\nFirst(k) = { k }\\n今回の問題におけるFirst集合\\nFirst(E) = First(T) = First(F) = { i ( }\\nFollow集合\\nFollow集合とは\\nFollow(K) … Kの次に来る可能性のある終端記号の集合\\nFollow集合の求め方\\n最初は{}\\n開始記号のFollow集合に$を加える\\nFollow(K)について\\n文法規則 A -> wK (wは任意の文字列)ならば\\nFollow(K) += Follow(A) \\n文法規則 A -> wKBかつ First(B)∋ε ならば\\nFollow(K) += Follow(A)\\n文法規則 A -> xKy (y≠ε) ならば\\nFollow(K) += First(y)\\n今回の問題におけるFollow集合\\nFollow(E) = { $ } + First( ) ) + First( + ) = { $ ) + }\\nFollow(T) = Follow(E) + First( * ) = { $ ) + * }\\nFollow(F) = Follow(T) = { $ ) + * }\\n\\nLALR(1)正準集合\\nI0\\nE -> ・E + T [ $ + ]\\nE -> ・T [ $ + ]\\nT -> ・T * F [ $ + * ]\\nT -> ・F [ $ + * ]\\nF -> ・i [ $ + * ]\\nF -> ・( E ) [ $ + * ]\\n\\nI1\\nE -> E ・+ T [ $ + ]\\n\\nI2\\nE -> T・ [ $ + ) ]\\nT -> T ・* F [ $ + * ) ]\\n\\nI3\\nT -> F・ [ $ + * ) ]\\n\\nI4\\nF -> i・ [ $ + * ) ]\\n\\nI5\\nF -> ( ・E ) [ $ + * ) ]\\nE -> ・E + T [ + ) ]\\nE -> ・T [ + ) ]\\nT -> ・T * F [ + * ) ]\\nT -> ・F [ + * ) ]\\nF -> ・i [ + * ) ]\\nF -> ・( E ) [ + * ) ]\\n\\nI6\\nE -> E + ・T [ $ + ) ]\\nT -> ・T * F [ $ + * ) ]\\nT -> ・F [ $ + * ) ]\\nF -> ・i [ $ + * ) ]\\nF -> ・( E ) [ $ + * ) ]\\n\\nI7\\nT -> T * ・F [ $ + * ) ]\\nF -> ・i [ $ + * ) ]\\nF -> ・( E ) [ $ + * ) ]\\n\\nI8\\nF -> ( E ・) [ $ + * ) ]\\nE -> E ・+ T [ + ) ]\\n\\nI9\\nE -> E + T・ [ $ + ) ]\\nT -> T ・* F [ $ + * ) ]\\n\\nI10\\nT -> T * F・ [ $ + * ) ]\\n\\nI11\\nF -> ( E )・ [ $ + * ) ]\\n\\nオートマトン\\n以上より、与えられた文法規則を満たす系列を受理するオートマトンをつくる。\\ndigraph G {\\nrankdir=LR;\\nempty [label = \\"\\" shape = plaintext];\\nnode [shape = doublecircle];I2 I9;\\nnode [shape = circle];\\nempty -> I0 [label = \\"start\\"];\\nI0 -> I1 [label = \\"E\\"];\\nI0 -> I2 [label = \\"T\\"];\\nI0 -> I3 [label = \\"F\\"];\\nI0 -> I4 [label = \\"i\\"];\\nI0 -> I5 [label = \\"(\\"];\\nI1 -> I6 [label = \\"+\\"];\\nI2 -> I7 [label = \\"*\\"];\\nI5 -> I8 [label = \\"E\\"];\\nI5 -> I2 [label = \\"T\\"];\\nI5 -> I3 [label = \\"F\\"];\\nI5 -> I4 [label = \\"i\\"];\\nI5 -> I5 [label = \\"(\\"];\\nI6 -> I9 [label = \\"T\\"];\\nI6 -> I3 [label = \\"F\\"];\\nI6 -> I4 [label = \\"i\\"];\\nI6 -> I5 [label = \\"(\\"];\\nI7 -> I10 [label = \\"F\\"];\\nI7 -> I4 [label = \\"i\\"];\\nI7 -> I5 [label = \\"(\\"];\\nI8 -> I11 [label = \\")\\"];\\nI8 -> I6 [label = \\"+\\"];\\nI9 -> I7 [label = \\"*\\"];\\n}\\n\\n構文解析表\\nオートマトンを構文解析表にまとめる。\\nI\\\\記号\\n+\\n*\\n(\\n)\\ni\\n$\\nE\\nT\\nF\\n\\n\\n\\n\\n0\\n\\n\\ns5\\n\\ns4\\n\\n1\\n2\\n3\\n\\n\\n1\\ns6\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n2\\nr2\\ns7\\n\\nr2\\n\\nacc\\n\\n\\n\\n\\n\\n3\\nr4\\nr4\\n\\nr4\\n\\nr4\\n\\n\\n\\n\\n\\n4\\nr5\\nr5\\n\\nr5\\n\\nr5\\n\\n\\n\\n\\n\\n5\\n\\n\\ns5\\n\\ns4\\n\\n8\\n2\\n3\\n\\n\\n6\\n\\n\\ns5\\n\\ns4\\n\\n\\n9\\n3\\n\\n\\n7\\n\\n\\ns5\\n\\ns4\\n\\n\\n\\n10\\n\\n\\n8\\ns6\\n\\n\\ns11\\n\\n\\n\\n\\n\\n\\n\\n9\\nr1\\ns7\\n\\nr1\\n\\nacc\\n\\n\\n\\n\\n\\n10\\nr3\\nr3\\n\\nr3\\n\\nr3\\n\\n\\n\\n\\n\\n11\\nr6\\nr6\\n\\nr6\\n\\nr6\\n\\n\\n\\n\\n\\n\\n構文解析\\n上記の構文解析表に従い、次のような系列を構文解析する。\\ni+i*i\\n( I0 , i+i*i$ ) // s6\\n( I0 i I4 , +i*i$ ) // r5\\n( I0 F I3 , +i*i$ ) // r4\\n( I0 T I2 , +i*i$ ) // r2\\n( I0 F I1 , +i*i$ ) // s6\\n( I0 F I1 + I6 , i*i$ ) // s4\\n( I0 F I1 + I6 i I4 , *i$ ) // r5\\n( I0 F I1 + I6 F I3 , *i$ ) // r4\\n( I0 F I1 + I6 T I9 , *i$ ) // s7\\n( I0 F I1 + I6 T I9 * I7 , i$ ) // s4\\n( I0 F I1 + I6 T I9 * I7 i I4 , $ ) // r5\\n( I0 F I1 + I6 T I9 * I7 F I10 , $ ) // r3\\n( I0 F I1 + I6 T I9 , $ ) //\\n\\ni*(i+i)\\n(略)\\n i*i+*i\\n(略)\\n\\n.article.markdown-body table th {\\nmin-width: 0px;\\n}\\n.article.markdown-body table td {\\nmin-width: 0px;\\n}","guid":"https://memo.basd4g.net/posts/compiler-lalr1/","isoDate":"2020-08-14T10:13:19.000Z"},{"title":"LR(0)構文解析を行いながら、コンパイラの構文解析を学ぶ","link":"https://memo.basd4g.net/posts/compiler-lr0/","pubDate":"Fri, 14 Aug 2020 19:04:31 +0900","content":"<p>以下、過去の自分向けのメモの移動。</p>\\n<p>コンパイラの主要な処理に構文解析がある。\\n今回は与えられたLR(0)文法規則に基づいて構文解析するオートマトンを作り、構文解析の手法について整理する。</p>\\n<h2 id=\\"問題\\">問題</h2>\\n<p>次の文法について、次の問を答えよ</p>\\n<pre><code>S -&gt; ( L )\\nS -&gt; a\\nL -&gt; L , S\\nL -&gt; S\\n</code></pre><p>上から順にR1,R2,R3,R4と呼ぶ。</p>\\n<p>ただし、SとLは非終端記号、(と)と,とaは終端記号とする。</p>\\n<ul>\\n<li>LR(0)正準集合とオートマトンを求めよ</li>\\n<li>以下の文字列が示された文法から生成されるかどうか、また構文解析の結果を答えよ</li>\\n</ul>\\n<h2 id=\\"lr0構文解析の方法\\">LR(0)構文解析の方法</h2>\\n<h3 id=\\"lrk構文解析とは\\">LR(k)構文解析とは</h3>\\n<ul>\\n<li>上向き構文解析(下向きは再帰的に行うが、バックトラックが発生するため大変)</li>\\n<li>左(Left)から読み、右端導出(Right most derivation)</li>\\n<li>kとは、先読みできる記号の数</li>\\n</ul>\\n<h3 id=\\"lr0構文解析の流れ\\">LR(0)構文解析の流れ</h3>\\n<ol>\\n<li>LR(0)正準集合とオートマトンをつくる</li>\\n<li>構文解析表を作る</li>\\n<li>構文解析表を元に解析する</li>\\n</ol>\\n<h3 id=\\"方針-shiftまたはreduceを繰り返し開始記号1つにまとまれば完了\\">方針: shiftまたはreduceを繰り返し、開始記号1つにまとまれば完了</h3>\\n<ul>\\n<li>shift: 入力を1つ読み込むこと</li>\\n<li>reduce: 文法規則を適用し、記号をまとめること</li>\\n</ul>\\n<p>オートマトンの状態をスタックに積みながら、行う</p>\\n<p>shiftするときは、入力を読み込み、入力記号に従い有向辺を遷移する。遷移後の状態をスタックにpushする。</p>\\n<p>reduceするときは、適用する文法規則に則って、いままでの遷移を巻き戻し(スタックを記号数分popし)、適用後の記号の遷移を積み直す(pushする)。</p>\\n<p>オートマトンを表にまとめ、情報を更かして、shift、reduceの手順を示したのが構文解析表である。</p>\\n<h2 id=\\"lr0におけるオートマトンの作成\\">LR(0)におけるオートマトンの作成</h2>\\n<h3 id=\\"前提\\">前提</h3>\\n<h4 id=\\"lr0項とは--アイテム記法\\">LR(0)項とは &hellip; (アイテム記法)</h4>\\n<p>文法規則の右辺、各記号の前後1箇所に・(ドット)を加えたもの。例えば<code>S -&gt; ( ・L )</code>といった表記</p>\\n<p>これは、ドットの前方は読み込み済みであること、ドットの後方は未読み込みであることを示す。</p>\\n<p>(読み込むとは、ドットを1つ右に移動させること(ドットが1つ右のLR(0)項を含む状態に遷移すること(後術)であって、ドットの次が何の値であるか確認することではない)。</p>\\n<h4 id=\\"lr0正準集合とは\\">LR(0)正準集合とは</h4>\\n<p>LR(0)項の集合である。\\nオートマトンを作成する際に一緒に作成する。</p>\\n<h4 id=\\"lr0におけるオートマトンとは\\">LR(0)におけるオートマトンとは</h4>\\n<p>LR(0)正準集合を状態、記号を1つもつ有向辺としたオートマトン。</p>\\n<h3 id=\\"lr0におけるオートマトンを作成する方法\\">LR(0)におけるオートマトンを作成する方法</h3>\\n<h4 id=\\"1-初期状態を定める\\">1. 初期状態を定める</h4>\\n<p>状態には開始記号が左辺で、ドットが最左なLR(0)項をすべて含む。\\n(※)を行う。</p>\\n<h4 id=\\"2-その他の状態を定める\\">2. その他の状態を定める</h4>\\n<p>既に存在する状態のドットが最右にないLR(0)項について、記号を一つ読み込んだ状態を新たにつくる。</p>\\n<p>遷移の有向辺には、読み込む記号をもたせる。\\n遷移後の状態は、記号を1つ読み込んだLR(0)項(ドットを1記号分右にずらしたLR(0)項)を含む。</p>\\n<p>さらに、遷移前の状態の他のLR(0)項について考える。\\n同じ記号を読み込める物があれば(遷移前のLR(0)項同士でドットの右隣の記号が一致すれば)、このLR(0)項についても、1記号読み込み後のLR(0)項を遷移後の状態に加える。</p>\\n<p>(※)を行う。</p>\\n<h4 id=\\"3-繰り返す\\">3. 繰り返す</h4>\\n<p>行える限り 2. を行う。</p>\\n<h4 id=\\"heading\\">(※)</h4>\\n<p>ある状態について、この状態に含むLR(0)項を考える。</p>\\n<p>ドットの右隣に非終端記号のあるLR(0)項があるならば、その終端記号を左辺に持ちドットが最左であるLR(0)項をすべて同じ状態に加える。</p>\\n<h3 id=\\"作成したオートマトン\\">作成したオートマトン</h3>\\n<h4 id=\\"状態遷移表\\">状態遷移表</h4>\\n<pre><code class=\\"language-dot\\" data-lang=\\"dot\\">digraph G {\\nrankdir=LR;\\nempty [label = &quot;&quot; shape = plaintext];\\nnode [shape = doublecircle];I2 I4;\\nnode [shape = circle];\\nempty -&gt; I0 [label = &quot;start&quot;];\\nI0 -&gt; I1 [label = &quot;(&quot;];\\nI0 -&gt; I2 [label = &quot;a&quot;];\\nI1 -&gt; I2 [label = &quot;a&quot;];\\nI1 -&gt; I3 [label = &quot;L&quot;];\\nI3 -&gt; I4 [label = &quot;)&quot;];\\nI3 -&gt; I5 [label = &quot;,&quot;];\\nI5 -&gt; I7 [label = &quot;S&quot;];\\nI1 -&gt; I1 [label = &quot;(&quot;];\\nI5 -&gt; I1 [label = &quot;(&quot;];\\nI5 -&gt; I2 [label = &quot;a&quot;];\\nI1 -&gt; I6 [label = &quot;S&quot;];\\n}\\n</code></pre><h4 id=\\"状態i0\\">状態I0</h4>\\n<ul>\\n<li><code>S -&gt; ・( L )</code></li>\\n<li><code>S -&gt; ・a</code></li>\\n</ul>\\n<h4 id=\\"状態i1\\">状態I1</h4>\\n<ul>\\n<li><code>S -&gt; ( ・L )</code> (・の右隣に非終端記号)</li>\\n<li><code>L -&gt; ・L , S</code></li>\\n<li><code>L -&gt; ・S</code> (・の右隣に非終端記号)</li>\\n<li><code>S -&gt; ・( L )</code></li>\\n<li><code>S -&gt; ・a</code></li>\\n</ul>\\n<h4 id=\\"状態i2\\">状態I2</h4>\\n<ul>\\n<li><code>S -&gt; a ・</code></li>\\n</ul>\\n<h4 id=\\"状態i3\\">状態I3</h4>\\n<ul>\\n<li><code>S -&gt; ( L ・)</code></li>\\n<li><code>L -&gt; L ・, S</code></li>\\n</ul>\\n<h4 id=\\"状態i4\\">状態I4</h4>\\n<ul>\\n<li><code>S -&gt; ( L ) ・</code></li>\\n</ul>\\n<h4 id=\\"状態i5\\">状態I5</h4>\\n<ul>\\n<li><code>L -&gt; L , ・S</code> (・の右隣に非終端記号)</li>\\n<li><code>S -&gt; ・( L )</code></li>\\n<li><code>S -&gt; ・a</code></li>\\n</ul>\\n<h4 id=\\"状態i6\\">状態I6</h4>\\n<ul>\\n<li><code>L -&gt; S ・</code></li>\\n</ul>\\n<h4 id=\\"状態i7\\">状態I7</h4>\\n<ul>\\n<li><code>L -&gt; L , S ・</code></li>\\n</ul>\\n<h2 id=\\"構文解析表\\">構文解析表</h2>\\n<p>現在の状態(スタックのトップ)の行、入力記号(読み込み前)の列のセルに、次の動作を書いた表。</p>\\n<p>次の動作とは、次のようなものである。</p>\\n<ul>\\n<li>shiftするかreduceするか</li>\\n<li>shiftならどの状態に遷移するか</li>\\n<li>reduceならどの文法規則を適用するか</li>\\n</ul>\\n<h3 id=\\"構文解析表のつくりかた\\">構文解析表のつくりかた</h3>\\n<h4 id=\\"1-縦軸のラベル\\">1. 縦軸のラベル</h4>\\n<p>縦軸にLR(0)正準集合を置く</p>\\n<h4 id=\\"2-横軸のラベル\\">2. 横軸のラベル</h4>\\n<p>横軸に記号を置く。(このとき、終端記号と非終端記号は分ける、。終端記号に$(入力の終了を表す)を加える)</p>\\n<h4 id=\\"3-shift\\">3. shift</h4>\\n<p>遷移元の状態を行、遷移時の終端記号を列とするセルに、skと書き込む。(状態Ikに遷移する)</p>\\n<p>shift(入力を1つ読み込む)して、スタックにkを積む(状態Ikに遷移する)ことを表す。</p>\\n<h4 id=\\"4-reduce時のpushする積み直す状態\\">4. reduce時のpushする(積み直す)状態</h4>\\n<p>遷移元の状態を行、遷移時の非終端記号を列とするセルに、kと書き込む。(状態Ikに遷移する)</p>\\n<p>reduce時、還元後の状態(文法規則の左辺)をスタックに積み直す動作を表す。</p>\\n<h4 id=\\"5-reduce時の適用する文法規則\\">5. reduce時の適用する文法規則</h4>\\n<p>最右がドットであるLR(0)項を含む状態の行、終端記号の列にrkと書き込む。(文法規則Rkを適用する)</p>\\n<h4 id=\\"6-完了状態\\">6. 完了状態</h4>\\n<p>左辺が開始記号で右辺のドットが最右であるLR(0)項を含む状態の行\\n、$(入力終了)の列のセルに、accと書き込む。</p>\\n<p>accを参照したら構文が正しいことが示され、構文解析を終了する。</p>\\n<h3 id=\\"構文解析表の作成結果\\">構文解析表の作成結果</h3>\\n<p>今回の構文解析表は次の通り</p>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\"left\\">I\\\\記号</th>\\n<th>(</th>\\n<th>)</th>\\n<th>,</th>\\n<th>a</th>\\n<th>$</th>\\n<th>S</th>\\n<th>L</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td align=\\"left\\">0</td>\\n<td>s1</td>\\n<td></td>\\n<td></td>\\n<td>s2</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">1</td>\\n<td>s1</td>\\n<td></td>\\n<td></td>\\n<td>s2</td>\\n<td></td>\\n<td>6</td>\\n<td>3</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">2</td>\\n<td>r2</td>\\n<td>r2</td>\\n<td>r2</td>\\n<td>r2</td>\\n<td>acc</td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">3</td>\\n<td></td>\\n<td>s4</td>\\n<td>s5</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">4</td>\\n<td>r1</td>\\n<td>r1</td>\\n<td>r1</td>\\n<td>r1</td>\\n<td>acc</td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">5</td>\\n<td>s1</td>\\n<td></td>\\n<td></td>\\n<td>s2</td>\\n<td></td>\\n<td>7</td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">6</td>\\n<td>r4</td>\\n<td>r4</td>\\n<td>r4</td>\\n<td>r4</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">7</td>\\n<td>r3</td>\\n<td>r3</td>\\n<td>r3</td>\\n<td>r3</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n</tbody>\\n</table>\\n<h3 id=\\"余談構文解析表が表すもの\\">余談:構文解析表が表すもの</h3>\\n<p>構文解析表の持つ情報は、次の3つに分けられる</p>\\n<h4 id=\\"1-オートマトンの状態遷移表\\">1. オートマトンの状態遷移表</h4>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\"left\\">I\\\\記号</th>\\n<th>(</th>\\n<th>)</th>\\n<th>,</th>\\n<th>a</th>\\n<th>S</th>\\n<th>L</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td align=\\"left\\">0</td>\\n<td>1</td>\\n<td></td>\\n<td></td>\\n<td>2</td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">1</td>\\n<td>1</td>\\n<td></td>\\n<td></td>\\n<td>2</td>\\n<td>6</td>\\n<td>3</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">2</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">3</td>\\n<td></td>\\n<td>4</td>\\n<td>5</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">4</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">5</td>\\n<td>1</td>\\n<td></td>\\n<td></td>\\n<td>2</td>\\n<td></td>\\n<td>7</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">6</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">7</td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n<td></td>\\n</tr>\\n</tbody>\\n</table>\\n<h4 id=\\"2-reduce可能状態と適用する文法規則\\">2. reduce可能状態と適用する文法規則</h4>\\n<p>I2のとき、文法規則R2を適用する。\\nI4のとき、文法規則R1を適用する。\\nI6のとき、文法規則R4を適用する。\\nI3のとき、文法規則R3を適用する。</p>\\n<h4 id=\\"3-完了状態\\">3. 完了状態</h4>\\n<p>I2,I4で全て読み込み済みのとき、構文解析が完了する。</p>\\n<h2 id=\\"構文解析\\">構文解析</h2>\\n<p>状態を記録するスタックを用意して、スタックトップと次の入力をもとに、動作を行う。</p>\\n<h3 id=\\"構文解析の方法\\">構文解析の方法</h3>\\n<h4 id=\\"1-初期状態ikであるときkをスタックに積む\\">1. 初期状態Ikであるとき、kをスタックに積む</h4>\\n<h4 id=\\"2-スタックtopの状態の行次の入力記号の列のセルの指示に従う\\">2. スタックtopの状態の行、次の入力記号の列のセルの指示に従う</h4>\\n<h5 id=\\"sk\\">sk</h5>\\n<p>shiftする。</p>\\n<ul>\\n<li>入力を読み取る。(次の動作のとき入力を次の終端記号にすすめる)</li>\\n<li>スタックにkを積む</li>\\n</ul>\\n<p>(オートマトンにおいて、入力の終端記号を辺とする状態遷移を行う)</p>\\n<h5 id=\\"rk\\">rk</h5>\\n<p>文法規則Rkに従ってreduceする。</p>\\n<ul>\\n<li>文法Rkを適用することを記録する。</li>\\n<li>文法Rkの右辺の記号数分、スタックをpopする。(状態遷移を巻き戻す)</li>\\n<li>上行のpop後のスタックトップの状態を行、文法Rkの左側の記号を列とするセルの数字をスタックにpushする。(文法Rk左側の記号の状態遷移を積み直す)</li>\\n</ul>\\n<h5 id=\\"acc\\">acc</h5>\\n<p>構文解析は成功。入力の分は、与えられた文法規則から生成される。\\n構文解析を終了する。</p>\\n<p>適用すべき文法規則とその順は、記録された文法規則Rkを順に読む。</p>\\n<h5 id=\\"空\\">空</h5>\\n<p>構文解析は失敗。入力の文は、与えられた文法規則から生成されることはない。</p>\\n<h3 id=\\"構文解析の結果\\">構文解析の結果</h3>\\n<p>次の文を構文解析する。</p>\\n<p>上から順に、解析の経過を記す。</p>\\n<h4 id=\\"aaa\\"><code>((a,a),a)</code></h4>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\"left\\">入力</th>\\n<th>スタックtop</th>\\n<th>操作</th>\\n<th align=\\"left\\">スタック</th>\\n<th align=\\"left\\">読み取り済み</th>\\n<th align=\\"left\\">還元後</th>\\n<th align=\\"left\\">文法規則</th>\\n<th align=\\"left\\">補足</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td align=\\"left\\"></td>\\n<td></td>\\n<td></td>\\n<td align=\\"left\\">0</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>0</td>\\n<td>s1</td>\\n<td align=\\"left\\">01</td>\\n<td align=\\"left\\">(</td>\\n<td align=\\"left\\">(</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>1</td>\\n<td>s1</td>\\n<td align=\\"left\\">011</td>\\n<td align=\\"left\\">((</td>\\n<td align=\\"left\\">((</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>1</td>\\n<td>s2</td>\\n<td align=\\"left\\">0112</td>\\n<td align=\\"left\\">((a</td>\\n<td align=\\"left\\">((a</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">0116</td>\\n<td align=\\"left\\">((a</td>\\n<td align=\\"left\\">((S</td>\\n<td align=\\"left\\">2</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">0113</td>\\n<td align=\\"left\\">((a</td>\\n<td align=\\"left\\">((L</td>\\n<td align=\\"left\\">24</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">01135</td>\\n<td align=\\"left\\">((a,</td>\\n<td align=\\"left\\">((L,</td>\\n<td align=\\"left\\">24</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>5</td>\\n<td>s2</td>\\n<td align=\\"left\\">011352</td>\\n<td align=\\"left\\">((a,a</td>\\n<td align=\\"left\\">((L,a</td>\\n<td align=\\"left\\">24</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">011357</td>\\n<td align=\\"left\\">((a,a</td>\\n<td align=\\"left\\">((L,S</td>\\n<td align=\\"left\\">242</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">0113</td>\\n<td align=\\"left\\">((a,a</td>\\n<td align=\\"left\\">((L</td>\\n<td align=\\"left\\">2423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">01134</td>\\n<td align=\\"left\\">((a,a)</td>\\n<td align=\\"left\\">((L)</td>\\n<td align=\\"left\\">2423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>4</td>\\n<td>r1</td>\\n<td align=\\"left\\">016</td>\\n<td align=\\"left\\">((a,a)</td>\\n<td align=\\"left\\">(S</td>\\n<td align=\\"left\\">24231</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">013</td>\\n<td align=\\"left\\">((a,a)</td>\\n<td align=\\"left\\">(L</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">0135</td>\\n<td align=\\"left\\">((a,a),</td>\\n<td align=\\"left\\">(L,</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>5</td>\\n<td>s2</td>\\n<td align=\\"left\\">01352</td>\\n<td align=\\"left\\">((a,a),a</td>\\n<td align=\\"left\\">(L,a</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">01357</td>\\n<td align=\\"left\\">((a,a),a</td>\\n<td align=\\"left\\">(L,S</td>\\n<td align=\\"left\\">2423142</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">013</td>\\n<td align=\\"left\\">((a,a),a</td>\\n<td align=\\"left\\">(L</td>\\n<td align=\\"left\\">24231423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">0134</td>\\n<td align=\\"left\\">((a,a),a)</td>\\n<td align=\\"left\\">(L)</td>\\n<td align=\\"left\\">24231423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">$</td>\\n<td>4</td>\\n<td>acc</td>\\n<td align=\\"left\\">0134</td>\\n<td align=\\"left\\">((a,a),a)$</td>\\n<td align=\\"left\\">S</td>\\n<td align=\\"left\\">242314231</td>\\n<td align=\\"left\\">accのときも文法規則r1は適用する。</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>以上より、与えられた文は、問題の文法規則から生成されることが示された。</p>\\n<h4 id=\\"aaaa\\"><code>((a,a),(a,a))</code></h4>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\"left\\">入力</th>\\n<th>スタックtop</th>\\n<th>操作</th>\\n<th align=\\"left\\">スタック</th>\\n<th align=\\"left\\">読み取り済み</th>\\n<th align=\\"left\\">還元後</th>\\n<th align=\\"left\\">文法規則</th>\\n<th align=\\"left\\">補足</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td align=\\"left\\"></td>\\n<td></td>\\n<td></td>\\n<td align=\\"left\\">0</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>0</td>\\n<td>s1</td>\\n<td align=\\"left\\">01</td>\\n<td align=\\"left\\">(</td>\\n<td align=\\"left\\">(</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>1</td>\\n<td>s1</td>\\n<td align=\\"left\\">011</td>\\n<td align=\\"left\\">((</td>\\n<td align=\\"left\\">((</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>1</td>\\n<td>s2</td>\\n<td align=\\"left\\">0112</td>\\n<td align=\\"left\\">((a</td>\\n<td align=\\"left\\">((a</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">0116</td>\\n<td align=\\"left\\">((a</td>\\n<td align=\\"left\\">((S</td>\\n<td align=\\"left\\">2</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">0113</td>\\n<td align=\\"left\\">((a</td>\\n<td align=\\"left\\">((L</td>\\n<td align=\\"left\\">24</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">01135</td>\\n<td align=\\"left\\">((a,</td>\\n<td align=\\"left\\">((L,</td>\\n<td align=\\"left\\">24</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>5</td>\\n<td>s2</td>\\n<td align=\\"left\\">011352</td>\\n<td align=\\"left\\">((a,a</td>\\n<td align=\\"left\\">((L,a</td>\\n<td align=\\"left\\">24</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">011357</td>\\n<td align=\\"left\\">((a,a</td>\\n<td align=\\"left\\">((L,S</td>\\n<td align=\\"left\\">242</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">0113</td>\\n<td align=\\"left\\">((a,a</td>\\n<td align=\\"left\\">((L</td>\\n<td align=\\"left\\">2423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">01134</td>\\n<td align=\\"left\\">((a,a)</td>\\n<td align=\\"left\\">((L)</td>\\n<td align=\\"left\\">2423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>4</td>\\n<td>r1</td>\\n<td align=\\"left\\">016</td>\\n<td align=\\"left\\">((a,a)</td>\\n<td align=\\"left\\">(S</td>\\n<td align=\\"left\\">24231</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">013</td>\\n<td align=\\"left\\">((a,a)</td>\\n<td align=\\"left\\">(L</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">0135</td>\\n<td align=\\"left\\">((a,a),</td>\\n<td align=\\"left\\">(L,</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>5</td>\\n<td>s1</td>\\n<td align=\\"left\\">01351</td>\\n<td align=\\"left\\">((a,a),(</td>\\n<td align=\\"left\\">(L,(</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>1</td>\\n<td>s2</td>\\n<td align=\\"left\\">013512</td>\\n<td align=\\"left\\">((a,a),(a</td>\\n<td align=\\"left\\">(L,(a</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">013516</td>\\n<td align=\\"left\\">((a,a),(a</td>\\n<td align=\\"left\\">(L,(S</td>\\n<td align=\\"left\\">2423142</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">013513</td>\\n<td align=\\"left\\">((a,a),(a</td>\\n<td align=\\"left\\">(L,(L</td>\\n<td align=\\"left\\">24231424</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">0135135</td>\\n<td align=\\"left\\">((a,a),(a,</td>\\n<td align=\\"left\\">(L,(L,</td>\\n<td align=\\"left\\">24231424</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>5</td>\\n<td>s2</td>\\n<td align=\\"left\\">01351352</td>\\n<td align=\\"left\\">((a,a),(a,a</td>\\n<td align=\\"left\\">(L,(L,a</td>\\n<td align=\\"left\\">24231424</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">01351357</td>\\n<td align=\\"left\\">((a,a),(a,a</td>\\n<td align=\\"left\\">(L,(L,S</td>\\n<td align=\\"left\\">242314242</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">013516</td>\\n<td align=\\"left\\">((a,a),(a,a</td>\\n<td align=\\"left\\">(L,(S</td>\\n<td align=\\"left\\">2423142423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">013513</td>\\n<td align=\\"left\\">((a,a),(a,a</td>\\n<td align=\\"left\\">(L,(L</td>\\n<td align=\\"left\\">24231424234</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">0135134</td>\\n<td align=\\"left\\">((a,a),(a,a)</td>\\n<td align=\\"left\\">(L,(L)</td>\\n<td align=\\"left\\">24231424234</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>4</td>\\n<td>r1</td>\\n<td align=\\"left\\">01357</td>\\n<td align=\\"left\\">((a,a),(a,a)</td>\\n<td align=\\"left\\">(L,S</td>\\n<td align=\\"left\\">242314242341</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">013</td>\\n<td align=\\"left\\">((a,a),(a,a)</td>\\n<td align=\\"left\\">(L</td>\\n<td align=\\"left\\">2423142423413</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">0134</td>\\n<td align=\\"left\\">((a,a),(a,a))</td>\\n<td align=\\"left\\">(L)</td>\\n<td align=\\"left\\">2423142423413</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">$</td>\\n<td>4</td>\\n<td>acc</td>\\n<td align=\\"left\\">0</td>\\n<td align=\\"left\\">((a,a),(a,a))</td>\\n<td align=\\"left\\">S</td>\\n<td align=\\"left\\">24231424234131</td>\\n<td align=\\"left\\">accのときも文法規則r1は適用する。</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>以上より、与えられた文は、問題の文法規則から生成されることが示された。</p>\\n<h4 id=\\"aaaa-1\\"><code>(a,(a,a),a)</code></h4>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\"left\\">入力</th>\\n<th>スタックtop</th>\\n<th>操作</th>\\n<th align=\\"left\\">スタック</th>\\n<th align=\\"left\\">読み取り済み</th>\\n<th align=\\"left\\">還元後</th>\\n<th align=\\"left\\">文法規則</th>\\n<th align=\\"left\\">補足</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td align=\\"left\\"></td>\\n<td></td>\\n<td></td>\\n<td align=\\"left\\">0</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>0</td>\\n<td>s1</td>\\n<td align=\\"left\\">01</td>\\n<td align=\\"left\\">(</td>\\n<td align=\\"left\\">(</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>1</td>\\n<td>s2</td>\\n<td align=\\"left\\">012</td>\\n<td align=\\"left\\">(a</td>\\n<td align=\\"left\\">(a</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">016</td>\\n<td align=\\"left\\">(a</td>\\n<td align=\\"left\\">(S</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">013</td>\\n<td align=\\"left\\">(a</td>\\n<td align=\\"left\\">(L</td>\\n<td align=\\"left\\">4</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">0135</td>\\n<td align=\\"left\\">(a,</td>\\n<td align=\\"left\\">(L,</td>\\n<td align=\\"left\\">4</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>5</td>\\n<td>s1</td>\\n<td align=\\"left\\">01351</td>\\n<td align=\\"left\\">(a,(</td>\\n<td align=\\"left\\">(L,(</td>\\n<td align=\\"left\\">4</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>1</td>\\n<td>s2</td>\\n<td align=\\"left\\">013512</td>\\n<td align=\\"left\\">(a,(a</td>\\n<td align=\\"left\\">(L,(a</td>\\n<td align=\\"left\\">4</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">013516</td>\\n<td align=\\"left\\">(a,(a</td>\\n<td align=\\"left\\">(L,(S</td>\\n<td align=\\"left\\">42</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">013513</td>\\n<td align=\\"left\\">(a,(a</td>\\n<td align=\\"left\\">(L,(L</td>\\n<td align=\\"left\\">424</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">0135135</td>\\n<td align=\\"left\\">(a,(a,</td>\\n<td align=\\"left\\">(L,(L,</td>\\n<td align=\\"left\\">424</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>5</td>\\n<td>s2</td>\\n<td align=\\"left\\">01351352</td>\\n<td align=\\"left\\">(a,(a,a</td>\\n<td align=\\"left\\">(L,(L,a</td>\\n<td align=\\"left\\">424</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">01351357</td>\\n<td align=\\"left\\">(a,(a,a</td>\\n<td align=\\"left\\">(L,(L,S</td>\\n<td align=\\"left\\">4242</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">013513</td>\\n<td align=\\"left\\">(a,(a,a</td>\\n<td align=\\"left\\">(L,(L</td>\\n<td align=\\"left\\">42423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">0135134</td>\\n<td align=\\"left\\">(a,(a,a)</td>\\n<td align=\\"left\\">(L,(L)</td>\\n<td align=\\"left\\">42423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>4</td>\\n<td>r1</td>\\n<td align=\\"left\\">01357</td>\\n<td align=\\"left\\">(a,(a,a)</td>\\n<td align=\\"left\\">(L,S</td>\\n<td align=\\"left\\">424231</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">013</td>\\n<td align=\\"left\\">(a,(a,a)</td>\\n<td align=\\"left\\">(L</td>\\n<td align=\\"left\\">4242313</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">0135</td>\\n<td align=\\"left\\">(a,(a,a),</td>\\n<td align=\\"left\\">(L,</td>\\n<td align=\\"left\\">4242313</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>5</td>\\n<td>s2</td>\\n<td align=\\"left\\">01352</td>\\n<td align=\\"left\\">(a,(a,a),a</td>\\n<td align=\\"left\\">(L,a</td>\\n<td align=\\"left\\">4242313</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">01357</td>\\n<td align=\\"left\\">(a,(a,a),a</td>\\n<td align=\\"left\\">(L,S</td>\\n<td align=\\"left\\">42423132</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">013</td>\\n<td align=\\"left\\">(a,(a,a),a</td>\\n<td align=\\"left\\">(L</td>\\n<td align=\\"left\\">424231323</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">0134</td>\\n<td align=\\"left\\">(a,(a,a),a)</td>\\n<td align=\\"left\\">(L)</td>\\n<td align=\\"left\\">424231323</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">$</td>\\n<td>4</td>\\n<td>acc</td>\\n<td align=\\"left\\">0</td>\\n<td align=\\"left\\">(a,(a,a),a)</td>\\n<td align=\\"left\\">S</td>\\n<td align=\\"left\\">4242313231</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n</tbody>\\n</table>\\n<h4 id=\\"aaaa-2\\"><code>(((a,a),a),a)</code></h4>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\"left\\">入力</th>\\n<th>スタックtop</th>\\n<th>操作</th>\\n<th align=\\"left\\">スタック</th>\\n<th align=\\"left\\">読み取り済み</th>\\n<th align=\\"left\\">還元後</th>\\n<th align=\\"left\\">文法規則</th>\\n<th align=\\"left\\">補足</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td align=\\"left\\"></td>\\n<td></td>\\n<td></td>\\n<td align=\\"left\\">0</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>0</td>\\n<td>s1</td>\\n<td align=\\"left\\">01</td>\\n<td align=\\"left\\">(</td>\\n<td align=\\"left\\">(</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>1</td>\\n<td>s1</td>\\n<td align=\\"left\\">011</td>\\n<td align=\\"left\\">((</td>\\n<td align=\\"left\\">((</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">(</td>\\n<td>1</td>\\n<td>s1</td>\\n<td align=\\"left\\">0111</td>\\n<td align=\\"left\\">(((</td>\\n<td align=\\"left\\">(((</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>1</td>\\n<td>s2</td>\\n<td align=\\"left\\">01112</td>\\n<td align=\\"left\\">(((a</td>\\n<td align=\\"left\\">(((a</td>\\n<td align=\\"left\\"></td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">01116</td>\\n<td align=\\"left\\">(((a</td>\\n<td align=\\"left\\">(((S</td>\\n<td align=\\"left\\">2</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">01113</td>\\n<td align=\\"left\\">(((a</td>\\n<td align=\\"left\\">(((L</td>\\n<td align=\\"left\\">24</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">011135</td>\\n<td align=\\"left\\">(((a,</td>\\n<td align=\\"left\\">(((L,</td>\\n<td align=\\"left\\">24</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>5</td>\\n<td>s2</td>\\n<td align=\\"left\\">0111352</td>\\n<td align=\\"left\\">(((a,a</td>\\n<td align=\\"left\\">(((L,a</td>\\n<td align=\\"left\\">24</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">0111357</td>\\n<td align=\\"left\\">(((a,a</td>\\n<td align=\\"left\\">(((L,S</td>\\n<td align=\\"left\\">242</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">01113</td>\\n<td align=\\"left\\">(((a,a</td>\\n<td align=\\"left\\">(((L</td>\\n<td align=\\"left\\">2423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">011134</td>\\n<td align=\\"left\\">(((a,a)</td>\\n<td align=\\"left\\">(((L)</td>\\n<td align=\\"left\\">2423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>4</td>\\n<td>r1</td>\\n<td align=\\"left\\">0116</td>\\n<td align=\\"left\\">(((a,a)</td>\\n<td align=\\"left\\">((S</td>\\n<td align=\\"left\\">24231</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>6</td>\\n<td>r4</td>\\n<td align=\\"left\\">0113</td>\\n<td align=\\"left\\">(((a,a)</td>\\n<td align=\\"left\\">((L</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">01135</td>\\n<td align=\\"left\\">(((a,a),</td>\\n<td align=\\"left\\">((L,</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>5</td>\\n<td>s2</td>\\n<td align=\\"left\\">011352</td>\\n<td align=\\"left\\">(((a,a),a</td>\\n<td align=\\"left\\">((L,a</td>\\n<td align=\\"left\\">242314</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">011357</td>\\n<td align=\\"left\\">(((a,a),a</td>\\n<td align=\\"left\\">((L,S</td>\\n<td align=\\"left\\">2423142</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">0113</td>\\n<td align=\\"left\\">(((a,a),a</td>\\n<td align=\\"left\\">((L</td>\\n<td align=\\"left\\">24231423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">01134</td>\\n<td align=\\"left\\">(((a,a),a)</td>\\n<td align=\\"left\\">((L)</td>\\n<td align=\\"left\\">24231423</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>4</td>\\n<td>r1</td>\\n<td align=\\"left\\">013</td>\\n<td align=\\"left\\">(((a,a),a)</td>\\n<td align=\\"left\\">(L</td>\\n<td align=\\"left\\">242314231</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">,</td>\\n<td>3</td>\\n<td>s5</td>\\n<td align=\\"left\\">0135</td>\\n<td align=\\"left\\">(((a,a),a),</td>\\n<td align=\\"left\\">(L,</td>\\n<td align=\\"left\\">242314231</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">a</td>\\n<td>5</td>\\n<td>s2</td>\\n<td align=\\"left\\">01352</td>\\n<td align=\\"left\\">(((a,a),a),a</td>\\n<td align=\\"left\\">(L,a</td>\\n<td align=\\"left\\">242314231</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>2</td>\\n<td>r2</td>\\n<td align=\\"left\\">01357</td>\\n<td align=\\"left\\">(((a,a),a),a</td>\\n<td align=\\"left\\">(L,S</td>\\n<td align=\\"left\\">2423142312</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>7</td>\\n<td>r3</td>\\n<td align=\\"left\\">013</td>\\n<td align=\\"left\\">(((a,a),a),a</td>\\n<td align=\\"left\\">(L</td>\\n<td align=\\"left\\">24231423123</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">)</td>\\n<td>3</td>\\n<td>s4</td>\\n<td align=\\"left\\">0134</td>\\n<td align=\\"left\\">(((a,a),a),a)</td>\\n<td align=\\"left\\">(L)</td>\\n<td align=\\"left\\">24231423123</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">$</td>\\n<td>4</td>\\n<td>acc</td>\\n<td align=\\"left\\">0</td>\\n<td align=\\"left\\">(((a,a),a),a)</td>\\n<td align=\\"left\\">S</td>\\n<td align=\\"left\\">242314231231</td>\\n<td align=\\"left\\"></td>\\n</tr>\\n</tbody>\\n</table>\\n<p>以上より、与えられた文は、問題の文法規則から生成されることが示された。</p>\\n<style>\\n.article.markdown-body table th {\\nmin-width: 0px;\\n}\\n.article.markdown-body table td {\\nmin-width: 0px;\\n}\\n</style>","contentSnippet":"以下、過去の自分向けのメモの移動。\\nコンパイラの主要な処理に構文解析がある。\\n今回は与えられたLR(0)文法規則に基づいて構文解析するオートマトンを作り、構文解析の手法について整理する。\\n問題\\n次の文法について、次の問を答えよ\\nS -> ( L )\\nS -> a\\nL -> L , S\\nL -> S\\n\\n上から順にR1,R2,R3,R4と呼ぶ。\\nただし、SとLは非終端記号、(と)と,とaは終端記号とする。\\nLR(0)正準集合とオートマトンを求めよ\\n以下の文字列が示された文法から生成されるかどうか、また構文解析の結果を答えよ\\nLR(0)構文解析の方法\\nLR(k)構文解析とは\\n上向き構文解析(下向きは再帰的に行うが、バックトラックが発生するため大変)\\n左(Left)から読み、右端導出(Right most derivation)\\nkとは、先読みできる記号の数\\nLR(0)構文解析の流れ\\nLR(0)正準集合とオートマトンをつくる\\n構文解析表を作る\\n構文解析表を元に解析する\\n方針: shiftまたはreduceを繰り返し、開始記号1つにまとまれば完了\\nshift: 入力を1つ読み込むこと\\nreduce: 文法規則を適用し、記号をまとめること\\nオートマトンの状態をスタックに積みながら、行う\\nshiftするときは、入力を読み込み、入力記号に従い有向辺を遷移する。遷移後の状態をスタックにpushする。\\nreduceするときは、適用する文法規則に則って、いままでの遷移を巻き戻し(スタックを記号数分popし)、適用後の記号の遷移を積み直す(pushする)。\\nオートマトンを表にまとめ、情報を更かして、shift、reduceの手順を示したのが構文解析表である。\\nLR(0)におけるオートマトンの作成\\n前提\\nLR(0)項とは … (アイテム記法)\\n文法規則の右辺、各記号の前後1箇所に・(ドット)を加えたもの。例えばS -> ( ・L )といった表記\\nこれは、ドットの前方は読み込み済みであること、ドットの後方は未読み込みであることを示す。\\n(読み込むとは、ドットを1つ右に移動させること(ドットが1つ右のLR(0)項を含む状態に遷移すること(後術)であって、ドットの次が何の値であるか確認することではない)。\\nLR(0)正準集合とは\\nLR(0)項の集合である。\\nオートマトンを作成する際に一緒に作成する。\\nLR(0)におけるオートマトンとは\\nLR(0)正準集合を状態、記号を1つもつ有向辺としたオートマトン。\\nLR(0)におけるオートマトンを作成する方法\\n1. 初期状態を定める\\n状態には開始記号が左辺で、ドットが最左なLR(0)項をすべて含む。\\n(※)を行う。\\n2. その他の状態を定める\\n既に存在する状態のドットが最右にないLR(0)項について、記号を一つ読み込んだ状態を新たにつくる。\\n遷移の有向辺には、読み込む記号をもたせる。\\n遷移後の状態は、記号を1つ読み込んだLR(0)項(ドットを1記号分右にずらしたLR(0)項)を含む。\\nさらに、遷移前の状態の他のLR(0)項について考える。\\n同じ記号を読み込める物があれば(遷移前のLR(0)項同士でドットの右隣の記号が一致すれば)、このLR(0)項についても、1記号読み込み後のLR(0)項を遷移後の状態に加える。\\n(※)を行う。\\n3. 繰り返す\\n行える限り 2. を行う。\\n(※)\\nある状態について、この状態に含むLR(0)項を考える。\\nドットの右隣に非終端記号のあるLR(0)項があるならば、その終端記号を左辺に持ちドットが最左であるLR(0)項をすべて同じ状態に加える。\\n作成したオートマトン\\n状態遷移表\\ndigraph G {\\nrankdir=LR;\\nempty [label = \\"\\" shape = plaintext];\\nnode [shape = doublecircle];I2 I4;\\nnode [shape = circle];\\nempty -> I0 [label = \\"start\\"];\\nI0 -> I1 [label = \\"(\\"];\\nI0 -> I2 [label = \\"a\\"];\\nI1 -> I2 [label = \\"a\\"];\\nI1 -> I3 [label = \\"L\\"];\\nI3 -> I4 [label = \\")\\"];\\nI3 -> I5 [label = \\",\\"];\\nI5 -> I7 [label = \\"S\\"];\\nI1 -> I1 [label = \\"(\\"];\\nI5 -> I1 [label = \\"(\\"];\\nI5 -> I2 [label = \\"a\\"];\\nI1 -> I6 [label = \\"S\\"];\\n}\\n\\n状態I0\\nS -> ・( L )\\nS -> ・a\\n状態I1\\nS -> ( ・L ) (・の右隣に非終端記号)\\nL -> ・L , S\\nL -> ・S (・の右隣に非終端記号)\\nS -> ・( L )\\nS -> ・a\\n状態I2\\nS -> a ・\\n状態I3\\nS -> ( L ・)\\nL -> L ・, S\\n状態I4\\nS -> ( L ) ・\\n状態I5\\nL -> L , ・S (・の右隣に非終端記号)\\nS -> ・( L )\\nS -> ・a\\n状態I6\\nL -> S ・\\n状態I7\\nL -> L , S ・\\n構文解析表\\n現在の状態(スタックのトップ)の行、入力記号(読み込み前)の列のセルに、次の動作を書いた表。\\n次の動作とは、次のようなものである。\\nshiftするかreduceするか\\nshiftならどの状態に遷移するか\\nreduceならどの文法規則を適用するか\\n構文解析表のつくりかた\\n1. 縦軸のラベル\\n縦軸にLR(0)正準集合を置く\\n2. 横軸のラベル\\n横軸に記号を置く。(このとき、終端記号と非終端記号は分ける、。終端記号に$(入力の終了を表す)を加える)\\n3. shift\\n遷移元の状態を行、遷移時の終端記号を列とするセルに、skと書き込む。(状態Ikに遷移する)\\nshift(入力を1つ読み込む)して、スタックにkを積む(状態Ikに遷移する)ことを表す。\\n4. reduce時のpushする(積み直す)状態\\n遷移元の状態を行、遷移時の非終端記号を列とするセルに、kと書き込む。(状態Ikに遷移する)\\nreduce時、還元後の状態(文法規則の左辺)をスタックに積み直す動作を表す。\\n5. reduce時の適用する文法規則\\n最右がドットであるLR(0)項を含む状態の行、終端記号の列にrkと書き込む。(文法規則Rkを適用する)\\n6. 完了状態\\n左辺が開始記号で右辺のドットが最右であるLR(0)項を含む状態の行\\n、$(入力終了)の列のセルに、accと書き込む。\\naccを参照したら構文が正しいことが示され、構文解析を終了する。\\n構文解析表の作成結果\\n今回の構文解析表は次の通り\\nI\\\\記号\\n(\\n)\\n,\\na\\n$\\nS\\nL\\n\\n\\n\\n\\n0\\ns1\\n\\n\\ns2\\n\\n\\n\\n\\n\\n1\\ns1\\n\\n\\ns2\\n\\n6\\n3\\n\\n\\n2\\nr2\\nr2\\nr2\\nr2\\nacc\\n\\n\\n\\n\\n3\\n\\ns4\\ns5\\n\\n\\n\\n\\n\\n\\n4\\nr1\\nr1\\nr1\\nr1\\nacc\\n\\n\\n\\n\\n5\\ns1\\n\\n\\ns2\\n\\n7\\n\\n\\n\\n6\\nr4\\nr4\\nr4\\nr4\\n\\n\\n\\n\\n\\n7\\nr3\\nr3\\nr3\\nr3\\n\\n\\n\\n\\n\\n\\n余談:構文解析表が表すもの\\n構文解析表の持つ情報は、次の3つに分けられる\\n1. オートマトンの状態遷移表\\nI\\\\記号\\n(\\n)\\n,\\na\\nS\\nL\\n\\n\\n\\n\\n0\\n1\\n\\n\\n2\\n\\n\\n\\n\\n1\\n1\\n\\n\\n2\\n6\\n3\\n\\n\\n2\\n\\n\\n\\n\\n\\n\\n\\n\\n3\\n\\n4\\n5\\n\\n\\n\\n\\n\\n4\\n\\n\\n\\n\\n\\n\\n\\n\\n5\\n1\\n\\n\\n2\\n\\n7\\n\\n\\n6\\n\\n\\n\\n\\n\\n\\n\\n\\n7\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n2. reduce可能状態と適用する文法規則\\nI2のとき、文法規則R2を適用する。\\nI4のとき、文法規則R1を適用する。\\nI6のとき、文法規則R4を適用する。\\nI3のとき、文法規則R3を適用する。\\n3. 完了状態\\nI2,I4で全て読み込み済みのとき、構文解析が完了する。\\n構文解析\\n状態を記録するスタックを用意して、スタックトップと次の入力をもとに、動作を行う。\\n構文解析の方法\\n1. 初期状態Ikであるとき、kをスタックに積む\\n2. スタックtopの状態の行、次の入力記号の列のセルの指示に従う\\nsk\\nshiftする。\\n入力を読み取る。(次の動作のとき入力を次の終端記号にすすめる)\\nスタックにkを積む\\n(オートマトンにおいて、入力の終端記号を辺とする状態遷移を行う)\\nrk\\n文法規則Rkに従ってreduceする。\\n文法Rkを適用することを記録する。\\n文法Rkの右辺の記号数分、スタックをpopする。(状態遷移を巻き戻す)\\n上行のpop後のスタックトップの状態を行、文法Rkの左側の記号を列とするセルの数字をスタックにpushする。(文法Rk左側の記号の状態遷移を積み直す)\\nacc\\n構文解析は成功。入力の分は、与えられた文法規則から生成される。\\n構文解析を終了する。\\n適用すべき文法規則とその順は、記録された文法規則Rkを順に読む。\\n空\\n構文解析は失敗。入力の文は、与えられた文法規則から生成されることはない。\\n構文解析の結果\\n次の文を構文解析する。\\n上から順に、解析の経過を記す。\\n((a,a),a)\\n入力\\nスタックtop\\n操作\\nスタック\\n読み取り済み\\n還元後\\n文法規則\\n補足\\n\\n\\n\\n\\n\\n\\n\\n0\\n\\n\\n\\n\\n\\n\\n(\\n0\\ns1\\n01\\n(\\n(\\n\\n\\n\\n\\n(\\n1\\ns1\\n011\\n((\\n((\\n\\n\\n\\n\\na\\n1\\ns2\\n0112\\n((a\\n((a\\n\\n\\n\\n\\n,\\n2\\nr2\\n0116\\n((a\\n((S\\n2\\n\\n\\n\\n,\\n6\\nr4\\n0113\\n((a\\n((L\\n24\\n\\n\\n\\n,\\n3\\ns5\\n01135\\n((a,\\n((L,\\n24\\n\\n\\n\\na\\n5\\ns2\\n011352\\n((a,a\\n((L,a\\n24\\n\\n\\n\\n)\\n2\\nr2\\n011357\\n((a,a\\n((L,S\\n242\\n\\n\\n\\n)\\n7\\nr3\\n0113\\n((a,a\\n((L\\n2423\\n\\n\\n\\n)\\n3\\ns4\\n01134\\n((a,a)\\n((L)\\n2423\\n\\n\\n\\n,\\n4\\nr1\\n016\\n((a,a)\\n(S\\n24231\\n\\n\\n\\n,\\n6\\nr4\\n013\\n((a,a)\\n(L\\n242314\\n\\n\\n\\n,\\n3\\ns5\\n0135\\n((a,a),\\n(L,\\n242314\\n\\n\\n\\na\\n5\\ns2\\n01352\\n((a,a),a\\n(L,a\\n242314\\n\\n\\n\\n)\\n2\\nr2\\n01357\\n((a,a),a\\n(L,S\\n2423142\\n\\n\\n\\n)\\n7\\nr3\\n013\\n((a,a),a\\n(L\\n24231423\\n\\n\\n\\n)\\n3\\ns4\\n0134\\n((a,a),a)\\n(L)\\n24231423\\n\\n\\n\\n$\\n4\\nacc\\n0134\\n((a,a),a)$\\nS\\n242314231\\naccのときも文法規則r1は適用する。\\n\\n\\n\\n以上より、与えられた文は、問題の文法規則から生成されることが示された。\\n((a,a),(a,a))\\n入力\\nスタックtop\\n操作\\nスタック\\n読み取り済み\\n還元後\\n文法規則\\n補足\\n\\n\\n\\n\\n\\n\\n\\n0\\n\\n\\n\\n\\n\\n\\n(\\n0\\ns1\\n01\\n(\\n(\\n\\n\\n\\n\\n(\\n1\\ns1\\n011\\n((\\n((\\n\\n\\n\\n\\na\\n1\\ns2\\n0112\\n((a\\n((a\\n\\n\\n\\n\\n,\\n2\\nr2\\n0116\\n((a\\n((S\\n2\\n\\n\\n\\n,\\n6\\nr4\\n0113\\n((a\\n((L\\n24\\n\\n\\n\\n,\\n3\\ns5\\n01135\\n((a,\\n((L,\\n24\\n\\n\\n\\na\\n5\\ns2\\n011352\\n((a,a\\n((L,a\\n24\\n\\n\\n\\n)\\n2\\nr2\\n011357\\n((a,a\\n((L,S\\n242\\n\\n\\n\\n)\\n7\\nr3\\n0113\\n((a,a\\n((L\\n2423\\n\\n\\n\\n)\\n3\\ns4\\n01134\\n((a,a)\\n((L)\\n2423\\n\\n\\n\\n,\\n4\\nr1\\n016\\n((a,a)\\n(S\\n24231\\n\\n\\n\\n,\\n6\\nr4\\n013\\n((a,a)\\n(L\\n242314\\n\\n\\n\\n,\\n3\\ns5\\n0135\\n((a,a),\\n(L,\\n242314\\n\\n\\n\\n(\\n5\\ns1\\n01351\\n((a,a),(\\n(L,(\\n242314\\n\\n\\n\\na\\n1\\ns2\\n013512\\n((a,a),(a\\n(L,(a\\n242314\\n\\n\\n\\n,\\n2\\nr2\\n013516\\n((a,a),(a\\n(L,(S\\n2423142\\n\\n\\n\\n,\\n6\\nr4\\n013513\\n((a,a),(a\\n(L,(L\\n24231424\\n\\n\\n\\n,\\n3\\ns5\\n0135135\\n((a,a),(a,\\n(L,(L,\\n24231424\\n\\n\\n\\na\\n5\\ns2\\n01351352\\n((a,a),(a,a\\n(L,(L,a\\n24231424\\n\\n\\n\\n)\\n2\\nr2\\n01351357\\n((a,a),(a,a\\n(L,(L,S\\n242314242\\n\\n\\n\\n)\\n7\\nr3\\n013516\\n((a,a),(a,a\\n(L,(S\\n2423142423\\n\\n\\n\\n)\\n6\\nr4\\n013513\\n((a,a),(a,a\\n(L,(L\\n24231424234\\n\\n\\n\\n)\\n3\\ns4\\n0135134\\n((a,a),(a,a)\\n(L,(L)\\n24231424234\\n\\n\\n\\n)\\n4\\nr1\\n01357\\n((a,a),(a,a)\\n(L,S\\n242314242341\\n\\n\\n\\n)\\n7\\nr3\\n013\\n((a,a),(a,a)\\n(L\\n2423142423413\\n\\n\\n\\n)\\n3\\ns4\\n0134\\n((a,a),(a,a))\\n(L)\\n2423142423413\\n\\n\\n\\n$\\n4\\nacc\\n0\\n((a,a),(a,a))\\nS\\n24231424234131\\naccのときも文法規則r1は適用する。\\n\\n\\n\\n以上より、与えられた文は、問題の文法規則から生成されることが示された。\\n(a,(a,a),a)\\n入力\\nスタックtop\\n操作\\nスタック\\n読み取り済み\\n還元後\\n文法規則\\n補足\\n\\n\\n\\n\\n\\n\\n\\n0\\n\\n\\n\\n\\n\\n\\n(\\n0\\ns1\\n01\\n(\\n(\\n\\n\\n\\n\\na\\n1\\ns2\\n012\\n(a\\n(a\\n\\n\\n\\n\\n,\\n2\\nr2\\n016\\n(a\\n(S\\n\\n\\n\\n\\n,\\n6\\nr4\\n013\\n(a\\n(L\\n4\\n\\n\\n\\n,\\n3\\ns5\\n0135\\n(a,\\n(L,\\n4\\n\\n\\n\\n(\\n5\\ns1\\n01351\\n(a,(\\n(L,(\\n4\\n\\n\\n\\na\\n1\\ns2\\n013512\\n(a,(a\\n(L,(a\\n4\\n\\n\\n\\n,\\n2\\nr2\\n013516\\n(a,(a\\n(L,(S\\n42\\n\\n\\n\\n,\\n6\\nr4\\n013513\\n(a,(a\\n(L,(L\\n424\\n\\n\\n\\n,\\n3\\ns5\\n0135135\\n(a,(a,\\n(L,(L,\\n424\\n\\n\\n\\na\\n5\\ns2\\n01351352\\n(a,(a,a\\n(L,(L,a\\n424\\n\\n\\n\\n)\\n2\\nr2\\n01351357\\n(a,(a,a\\n(L,(L,S\\n4242\\n\\n\\n\\n)\\n7\\nr3\\n013513\\n(a,(a,a\\n(L,(L\\n42423\\n\\n\\n\\n)\\n3\\ns4\\n0135134\\n(a,(a,a)\\n(L,(L)\\n42423\\n\\n\\n\\n,\\n4\\nr1\\n01357\\n(a,(a,a)\\n(L,S\\n424231\\n\\n\\n\\n,\\n7\\nr3\\n013\\n(a,(a,a)\\n(L\\n4242313\\n\\n\\n\\n,\\n3\\ns5\\n0135\\n(a,(a,a),\\n(L,\\n4242313\\n\\n\\n\\na\\n5\\ns2\\n01352\\n(a,(a,a),a\\n(L,a\\n4242313\\n\\n\\n\\n)\\n2\\nr2\\n01357\\n(a,(a,a),a\\n(L,S\\n42423132\\n\\n\\n\\n)\\n7\\nr3\\n013\\n(a,(a,a),a\\n(L\\n424231323\\n\\n\\n\\n)\\n3\\ns4\\n0134\\n(a,(a,a),a)\\n(L)\\n424231323\\n\\n\\n\\n$\\n4\\nacc\\n0\\n(a,(a,a),a)\\nS\\n4242313231\\n\\n\\n\\n\\n(((a,a),a),a)\\n入力\\nスタックtop\\n操作\\nスタック\\n読み取り済み\\n還元後\\n文法規則\\n補足\\n\\n\\n\\n\\n\\n\\n\\n0\\n\\n\\n\\n\\n\\n\\n(\\n0\\ns1\\n01\\n(\\n(\\n\\n\\n\\n\\n(\\n1\\ns1\\n011\\n((\\n((\\n\\n\\n\\n\\n(\\n1\\ns1\\n0111\\n(((\\n(((\\n\\n\\n\\n\\na\\n1\\ns2\\n01112\\n(((a\\n(((a\\n\\n\\n\\n\\n,\\n2\\nr2\\n01116\\n(((a\\n(((S\\n2\\n\\n\\n\\n,\\n6\\nr4\\n01113\\n(((a\\n(((L\\n24\\n\\n\\n\\n,\\n3\\ns5\\n011135\\n(((a,\\n(((L,\\n24\\n\\n\\n\\na\\n5\\ns2\\n0111352\\n(((a,a\\n(((L,a\\n24\\n\\n\\n\\n)\\n2\\nr2\\n0111357\\n(((a,a\\n(((L,S\\n242\\n\\n\\n\\n)\\n7\\nr3\\n01113\\n(((a,a\\n(((L\\n2423\\n\\n\\n\\n)\\n3\\ns4\\n011134\\n(((a,a)\\n(((L)\\n2423\\n\\n\\n\\n,\\n4\\nr1\\n0116\\n(((a,a)\\n((S\\n24231\\n\\n\\n\\n,\\n6\\nr4\\n0113\\n(((a,a)\\n((L\\n242314\\n\\n\\n\\n,\\n3\\ns5\\n01135\\n(((a,a),\\n((L,\\n242314\\n\\n\\n\\na\\n5\\ns2\\n011352\\n(((a,a),a\\n((L,a\\n242314\\n\\n\\n\\n)\\n2\\nr2\\n011357\\n(((a,a),a\\n((L,S\\n2423142\\n\\n\\n\\n)\\n7\\nr3\\n0113\\n(((a,a),a\\n((L\\n24231423\\n\\n\\n\\n)\\n3\\ns4\\n01134\\n(((a,a),a)\\n((L)\\n24231423\\n\\n\\n\\n,\\n4\\nr1\\n013\\n(((a,a),a)\\n(L\\n242314231\\n\\n\\n\\n,\\n3\\ns5\\n0135\\n(((a,a),a),\\n(L,\\n242314231\\n\\n\\n\\na\\n5\\ns2\\n01352\\n(((a,a),a),a\\n(L,a\\n242314231\\n\\n\\n\\n)\\n2\\nr2\\n01357\\n(((a,a),a),a\\n(L,S\\n2423142312\\n\\n\\n\\n)\\n7\\nr3\\n013\\n(((a,a),a),a\\n(L\\n24231423123\\n\\n\\n\\n)\\n3\\ns4\\n0134\\n(((a,a),a),a)\\n(L)\\n24231423123\\n\\n\\n\\n$\\n4\\nacc\\n0\\n(((a,a),a),a)\\nS\\n242314231231\\n\\n\\n\\n\\n以上より、与えられた文は、問題の文法規則から生成されることが示された。\\n\\n.article.markdown-body table th {\\nmin-width: 0px;\\n}\\n.article.markdown-body table td {\\nmin-width: 0px;\\n}","guid":"https://memo.basd4g.net/posts/compiler-lr0/","isoDate":"2020-08-14T10:04:31.000Z"},{"title":"Dockerチートシート プログラマのためのDocker教科書 第2版より","link":"https://memo.basd4g.net/posts/docker/","pubDate":"Fri, 14 Aug 2020 18:59:31 +0900","content":"<p>以下、過去の自分用メモの移動。</p>\\n<p>dockerに入門するにあたり「プログラマのためのDocker教科書 第2版より」を読んだ。\\nDockerfileを書いてコンテナを走らせるための自分向けのまとめをチートシート的に書き記す。</p>\\n<h2 id=\\"dockerfileの命令\\">Dockerfileの命令</h2>\\n<h3 id=\\"命令一覧\\">命令一覧</h3>\\n<ul>\\n<li>FROM .. ベースイメージの指定</li>\\n<li>RUN .. コマンド実行</li>\\n<li>CMD .. コンテナの実行コマンド</li>\\n<li>LABEL .. ラベルを設定</li>\\n<li>EXPOSE .. ポートのエクスポート</li>\\n<li>ENV .. 環境変数</li>\\n<li>ADD .. ファイル/ディレクトリの追加</li>\\n<li>COPY .. ファイルのコピー</li>\\n<li>ENTRYPOINT .. コンテナの実行コマンド</li>\\n<li>VOLUME .. ボリュームのマウント</li>\\n<li>USER .. ユーザの指定</li>\\n<li>WORKDIR .. 作業ディレクトリ</li>\\n<li>ARG .. Dockerfile内の変数</li>\\n<li>ONBUILD .. ビルド完了後に実行される命令</li>\\n<li>STOPSIGNAL .. システムコールシグナルの設定</li>\\n<li>HEALTHCHECK .. コンテナのヘルスチェック</li>\\n<li>SHELL .. デフォルトシェルの設定</li>\\n</ul>\\n<h3 id=\\"コメント\\">コメント</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-Dockerfile\\" data-lang=\\"Dockerfile\\"><span class=\\"c\\"># コメント</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span>命令 <span class=\\"c1\\"># コメント</span><span class=\\"err\\">\\n</span></code></pre></div><h3 id=\\"from\\">FROM</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-Dockerfile\\" data-lang=\\"Dockerfile\\"><span class=\\"k\\">FROM</span><span class=\\"s\\"> centos:7</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\"># FROM [イメージ名]</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\"># FROM [イメージ名]:[タグ名]</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\"># FROM [イメージ名]@[ダイジェスト]</span><span class=\\"err\\">\\n</span></code></pre></div><h4 id=\\"ダイジェスト\\">ダイジェスト</h4>\\n<p>Docker Hubにアップロードする際に自動で付与されるユニークな識別子。\\nダイジェストを使うことでイメージを一意に指定できる。\\n<code>docker image ls --digests</code>で確認できる</p>\\n<h3 id=\\"build\\">build</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-bash\\" data-lang=\\"bash\\">$ docker build -t <span class=\\"o\\">[</span>作成するイメージ名<span class=\\"o\\">]</span>:<span class=\\"o\\">[</span>タグ名<span class=\\"o\\">]</span> <span class=\\"o\\">[</span>Dockerfileのあるディレクトリのパス<span class=\\"o\\">]</span>\\n</code></pre></div><h2 id=\\"docker-engineの状態を確認\\">docker engineの状態を確認</h2>\\n<pre><code>$ docker version\\n$ docker tutorial\\n$ docker system info\\n$ docker system df\\n# disk info\\n</code></pre><h2 id=\\"nginxをdockerで動かしてみる\\">nginxをdockerで動かしてみる</h2>\\n<pre><code>$ docker pull nginx\\n$ docker image ls\\n$ docker container run --name nginxserver -d -p 80:80 nginx\\n# open http://localhost:80/ on web browser\\n$ docker ps\\n$ docker stop nginxserver\\n$ docker start nginxserver\\n</code></pre><h2 id=\\"centosをpullしてみる\\">centosをpullしてみる</h2>\\n<pre><code># p96\\n$ docker image pull centos:7\\n$ docker image ls\\n</code></pre><h2 id=\\"dct\\">DCT</h2>\\n<p>docker imageが改ざんされているかどうか、公開鍵(Tagging Key)を用いて検証し、改ざんがある場合そのイメージを無効化する機能。</p>\\n<p>有効化するには環境変数を付加</p>\\n<p>署名なしイメージのpull時は無効化しなければならない。</p>\\n<pre><code># enable\\n$ export DOCKER_CONTENT_TRUST=1\\n# disable\\n$ export DOCKER_CONTENT_TRUST=0\\n</code></pre><h2 id=\\"docker-imageの操作\\">docker imageの操作</h2>\\n<pre><code># pullしたイメージの詳細情報を確認(イメージID,作成日,dockerのversion,CPUアーキテクチャ等)\\n$ docker image inspect ubuntu:latest\\n# jsonの一部のみを取得\\n$ docker image inspect --format=&quot;{{ .Os }}&quot; ubuntu:latest\\n$ docker image inspect --format=&quot;{{ .ContainerConfig.Image }}&quot; ubuntu:latest\\n# docker image にタグ付け\\n$ docker image tag nginx basd4g/nginxserver:1.0\\n# docker hub上のimage(この場合はnginx)を検索\\n$ docker search nginx\\n# Option: --no-trunc .. 結果をすべて表示, --limit n .. n件の検索結果, --filter=stars=n .. star数下限による絞り込み\\n$ docker image rm [--force(-f) --no-prun] basd4g/nginxserver\\n# --force .. -f , --no-prune .. 中間イメージを削除しない\\n# basd4g/nginxserver ... REPOSITORYではなくIMAGE IDでも良い\\n$ docker image prune [--all(-a) --force(-f)]\\n# 未使用のdocker imageを削除\\n</code></pre><h2 id=\\"docker-image-のpush\\">docker image のpush</h2>\\n<pre><code>$ docker login -u basd4g -p xxx\\n$ docker image push basd4g/nginxserver:1.0\\n$ docker logout\\n</code></pre><h2 id=\\"docker-container-run\\">docker container run</h2>\\n<pre><code>$ docker container run [ option ] basd4g/nginxserver\\n$ docker run [ option ] basd4g/nginxserver # containerは省略可能\\n$ docker run -it --name &quot;test1&quot; ubuntu /bin/bash\\n$ docker run -d -p 8080:80 nginx\\n$ docker run -d --dns 8.8.8.8 nginx\\n$ docker run -d --mac-address=&quot;92:d0:c6:0a:29:33&quot; ubuntu\\n# $ docker container inspect --format=&quot;{{ .Config.MacAddress }}&quot; [Container ID]\\n$docker run -id --add-host test.com:192.168.0.1 ubuntu\\n</code></pre><h3 id=\\"実行開始時オプション\\">実行開始時オプション</h3>\\n<p>&ndash;attach(-a) STDIN/STDOUT/STDERR &ndash;cidfile &ndash;detach(-d) &ndash;interactive(-i) &ndash;tty(-t)</p>\\n<ul>\\n<li>-a .. 標準入力/標準出力/標準エラー出力にアタッチ</li>\\n<li>-d .. バックグラウンドで実行</li>\\n<li>-i .. コンテナの標準入力を開く</li>\\n<li>-t .. 端末デバイスを使う</li>\\n</ul>\\n<h3 id=\\"終了時オプション\\">終了時オプション</h3>\\n<ul>\\n<li>&ndash;restart .. no (再起動しない)/ on-failure (終了ステータスが0でないなら再起動)/ on-failure:4 (終了ステータスが0でないなら4回再起動/ always (常に)/ unless-stopped (直前のコンテナの状態が停止状態でなければ再起動)</li>\\n<li>&ndash;rm .. 実行後のコンテナを自動で削除(&ndash;restartオプションと排他)</li>\\n</ul>\\n<h3 id=\\"ネットワークオプション\\">ネットワークオプション</h3>\\n<ul>\\n<li>&ndash;add-host=localhost:127.0.0.1 &hellip; コンテナの/etc/hostsにホスト名とIPアドレスを定義</li>\\n<li>&ndash;dns=8.8.8.8 &hellip; コンテナ用のDNSサーバのIPアドレス</li>\\n<li>&ndash;expose .. 指定したレンジのポート番号を割り当てる</li>\\n<li>&ndash;mac-address=FF:FF:FF:FF:FF:FF .. コンテナのMACアドレスを指定</li>\\n<li>&ndash;net=[bridge | none | container:&lt;name | id &gt; | host | NETWORK] .. コンテナのネットワークを指定</li>\\n<li>&ndash;hostname(-h) .. コンテナ自信のホスト名を指定</li>\\n<li>&ndash;publish(-p) [ホストのポート番号]:[コンテナのポート番号] .. ホストとコンテナのポートマッピング</li>\\n<li>&ndash;publish-all(-P) .. ホストの任意のポートをコンテナに割り当てる</li>\\n</ul>\\n<h3 id=\\"リソースオプション\\">リソースオプション</h3>\\n<ul>\\n<li>&ndash;cpu-shares(-c) .. CPUの使用の配分(1024が100%)</li>\\n<li>&ndash;memory(-m) .. 使用するメモリを制限(単位はb,k,m,gのいずれか)</li>\\n<li>&ndash;volume(-v)=[ホストのディレクトリ]:[コンテナのディレクトリ] .. ディレクトリを共有</li>\\n</ul>\\n<h3 id=\\"環境変数など\\">環境変数など</h3>\\n<ul>\\n<li>&ndash;env(-e)=[環境変数] .. 環境変数を設定</li>\\n<li>&ndash;envfile=[ファイル名] .. fileから環境変数を設定</li>\\n<li>&ndash;readonly=[true|false] .. コンテナのファイルシステムを読み込み専用にする</li>\\n<li>&ndash;workdir(-w)=[パス] .. コンテナの作業ディレクトリを指定する</li>\\n<li>&ndash;user(-u)=[ユーザ名] .. ユーザ名かUIDを指定する</li>\\n</ul>\\n<pre><code>$ docker run --cpu-shares=512 --memory=1g ubuntu\\n$ docker run -v /Users/basd4g/webap:/usr/share/nginx/html nginx\\n</code></pre><h2 id=\\"docker-network\\">docker network</h2>\\n<pre><code>$ docker network create -d bridge webap-net\\n$ docker container run --net=webap-net -it ubuntu\\n$ docker network ls\\n$ docker network connect [ option ] ネットワーク コンテナ\\n$ docker network disconnect ネットワーク コンテナ\\n$ docker network inspect [ option ] ネットワーク\\n$ docker network rm [ option ] ネットワーク\\n</code></pre><h2 id=\\"コンテナの状態確認\\">コンテナの状態確認</h2>\\n<pre><code>$ docker container ls [ --all(-a) --filter(-f) --format --last -8 --latest -l --no-trunc --quiet(-q) --size(-s) ]\\n# 稼働しているコンテナの状態一覧\\n$ docker container stats コンテナ識別子\\n# コンテナ稼働確認 識別子はnginxserver等 Ctrl+Cで終了\\n$ docker container top コンテナ識別子\\n# コンテナで実行中のプロセスを確認\\n</code></pre><h2 id=\\"コンテナの状態変更\\">コンテナの状態変更</h2>\\n<pre><code>$ docker container start[ --atatch(-a) --interactive(-i) ] コンテナ識別子\\n$ docker container stop [ -time(-t) ..コンテナの停止時間を指定する(defaultは10s) ] コンテナ識別子\\n$ docker container restart [ -time(-t) ..コンテナの再起動時間を指定する(defaultは10s) ] コンテナ識別子\\n$ docker container pause コンテナ識別子\\n$ docker container unpause コンテナ識別子\\n</code></pre><h2 id=\\"others\\">others</h2>\\n<pre><code>$ docker container rm [ --force(-f) .. 起動中のコンテナを強制的に削除 , --volumes(-v) .. 割り当てたボリュームを削除 ] コンテナ識別子\\n$ docker container attach コンテナ識別子\\n# 接続後、Ctrl+Cでコンテナごと終了、デタッチのみはCtrl+P -&gt; Ctrl+Q\\n$ docker container exec [ --detach(-d) --interactive(-i) --tty(-t) --user(-u) ] コンテナ識別子 実行コマンド\\n$ docker container top\\n$ docker container port # 転送されているポートの確認\\n$ docker container cp コンテナ識別子:コンテナ内のファイルパス ホストのディレクトリパス # ファイルをコピー\\n# cp以後を逆にすると、逆転送も可能\\n$ docker container diff コンテナ識別子　\\n# コンテナがイメージから作成されたときとの差分 A..ファイル追加 B..ファイル削除 C..ファイル更新\\n$ docker container commit [オプション] コンテナ識別子 [イメージ名[:タグ名]\\n</code></pre>","contentSnippet":"以下、過去の自分用メモの移動。\\ndockerに入門するにあたり「プログラマのためのDocker教科書 第2版より」を読んだ。\\nDockerfileを書いてコンテナを走らせるための自分向けのまとめをチートシート的に書き記す。\\nDockerfileの命令\\n命令一覧\\nFROM .. ベースイメージの指定\\nRUN .. コマンド実行\\nCMD .. コンテナの実行コマンド\\nLABEL .. ラベルを設定\\nEXPOSE .. ポートのエクスポート\\nENV .. 環境変数\\nADD .. ファイル/ディレクトリの追加\\nCOPY .. ファイルのコピー\\nENTRYPOINT .. コンテナの実行コマンド\\nVOLUME .. ボリュームのマウント\\nUSER .. ユーザの指定\\nWORKDIR .. 作業ディレクトリ\\nARG .. Dockerfile内の変数\\nONBUILD .. ビルド完了後に実行される命令\\nSTOPSIGNAL .. システムコールシグナルの設定\\nHEALTHCHECK .. コンテナのヘルスチェック\\nSHELL .. デフォルトシェルの設定\\nコメント\\n# コメント\\n命令 # コメント\\n\\n\\nFROM\\nFROM centos:7\\n# FROM [イメージ名]\\n# FROM [イメージ名]:[タグ名]\\n# FROM [イメージ名]@[ダイジェスト]\\n\\n\\nダイジェスト\\nDocker Hubにアップロードする際に自動で付与されるユニークな識別子。\\nダイジェストを使うことでイメージを一意に指定できる。\\ndocker image ls --digestsで確認できる\\nbuild\\n$ docker build -t [作成するイメージ名]:[タグ名] [Dockerfileのあるディレクトリのパス]\\n\\n\\ndocker engineの状態を確認\\n$ docker version\\n$ docker tutorial\\n$ docker system info\\n$ docker system df\\n# disk info\\n\\nnginxをdockerで動かしてみる\\n$ docker pull nginx\\n$ docker image ls\\n$ docker container run --name nginxserver -d -p 80:80 nginx\\n# open http://localhost:80/ on web browser\\n$ docker ps\\n$ docker stop nginxserver\\n$ docker start nginxserver\\n\\ncentosをpullしてみる\\n# p96\\n$ docker image pull centos:7\\n$ docker image ls\\n\\nDCT\\ndocker imageが改ざんされているかどうか、公開鍵(Tagging Key)を用いて検証し、改ざんがある場合そのイメージを無効化する機能。\\n有効化するには環境変数を付加\\n署名なしイメージのpull時は無効化しなければならない。\\n# enable\\n$ export DOCKER_CONTENT_TRUST=1\\n# disable\\n$ export DOCKER_CONTENT_TRUST=0\\n\\ndocker imageの操作\\n# pullしたイメージの詳細情報を確認(イメージID,作成日,dockerのversion,CPUアーキテクチャ等)\\n$ docker image inspect ubuntu:latest\\n# jsonの一部のみを取得\\n$ docker image inspect --format=\\"{{ .Os }}\\" ubuntu:latest\\n$ docker image inspect --format=\\"{{ .ContainerConfig.Image }}\\" ubuntu:latest\\n# docker image にタグ付け\\n$ docker image tag nginx basd4g/nginxserver:1.0\\n# docker hub上のimage(この場合はnginx)を検索\\n$ docker search nginx\\n# Option: --no-trunc .. 結果をすべて表示, --limit n .. n件の検索結果, --filter=stars=n .. star数下限による絞り込み\\n$ docker image rm [--force(-f) --no-prun] basd4g/nginxserver\\n# --force .. -f , --no-prune .. 中間イメージを削除しない\\n# basd4g/nginxserver ... REPOSITORYではなくIMAGE IDでも良い\\n$ docker image prune [--all(-a) --force(-f)]\\n# 未使用のdocker imageを削除\\n\\ndocker image のpush\\n$ docker login -u basd4g -p xxx\\n$ docker image push basd4g/nginxserver:1.0\\n$ docker logout\\n\\ndocker container run\\n$ docker container run [ option ] basd4g/nginxserver\\n$ docker run [ option ] basd4g/nginxserver # containerは省略可能\\n$ docker run -it --name \\"test1\\" ubuntu /bin/bash\\n$ docker run -d -p 8080:80 nginx\\n$ docker run -d --dns 8.8.8.8 nginx\\n$ docker run -d --mac-address=\\"92:d0:c6:0a:29:33\\" ubuntu\\n# $ docker container inspect --format=\\"{{ .Config.MacAddress }}\\" [Container ID]\\n$docker run -id --add-host test.com:192.168.0.1 ubuntu\\n\\n実行開始時オプション\\n–attach(-a) STDIN/STDOUT/STDERR –cidfile –detach(-d) –interactive(-i) –tty(-t)\\n-a .. 標準入力/標準出力/標準エラー出力にアタッチ\\n-d .. バックグラウンドで実行\\n-i .. コンテナの標準入力を開く\\n-t .. 端末デバイスを使う\\n終了時オプション\\n–restart .. no (再起動しない)/ on-failure (終了ステータスが0でないなら再起動)/ on-failure:4 (終了ステータスが0でないなら4回再起動/ always (常に)/ unless-stopped (直前のコンテナの状態が停止状態でなければ再起動)\\n–rm .. 実行後のコンテナを自動で削除(–restartオプションと排他)\\nネットワークオプション\\n–add-host=localhost:127.0.0.1 … コンテナの/etc/hostsにホスト名とIPアドレスを定義\\n–dns=8.8.8.8 … コンテナ用のDNSサーバのIPアドレス\\n–expose .. 指定したレンジのポート番号を割り当てる\\n–mac-address=FF:FF:FF:FF:FF:FF .. コンテナのMACアドレスを指定\\n–net=[bridge | none | container:<name | id > | host | NETWORK] .. コンテナのネットワークを指定\\n–hostname(-h) .. コンテナ自信のホスト名を指定\\n–publish(-p) [ホストのポート番号]:[コンテナのポート番号] .. ホストとコンテナのポートマッピング\\n–publish-all(-P) .. ホストの任意のポートをコンテナに割り当てる\\nリソースオプション\\n–cpu-shares(-c) .. CPUの使用の配分(1024が100%)\\n–memory(-m) .. 使用するメモリを制限(単位はb,k,m,gのいずれか)\\n–volume(-v)=[ホストのディレクトリ]:[コンテナのディレクトリ] .. ディレクトリを共有\\n環境変数など\\n–env(-e)=[環境変数] .. 環境変数を設定\\n–envfile=[ファイル名] .. fileから環境変数を設定\\n–readonly=[true|false] .. コンテナのファイルシステムを読み込み専用にする\\n–workdir(-w)=[パス] .. コンテナの作業ディレクトリを指定する\\n–user(-u)=[ユーザ名] .. ユーザ名かUIDを指定する\\n$ docker run --cpu-shares=512 --memory=1g ubuntu\\n$ docker run -v /Users/basd4g/webap:/usr/share/nginx/html nginx\\n\\ndocker network\\n$ docker network create -d bridge webap-net\\n$ docker container run --net=webap-net -it ubuntu\\n$ docker network ls\\n$ docker network connect [ option ] ネットワーク コンテナ\\n$ docker network disconnect ネットワーク コンテナ\\n$ docker network inspect [ option ] ネットワーク\\n$ docker network rm [ option ] ネットワーク\\n\\nコンテナの状態確認\\n$ docker container ls [ --all(-a) --filter(-f) --format --last -8 --latest -l --no-trunc --quiet(-q) --size(-s) ]\\n# 稼働しているコンテナの状態一覧\\n$ docker container stats コンテナ識別子\\n# コンテナ稼働確認 識別子はnginxserver等 Ctrl+Cで終了\\n$ docker container top コンテナ識別子\\n# コンテナで実行中のプロセスを確認\\n\\nコンテナの状態変更\\n$ docker container start[ --atatch(-a) --interactive(-i) ] コンテナ識別子\\n$ docker container stop [ -time(-t) ..コンテナの停止時間を指定する(defaultは10s) ] コンテナ識別子\\n$ docker container restart [ -time(-t) ..コンテナの再起動時間を指定する(defaultは10s) ] コンテナ識別子\\n$ docker container pause コンテナ識別子\\n$ docker container unpause コンテナ識別子\\n\\nothers\\n$ docker container rm [ --force(-f) .. 起動中のコンテナを強制的に削除 , --volumes(-v) .. 割り当てたボリュームを削除 ] コンテナ識別子\\n$ docker container attach コンテナ識別子\\n# 接続後、Ctrl+Cでコンテナごと終了、デタッチのみはCtrl+P -> Ctrl+Q\\n$ docker container exec [ --detach(-d) --interactive(-i) --tty(-t) --user(-u) ] コンテナ識別子 実行コマンド\\n$ docker container top\\n$ docker container port # 転送されているポートの確認\\n$ docker container cp コンテナ識別子:コンテナ内のファイルパス ホストのディレクトリパス # ファイルをコピー\\n# cp以後を逆にすると、逆転送も可能\\n$ docker container diff コンテナ識別子　\\n# コンテナがイメージから作成されたときとの差分 A..ファイル追加 B..ファイル削除 C..ファイル更新\\n$ docker container commit [オプション] コンテナ識別子 [イメージ名[:タグ名]","guid":"https://memo.basd4g.net/posts/docker/","isoDate":"2020-08-14T09:59:31.000Z"},{"title":"GitHubにsshでつなぐ","link":"https://memo.basd4g.net/posts/github-ssh/","pubDate":"Fri, 14 Aug 2020 18:55:39 +0900","content":"<p>以下、過去の自分用メモの移動。</p>\\n<p>WindowsやMacでは、GitHubのIDとパスワードを安全に記憶して、HTTPS通信で勝手に使ってくれるのだが、Ubuntuではどうもよい方法がなさそうだった。</p>\\n<p>そこでHTTPSではなくSSHを使ってgithubと通信するようにして、公開鍵認証により安全を担保しようというわけだ。</p>\\n<h2 id=\\"鍵ペアを作る\\">鍵ペアを作る</h2>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">cd</span> ~/.ssh\\n$ ssh-keygen -t rsa -b <span class=\\"m\\">4096</span> -C <span class=\\"s2\\">&#34;mymail@example.com&#34;</span>\\n<span class=\\"c1\\"># 鍵の名前を id_rsa_github とする</span>\\n<span class=\\"c1\\"># パスワードも聞かれるので入力</span>\\n$ ls -1\\nid_rsa_github <span class=\\"c1\\"># 秘密鍵</span>\\nid_rsa_github.pub <span class=\\"c1\\"># 公開鍵</span>\\n<span class=\\"c1\\"># 作成時に既に正しく設定されていた Ubuntu20.04LTS</span>\\n<span class=\\"c1\\"># $ chmod 600 id_rsa_github</span>\\n</code></pre></div><h2 id=\\"githubに登録\\">GitHubに登録</h2>\\n<p>GitHub &gt; Settings &gt; SSH Keys &gt; Add SSH key から公開鍵を登録する</p>\\n<p>Title : PC名等\\nKey: 公開鍵をコピペ</p>\\n<p>Add keyを押し、その後パスワードも入力</p>\\n<h2 id=\\"ローカルマシン上で設定\\">ローカルマシン上で設定</h2>\\n<p><code>~/.ssh/config</code>に以下を追記</p>\\n<pre><code class=\\"language-~/.ssh/config\\" data-lang=\\"~/.ssh/config\\">Host github\\nHostName github.com\\nIdentityFile ~/.ssh/id_rsa_github\\nUser git\\n</code></pre><div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># ssh-agentが動作しているか確認</span>\\n<span class=\\"nb\\">eval</span> <span class=\\"s2\\">&#34;</span><span class=\\"si\\">${</span><span class=\\"nv\\">ssh</span><span class=\\"p\\">-agent -s</span><span class=\\"si\\">}</span><span class=\\"s2\\">&#34;</span>\\nAgent pid <span class=\\"m\\">32047</span>\\n$ ssh-add ~/.ssh/id_rsa_github\\n<span class=\\"c1\\"># パスワードを入力</span>\\n<span class=\\"c1\\"># 接続確認</span>\\n$ ssh -T git@github.com\\n</code></pre></div>","contentSnippet":"以下、過去の自分用メモの移動。\\nWindowsやMacでは、GitHubのIDとパスワードを安全に記憶して、HTTPS通信で勝手に使ってくれるのだが、Ubuntuではどうもよい方法がなさそうだった。\\nそこでHTTPSではなくSSHを使ってgithubと通信するようにして、公開鍵認証により安全を担保しようというわけだ。\\n鍵ペアを作る\\n$ cd ~/.ssh\\n$ ssh-keygen -t rsa -b 4096 -C \\"mymail@example.com\\"\\n# 鍵の名前を id_rsa_github とする\\n# パスワードも聞かれるので入力\\n$ ls -1\\nid_rsa_github # 秘密鍵\\nid_rsa_github.pub # 公開鍵\\n# 作成時に既に正しく設定されていた Ubuntu20.04LTS\\n# $ chmod 600 id_rsa_github\\n\\n\\nGitHubに登録\\nGitHub > Settings > SSH Keys > Add SSH key から公開鍵を登録する\\nTitle : PC名等\\nKey: 公開鍵をコピペ\\nAdd keyを押し、その後パスワードも入力\\nローカルマシン上で設定\\n~/.ssh/configに以下を追記\\nHost github\\nHostName github.com\\nIdentityFile ~/.ssh/id_rsa_github\\nUser git\\n\\n\\n# ssh-agentが動作しているか確認\\neval \\"${ssh-agent -s}\\"\\nAgent pid 32047\\n$ ssh-add ~/.ssh/id_rsa_github\\n# パスワードを入力\\n# 接続確認\\n$ ssh -T git@github.com","guid":"https://memo.basd4g.net/posts/github-ssh/","isoDate":"2020-08-14T09:55:39.000Z"},{"title":"Lily58 Pro を Bluetooth 対応し無線化する","link":"https://memo.basd4g.net/posts/lily58-pro-ble/","pubDate":"Fri, 14 Aug 2020 02:07:01 +0900","content":"<p><a href=\\"https://memo.basd4g.net/posts/lily58-pro-build-log/\\">前回の記事で作った</a>左右分割型の自作キーボード <a href=\\"https://yuchi-kbd.hatenablog.com/entry/2018/12/23/214342\\"target=\\"_blank\\">Lily58 Pro</a> を Bluetooth に対応させ、無線で PC に接続できるように改造した。\\nその作業記録。</p>\\n<p>この記事では、無線化にあたり次のことを行う。</p>\\n<ul>\\n<li>USBからキーボードへの給電がなくなるので、別途<a href=\\"https://yushakobo.jp/shop/ble-micro-pro-battery-board/\\"target=\\"_blank\\">ボタン電池用の電源基板</a>をつなぐ</li>\\n<li>有線キーボードの制御用マイコンである Pro Micro を、Bluetooth に対応した <a href=\\"https://github.com/sekigon-gonnoc/BLE-Micro-Pro\\"target=\\"_blank\\">BLE Micro Pro</a> に交換する</li>\\n<li>BLE Micro Pro にファームウェアを書き込む</li>\\n</ul>\\n<h2 id=\\"必要なもの\\">必要なもの</h2>\\n<ul>\\n<li>Lily58 Pro (<a href=\\"https://yushakobo.jp/shop/lily58-pro/\\"target=\\"_blank\\">遊舎工房</a>)</li>\\n<li>Pro Micro 互換の Bluetooth-LowEnergy 対応マイコン(<a href=\\"https://yusahakobo.jp/shop/ble-micro-pro/\\"target=\\"_blank\\">遊舎工房</a>|<a href=\\"https://nogikes.booth.pm/items/1177319\\"target=\\"_blank\\">Booth</a>) x2</li>\\n<li>上記マイコン用ボタン電池基板 (<a href=\\"https://yushakobo.jp/shop/ble-micro-pro-battery-board/\\"target=\\"_blank\\">遊舎工房</a>|<a href=\\"https://nogikes.booth.pm/items/1655285\\"target=\\"_blank\\">Booth</a>) x2</li>\\n<li>上記の互換ボードを Lily58 に PCB に固定するためのコンスルー 12ピン (<a href=\\"https://yushakobo.jp/shop/a01mc-00/\\"target=\\"_blank\\">遊舎工房</a>)</li>\\n<li>ボタン電池 CR1632 x4</li>\\n<li>(電池ホルダーを紛失したので) 100均に売っている金属製のコードホルダー x4</li>\\n<li>(電池ホルダーを紛失したので) 上記と基板をつなぐスズメッキ線</li>\\n<li>マイコンと電池基板をつなぐICピン 長さ1ピン x4</li>\\n<li>絶縁用ビニールテープ</li>\\n<li>はんだ、はんだごて、はんだ吸い取り線、ピンセット等</li>\\n</ul>\\n<h2 id=\\"手順\\">手順</h2>\\n<p>手順を示した<a href=\\"https://sekigon-gonnoc.github.io/BLE-Micro-Pro/#/getting_started\\"target=\\"_blank\\">公式ガイド</a>に従って作業を進めた</p>\\n<h3 id=\\"1-lily58-pro-を完成させる\\">1. Lily58 Pro を完成させる</h3>\\n<p>Pro Microはコンスルーを使って組み立て、交換できるようにしておく</p>\\n<h3 id=\\"2-電池基板の組み立て\\">2. 電池基板の組み立て</h3>\\n<h4 id=\\"21-コンデンサ-スイッチ-ダイオードの取り付け\\">2.1. コンデンサ, スイッチ, ダイオードの取り付け</h4>\\n<p>電池基板に付属の電子部品をはんだ付けする。</p>\\n<p>はんだ付けの手順は以下の通り。Lily58 Proの部品をはんだ付けしたのと同じように行えばよい。\\n写真はコンデンサを固定するときのものである。</p>\\n<ol>\\n<li>まず基板のランドの片方を温めて半田をつける</li>\\n</ol>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/powerboard1.jpg\\"><img src=\\"https://blob.basd4g.net/powerboard1.jpg\\"\\nalt=\\"基板のランドの片方を温めて半田をつける\\"/></a></p>\\n<ol start=\\"2\\">\\n<li>先程つけた半田を溶かして部品の片方を固定する</li>\\n</ol>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/powerboard2.jpg\\"><img src=\\"https://blob.basd4g.net/powerboard2.jpg\\"\\nalt=\\"部品の片方を固定する\\"/></a></p>\\n<ol start=\\"3\\">\\n<li>まだ半田を流していない側の端子とランドを温めて半田をつける</li>\\n</ol>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/powerboard3.jpg\\"><img src=\\"https://blob.basd4g.net/powerboard3.jpg\\"\\nalt=\\"部品を完全に固定する\\"/></a></p>\\n<p>コンデンサは極性がないのでどちら向きにつけてもよい。</p>\\n<p>ダイオードはコンデンサと反対の面につける。\\n極性があるので注意。\\nダイオードの表面に線が入っており、線が近い方の端子がプラス。\\nこれを基板のシルク印刷(丸ポッチがある方)に合わせる。</p>\\n<p>組み立てると次のようになる。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/powerboard4.jpg\\"><img src=\\"https://blob.basd4g.net/powerboard4.jpg\\"\\nalt=\\"表面実装部品を組み立てた電池基板\\"/></a></p>\\n<h4 id=\\"22-電池固定用ホルダーの取り付け\\">2.2. 電池固定用ホルダーの取り付け</h4>\\n<p>今回は(届いたときに内容物を確認していなかったがおそらく)この部品を紛失したため、電池が固定できそうな金属部品を探して代用した。</p>\\n<p>それがダイソーのコードホルダー。\\nこれの左右を切り落として、コの字のパーツを作り、折り曲げる。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/powerboard5.jpg\\"><img src=\\"https://blob.basd4g.net/powerboard5.jpg\\"\\nalt=\\"ダイソーのコードホルダーを加工する\\"/></a></p>\\n<p>次に、完成時に電池と基板を挟み込むように、基板の電池を固定するのと反対側の面に、金具を金具に付属の粘着テープで固定する。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/powerboard7.jpg\\"><img src=\\"https://blob.basd4g.net/powerboard7.jpg\\"\\nalt=\\"コードホルダーと基板を結線する\\"/></a></p>\\n<p>そのあと、基板のホールと金具をスズメッキ線で結線する。</p>\\n<p>最後に電池を取り付けてテスターで3Vが得られることを確認したら、全体をビニールテープで絶縁する。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/powerboard8.jpg\\"><img src=\\"https://blob.basd4g.net/powerboard8.jpg\\"\\nalt=\\"ビニールテープで絶縁する\\"/></a></p>\\n<h3 id=\\"3-ble-micro-pro-の組み立て\\">3. BLE Micro Pro の組み立て</h3>\\n<p>BLE Micro Pro にコンスルーを取り付ける。はんだ付けの必要はないと書いてあったがなんとなく半田を流しておいた。</p>\\n<p>その後、ピンヘッダを1本だけの長さにして、電池基板を BLE Micro Pro につなげる。</p>\\n<p>最後に BLE Micro Pro を Lily58 に刺して完成。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/lily58proble.jpg\\"><img src=\\"https://blob.basd4g.net/lily58proble.jpg\\"\\nalt=\\"Bluetooth対応の組み立てが完了したLily58 Pro\\"/></a></p>\\n<h3 id=\\"4-ファームウェアの書き込み\\">4. ファームウェアの書き込み</h3>\\n<p>事前に 電池基板のスイッチを切っておいたほうがわかりやすい。\\nLily58 Pro に固定した状態で左右の基板ともに、左にスイッチを倒すとOFF。</p>\\n<p>BLE Pro Micro は <a href=\\"https://sekigon-gonnoc.github.io/home#/keymap\\"target=\\"_blank\\">専用の Web Configurator</a> という Chrome 上で動く Webアプリで書き込むのが一番簡単な方法らしい。</p>\\n<ol>\\n<li>\\n<p>Chrome の設定変更\\n<code>chrome://flags#enable-experimental-web-platform-features</code> を開き Experimental Web Platform features を Enabled にする。</p>\\n</li>\\n<li>\\n<p><a href=\\"https://sekigon-gonnoc.github.io/home#/keymap\\"target=\\"_blank\\">専用の Web Configurator</a> にアクセスする</p>\\n</li>\\n<li>\\n<p>ナビゲーション付きでセットアップを開始する</p>\\n</li>\\n<li>\\n<p>キーボードの選択画面で Lily58 の rev1 を選ぶ Disable Mass storage Class と Use with LPME-IO のチェックは入れない</p>\\n</li>\\n<li>\\n<p>最新のブートローダー (記事執筆時は0_7_1) 選び Update</p>\\n</li>\\n<li>\\n<p>デバイスを選択する画面が出てくるので, BLE Micro Pro を PC と USBで接続する。\\nBLE Micro Pro(新しく増えたデバイス)を選択。\\n筆者の環境(Macbook Air 2018 Catarina)では <code>IOUSBHostDevice (tty.usbmodem0000000000011)</code> と <code>IOUSBHostDevice (cu.usbmodem0000000000011)</code>が出現したが、後者を選ぶと書き込めた。</p>\\n</li>\\n<li>\\n<p>アプリケーション(必ずブートローダー同じバージョンのもの)を書き込む。Is Left のみにチェックが入っていること。</p>\\n</li>\\n<li>\\n<p>もう一つの BLE Micro Pro も同様に書き込む。アプリケーション書き込み時に Is Slave のみにチェックが入っていること。</p>\\n</li>\\n</ol>\\n<h3 id=\\"5-キーマップの書き込み\\">5. キーマップの書き込み</h3>\\n<ol>\\n<li><a href=\\"https://sekigon-gonnoc.github.io/qmk_configurator/#/\\"target=\\"_blank\\">専用の QMK Configurator</a> にアクセスする。</li>\\n<li>BLE Micro Pro を PC に USB 接続した状態で、CONNECT BY SERIAL ボタンを押す。</li>\\n<li>キーボードリストから lily58/rev1 を選択する。</li>\\n<li>好みのキーマップを作成する。</li>\\n<li>KEYMAP.JSON の左側のボタンを押してキーボードに反映</li>\\n<li>そのまま試しにキーを打ってみて問題なさそうであれば、SAVE KEYMAP ボタンでキーボードに保存。</li>\\n<li>USBを抜いて、PCと BLE Micro Pro を切り離す</li>\\n</ol>\\n<h3 id=\\"6-キーボードを実際に使う\\">6. キーボードを実際に使う</h3>\\n<p>左右どちらも電池基板の電源を入れると、勝手に左右がペアリングする。\\nPC の Bluetooth 設定ページを見ると Lily58 が出現しているので選択すると PC とのペアリングが完了し使えるようになる。</p>\\n<h2 id=\\"感想\\">感想</h2>\\n<ul>\\n<li>公式のドキュメントと、他の分割キーボードの Bluetooth 化の記事を見ながら進めた。</li>\\n<li>電池ホルダーがないことに気づいたときは凹んだが、完成品は特に不自然なく動作させられてよかった。</li>\\n<li>QMK をビルドして書き込む方法はうまく行ってないので、また必要になる時があったら試してみることとする。</li>\\n<li>Web アプリの QMK Configurator はよくできていて、キーの長押しで動作を変えるといった機能にも対応しているのでひとまずは普通に使えている。</li>\\n<li>キーボードのペアリングはとてもスムーズだったし、ペアリング後も電源を入れるとすぐにPCとつながるのでとても快適に使うことができている。</li>\\n<li>いまのところ一日に一回くらい、キーが押しっぱなしになる(キーを押して無いのにキーコードが送信され続ける)ことがあり、キーボードの電源を一旦切ることで解決している。原因は不明。 今後も継続して発生するようであれば、これの原因究明もせねばならない。</li>\\n</ul>\\n<p>こんなところかな。</p>\\n<p>自作キーボードとはいえ、普通に問題なく使える快適なものが出来上がってとても満足だ。\\nキーボードや無線化キットを設計したり情報をまとめたりしてくれている方々に感謝したい。</p>\\n<p>両手で1万円くらいかけてわざわざ無線化したのは理由があるのだが、それはまた別記事で紹介することとする。</p>\\n<hr>\\n<p>追記: (2020/10/04) lily58ビルドログへのリンクを相対リンクへ修正</p>","contentSnippet":"前回の記事で作った左右分割型の自作キーボード Lily58 Pro を Bluetooth に対応させ、無線で PC に接続できるように改造した。\\nその作業記録。\\nこの記事では、無線化にあたり次のことを行う。\\nUSBからキーボードへの給電がなくなるので、別途ボタン電池用の電源基板をつなぐ\\n有線キーボードの制御用マイコンである Pro Micro を、Bluetooth に対応した BLE Micro Pro に交換する\\nBLE Micro Pro にファームウェアを書き込む\\n必要なもの\\nLily58 Pro (遊舎工房)\\nPro Micro 互換の Bluetooth-LowEnergy 対応マイコン(遊舎工房|Booth) x2\\n上記マイコン用ボタン電池基板 (遊舎工房|Booth) x2\\n上記の互換ボードを Lily58 に PCB に固定するためのコンスルー 12ピン (遊舎工房)\\nボタン電池 CR1632 x4\\n(電池ホルダーを紛失したので) 100均に売っている金属製のコードホルダー x4\\n(電池ホルダーを紛失したので) 上記と基板をつなぐスズメッキ線\\nマイコンと電池基板をつなぐICピン 長さ1ピン x4\\n絶縁用ビニールテープ\\nはんだ、はんだごて、はんだ吸い取り線、ピンセット等\\n手順\\n手順を示した公式ガイドに従って作業を進めた\\n1. Lily58 Pro を完成させる\\nPro Microはコンスルーを使って組み立て、交換できるようにしておく\\n2. 電池基板の組み立て\\n2.1. コンデンサ, スイッチ, ダイオードの取り付け\\n電池基板に付属の電子部品をはんだ付けする。\\nはんだ付けの手順は以下の通り。Lily58 Proの部品をはんだ付けしたのと同じように行えばよい。\\n写真はコンデンサを固定するときのものである。\\nまず基板のランドの片方を温めて半田をつける\\n\\n先程つけた半田を溶かして部品の片方を固定する\\n\\nまだ半田を流していない側の端子とランドを温めて半田をつける\\n\\nコンデンサは極性がないのでどちら向きにつけてもよい。\\nダイオードはコンデンサと反対の面につける。\\n極性があるので注意。\\nダイオードの表面に線が入っており、線が近い方の端子がプラス。\\nこれを基板のシルク印刷(丸ポッチがある方)に合わせる。\\n組み立てると次のようになる。\\n\\n2.2. 電池固定用ホルダーの取り付け\\n今回は(届いたときに内容物を確認していなかったがおそらく)この部品を紛失したため、電池が固定できそうな金属部品を探して代用した。\\nそれがダイソーのコードホルダー。\\nこれの左右を切り落として、コの字のパーツを作り、折り曲げる。\\n\\n次に、完成時に電池と基板を挟み込むように、基板の電池を固定するのと反対側の面に、金具を金具に付属の粘着テープで固定する。\\n\\nそのあと、基板のホールと金具をスズメッキ線で結線する。\\n最後に電池を取り付けてテスターで3Vが得られることを確認したら、全体をビニールテープで絶縁する。\\n\\n3. BLE Micro Pro の組み立て\\nBLE Micro Pro にコンスルーを取り付ける。はんだ付けの必要はないと書いてあったがなんとなく半田を流しておいた。\\nその後、ピンヘッダを1本だけの長さにして、電池基板を BLE Micro Pro につなげる。\\n最後に BLE Micro Pro を Lily58 に刺して完成。\\n\\n4. ファームウェアの書き込み\\n事前に 電池基板のスイッチを切っておいたほうがわかりやすい。\\nLily58 Pro に固定した状態で左右の基板ともに、左にスイッチを倒すとOFF。\\nBLE Pro Micro は 専用の Web Configurator という Chrome 上で動く Webアプリで書き込むのが一番簡単な方法らしい。\\nChrome の設定変更\\nchrome://flags#enable-experimental-web-platform-features を開き Experimental Web Platform features を Enabled にする。\\n専用の Web Configurator にアクセスする\\nナビゲーション付きでセットアップを開始する\\nキーボードの選択画面で Lily58 の rev1 を選ぶ Disable Mass storage Class と Use with LPME-IO のチェックは入れない\\n最新のブートローダー (記事執筆時は0_7_1) 選び Update\\nデバイスを選択する画面が出てくるので, BLE Micro Pro を PC と USBで接続する。\\nBLE Micro Pro(新しく増えたデバイス)を選択。\\n筆者の環境(Macbook Air 2018 Catarina)では IOUSBHostDevice (tty.usbmodem0000000000011) と IOUSBHostDevice (cu.usbmodem0000000000011)が出現したが、後者を選ぶと書き込めた。\\nアプリケーション(必ずブートローダー同じバージョンのもの)を書き込む。Is Left のみにチェックが入っていること。\\nもう一つの BLE Micro Pro も同様に書き込む。アプリケーション書き込み時に Is Slave のみにチェックが入っていること。\\n5. キーマップの書き込み\\n専用の QMK Configurator にアクセスする。\\nBLE Micro Pro を PC に USB 接続した状態で、CONNECT BY SERIAL ボタンを押す。\\nキーボードリストから lily58/rev1 を選択する。\\n好みのキーマップを作成する。\\nKEYMAP.JSON の左側のボタンを押してキーボードに反映\\nそのまま試しにキーを打ってみて問題なさそうであれば、SAVE KEYMAP ボタンでキーボードに保存。\\nUSBを抜いて、PCと BLE Micro Pro を切り離す\\n6. キーボードを実際に使う\\n左右どちらも電池基板の電源を入れると、勝手に左右がペアリングする。\\nPC の Bluetooth 設定ページを見ると Lily58 が出現しているので選択すると PC とのペアリングが完了し使えるようになる。\\n感想\\n公式のドキュメントと、他の分割キーボードの Bluetooth 化の記事を見ながら進めた。\\n電池ホルダーがないことに気づいたときは凹んだが、完成品は特に不自然なく動作させられてよかった。\\nQMK をビルドして書き込む方法はうまく行ってないので、また必要になる時があったら試してみることとする。\\nWeb アプリの QMK Configurator はよくできていて、キーの長押しで動作を変えるといった機能にも対応しているのでひとまずは普通に使えている。\\nキーボードのペアリングはとてもスムーズだったし、ペアリング後も電源を入れるとすぐにPCとつながるのでとても快適に使うことができている。\\nいまのところ一日に一回くらい、キーが押しっぱなしになる(キーを押して無いのにキーコードが送信され続ける)ことがあり、キーボードの電源を一旦切ることで解決している。原因は不明。 今後も継続して発生するようであれば、これの原因究明もせねばならない。\\nこんなところかな。\\n自作キーボードとはいえ、普通に問題なく使える快適なものが出来上がってとても満足だ。\\nキーボードや無線化キットを設計したり情報をまとめたりしてくれている方々に感謝したい。\\n両手で1万円くらいかけてわざわざ無線化したのは理由があるのだが、それはまた別記事で紹介することとする。\\n追記: (2020/10/04) lily58ビルドログへのリンクを相対リンクへ修正","guid":"https://memo.basd4g.net/posts/lily58-pro-ble/","isoDate":"2020-08-13T17:07:01.000Z"},{"title":"Lily58 を作って自作キーボードに入門した (Lily58 Pro Build Log)","link":"https://memo.basd4g.net/posts/lily58-pro-build-log/","pubDate":"Fri, 14 Aug 2020 01:55:25 +0900","content":"<blockquote class=\\"twitter-tweet\\"><p lang=\\"ja\\" dir=\\"ltr\\">毎月一回、自作キーボードが作りたくなってカートに商品を入れるまでやる。あと一歩のところで踏みとどまる。</p>&mdash; けーすけ@やんまー (@basd4g) <a href=\\"https://twitter.com/basd4g/status/1284673759593418752?ref_src=twsrc%5Etfw\\">July 19, 2020</a></blockquote> <script async src=\\"https://platform.twitter.com/widgets.js\\" charset=\\"utf-8\\"><\/script>\\n<p>数ヶ月前から、自作キーボードが気になっていたのだが、ついに手を出してしまった。</p>\\n<h2 id=\\"自作キーボードとは\\">自作キーボードとは</h2>\\n<p>自作キーボードとは、キースイッチやキーキャップ、基板(PCB)等を購入し、自分で組み立ててキーボードを作ることである。\\n自分の欲しいキーボードを作ることができるのが魅力。</p>\\n<p>パーツをはんだ付けしたり、マイコンにファームウェアを書き込んだり、場合によっては基板を設計したりすることでつくる。</p>\\n<p>今回は既に設計, 基板が製造済みで、組み立てキット形式になっている Lily58 Pro を作ることにした。</p>\\n<h2 id=\\"lily58-pro-を選んだ理由\\">Lily58 Pro を選んだ理由</h2>\\n<p>作る機種は、<a href=\\"https://yuchi-kbd.hatenablog.com/entry/2018/12/23/214342\\"target=\\"_blank\\">Lily 58 Pro</a>とした。</p>\\n<p>Lily58 が魅力だったのは次の点。</p>\\n<h3 id=\\"キーマップを自由に書き換えられること\\">キーマップを自由に書き換えられること</h3>\\n<p>これは Lily58 に限らず自作キーボードの殆どに言えることだと思うが、キーボードの挙動を自由に書き換えることができる。\\n打ちづらい位置にあるキーは使用頻度の少ないキーと入れ替えたり、複数キーの同時押しで特殊な動作をさせたりすることが可能になる。</p>\\n<p>自作キーボードは極端に言うとマイコンとスイッチの集合体なので、挙動は本当に自由に決めれると言ってよい。\\n(実際には qmk といわれるファームウェアを使うことが一般的で、これの一部を書き換えることでカスタマイズを実現する。)</p>\\n<p>キーボード側で自由に設定できるのはとてもありがたい。\\nもともとキーリマッパと呼ばれるソフトウェアを使って挙動を書き換えていたのだが、これは環境構築が面倒だったりする。\\n(Mac では Karabiner Elements、Ubuntu では xkeysnail を使っていた。)\\n自作キーボードであれば USB を刺すだけで済む。</p>\\n<p>キーマップを自由に書き換えられるのって嬉しいのか？と思う人、あなたは CapsLock を使っているだろうか。\\n結構使用頻度の少ないキーだと思うのだが、そこそこ押しやすい位置にある。\\n例えばこれを Ctrl に変えればショートカットを押しやすいし、ESC にすれば Vim が使いやすくなるし、半角/かなキーにするのも便利かもしれない。</p>\\n<p>こんな感じで一つずつ置き換えるキーを増やしていき、設定が煩雑になって自作キーボードが欲しくなった。</p>\\n<h3 id=\\"キー数が60個程度-いわゆる60キーボード\\">キー数が60個程度 (いわゆる60%キーボード)</h3>\\n<p>普段使わないキーはいらないので、コンパクトなものがほしい。\\nただし40%等のこれ以上キー数が少ないものは不安。</p>\\n<p>既に60%の中華キーボード (<a href=\\"https://www.amazon.co.jp/gp/product/B07QQXJ58V/ref=ppx_yo_dt_b_asin_title_o03_s00?ie=UTF8&amp;psc=1\\"target=\\"_blank\\">RK Royal RK61</a>) を使っているので、良い落とし所なのではと思った。</p>\\n<p>ちなみにこの RK61 は4月頃に自作キーボード (DZ60) を作ろうか迷った挙げ句「自作キーボード、まだ自分には早いかな」と思い、とりあえず60%の US 配列キーボードを買ったもの。\\n普通に使えていたが、結局自作キーボード欲を抑えることができなかった。</p>\\n<h3 id=\\"kailh-ロープロファイルに対応している\\">kailh ロープロファイルに対応している</h3>\\n<p>Lily58 Pro は kailh ロープロファイル (浅いキーストロークのスイッチの規格) に対応している。</p>\\n<p>私はノートパソコンのキーボードのような、キーストロークの浅いキーボードが割と好きで、キーストロークが深いと打ち間違いやすい気がしていた。\\n(RK61を使っていたときの感想。昔はメンブレンのキーボードとか普通に使っていたはずなのだが。)</p>\\n<p>作ったあとの感想になるが、このキースイッチの選択は正解で浅いキーボードは打ちやすいと感じる。</p>\\n<h3 id=\\"左右分割型であること\\">左右分割型であること</h3>\\n<p>左右分割型だと肩が丸まらないので姿勢が良くなるらしい。\\n当初は分割でなく一体型のキーボードに注目していたが、調べるうちにどうせ作るなら金額も変わらないし左右分割型にしてみるかという気分になっていった。</p>\\n<p>左右分割型にしたことで夢が広がるのだがそれはまた別の記事に書くこととする。</p>\\n<h3 id=\\"column-straggered-であること\\">column-straggered であること</h3>\\n<p>column-straggerd とはキー配列の種類で、列ごとに縦方向にずれたもの。</p>\\n<p>一般的なキーボードは キーが一段ごとに横方向に半分程度ずれている。(row-straggered という。)\\nこのずれはタイプライターの機械構造に起因していて、特に打ちやすくするためではないらしい。</p>\\n<p>この横方向にずれた配列が打ちづらいのはわりと感じる(右人差し指でYを打鍵するの遠すぎないか？？)ので、完全に格子状の Ortholiner ないしは column-straggerd なキーボードを求めた。</p>\\n<p>ちなみにYを右人差し指でタイプするのは遠すぎるので、左人差し指でタイプする癖がついていたのだが、分割キーボードにしたことでこの癖は矯正することになった。</p>\\n<h2 id=\\"購入したもの\\">購入したもの</h2>\\n<p>自作キーボードの部品を買える通販サイトの代表的なものに以下のサイトがある。\\n今回は全て遊舎工房で購入した。</p>\\n<ul>\\n<li><a href=\\"https://yushakobo.jp/\\"target=\\"_blank\\">遊舎工房</a></li>\\n<li><a href=\\"https://yushakobo.jp/\\"target=\\"_blank\\">Aliexpress</a></li>\\n<li><a href=\\"https://kbdfans.com/\\"target=\\"_blank\\">KBDFANS</a></li>\\n<li><a href=\\"https://eucalyn.shop/\\"target=\\"_blank\\">ゆかりキーボードファクトリー</a></li>\\n<li><a href=\\"https://talpkeyboard.stores.jp/\\"target=\\"_blank\\">TALP KEYBOARD</a></li>\\n</ul>\\n<p>購入した商品は以下の通り。</p>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\"left\\">商品</th>\\n<th align=\\"right\\">数量</th>\\n<th align=\\"right\\">値段</th>\\n<th align=\\"left\\">補足</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td align=\\"left\\"><a href=\\"https://yushakobo.jp/shop/lily58-pro/?attribute_pa_sockettype=choc\\"target=\\"_blank\\">Lily58 Pro - Kailh Choc ロープロファイル用</a></td>\\n<td align=\\"right\\">1</td>\\n<td align=\\"right\\">14,800</td>\\n<td align=\\"left\\">大半のパーツが含まれるキット</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\"><a href=\\"https://yushakobo.jp/shop/pg1350/?attribute_pa_stem=red\\"target=\\"_blank\\">Kailhロープロファイルスイッチ（10個） - 赤</a></td>\\n<td align=\\"right\\">6</td>\\n<td align=\\"right\\">2,880</td>\\n<td align=\\"left\\">キーを押したことを判定するスイッチ</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\"><a href=\\"https://yushakobo.jp/shop/pg1350cap-doubleshot/?attribute_pa_keycapcolor=black\\"target=\\"_blank\\">Kailhロープロ刻印キーキャップ - 黒</a></td>\\n<td align=\\"right\\">1</td>\\n<td align=\\"right\\">3,000</td>\\n<td align=\\"left\\">キースイッチの上にかぶせるキャップ (刻印付きで100個くらい入っている)</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\"><a href=\\"https://yushakobo.jp/shop/a0300lb/?attribute_pa_color=white&amp;attribute_pa_size=1-5u\\"target=\\"_blank\\">Kailhロープロ無刻印キーキャップ1.5U 2U（1個） - 白, 1.5u</a></td>\\n<td align=\\"right\\">2</td>\\n<td align=\\"right\\">400</td>\\n<td align=\\"left\\">親指部分の少し長いキーキャップ</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\"><a href=\\"https://yushakobo.jp/shop/pg1350cap-blank/?attribute_pa_keycapcolor=white\\"target=\\"_blank\\">Kailhロープロ無刻印キーキャップ1U（10個） - 白</a></td>\\n<td align=\\"right\\">1</td>\\n<td align=\\"right\\">300</td>\\n<td align=\\"left\\">刻印が合わないところに使うキーキャップ</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\"><a href=\\"https://yushakobo.jp/shop/pg1350cap-blank/?attribute_pa_keycapcolor=black\\"target=\\"_blank\\">Kailhロープロ無刻印キーキャップ1U（10個） - 黒</a></td>\\n<td align=\\"right\\">1</td>\\n<td align=\\"right\\">300</td>\\n<td align=\\"left\\">刻印が合わないところに使うキーキャップ</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\"><a href=\\"https://yushakobo.jp/shop/trrs_cable/\\"target=\\"_blank\\">TRRSケーブル 1m</a></td>\\n<td align=\\"right\\">1</td>\\n<td align=\\"right\\">300</td>\\n<td align=\\"left\\">左右をつなぐケーブル</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\"><a href=\\"https://yushakobo.jp/shop/promicro-spring-pinheader/?attribute_pa_firmware=none\\"target=\\"_blank\\">Pro Micro （コンスルー付き） - なし</a></td>\\n<td align=\\"right\\">1</td>\\n<td align=\\"right\\">1000</td>\\n<td align=\\"left\\">後述の通り、キットに入っているPro Microをダメにしてしまったので追加購入</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>この他に Pro Micro と PC をつなぐ USB(A to microB)ケーブルも必要。(<a href=\\"https://www.amazon.co.jp/gp/product/B071S5NTDR/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1\\"target=\\"_blank\\">家にあるもの</a>を使った)</p>\\n<p>Lily58 は、一般にTabやCtrlなどが位置するキーも1U(アルファベットのキーと同じ大きさ)である。\\n今回購入したキーキャップセットのキャップは合わないので、別途個別に無刻印のキーキャップをバラで買った。\\n(見た目を気にしたければテンキー用の1Uキーなどが余るのでそれを使ってもよさそう。)</p>\\n<p>金額は合計して消費税を足して、2.5万円しないくらい。</p>\\n<h2 id=\\"組み立て\\">組み立て</h2>\\n<p>組み立てには、上記の購入部品の他にはんだ、はんだごて、ピンセット、プラスドライバーが必要になる。エポキシ接着剤(100均に売ってる)、ハンダ吸い取り線もあるといい。</p>\\n<h3 id=\\"usb端子の補強\\">USB端子の補強</h3>\\n<p>まずはじめに &lsquo;もげmicro&rsquo; を防ぐためにエポキシ接着剤で補強する。</p>\\n<p>USBを刺す基板である Pro Micro はコネクタが折れやすいらしく、抜き差しを繰り返すとコネクタが折れてPro Microが使えなくなることがよくあるらしい。\\n(自作キーボード界隈ではこのことを\'もげMicro\'と呼ぶそう)</p>\\n<p>この対策のために今回遊舎工房で買ったキットはコンスルーというピンが入っており、はんだ付けせずにPro Microを接続できて交換がしやすいようになっている。</p>\\n<p>また、端子部分を補強するためにエポキシ接着剤をコネクタ周囲に流して固定するのが定番のようだ。\\n私もインターネットの記事を参考にエポキシ接着剤を塗り、、、</p>\\n<p>やってしまった。\\nコネクタ内部に接着剤が流れ込み、USBが刺さらなくなってしまった。\\n仕方ないので追加でPro Microを一つ注文し、作業をすすめる。</p>\\n<h3 id=\\"lily58-pro-キットの組み立て\\">Lily58 Pro キットの組み立て</h3>\\n<p>以降の組み立ての過程はキーボード設計者のゆーちさんが書いた<a href=\\"https://github.com/kata0510/Lily58/blob/master/Pro/Doc/buildguide_jp.md\\"target=\\"_blank\\">ビルドガイド</a>に書かれている。\\nこれを<strong>よく読んで</strong>作れば問題ない。</p>\\n<p>私はキースイッチ受けとダイオードを逆の面につけてしまい一度ハンダを取り除いて再度つけるなどした。</p>\\n<p>あとはんだ付けに不安があれば、はんだ付け後にテスターで導通を確認するのがよい。\\n沢山数があって面倒だが、ここでミスっているのを跡で治すほうが大変なのでチェックしておくことをおすすめする。\\n私はキースイッチ受けの導通をチェックしておらず、完成後に2つ半田をつけ直した。</p>\\n<p>組み立て中の写真を取るのを忘れたが、数時間で組み上がったと思う。</p>\\n<h2 id=\\"ファームウェアの書き込み\\">ファームウェアの書き込み</h2>\\n<h3 id=\\"デフォルトのファームウェアを書き込む\\">デフォルトのファームウェアを書き込む</h3>\\n<p>次の手順でファームウェアを書き込む。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># Ubuntu 20.04 LTS</span>\\n<span class=\\"c1\\"># apt で事前にいくつかのパッケージの導入が必要かも</span>\\n$ git clone git@github.com:qmk/qmk_firmware.git\\n$ <span class=\\"nb\\">cd</span> qmk_firmware\\n$ make git-submodule\\n$ sudo make lily58:default:avrdude\\n<span class=\\"c1\\"># 次のような表示が出てきたら, キーボードのリセットボタンを押す</span>\\n<span class=\\"c1\\"># Detecting USB port, reset your controller now...</span>\\n<span class=\\"c1\\"># 同様の手順で左右のマイコンに同じファームウェアを書き込む</span>\\n<span class=\\"c1\\"># 左手のUSBコネクタにケーブルを, 左右のTPRS端子に4極ケーブルを刺す</span>\\n</code></pre></div><h3 id=\\"ファームウェアのカスタマイズ\\">ファームウェアのカスタマイズ</h3>\\n<p>次の手順でファームウェアを書き込む。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># basd4g と名付けた自分用キーマップを作る</span>\\n$ cp -r keyboards/lily58/keymaps/default keyboards/lily58/keymaps/basd4g\\n$ vim keyboards/lily58/keymaps/basd4g/keymap.c\\n<span class=\\"c1\\"># キーマップを書き換える</span>\\n$ sudo make lily58:basd4g:avrdude\\n<span class=\\"c1\\"># 次のような表示が出てきたら, キーボードのリセットボタンを押す</span>\\n<span class=\\"c1\\"># Detecting USB port, reset your controller now...</span>\\n<span class=\\"c1\\"># 同様の手順で左右のマイコンに同じファームウェアを書き込む</span>\\n<span class=\\"c1\\"># 左手のUSBコネクタにケーブルを, 左右のTPRS端子に4極ケーブルを刺す</span>\\n</code></pre></div><p>私が現在設定している<a href=\\"https://github.com/basd4g/qmk_firmware/blob/master/keyboards/lily58/keymaps/basd4g/keymap.c\\"target=\\"_blank\\">キーマップは次の通り</a>。</p>\\n<p>記事の前半で60%のキーボードが良いと言っておきながら、ホームポジションから離れた上段1列は無効化している(2020/08/05現在)。\\nまだ慣れていないので使いやすいかどうかはまだ不明だが、慣れたら便利そうな気がしている。</p>\\n<h2 id=\\"まとめ\\">まとめ</h2>\\n<p>組み立てるのも結構楽しいし、キーボードが左右で割れているのは新鮮だし、作って良かった。\\nキーマップについてはまだまだ慣れていないし、使いながら改良していきたい。</p>","contentSnippet":"毎月一回、自作キーボードが作りたくなってカートに商品を入れるまでやる。あと一歩のところで踏みとどまる。\\n— けーすけ@やんまー (@basd4g) July 19, 2020\\n \\n数ヶ月前から、自作キーボードが気になっていたのだが、ついに手を出してしまった。\\n自作キーボードとは\\n自作キーボードとは、キースイッチやキーキャップ、基板(PCB)等を購入し、自分で組み立ててキーボードを作ることである。\\n自分の欲しいキーボードを作ることができるのが魅力。\\nパーツをはんだ付けしたり、マイコンにファームウェアを書き込んだり、場合によっては基板を設計したりすることでつくる。\\n今回は既に設計, 基板が製造済みで、組み立てキット形式になっている Lily58 Pro を作ることにした。\\nLily58 Pro を選んだ理由\\n作る機種は、Lily 58 Proとした。\\nLily58 が魅力だったのは次の点。\\nキーマップを自由に書き換えられること\\nこれは Lily58 に限らず自作キーボードの殆どに言えることだと思うが、キーボードの挙動を自由に書き換えることができる。\\n打ちづらい位置にあるキーは使用頻度の少ないキーと入れ替えたり、複数キーの同時押しで特殊な動作をさせたりすることが可能になる。\\n自作キーボードは極端に言うとマイコンとスイッチの集合体なので、挙動は本当に自由に決めれると言ってよい。\\n(実際には qmk といわれるファームウェアを使うことが一般的で、これの一部を書き換えることでカスタマイズを実現する。)\\nキーボード側で自由に設定できるのはとてもありがたい。\\nもともとキーリマッパと呼ばれるソフトウェアを使って挙動を書き換えていたのだが、これは環境構築が面倒だったりする。\\n(Mac では Karabiner Elements、Ubuntu では xkeysnail を使っていた。)\\n自作キーボードであれば USB を刺すだけで済む。\\nキーマップを自由に書き換えられるのって嬉しいのか？と思う人、あなたは CapsLock を使っているだろうか。\\n結構使用頻度の少ないキーだと思うのだが、そこそこ押しやすい位置にある。\\n例えばこれを Ctrl に変えればショートカットを押しやすいし、ESC にすれば Vim が使いやすくなるし、半角/かなキーにするのも便利かもしれない。\\nこんな感じで一つずつ置き換えるキーを増やしていき、設定が煩雑になって自作キーボードが欲しくなった。\\nキー数が60個程度 (いわゆる60%キーボード)\\n普段使わないキーはいらないので、コンパクトなものがほしい。\\nただし40%等のこれ以上キー数が少ないものは不安。\\n既に60%の中華キーボード (RK Royal RK61) を使っているので、良い落とし所なのではと思った。\\nちなみにこの RK61 は4月頃に自作キーボード (DZ60) を作ろうか迷った挙げ句「自作キーボード、まだ自分には早いかな」と思い、とりあえず60%の US 配列キーボードを買ったもの。\\n普通に使えていたが、結局自作キーボード欲を抑えることができなかった。\\nkailh ロープロファイルに対応している\\nLily58 Pro は kailh ロープロファイル (浅いキーストロークのスイッチの規格) に対応している。\\n私はノートパソコンのキーボードのような、キーストロークの浅いキーボードが割と好きで、キーストロークが深いと打ち間違いやすい気がしていた。\\n(RK61を使っていたときの感想。昔はメンブレンのキーボードとか普通に使っていたはずなのだが。)\\n作ったあとの感想になるが、このキースイッチの選択は正解で浅いキーボードは打ちやすいと感じる。\\n左右分割型であること\\n左右分割型だと肩が丸まらないので姿勢が良くなるらしい。\\n当初は分割でなく一体型のキーボードに注目していたが、調べるうちにどうせ作るなら金額も変わらないし左右分割型にしてみるかという気分になっていった。\\n左右分割型にしたことで夢が広がるのだがそれはまた別の記事に書くこととする。\\ncolumn-straggered であること\\ncolumn-straggerd とはキー配列の種類で、列ごとに縦方向にずれたもの。\\n一般的なキーボードは キーが一段ごとに横方向に半分程度ずれている。(row-straggered という。)\\nこのずれはタイプライターの機械構造に起因していて、特に打ちやすくするためではないらしい。\\nこの横方向にずれた配列が打ちづらいのはわりと感じる(右人差し指でYを打鍵するの遠すぎないか？？)ので、完全に格子状の Ortholiner ないしは column-straggerd なキーボードを求めた。\\nちなみにYを右人差し指でタイプするのは遠すぎるので、左人差し指でタイプする癖がついていたのだが、分割キーボードにしたことでこの癖は矯正することになった。\\n購入したもの\\n自作キーボードの部品を買える通販サイトの代表的なものに以下のサイトがある。\\n今回は全て遊舎工房で購入した。\\n遊舎工房\\nAliexpress\\nKBDFANS\\nゆかりキーボードファクトリー\\nTALP KEYBOARD\\n購入した商品は以下の通り。\\n商品\\n数量\\n値段\\n補足\\n\\n\\n\\n\\nLily58 Pro - Kailh Choc ロープロファイル用\\n1\\n14,800\\n大半のパーツが含まれるキット\\n\\n\\nKailhロープロファイルスイッチ（10個） - 赤\\n6\\n2,880\\nキーを押したことを判定するスイッチ\\n\\n\\nKailhロープロ刻印キーキャップ - 黒\\n1\\n3,000\\nキースイッチの上にかぶせるキャップ (刻印付きで100個くらい入っている)\\n\\n\\nKailhロープロ無刻印キーキャップ1.5U 2U（1個） - 白, 1.5u\\n2\\n400\\n親指部分の少し長いキーキャップ\\n\\n\\nKailhロープロ無刻印キーキャップ1U（10個） - 白\\n1\\n300\\n刻印が合わないところに使うキーキャップ\\n\\n\\nKailhロープロ無刻印キーキャップ1U（10個） - 黒\\n1\\n300\\n刻印が合わないところに使うキーキャップ\\n\\n\\nTRRSケーブル 1m\\n1\\n300\\n左右をつなぐケーブル\\n\\n\\nPro Micro （コンスルー付き） - なし\\n1\\n1000\\n後述の通り、キットに入っているPro Microをダメにしてしまったので追加購入\\n\\n\\n\\nこの他に Pro Micro と PC をつなぐ USB(A to microB)ケーブルも必要。(家にあるものを使った)\\nLily58 は、一般にTabやCtrlなどが位置するキーも1U(アルファベットのキーと同じ大きさ)である。\\n今回購入したキーキャップセットのキャップは合わないので、別途個別に無刻印のキーキャップをバラで買った。\\n(見た目を気にしたければテンキー用の1Uキーなどが余るのでそれを使ってもよさそう。)\\n金額は合計して消費税を足して、2.5万円しないくらい。\\n組み立て\\n組み立てには、上記の購入部品の他にはんだ、はんだごて、ピンセット、プラスドライバーが必要になる。エポキシ接着剤(100均に売ってる)、ハンダ吸い取り線もあるといい。\\nUSB端子の補強\\nまずはじめに ‘もげmicro’ を防ぐためにエポキシ接着剤で補強する。\\nUSBを刺す基板である Pro Micro はコネクタが折れやすいらしく、抜き差しを繰り返すとコネクタが折れてPro Microが使えなくなることがよくあるらしい。\\n(自作キーボード界隈ではこのことを\'もげMicro\'と呼ぶそう)\\nこの対策のために今回遊舎工房で買ったキットはコンスルーというピンが入っており、はんだ付けせずにPro Microを接続できて交換がしやすいようになっている。\\nまた、端子部分を補強するためにエポキシ接着剤をコネクタ周囲に流して固定するのが定番のようだ。\\n私もインターネットの記事を参考にエポキシ接着剤を塗り、、、\\nやってしまった。\\nコネクタ内部に接着剤が流れ込み、USBが刺さらなくなってしまった。\\n仕方ないので追加でPro Microを一つ注文し、作業をすすめる。\\nLily58 Pro キットの組み立て\\n以降の組み立ての過程はキーボード設計者のゆーちさんが書いたビルドガイドに書かれている。\\nこれをよく読んで作れば問題ない。\\n私はキースイッチ受けとダイオードを逆の面につけてしまい一度ハンダを取り除いて再度つけるなどした。\\nあとはんだ付けに不安があれば、はんだ付け後にテスターで導通を確認するのがよい。\\n沢山数があって面倒だが、ここでミスっているのを跡で治すほうが大変なのでチェックしておくことをおすすめする。\\n私はキースイッチ受けの導通をチェックしておらず、完成後に2つ半田をつけ直した。\\n組み立て中の写真を取るのを忘れたが、数時間で組み上がったと思う。\\nファームウェアの書き込み\\nデフォルトのファームウェアを書き込む\\n次の手順でファームウェアを書き込む。\\n# Ubuntu 20.04 LTS\\n# apt で事前にいくつかのパッケージの導入が必要かも\\n$ git clone git@github.com:qmk/qmk_firmware.git\\n$ cd qmk_firmware\\n$ make git-submodule\\n$ sudo make lily58:default:avrdude\\n# 次のような表示が出てきたら, キーボードのリセットボタンを押す\\n# Detecting USB port, reset your controller now...\\n# 同様の手順で左右のマイコンに同じファームウェアを書き込む\\n# 左手のUSBコネクタにケーブルを, 左右のTPRS端子に4極ケーブルを刺す\\n\\n\\nファームウェアのカスタマイズ\\n次の手順でファームウェアを書き込む。\\n# basd4g と名付けた自分用キーマップを作る\\n$ cp -r keyboards/lily58/keymaps/default keyboards/lily58/keymaps/basd4g\\n$ vim keyboards/lily58/keymaps/basd4g/keymap.c\\n# キーマップを書き換える\\n$ sudo make lily58:basd4g:avrdude\\n# 次のような表示が出てきたら, キーボードのリセットボタンを押す\\n# Detecting USB port, reset your controller now...\\n# 同様の手順で左右のマイコンに同じファームウェアを書き込む\\n# 左手のUSBコネクタにケーブルを, 左右のTPRS端子に4極ケーブルを刺す\\n\\n\\n私が現在設定しているキーマップは次の通り。\\n記事の前半で60%のキーボードが良いと言っておきながら、ホームポジションから離れた上段1列は無効化している(2020/08/05現在)。\\nまだ慣れていないので使いやすいかどうかはまだ不明だが、慣れたら便利そうな気がしている。\\nまとめ\\n組み立てるのも結構楽しいし、キーボードが左右で割れているのは新鮮だし、作って良かった。\\nキーマップについてはまだまだ慣れていないし、使いながら改良していきたい。","guid":"https://memo.basd4g.net/posts/lily58-pro-build-log/","isoDate":"2020-08-13T16:55:25.000Z"},{"title":"Ubuntu20.04でトラックボールのボールを転がしてスクロールする","link":"https://memo.basd4g.net/posts/ubuntu-m570-scroll/","pubDate":"Fri, 14 Aug 2020 01:20:09 +0900","content":"<p>最近、Logicool のトラックボール M570 を購入した。\\nこのトラックボールはスクロールホイールがついているが、左右にスクロールする機能はない。</p>\\n<p>そこで、ボールを転がして上下左右にスクロールを可能にする。</p>\\n<p>今回は Ubuntu 20.04 をターゲットに設定を行う。\\n(macOS では、Karabiner Elements と Scroll Reverser というソフト (どちらも brew cask にあり) を使い実現した。詳細は省略)</p>\\n<h2 id=\\"デバイス名を調べる\\">デバイス名を調べる</h2>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ xinput list\\n⎡ Virtual core pointer <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>2 <span class=\\"o\\">[</span>master pointer <span class=\\"o\\">(</span>3<span class=\\"o\\">)]</span>\\n⎜ ↳ Virtual core XTEST pointer <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>4 <span class=\\"o\\">[</span>slave pointer <span class=\\"o\\">(</span>2<span class=\\"o\\">)]</span>\\n⎜ ↳ Logitech M570 <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>9 <span class=\\"o\\">[</span>slave pointer <span class=\\"o\\">(</span>2<span class=\\"o\\">)]</span>\\n⎜ ↳ Lily58 Consumer Control <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>11 <span class=\\"o\\">[</span>slave pointer <span class=\\"o\\">(</span>2<span class=\\"o\\">)]</span>\\n⎜ ↳ Lily58 Mouse <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>13 <span class=\\"o\\">[</span>slave pointer <span class=\\"o\\">(</span>2<span class=\\"o\\">)]</span>\\n⎣ Virtual core keyboard <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>3 <span class=\\"o\\">[</span>master keyboard <span class=\\"o\\">(</span>2<span class=\\"o\\">)]</span>\\n↳ Virtual core XTEST keyboard <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>5 <span class=\\"o\\">[</span>slave keyboard <span class=\\"o\\">(</span>3<span class=\\"o\\">)]</span>\\n↳ Power Button <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>6 <span class=\\"o\\">[</span>slave keyboard <span class=\\"o\\">(</span>3<span class=\\"o\\">)]</span>\\n↳ Video Bus <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>7 <span class=\\"o\\">[</span>slave keyboard <span class=\\"o\\">(</span>3<span class=\\"o\\">)]</span>\\n↳ Power Button <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>8 <span class=\\"o\\">[</span>slave keyboard <span class=\\"o\\">(</span>3<span class=\\"o\\">)]</span>\\n↳ Lily58 Keyboard <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>10 <span class=\\"o\\">[</span>slave keyboard <span class=\\"o\\">(</span>3<span class=\\"o\\">)]</span>\\n↳ Lily58 Consumer Control <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>12 <span class=\\"o\\">[</span>slave keyboard <span class=\\"o\\">(</span>3<span class=\\"o\\">)]</span>\\n↳ Lily58 System Control <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>14 <span class=\\"o\\">[</span>slave keyboard <span class=\\"o\\">(</span>3<span class=\\"o\\">)]</span>\\n↳ WI-C300 <span class=\\"o\\">(</span>AVRCP<span class=\\"o\\">)</span> <span class=\\"nv\\">id</span><span class=\\"o\\">=</span>15 <span class=\\"o\\">[</span>slave keyboard <span class=\\"o\\">(</span>3<span class=\\"o\\">)]</span>\\n</code></pre></div><p>以上より、デバイス名は<code>Logitech M570</code>、デバイスIDは<code>9</code>。\\nのちの設定ファイルでデバイス名を利用する。</p>\\n<h2 id=\\"ボタン番号を調べる\\">ボタン番号を調べる</h2>\\n<p>以下のコマンドでIDが<code>9</code>のデバイスの状態をみることができる。</p>\\n<p>今回はマウスのスクロールホイールを押し込むボタンの番号を知るために、スクロールホイールを押し込みながら以下のコマンドを実行する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ xinput query-state <span class=\\"m\\">9</span>\\n</code></pre></div><p>実行結果より、 M570 のスクロールホイールを押し込むボタンの番号は<code>3</code>であることがわかった。</p>\\n<h2 id=\\"設定を記入する\\">設定を記入する</h2>\\n<p>root権限で <code>/usr/share/X11/xorg.conf.d/40-libinput.conf</code> に以下を追記する。</p>\\n<pre><code class=\\"language-/usr/share/X11/xorg.conf.d/40-libinput.conf\\" data-lang=\\"/usr/share/X11/xorg.conf.d/40-libinput.conf\\"># Logitech M570 Scrolling with pressed the right button and rolled the ball\\nSection &quot;InputClass&quot;\\nIdentifier &quot;Logitech M570&quot;\\nMatchProduct &quot;Logitech M570&quot;\\nDriver &quot;libinput&quot;\\nOption &quot;ScrollMethod&quot; &quot;button&quot;\\nOption &quot;ScrollMethod&quot; &quot;3&quot;\\nEndSection\\n</code></pre><p>再起動するとスクロールホイール押下時にボールによるスクロールが有効化される。</p>\\n<h2 id=\\"参考\\">参考</h2>\\n<ul>\\n<li><a href=\\"https://yu1.dev/posts/%E5%B8%B8%E7%94%A8ubuntu-18.04-lts%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97/\\"target=\\"_blank\\">常用Ubuntu 18.04 LTSのセットアップ - yu1.dev</a></li>\\n</ul>","contentSnippet":"最近、Logicool のトラックボール M570 を購入した。\\nこのトラックボールはスクロールホイールがついているが、左右にスクロールする機能はない。\\nそこで、ボールを転がして上下左右にスクロールを可能にする。\\n今回は Ubuntu 20.04 をターゲットに設定を行う。\\n(macOS では、Karabiner Elements と Scroll Reverser というソフト (どちらも brew cask にあり) を使い実現した。詳細は省略)\\nデバイス名を調べる\\n$ xinput list\\n⎡ Virtual core pointer id=2 [master pointer (3)]\\n⎜ ↳ Virtual core XTEST pointer id=4 [slave pointer (2)]\\n⎜ ↳ Logitech M570 id=9 [slave pointer (2)]\\n⎜ ↳ Lily58 Consumer Control id=11 [slave pointer (2)]\\n⎜ ↳ Lily58 Mouse id=13 [slave pointer (2)]\\n⎣ Virtual core keyboard id=3 [master keyboard (2)]\\n↳ Virtual core XTEST keyboard id=5 [slave keyboard (3)]\\n↳ Power Button id=6 [slave keyboard (3)]\\n↳ Video Bus id=7 [slave keyboard (3)]\\n↳ Power Button id=8 [slave keyboard (3)]\\n↳ Lily58 Keyboard id=10 [slave keyboard (3)]\\n↳ Lily58 Consumer Control id=12 [slave keyboard (3)]\\n↳ Lily58 System Control id=14 [slave keyboard (3)]\\n↳ WI-C300 (AVRCP) id=15 [slave keyboard (3)]\\n\\n\\n以上より、デバイス名はLogitech M570、デバイスIDは9。\\nのちの設定ファイルでデバイス名を利用する。\\nボタン番号を調べる\\n以下のコマンドでIDが9のデバイスの状態をみることができる。\\n今回はマウスのスクロールホイールを押し込むボタンの番号を知るために、スクロールホイールを押し込みながら以下のコマンドを実行する。\\n$ xinput query-state 9\\n\\n\\n実行結果より、 M570 のスクロールホイールを押し込むボタンの番号は3であることがわかった。\\n設定を記入する\\nroot権限で /usr/share/X11/xorg.conf.d/40-libinput.conf に以下を追記する。\\n# Logitech M570 Scrolling with pressed the right button and rolled the ball\\nSection \\"InputClass\\"\\nIdentifier \\"Logitech M570\\"\\nMatchProduct \\"Logitech M570\\"\\nDriver \\"libinput\\"\\nOption \\"ScrollMethod\\" \\"button\\"\\nOption \\"ScrollMethod\\" \\"3\\"\\nEndSection\\n\\n再起動するとスクロールホイール押下時にボールによるスクロールが有効化される。\\n参考\\n常用Ubuntu 18.04 LTSのセットアップ - yu1.dev","guid":"https://memo.basd4g.net/posts/ubuntu-m570-scroll/","isoDate":"2020-08-13T16:20:09.000Z"},{"title":"自作コンパイラのfor文バグ","link":"https://memo.basd4g.net/posts/willani-for-stmt-bug/","pubDate":"Thu, 09 Jul 2020 02:09:03 +0900","content":"<p>C言語のコンパイラを自作に関する今日の日記。</p>\\n<p>これまでの記事</p>\\n<ul>\\n<li>「<a href=\\"https://memo.basd4g.net/posts/willani-start/\\">数日前からCコンパイラを書き始めた。</a>」</li>\\n<li>「<a href=\\"https://memo.basd4g.net/posts/willani-compliperbook-finished/\\">自作Cコンパイラの途中経過</a>」</li>\\n<li>「<a href=\\"https://memo.basd4g.net/posts/try-selfhost\\">自作コンパイラのセルフホストに挑戦中</a>」</li>\\n<li>「<a href=\\"posts/willani-struct-alignment\\">C言語の構造体メンバのアライメント (x86_64, Linux (System V ABI))</a>」</li>\\n</ul>\\n<hr>\\n<p>今日実装したのは次の2つ。</p>\\n<ul>\\n<li>構造体のアライメント</li>\\n<li>for文バグの修正</li>\\n</ul>\\n<p>ちなみに昨日はastをjsonで吐くコード(git反映前に間違えて切り取って飛ばしてしまい頑張って再実装したが、翌日セルフホスト向けにはバグっていることがわかりお蔵入り)、セルフホスト用のシェルスクリプトなどを実装していた。</p>\\n<h2 id=\\"構造体のアライメント\\">構造体のアライメント</h2>\\n<p><a href=\\"https://github.com/basd4g/willani\\"target=\\"_blank\\">willani</a> での今日行ったアライメントの実装は<a href=\\"https://github.com/basd4g/willani/commit/ae1d68f94211c6c510ea2247abcde7386ffd25c8\\"target=\\"_blank\\">このあたり</a>。実装内容は前回の記事(<a href=\\"posts/willani-struct-alignment\\">C言語の構造体メンバのアライメント (x86_64, Linux (System V ABI))</a>)で説明している。</p>\\n<p>セルフホストをしようとしているがうまくいかないファイルが結構ある。\\n構造体のアライメントを実装するきっかけは色々なファイルを第一世代コンパイラに流しているときに出てきた問題からである。</p>\\n<p>トークナイズ結果をファイルに出力する <code>src/tokenize_log.c</code> というファイルを willani でビルドしてリンクすると、コンパイラは動くがトークナイズ結果のうち構造体アクセスしている部分だけ出力がなかった。\\nここから構造体のアライメントが必要なことと実装していないことに気づいた。</p>\\n<p>本当は配列も 16byte 境界でアライメントしなければならなかった気がするが、こちらはまだ未実装。\\nUnion もアライメントしなきゃいけないが、こちらはそもそも Union を未実装。\\nグローバル変数もアライメントしなきゃいけないが、これもまだ実装していない。</p>\\n<h2 id=\\"for文バグの修正\\">for文バグの修正</h2>\\n<p>今日はこのアライメントと、いわゆるfor文バグ (と私が呼んでいるもの) の修正をやった。</p>\\n<p>ここ最近セルフホストに向けて、gccでコンパイルしたアセンブリに一部 willani でコンパイラしたアセンブリを混ぜてリンクして第1.5世代コンパイラを作っている。\\nその中で <code>src/type.c</code> というファイルを willani でビルドしてリンクしたときの話。</p>\\n<p>バグの詳細は記事最後に記す。\\n時系列に説明しているので長くなってしまった。</p>\\n<p>どうもセルフホストに近づいてコンパイラ自身のコードをビルドし始めるとどこで何がバグっているのかわからなくなってくる。</p>\\n<p>普通のプログラムでは、入力が誤っているか、入力を受け取るコードが誤っているかを考えればいいが、セルフホストを目指すコンパイラではさらに、入力を受けとるコードを生成するコードが誤っている可能性も考慮しなければならない。</p>\\n<p>例えばあとで記す「バグの詳細」に出てくる構造体は、入力文字列で表記されている構造体と、入力文字列を処理するプログラムのデータ構造としての構造体、そしてそのプログラムを生成するときのデータ構造としての構造体があって、いま考えている構造体はなんなんだ？という気持ちになる。</p>\\n<p>とにかくバグトラックが大変で、些細なことで1日が溶けた。</p>\\n<p>今回の<code>src/type.c</code>ではあまりなかったが、segmentation falut で終了することもよくあるし、デバッグが結構大変。</p>\\n<p>パース結果のログは、パースが完全に終わってからASTをたどって出力しているので、パース中に死ぬとどんな状況かつかめないことが多々ある。なのでパース中のデバッグを楽にするためのログ出力などは強化していきたい。</p>\\n<p>大変とは書いたが、ゆっくりだが着実にセルフホストに近づいているし、なにより自分の書いたコードで自分の書いたコードをコンパイルする状況はなんともいえないワクワク感があるので楽しい。</p>\\n<p>明日以降も楽しみながら進めていきたい。</p>\\n<hr>\\n<p>補足: タイトルについて</p>\\n<p>今日見つけたバグは、私がfor文バグと呼んでいて、実際for文の実装にバグがあったが、内容はささいな話で、結構実装依存な内容である。</p>\\n<p>なのでfor文の実装に他の人もハマりがちな落とし穴があるという意味はなく、タイトルはあくまで自分の記憶のためのもの。</p>\\n<hr>\\n<h2 id=\\"バグの詳細\\">バグの詳細</h2>\\n<p>どうもこの第1.5世代コンパイラは、構造体のメンバを読む処理がバグっていて、定義済みのメンバを呼び出すコードを解釈する際に、同名のメンバが定義されていないとしてエラーを出力していた。</p>\\n<p>構造体を含まないコードは問題なくコンパイルできるので、構造体のメンバを読むあたりが明らかに怪しい。\\nしかしどうやってバグっているのか全く検討がつかなかった。</p>\\n<p>まず疑ったのは、入力のコードの構造体を読み込むときに構造体のアライメントが狂っていて読み込みに失敗しているのではないかということ。\\n実は多分ここでもバグっていて、まずは冒頭のような構造体のアライメントを実装した。\\nこれにより、構造体の情報を willani 内部で保持する構造体 (Member 構造体) の各メンバに、コンパイラ内で正しくアクセスできるようになった。</p>\\n<p>しかしエラーは消えず、ほかにどこがバグっているのかよくわからない。\\n(自作コンパイラでは、エラーメッセージは往々にして自分が書いたものが出力されるので、なんともいえない気持ちになる。)</p>\\n<p>ひとまず関係のある Member 構造体の生成・格納・検索などのコードに片っ端に fprintf を挿入し、変数の値やポインタの指すメモリ番地などをダンプすることとした。</p>\\n<p>ダンプしたことでエラー発生の直前までうまく値がわたっていることはわかった。\\n何故か (for 文をつかった) メンバ名の検索だけがうまくいっていない。</p>\\n<p>色々試したうえで、たまたま for 文を while 文に書き換えると嘘のように正しく動作して解決した。</p>\\n<p>あとで調べると、for 文の初期化処理がうまくいってなかったようだ。\\nfor 文を表す node は、初期化文を表す node を init メンバとして持っている。\\ninit メンバはふつう1文を表す1つの node で、next メンバに値が入ることはないとして実装されていた。</p>\\n<p>しかし、init メンバが変数の宣言と初期化を行う文の node で、かつ初期化子が実行時に定まるとき(例えば <code>int a=p;</code>)バグる。\\n<code>int a=1;</code> のような文は、willani では1つの Node 構造体 (<code>Node.kind = ND_STMT_VAR_INIT</code>) で表される。\\nこの構造体には初期化の値も含まれており、初期化の値が即値(コンパイル時に定まる値(数字か文字列))なら1つの構造体で完結する。\\n一方初期化の値は実行時に定まる場合もある。\\nこのときは Node 構造体の next メンバで別の Node 構造体を数珠つなぎに持ち、これらが初期化用の式文をそれぞれあらわすようになっている。</p>\\n<p><code>src/codegen.c</code> の実装バグで、for 文の init メンバの next メンバが指すノードを出力していなかったことで、構造体のメンバを表す変数のアドレスを初期価値として渡すコードがコンパイル時に含まれていなかったらしい。</p>\\n<p>わかってしまえば数行で解決できるバグだった。\\n(<a href=\\"https://github.com/basd4g/willani/commit/7af9e76cadd338e85e41974e257e498819a59756\\"target=\\"_blank\\">コミット</a>)</p>","contentSnippet":"C言語のコンパイラを自作に関する今日の日記。\\nこれまでの記事\\n「数日前からCコンパイラを書き始めた。」\\n「自作Cコンパイラの途中経過」\\n「自作コンパイラのセルフホストに挑戦中」\\n「C言語の構造体メンバのアライメント (x86_64, Linux (System V ABI))」\\n今日実装したのは次の2つ。\\n構造体のアライメント\\nfor文バグの修正\\nちなみに昨日はastをjsonで吐くコード(git反映前に間違えて切り取って飛ばしてしまい頑張って再実装したが、翌日セルフホスト向けにはバグっていることがわかりお蔵入り)、セルフホスト用のシェルスクリプトなどを実装していた。\\n構造体のアライメント\\nwillani での今日行ったアライメントの実装はこのあたり。実装内容は前回の記事(C言語の構造体メンバのアライメント (x86_64, Linux (System V ABI)))で説明している。\\nセルフホストをしようとしているがうまくいかないファイルが結構ある。\\n構造体のアライメントを実装するきっかけは色々なファイルを第一世代コンパイラに流しているときに出てきた問題からである。\\nトークナイズ結果をファイルに出力する src/tokenize_log.c というファイルを willani でビルドしてリンクすると、コンパイラは動くがトークナイズ結果のうち構造体アクセスしている部分だけ出力がなかった。\\nここから構造体のアライメントが必要なことと実装していないことに気づいた。\\n本当は配列も 16byte 境界でアライメントしなければならなかった気がするが、こちらはまだ未実装。\\nUnion もアライメントしなきゃいけないが、こちらはそもそも Union を未実装。\\nグローバル変数もアライメントしなきゃいけないが、これもまだ実装していない。\\nfor文バグの修正\\n今日はこのアライメントと、いわゆるfor文バグ (と私が呼んでいるもの) の修正をやった。\\nここ最近セルフホストに向けて、gccでコンパイルしたアセンブリに一部 willani でコンパイラしたアセンブリを混ぜてリンクして第1.5世代コンパイラを作っている。\\nその中で src/type.c というファイルを willani でビルドしてリンクしたときの話。\\nバグの詳細は記事最後に記す。\\n時系列に説明しているので長くなってしまった。\\nどうもセルフホストに近づいてコンパイラ自身のコードをビルドし始めるとどこで何がバグっているのかわからなくなってくる。\\n普通のプログラムでは、入力が誤っているか、入力を受け取るコードが誤っているかを考えればいいが、セルフホストを目指すコンパイラではさらに、入力を受けとるコードを生成するコードが誤っている可能性も考慮しなければならない。\\n例えばあとで記す「バグの詳細」に出てくる構造体は、入力文字列で表記されている構造体と、入力文字列を処理するプログラムのデータ構造としての構造体、そしてそのプログラムを生成するときのデータ構造としての構造体があって、いま考えている構造体はなんなんだ？という気持ちになる。\\nとにかくバグトラックが大変で、些細なことで1日が溶けた。\\n今回のsrc/type.cではあまりなかったが、segmentation falut で終了することもよくあるし、デバッグが結構大変。\\nパース結果のログは、パースが完全に終わってからASTをたどって出力しているので、パース中に死ぬとどんな状況かつかめないことが多々ある。なのでパース中のデバッグを楽にするためのログ出力などは強化していきたい。\\n大変とは書いたが、ゆっくりだが着実にセルフホストに近づいているし、なにより自分の書いたコードで自分の書いたコードをコンパイルする状況はなんともいえないワクワク感があるので楽しい。\\n明日以降も楽しみながら進めていきたい。\\n補足: タイトルについて\\n今日見つけたバグは、私がfor文バグと呼んでいて、実際for文の実装にバグがあったが、内容はささいな話で、結構実装依存な内容である。\\nなのでfor文の実装に他の人もハマりがちな落とし穴があるという意味はなく、タイトルはあくまで自分の記憶のためのもの。\\nバグの詳細\\nどうもこの第1.5世代コンパイラは、構造体のメンバを読む処理がバグっていて、定義済みのメンバを呼び出すコードを解釈する際に、同名のメンバが定義されていないとしてエラーを出力していた。\\n構造体を含まないコードは問題なくコンパイルできるので、構造体のメンバを読むあたりが明らかに怪しい。\\nしかしどうやってバグっているのか全く検討がつかなかった。\\nまず疑ったのは、入力のコードの構造体を読み込むときに構造体のアライメントが狂っていて読み込みに失敗しているのではないかということ。\\n実は多分ここでもバグっていて、まずは冒頭のような構造体のアライメントを実装した。\\nこれにより、構造体の情報を willani 内部で保持する構造体 (Member 構造体) の各メンバに、コンパイラ内で正しくアクセスできるようになった。\\nしかしエラーは消えず、ほかにどこがバグっているのかよくわからない。\\n(自作コンパイラでは、エラーメッセージは往々にして自分が書いたものが出力されるので、なんともいえない気持ちになる。)\\nひとまず関係のある Member 構造体の生成・格納・検索などのコードに片っ端に fprintf を挿入し、変数の値やポインタの指すメモリ番地などをダンプすることとした。\\nダンプしたことでエラー発生の直前までうまく値がわたっていることはわかった。\\n何故か (for 文をつかった) メンバ名の検索だけがうまくいっていない。\\n色々試したうえで、たまたま for 文を while 文に書き換えると嘘のように正しく動作して解決した。\\nあとで調べると、for 文の初期化処理がうまくいってなかったようだ。\\nfor 文を表す node は、初期化文を表す node を init メンバとして持っている。\\ninit メンバはふつう1文を表す1つの node で、next メンバに値が入ることはないとして実装されていた。\\nしかし、init メンバが変数の宣言と初期化を行う文の node で、かつ初期化子が実行時に定まるとき(例えば int a=p;)バグる。\\nint a=1; のような文は、willani では1つの Node 構造体 (Node.kind = ND_STMT_VAR_INIT) で表される。\\nこの構造体には初期化の値も含まれており、初期化の値が即値(コンパイル時に定まる値(数字か文字列))なら1つの構造体で完結する。\\n一方初期化の値は実行時に定まる場合もある。\\nこのときは Node 構造体の next メンバで別の Node 構造体を数珠つなぎに持ち、これらが初期化用の式文をそれぞれあらわすようになっている。\\nsrc/codegen.c の実装バグで、for 文の init メンバの next メンバが指すノードを出力していなかったことで、構造体のメンバを表す変数のアドレスを初期価値として渡すコードがコンパイル時に含まれていなかったらしい。\\nわかってしまえば数行で解決できるバグだった。\\n(コミット)","guid":"https://memo.basd4g.net/posts/willani-for-stmt-bug/","isoDate":"2020-07-08T17:09:03.000Z"},{"title":"C言語の構造体メンバのアライメント (x86_64, Linux (System V ABI))","link":"https://memo.basd4g.net/posts/willani-struct-alignment/","pubDate":"Thu, 09 Jul 2020 00:59:59 +0900","content":"<p>System V ABI における構造体メンバのアライメントの方法を記す。</p>\\n<p>C言語のコンパイラを自作しているときに学んだことの記録で、\\nこれまでの記事\\n「<a href=\\"https://memo.basd4g.net/posts/willani-start/\\">数日前からCコンパイラを書き始めた。</a>」\\n「<a href=\\"https://memo.basd4g.net/posts/willani-compliperbook-finished/\\">自作Cコンパイラの途中経過</a>」\\n「<a href=\\"https://memo.basd4g.net/posts/try-selfhost\\">自作コンパイラのセルフホストに挑戦中</a>」\\nに続く記事である。</p>\\n<h2 id=\\"system-v-abi-とは\\">System V ABI とは？</h2>\\n<p>ABI (Application Binary Interface) とは、バイナリレベルでのコンパイラが満たすべき規約である。\\nアーキテクチャやOSごとに決まっており、例えば我々が一般的に使うintelのCPUである x86_64 でいえば、 Windows は Microsoft ABI, Linux と macOS は <a href=\\"https://www.uclibc.org/docs/psABI-x86_64.pdf\\"target=\\"_blank\\">System V ABI</a>という規約で定められている。</p>\\n<p>具体的には次のようなものが決められている。</p>\\n<ul>\\n<li>int long 等の型のサイズ</li>\\n<li>構造体のメモリ上での配置</li>\\n<li>関数呼び出し時のスタック, レジスタの扱い</li>\\n</ul>\\n<p>ABIはなんのためにあるのか？\\nそれは異なるコンパイラ間でビルドしたバイナリをリンクできるようにするためである。</p>\\n<p>現在、一般に libc などのライブラリはバイナリに含まれず、事前に別にビルドされたものを実行時にダイナミックリンクして呼び出している。\\nこのような状況下では、異なるコンパイラでビルドされたバイナリ同士が相互に関数を呼び出すことが考えられる。</p>\\n<p>(大きなライブラリは個別のアプリケーション開発時にビルドするのは手間だし、libcなどは様々なバイナリで使われるので、バイナリに含ませないことで共通化して容量を削減させたい。)</p>\\n<p>int や long といったデータ型は C言語の仕様ではサイズが定められていない。long のサイズが int 以上である、といったことは決まっているが、別に 4byteでなくてもよい。 (16bit CPU では 2byte だったりする。)\\nデータ型はアーキテクチャに依存することが多い？と思われる。</p>\\n<p>他にも関数呼び出し時に引数や戻り値をどのように渡せばよいかを考えると ABI の必要性がみえてくる。\\n引数はレジスタに入れることも考えられるし、スタックに積むことも考えられる。C言語の仕様では引数や戻り値という概念は存在するが、具体的にどう実装するかは定められていない。そこであるコンパイラではレジスタ渡しをするかもしれないし、あるコンパイラではスタック渡しをするかもしれない。どちらも使うコンパイラもあるかも知れないし、コンパイラの作りようはいくらでもある。</p>\\n<p>しかしコンパイラが自由に作ってしまうと、他のバイナリから呼ぶときに困る。他のコンパイラでビルドしたバイナリは引数をレジスタに詰めて渡したつもりになっていたが、受け取る側はスタックを読みだすかもしれない。</p>\\n<p>このようなアーキテクチャやOSによって共通なC言語をバイナリレベルでコンパイラがどう実装するか決めておいたほうがよいことがABIで定められている。</p>\\n<h2 id=\\"アライメントとは\\">アライメントとは？</h2>\\n<p>スタックに領域を確保するとき、空いている部分にピッタリ詰めるのではなく、ある程度キリの良いメモリ配置になるように、使っていない無駄な領域(パディング)を用意してメモリ番地を揃えることをアライメントという。</p>\\n<p>C言語のアライメントはABIによって定められている。</p>\\n<p>アライメントは構造体に求められる。\\nローカル変数同士はどう配置されていようと関係なく、それを読み出すのは自身のバイナリであるから問題ない。</p>\\n<p>System V ABIでは、各データ型のサイズとアライメントすべき単位のサイズがそれぞれ同じバイト数になっている。\\n(<a href=\\"https://www.uclibc.org/docs/psABI-x86_64.pdf\\"target=\\"_blank\\">仕様書</a> 12ページ Figure 3.1 Scalar Types)</p>\\n<h2 id=\\"本題-system-v-abi-における構造体メンバのアライメント\\">本題: System V ABI における構造体メンバのアライメント</h2>\\n<h3 id=\\"仕様書の記述\\">仕様書の記述</h3>\\n<p>仕様書には構造体メンバのアライメントについて次のような記述がある。\\n(<a href=\\"https://www.uclibc.org/docs/psABI-x86_64.pdf\\"target=\\"_blank\\">仕様書</a> 13ページ 中段 Aggregates and Unions)</p>\\n<blockquote>\\n<p>Structures and unions assume the alignment of their most strictly aligned component. Each member is assigned to the lowest available offset with the appropriate alignment. The size of any object is always a multiple of the object‘s alignment.</p>\\n</blockquote>\\n<p>any object と the object が何を指しているのか最初イマイチわかっていなかったが、他の日本語の解説なども読んだ結果、次を意味するらしい。</p>\\n<ul>\\n<li>構造体の各メンバは, それぞれの要素ごとに厳密にアライメントされる。( =&gt; 利用可能なオフセットの中で最も低いもの(パディングが小さいもの)に配置される。)</li>\\n<li>構造体末尾のパディングは, 構造体の要素のアライメント単位の中で最大の値でアライメントされるように付加する。</li>\\n</ul>\\n<h3 id=\\"例\\">例</h3>\\n<p>次のような構造体を考える</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-C\\" data-lang=\\"C\\"><span class=\\"k\\">struct</span> <span class=\\"n\\">hoge</span> <span class=\\"p\\">{</span>\\n<span class=\\"kt\\">char</span> <span class=\\"n\\">a</span><span class=\\"p\\">;</span>\\n<span class=\\"kt\\">char</span> <span class=\\"n\\">b</span><span class=\\"p\\">;</span>\\n<span class=\\"kt\\">int</span> <span class=\\"n\\">c</span><span class=\\"p\\">;</span>\\n<span class=\\"kt\\">short</span> <span class=\\"n\\">d</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">};</span>\\n</code></pre></div><p>以上の構造体の実体は、次のようにアライメントされる</p>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\"left\\">メモリ番地</th>\\n<th align=\\"left\\">内容</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.00</td>\\n<td align=\\"left\\">char a</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.ff</td>\\n<td align=\\"left\\">char b</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.fe</td>\\n<td align=\\"left\\">padding</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.fd</td>\\n<td align=\\"left\\">padding</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.fc</td>\\n<td align=\\"left\\">int c</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.fb</td>\\n<td align=\\"left\\">int c</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.fa</td>\\n<td align=\\"left\\">int c</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.f9</td>\\n<td align=\\"left\\">int c</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.f8</td>\\n<td align=\\"left\\">short d</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.f7</td>\\n<td align=\\"left\\">short d</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.f6</td>\\n<td align=\\"left\\">padding</td>\\n</tr>\\n<tr>\\n<td align=\\"left\\">0x&hellip;.f5</td>\\n<td align=\\"left\\">padding</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>まず、定義されたメンバと同じ順で配置される。</p>\\n<ol>\\n<li><code>char a</code> は先頭なので何も考えずに配置する。</li>\\n<li><code>char b</code> を配置するために、必要ならパディングをしてメモリをアライメントする。\\n<code>char</code> のアライメントすべきメモリ境界の単位は 1byte (すなわちどこでも良い) なのでパディングの必要がない (既にアライメントされているともいえる)</li>\\n<li><code>char b</code> をアラインされた場所 (今回は <code>char a</code> のすぐ後ろ) に配置する。</li>\\n<li><code>int c</code> を配置するために、必要ならパディングをしたメモリをアライメントする。\\n<code>int</code> のアライメントすべきメモリ境界は4byteであるが、番地 <code>0x...fe</code> はこれを満たしていないので、2byte パディングしてメモリをアライメントする。</li>\\n<li><code>int c</code> をアラインされた場所 (今回は 2byte のパディングの後ろ) に配置する。</li>\\n<li><code>short d</code> を配置するために、必要ならパディングをしてメモリをアライメントする。\\n<code>short</code> のアライメントすべきメモリ境界の単位は 2byte で、今回はこれを満たしているのでパディングの必要がない (既にアライメントされているともいえる)</li>\\n<li><code>short d</code> をアラインされた場所 (今回は <code>int d</code> のすぐ後ろ) に配置する。</li>\\n<li><code>struct hoge</code> 自体の終わりにパディングをする。\\nアライメントすべきメモリ境界は、メンバのアライメントすべきメモリ境界 (<code>char</code>&hellip;1byte, <code>int</code>&hellip;4byte, <code>short</code>&hellip;2byte) のうち最も大きい値である <code>int</code>&hellip;4byte に合わせるようにパディングする\\nよって 2byte のパディングを追加</li>\\n</ol>\\n<p>以上。</p>\\n<p>ちなみに <code>sizeof(struct hoge)</code> の値は <code>12</code> となる。</p>\\n<ul>\\n<li>参考: <a href=\\"https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0%E3%82%A2%E3%83%A9%E3%82%A4%E3%83%A1%E3%83%B3%E3%83%88\\"target=\\"_blank\\">データ構造アライメント - Wikipedia</a> &hellip; 日本語のわかりやすい解説。</li>\\n</ul>\\n<h2 id=\\"何故アライメントするのか\\">何故アライメントするのか</h2>\\n<p>アクセスが速くなるとか？？。。。</p>\\n<hr>\\n<p>追記: (2020/10/04) 不要な改行タグを削除</p>","contentSnippet":"System V ABI における構造体メンバのアライメントの方法を記す。\\nC言語のコンパイラを自作しているときに学んだことの記録で、\\nこれまでの記事\\n「数日前からCコンパイラを書き始めた。」\\n「自作Cコンパイラの途中経過」\\n「自作コンパイラのセルフホストに挑戦中」\\nに続く記事である。\\nSystem V ABI とは？\\nABI (Application Binary Interface) とは、バイナリレベルでのコンパイラが満たすべき規約である。\\nアーキテクチャやOSごとに決まっており、例えば我々が一般的に使うintelのCPUである x86_64 でいえば、 Windows は Microsoft ABI, Linux と macOS は System V ABIという規約で定められている。\\n具体的には次のようなものが決められている。\\nint long 等の型のサイズ\\n構造体のメモリ上での配置\\n関数呼び出し時のスタック, レジスタの扱い\\nABIはなんのためにあるのか？\\nそれは異なるコンパイラ間でビルドしたバイナリをリンクできるようにするためである。\\n現在、一般に libc などのライブラリはバイナリに含まれず、事前に別にビルドされたものを実行時にダイナミックリンクして呼び出している。\\nこのような状況下では、異なるコンパイラでビルドされたバイナリ同士が相互に関数を呼び出すことが考えられる。\\n(大きなライブラリは個別のアプリケーション開発時にビルドするのは手間だし、libcなどは様々なバイナリで使われるので、バイナリに含ませないことで共通化して容量を削減させたい。)\\nint や long といったデータ型は C言語の仕様ではサイズが定められていない。long のサイズが int 以上である、といったことは決まっているが、別に 4byteでなくてもよい。 (16bit CPU では 2byte だったりする。)\\nデータ型はアーキテクチャに依存することが多い？と思われる。\\n他にも関数呼び出し時に引数や戻り値をどのように渡せばよいかを考えると ABI の必要性がみえてくる。\\n引数はレジスタに入れることも考えられるし、スタックに積むことも考えられる。C言語の仕様では引数や戻り値という概念は存在するが、具体的にどう実装するかは定められていない。そこであるコンパイラではレジスタ渡しをするかもしれないし、あるコンパイラではスタック渡しをするかもしれない。どちらも使うコンパイラもあるかも知れないし、コンパイラの作りようはいくらでもある。\\nしかしコンパイラが自由に作ってしまうと、他のバイナリから呼ぶときに困る。他のコンパイラでビルドしたバイナリは引数をレジスタに詰めて渡したつもりになっていたが、受け取る側はスタックを読みだすかもしれない。\\nこのようなアーキテクチャやOSによって共通なC言語をバイナリレベルでコンパイラがどう実装するか決めておいたほうがよいことがABIで定められている。\\nアライメントとは？\\nスタックに領域を確保するとき、空いている部分にピッタリ詰めるのではなく、ある程度キリの良いメモリ配置になるように、使っていない無駄な領域(パディング)を用意してメモリ番地を揃えることをアライメントという。\\nC言語のアライメントはABIによって定められている。\\nアライメントは構造体に求められる。\\nローカル変数同士はどう配置されていようと関係なく、それを読み出すのは自身のバイナリであるから問題ない。\\nSystem V ABIでは、各データ型のサイズとアライメントすべき単位のサイズがそれぞれ同じバイト数になっている。\\n(仕様書 12ページ Figure 3.1 Scalar Types)\\n本題: System V ABI における構造体メンバのアライメント\\n仕様書の記述\\n仕様書には構造体メンバのアライメントについて次のような記述がある。\\n(仕様書 13ページ 中段 Aggregates and Unions)\\nStructures and unions assume the alignment of their most strictly aligned component. Each member is assigned to the lowest available offset with the appropriate alignment. The size of any object is always a multiple of the object‘s alignment.\\nany object と the object が何を指しているのか最初イマイチわかっていなかったが、他の日本語の解説なども読んだ結果、次を意味するらしい。\\n構造体の各メンバは, それぞれの要素ごとに厳密にアライメントされる。( => 利用可能なオフセットの中で最も低いもの(パディングが小さいもの)に配置される。)\\n構造体末尾のパディングは, 構造体の要素のアライメント単位の中で最大の値でアライメントされるように付加する。\\n例\\n次のような構造体を考える\\nstruct hoge {\\nchar a;\\nchar b;\\nint c;\\nshort d;\\n};\\n\\n\\n以上の構造体の実体は、次のようにアライメントされる\\nメモリ番地\\n内容\\n\\n\\n\\n\\n0x….00\\nchar a\\n\\n\\n0x….ff\\nchar b\\n\\n\\n0x….fe\\npadding\\n\\n\\n0x….fd\\npadding\\n\\n\\n0x….fc\\nint c\\n\\n\\n0x….fb\\nint c\\n\\n\\n0x….fa\\nint c\\n\\n\\n0x….f9\\nint c\\n\\n\\n0x….f8\\nshort d\\n\\n\\n0x….f7\\nshort d\\n\\n\\n0x….f6\\npadding\\n\\n\\n0x….f5\\npadding\\n\\n\\n\\nまず、定義されたメンバと同じ順で配置される。\\nchar a は先頭なので何も考えずに配置する。\\nchar b を配置するために、必要ならパディングをしてメモリをアライメントする。\\nchar のアライメントすべきメモリ境界の単位は 1byte (すなわちどこでも良い) なのでパディングの必要がない (既にアライメントされているともいえる)\\nchar b をアラインされた場所 (今回は char a のすぐ後ろ) に配置する。\\nint c を配置するために、必要ならパディングをしたメモリをアライメントする。\\nint のアライメントすべきメモリ境界は4byteであるが、番地 0x...fe はこれを満たしていないので、2byte パディングしてメモリをアライメントする。\\nint c をアラインされた場所 (今回は 2byte のパディングの後ろ) に配置する。\\nshort d を配置するために、必要ならパディングをしてメモリをアライメントする。\\nshort のアライメントすべきメモリ境界の単位は 2byte で、今回はこれを満たしているのでパディングの必要がない (既にアライメントされているともいえる)\\nshort d をアラインされた場所 (今回は int d のすぐ後ろ) に配置する。\\nstruct hoge 自体の終わりにパディングをする。\\nアライメントすべきメモリ境界は、メンバのアライメントすべきメモリ境界 (char…1byte, int…4byte, short…2byte) のうち最も大きい値である int…4byte に合わせるようにパディングする\\nよって 2byte のパディングを追加\\n以上。\\nちなみに sizeof(struct hoge) の値は 12 となる。\\n参考: データ構造アライメント - Wikipedia … 日本語のわかりやすい解説。\\n何故アライメントするのか\\nアクセスが速くなるとか？？。。。\\n追記: (2020/10/04) 不要な改行タグを削除","guid":"https://memo.basd4g.net/posts/willani-struct-alignment/","isoDate":"2020-07-08T15:59:59.000Z"},{"title":"自作コンパイラのセルフホストに挑戦中","link":"https://memo.basd4g.net/posts/willani-try-selfhost/","pubDate":"Tue, 07 Jul 2020 01:54:10 +0900","content":"<p>以前の記事「<a href=\\"https://memo.basd4g.net/posts/willani-start/\\">数日前からCコンパイラを書き始めた。</a>」「<a href=\\"https://memo.basd4g.net/posts/willani-compliperbook-finished/\\">自作Cコンパイラの途中経過</a>」に続く記事。</p>\\n<p>これは日記であって、知見が書かれた文章ではない。</p>\\n<h2 id=\\"経過報告\\">経過報告</h2>\\n<p>気づけば2020年も半分が終わり、梅雨に入って雨が続き、今日もジメジメと蒸し暑い。\\n大学の研究室は相変わらずリモートで、新型コロナウィルスの東京都の感染者数も100人を超える日が続き、収束の気配がない。</p>\\n<p>世間は春から夏へ季節が変わろうとしているし、世界的にウィルスとの戦いを繰り広げている昨今だが、私のやっていることは相変わらずCコンパイラ「<a href=\\"https://github.com/basd4g/willani\\"target=\\"_blank\\">willani</a>」の制作。もう6週目になるだろうか。</p>\\n<p>昨日あたりからセルフホストに向けて、やっとコンパイラ本体のコードを第一世代コンパイラに流し始めた。\\nまだ本体のコード全ての機能は実装していないため、そのあたりは置き換えるシェルスクリプトを書いて、一旦スクリプトを挟んでからコンパイルする。\\n(#include, 可変長引数定義, 構造体の初期化などが未実装)</p>\\n<p>プリプロセスは#defineだけ実装した。プリプロセッサの大枠はできており、他のプリプロセス文も頑張れば実装できそう感はある。\\n他にも、ちょっと頑張れば追加できそうな機能がいくつかあるが、一旦機能追加よりもセルフホストに軸をおくことにした。</p>\\n<p>20以上のファイルに分割しているので、ファイル単位で置き換えていく。\\n一つのオブジェクトファイルをを第一世代コンパイラで出力したものに置き換える。\\n問題なければ次のファイルを第一世代コンパイラで出力したものに置き換える。\\n問題なければ、、、と繰り返し作業を進める。</p>\\n<h2 id=\\"よくわからなかったこと\\">よくわからなかったこと</h2>\\n<p>親コンパイラと第一世代コンパイラでコンパイルしたものを混ぜてgccに投げると、うまく静的リンクできない。\\nPIEがどうこう、.textセクションやdataセクションは動的リンクでは使えないぞ、などと怒られる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"nv\\">$gcc</span> -static -o willani *.c *.s <span class=\\"c1\\"># *.sはwillaniでコンパイルしたアセンブリ</span>\\n</code></pre></div><p>解決策として、コンパイルと、アセンブル&amp;リンクを分けて行った。\\n親コンパイラの出力も一旦、個々のアセンブリファイルとして出力する。 <code>$gcc hoge.c -S -o hoge.s</code>のように。</p>\\n<p>これらを第一世代コンパイラで出力したアセンブリと混ぜてリンクしてもらう。\\nリンクはlibcが必要である。\\ngccコマンド(<code>$gcc *.s -static -o willani</code>)で行った。\\n(<code>$ld</code>を使ってlibcを含んで静的リンクするのってどうやるの?未調査。)</p>\\n<p>アセンブルとリンクは分けなくても問題なかった。\\n(<code>$as hoge.s -o hoge.o</code>とアセンブルを別途行ってもいいが、gccにアセンブリを投げたらいい感じにリンクまで終わらせてくれる。)</p>\\n<h2 id=\\"第二世代コンパイラのデバッグがつらそう\\">第二世代コンパイラのデバッグがつらそう</h2>\\n<p>構造体のメモリ配置がABIに従ってなさそうで、今第1.5世代コンパイラ<a id=\\"ref1\\" href=\\"#refed1\\">^1</a>がバグっている。\\n第一世代コンパイラはテストに通るのに第二世代コンパイラ(1.5世代含む)はバグっている状況は、どこから手をつけていいかわからずに混乱した。\\n今後も前途多難だな。。</p>\\n<h2 id=\\"技術メモgccでデバッグ情報のないアセンブリを出力する\\">技術メモ:gccでデバッグ情報のないアセンブリを出力する</h2>\\n<p>今さっき知ったtips</p>\\n<p><code>$gcc sample.c -S -o sample-s</code>のようにコンパイルすると、デバッグ情報が含まれる。(<code>-g</code>オプションとは違い、最低限。)\\n例えば<code>.cfi_startproc</code>などの行が出力に含まれて、人間が読むときには邪魔。</p>\\n<p>そこで、<em><strong><code>-fno-asynchronous-unwind-tables</code></strong></em>オプションが有効。</p>\\n<p><code>$gcc sample.c -fno-asynchronous-unwind-tables -S -static -o sample.s</code>のようにオプションを追加すると無駄な行が出力されないので読みやすくなる。</p>\\n<p>Cの仕様を調べるとき、gccの出力と見比べたりするのが結構役に立つので、見やすいアセンブリを出せて助かる。(車輪の再発明だからできることだが。)</p>\\n<h2 id=\\"コンパイラをつくっていて良いこと\\">コンパイラをつくっていて良いこと</h2>\\n<p>車輪の再発明あるあるではあるが、ブラックボックスを一つ紐解けた。<a id=\\"ref2\\" href=\\"#refed2\\">^2</a></p>\\n<p>作る前はコンパイラはよくわからないがよしなにやってくれるもので、アセンブリはとっつきづらいもので、オブジェクトファイルってあるよな程度の理解だった。\\n概念としてコンパイル、アセンブル、リンクは知っていたが、実装レベルで知れるのは良い。\\nコンパイラは要するに文字列変換プログラムだし、アセンブリはただのテキストデータだし、(リンクはそこそこ大変そうで学ぶべきことがたくさんありそうだけど)、何やってるかは以前より想像がつくようになった。</p>\\n<h2 id=\\"これからやること\\">これからやること</h2>\\n<ul>\\n<li>構造体のメモリ配置を System V ABI に準拠させる</li>\\n<li>構造体の初期化文</li>\\n<li>セルフホスト</li>\\n<li>#include</li>\\n<li>#ifndef #ifdef #if #end</li>\\n</ul>\\n<br/>\\n<br/>\\n<hr>\\n<p>補足</p>\\n<ul>\\n<li>\\n<p><a id=\\"refed1\\" href=\\"#ref1\\">^1</a>第1.5世代コンパイラ\\n&hellip; 親コンパイラ(gcc)の出力と第一世代コンパイラの出力を混ぜてアセンブル、リンクして作ったコンパイラを指す。</p>\\n</li>\\n<li>\\n<p><a id=\\"refed2\\" href=\\"#ref2\\">^2</a>ブラックボックスを紐解く\\n&hellip; 過去にPDFファイルを自分で作ったり、正規表現エンジン(作りかけ)を作ったり、認証認可の仕組みを作ったときも同じ気持ちになった。今後、OS(途中で止まってる)やHTTPサーバ、インタプリタ(やJITコンパイラ)なんかも生きてるうちに取り組みたい。</p>\\n</li>\\n</ul>","contentSnippet":"以前の記事「数日前からCコンパイラを書き始めた。」「自作Cコンパイラの途中経過」に続く記事。\\nこれは日記であって、知見が書かれた文章ではない。\\n経過報告\\n気づけば2020年も半分が終わり、梅雨に入って雨が続き、今日もジメジメと蒸し暑い。\\n大学の研究室は相変わらずリモートで、新型コロナウィルスの東京都の感染者数も100人を超える日が続き、収束の気配がない。\\n世間は春から夏へ季節が変わろうとしているし、世界的にウィルスとの戦いを繰り広げている昨今だが、私のやっていることは相変わらずCコンパイラ「willani」の制作。もう6週目になるだろうか。\\n昨日あたりからセルフホストに向けて、やっとコンパイラ本体のコードを第一世代コンパイラに流し始めた。\\nまだ本体のコード全ての機能は実装していないため、そのあたりは置き換えるシェルスクリプトを書いて、一旦スクリプトを挟んでからコンパイルする。\\n(#include, 可変長引数定義, 構造体の初期化などが未実装)\\nプリプロセスは#defineだけ実装した。プリプロセッサの大枠はできており、他のプリプロセス文も頑張れば実装できそう感はある。\\n他にも、ちょっと頑張れば追加できそうな機能がいくつかあるが、一旦機能追加よりもセルフホストに軸をおくことにした。\\n20以上のファイルに分割しているので、ファイル単位で置き換えていく。\\n一つのオブジェクトファイルをを第一世代コンパイラで出力したものに置き換える。\\n問題なければ次のファイルを第一世代コンパイラで出力したものに置き換える。\\n問題なければ、、、と繰り返し作業を進める。\\nよくわからなかったこと\\n親コンパイラと第一世代コンパイラでコンパイルしたものを混ぜてgccに投げると、うまく静的リンクできない。\\nPIEがどうこう、.textセクションやdataセクションは動的リンクでは使えないぞ、などと怒られる。\\n$gcc -static -o willani *.c *.s # *.sはwillaniでコンパイルしたアセンブリ\\n\\n\\n解決策として、コンパイルと、アセンブル&リンクを分けて行った。\\n親コンパイラの出力も一旦、個々のアセンブリファイルとして出力する。 $gcc hoge.c -S -o hoge.sのように。\\nこれらを第一世代コンパイラで出力したアセンブリと混ぜてリンクしてもらう。\\nリンクはlibcが必要である。\\ngccコマンド($gcc *.s -static -o willani)で行った。\\n($ldを使ってlibcを含んで静的リンクするのってどうやるの?未調査。)\\nアセンブルとリンクは分けなくても問題なかった。\\n($as hoge.s -o hoge.oとアセンブルを別途行ってもいいが、gccにアセンブリを投げたらいい感じにリンクまで終わらせてくれる。)\\n第二世代コンパイラのデバッグがつらそう\\n構造体のメモリ配置がABIに従ってなさそうで、今第1.5世代コンパイラ^1がバグっている。\\n第一世代コンパイラはテストに通るのに第二世代コンパイラ(1.5世代含む)はバグっている状況は、どこから手をつけていいかわからずに混乱した。\\n今後も前途多難だな。。\\n技術メモ:gccでデバッグ情報のないアセンブリを出力する\\n今さっき知ったtips\\n$gcc sample.c -S -o sample-sのようにコンパイルすると、デバッグ情報が含まれる。(-gオプションとは違い、最低限。)\\n例えば.cfi_startprocなどの行が出力に含まれて、人間が読むときには邪魔。\\nそこで、-fno-asynchronous-unwind-tablesオプションが有効。\\n$gcc sample.c -fno-asynchronous-unwind-tables -S -static -o sample.sのようにオプションを追加すると無駄な行が出力されないので読みやすくなる。\\nCの仕様を調べるとき、gccの出力と見比べたりするのが結構役に立つので、見やすいアセンブリを出せて助かる。(車輪の再発明だからできることだが。)\\nコンパイラをつくっていて良いこと\\n車輪の再発明あるあるではあるが、ブラックボックスを一つ紐解けた。^2\\n作る前はコンパイラはよくわからないがよしなにやってくれるもので、アセンブリはとっつきづらいもので、オブジェクトファイルってあるよな程度の理解だった。\\n概念としてコンパイル、アセンブル、リンクは知っていたが、実装レベルで知れるのは良い。\\nコンパイラは要するに文字列変換プログラムだし、アセンブリはただのテキストデータだし、(リンクはそこそこ大変そうで学ぶべきことがたくさんありそうだけど)、何やってるかは以前より想像がつくようになった。\\nこれからやること\\n構造体のメモリ配置を System V ABI に準拠させる\\n構造体の初期化文\\nセルフホスト\\n#include\\n#ifndef #ifdef #if #end\\n補足\\n^1第1.5世代コンパイラ\\n… 親コンパイラ(gcc)の出力と第一世代コンパイラの出力を混ぜてアセンブル、リンクして作ったコンパイラを指す。\\n^2ブラックボックスを紐解く\\n… 過去にPDFファイルを自分で作ったり、正規表現エンジン(作りかけ)を作ったり、認証認可の仕組みを作ったときも同じ気持ちになった。今後、OS(途中で止まってる)やHTTPサーバ、インタプリタ(やJITコンパイラ)なんかも生きてるうちに取り組みたい。","guid":"https://memo.basd4g.net/posts/willani-try-selfhost/","isoDate":"2020-07-06T16:54:10.000Z"},{"title":"gimonfu で、はてなブログの記事を GitHub と同期する","link":"https://qiita.com/basd4g/items/1a38857f6bafb20f065d","pubDate":"2020-06-14T13:40:42.000Z","author":"basd4g","content":"<p>ブログ記事を Markdown で書きたい、さらにgitでバージョン管理したいと思うことはないだろうか？</p>\\n\\n<p>私は上記のようなモチベーションで、はてなブログの記事を管理する CLI <a href=\\"https://github.com/basd4g/gimonfu\\" rel=\\"nofollow noopener\\" target=\\"_blank\\">「gimonfu」</a>を作成した。</p>\\n\\n<p>gimonfuは、はてなブログの記事をMarkdownファイルとしてダウンロードしたり、Markdownファイルを記事として投稿したりできる。<br>\\n手元のディレクトリとはてなブログの記事群の差分を比較し、新しいものだけを投稿/更新/ダウンロードする。</p>\\n\\n<p>　　<br>\\n本記事では、gimonfu と GitHub Actions を使って、GitHub のリポジトリとはてなブログを連携し、記事を git で管理できるように設定を行う。</p>\\n\\n<p>つまり、Markdown ファイルを GitHub のリポジトリにプッシュするだけで、はてなブログに記事を公開できる。<br>\\nまた、はてなの Web ページで記事を編集すると GitHub のリポジトリに自動で反映されてバックアップを取ることができる。</p>\\n\\n<p>GitHub Actions の YAML だけをみて設定できる方は、本記事の文章を飛ばして、<a href=\\"https://github.com/basd4g/basd4g.hatenablog.com/tree/master/.github/workflows\\" rel=\\"nofollow noopener\\" target=\\"_blank\\">私の GitHub にある YAML</a> を確認いただきたい。</p>\\n\\n<h2>\\n<span id=\\"1-はてなブログの記事執筆設定を-markdown-モードにする\\" class=\\"fragment\\"></span><a href=\\"#1-%E3%81%AF%E3%81%A6%E3%81%AA%E3%83%96%E3%83%AD%E3%82%B0%E3%81%AE%E8%A8%98%E4%BA%8B%E5%9F%B7%E7%AD%86%E8%A8%AD%E5%AE%9A%E3%82%92-markdown-%E3%83%A2%E3%83%BC%E3%83%89%E3%81%AB%E3%81%99%E3%82%8B\\"><i class=\\"fa fa-link\\"></i></a>1. はてなブログの記事執筆設定を Markdown モードにする</h2>\\n\\n<p><a href=\\"https://blog.hatena.ne.jp/-/config\\" rel=\\"nofollow noopener\\" target=\\"_blank\\">はてなブログの設定ページ</a>から、設定 -&gt; 編集モード を 「Markdownモード」に設定し「変更する」ボタンを押す</p>\\n\\n<p>まずはてなブログの基本設定を開く。</p>\\n\\n<p><a href=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F67f1b64f-3c5e-a330-1ec2-3171832e478c.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6691ee24bd23697039d782c8b076090e\\" target=\\"_blank\\" rel=\\"nofollow noopener\\"><img src=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F67f1b64f-3c5e-a330-1ec2-3171832e478c.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6691ee24bd23697039d782c8b076090e\\" alt=\\"はてなブログの基本設定を開く\\" data-canonical-src=\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482778/67f1b64f-3c5e-a330-1ec2-3171832e478c.png\\" srcset=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F67f1b64f-3c5e-a330-1ec2-3171832e478c.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=696207c9a8b99a70ea071458798bd260 1x\\" loading=\\"lazy\\"></a></p>\\n\\n<p>下へスクロールし、編集モードを Markdown モードにする。</p>\\n\\n<p><a href=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F92b32212-7ce1-562b-dd63-7b4458f8c9c0.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=610baea93f203e3662d43b965fccf0a3\\" target=\\"_blank\\" rel=\\"nofollow noopener\\"><img src=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F92b32212-7ce1-562b-dd63-7b4458f8c9c0.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=610baea93f203e3662d43b965fccf0a3\\" alt=\\"編集モードを Markdown モードへ\\" data-canonical-src=\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482778/92b32212-7ce1-562b-dd63-7b4458f8c9c0.png\\" srcset=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F92b32212-7ce1-562b-dd63-7b4458f8c9c0.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b83ec4366053a8ea83fdaf410bfe1570 1x\\" loading=\\"lazy\\"></a></p>\\n\\n<p>「変更する」ボタンを押して変更を反映する。</p>\\n\\n<p><a href=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F97a30367-c89e-d843-ca82-0d9edb7dd42a.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dc750eecb733c71a26fc7e4af71b03ae\\" target=\\"_blank\\" rel=\\"nofollow noopener\\"><img src=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F97a30367-c89e-d843-ca82-0d9edb7dd42a.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dc750eecb733c71a26fc7e4af71b03ae\\" alt=\\"「変更する」ボタンを押して変更を反映する\\" data-canonical-src=\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482778/97a30367-c89e-d843-ca82-0d9edb7dd42a.png\\" srcset=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F97a30367-c89e-d843-ca82-0d9edb7dd42a.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c9e26bdac1fd2bc73006d68a7cf16e67 1x\\" loading=\\"lazy\\"></a></p>\\n\\n<p>(補足: 他モードでの動作確認はしていないので、もし Markdown 記法以外を利用する場合はご自身で試して欲しい。</p>\\n\\n<h2>\\n<span id=\\"2-はてなブログの-api-キーを確認する\\" class=\\"fragment\\"></span><a href=\\"#2-%E3%81%AF%E3%81%A6%E3%81%AA%E3%83%96%E3%83%AD%E3%82%B0%E3%81%AE-api-%E3%82%AD%E3%83%BC%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\\"><i class=\\"fa fa-link\\"></i></a>2. はてなブログの API キーを確認する</h2>\\n\\n<p><a href=\\"https://blog.hatena.ne.jp/-/config\\" rel=\\"nofollow noopener\\" target=\\"_blank\\">はてなブログの設定ページ</a>から、設定 -&gt; 詳細設定 に移動し、ユーザID, ブログID, API キー をメモする</p>\\n\\n<p>まずはてなブログの詳細設定を開く。</p>\\n\\n<p><a href=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F5571ac8f-8876-5d7b-3fc5-293be640440b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=35e3dc13a0a000ab9e13f15b9220b9d2\\" target=\\"_blank\\" rel=\\"nofollow noopener\\"><img src=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F5571ac8f-8876-5d7b-3fc5-293be640440b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=35e3dc13a0a000ab9e13f15b9220b9d2\\" alt=\\"詳細設定へ移動\\" data-canonical-src=\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482778/5571ac8f-8876-5d7b-3fc5-293be640440b.png\\" srcset=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F5571ac8f-8876-5d7b-3fc5-293be640440b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=949149fae1b9d2cb2e7a2c0e522feb4b 1x\\" loading=\\"lazy\\"></a></p>\\n\\n<p>下へスクロールし、AtomPubの項目から、ユーザID, ブログID, APIキーを確認する。</p>\\n\\n<p><a href=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F115c3037-2781-fd14-b521-62b81b89515b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b1f9a29261ff158bbf6c3ad3c4a4e5b2\\" target=\\"_blank\\" rel=\\"nofollow noopener\\"><img src=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F115c3037-2781-fd14-b521-62b81b89515b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b1f9a29261ff158bbf6c3ad3c4a4e5b2\\" alt=\\"APIキーをメモする\\" data-canonical-src=\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482778/115c3037-2781-fd14-b521-62b81b89515b.png\\" srcset=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F115c3037-2781-fd14-b521-62b81b89515b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=470fb59b9774f2ed25dc6693c47d0ad2 1x\\" loading=\\"lazy\\"></a></p>\\n\\n<h2>\\n<span id=\\"3-github-リポジトリを作りワークフローに使う-secrets-を登録する\\" class=\\"fragment\\"></span><a href=\\"#3-github-%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E3%82%8A%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AB%E4%BD%BF%E3%81%86-secrets-%E3%82%92%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B\\"><i class=\\"fa fa-link\\"></i></a>3. GitHub リポジトリを作り、ワークフローに使う Secrets を登録する</h2>\\n\\n<p>ワークフローとは、GitHub Actions で実行する一連の内容を記したものである。<br>\\n指定した時間になったときや、GitHub に コミットをプッシュしたとき、事前に作成したワークフローを自動で実行できる。</p>\\n\\n<p>この章では、GitHub で新しいリポジトリを作り、ワークフローで使う Secrets を登録する。</p>\\n\\n<p>まずは、新しいリポジトリを作った後、Settings -&gt; Secrets を開く</p>\\n\\n<p><a href=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2Fdf8dbb12-4541-cb85-914d-8a82cf00ac4c.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=362de0b2b9897edea1c512dda33d22f4\\" target=\\"_blank\\" rel=\\"nofollow noopener\\"><img src=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2Fdf8dbb12-4541-cb85-914d-8a82cf00ac4c.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=362de0b2b9897edea1c512dda33d22f4\\" alt=\\"Secrets 登録画面を開く\\" data-canonical-src=\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482778/df8dbb12-4541-cb85-914d-8a82cf00ac4c.png\\" srcset=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2Fdf8dbb12-4541-cb85-914d-8a82cf00ac4c.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d7ec872393b41c9a388761138cba8a50 1x\\" loading=\\"lazy\\"></a></p>\\n\\n<p>ワークフローで使う Name と Value の組み合わせを5組登録する</p>\\n\\n<p><a href=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2Fe4b03d09-e53a-72fd-63c9-f469b0a36c76.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=927118682e7bdc341013efc2cd99913f\\" target=\\"_blank\\" rel=\\"nofollow noopener\\"><img src=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2Fe4b03d09-e53a-72fd-63c9-f469b0a36c76.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=927118682e7bdc341013efc2cd99913f\\" alt=\\"Secrets の Name と Value を登録する\\" data-canonical-src=\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482778/e4b03d09-e53a-72fd-63c9-f469b0a36c76.png\\" srcset=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2Fe4b03d09-e53a-72fd-63c9-f469b0a36c76.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b3edab65958b3d4ee2039994be2aeb95 1x\\" loading=\\"lazy\\"></a></p>\\n\\n<p>登録する内容は次の通り。<br>\\n例を参考に自分の文字列に置き換えてほしい。</p>\\n\\n<table>\\n<thead>\\n<tr>\\n<th>Name</th>\\n<th>Value</th>\\n<th>Value (例)</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td><code>HATENA_USER</code></td>\\n<td>先程確認したはてなブログのユーザID</td>\\n<td>basd4g</td>\\n</tr>\\n<tr>\\n<td><code>HATENA_BLOG_ID</code></td>\\n<td>先程確認したはてなブログのブログID</td>\\n<td>basd4g.hatenablog.com</td>\\n</tr>\\n<tr>\\n<td><code>HATENA_API_KEY</code></td>\\n<td>先程確認したはてなブログのAPIキー</td>\\n<td>abcdef0123</td>\\n</tr>\\n<tr>\\n<td><code>GIT_NAME</code></td>\\n<td>(ワークフローで自動的に作られるコミットの)自分の名前</td>\\n<td>Taro Yamada</td>\\n</tr>\\n<tr>\\n<td><code>GIT_MAIL</code></td>\\n<td>(ワークフローで自動的に作られるコミットの)自分のメールアドレス</td>\\n<td><a href=\\"mailto:basd4g@example.com\\" class=\\"autolink\\">basd4g@example.com</a></td>\\n</tr>\\n</tbody>\\n</table>\\n\\n<h2>\\n<span id=\\"4-記事をダウンロードするワークフローを追加する\\" class=\\"fragment\\"></span><a href=\\"#4-%E8%A8%98%E4%BA%8B%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\\"><i class=\\"fa fa-link\\"></i></a>4. 記事をダウンロードするワークフローを追加する</h2>\\n\\n<p>記事をダウンロードする GitHub Actions ワークフローを追加する。</p>\\n\\n<p>ワークフローは GitHub リポジトリのWebページ上からも追加できる。</p>\\n\\n<p><a href=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F14e76828-2fd6-a7da-2d0c-33cb7a002346.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=67aefef6b72b5ce43c7575d78a86c815\\" target=\\"_blank\\" rel=\\"nofollow noopener\\"><img src=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F14e76828-2fd6-a7da-2d0c-33cb7a002346.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=67aefef6b72b5ce43c7575d78a86c815\\" alt=\\"新しいワークフローを追加する\\" data-canonical-src=\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482778/14e76828-2fd6-a7da-2d0c-33cb7a002346.png\\" srcset=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F14e76828-2fd6-a7da-2d0c-33cb7a002346.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0e9d6b5c89f56fc63af5903ba2f4b089 1x\\" loading=\\"lazy\\"></a></p>\\n\\n<p><a href=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F5428aefd-30ad-6970-9aaf-cbc11273f806.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0f7be7d6bb6c9b4cf09abdb617764879\\" target=\\"_blank\\" rel=\\"nofollow noopener\\"><img src=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F5428aefd-30ad-6970-9aaf-cbc11273f806.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0f7be7d6bb6c9b4cf09abdb617764879\\" alt=\\"記事をダウンロードするワークフローを追加する\\" data-canonical-src=\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482778/5428aefd-30ad-6970-9aaf-cbc11273f806.png\\" srcset=\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482778%2F5428aefd-30ad-6970-9aaf-cbc11273f806.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1b9b51bb8718d1547a498df412ffb909 1x\\" loading=\\"lazy\\"></a></p>\\n\\n<p><code>.github/workflows/pull.yaml</code> に次の内容を記述する</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"yaml\\">\\n<div class=\\"code-lang\\"><span class=\\"bold\\">pull.yaml</span></div>\\n<div class=\\"highlight\\"><pre><span class=\\"na\\">name</span><span class=\\"pi\\">:</span> <span class=\\"s\\">Pull</span>\\n\\n<span class=\\"na\\">on</span><span class=\\"pi\\">:</span>\\n  <span class=\\"na\\">push</span><span class=\\"pi\\">:</span>\\n    <span class=\\"na\\">branches</span><span class=\\"pi\\">:</span> <span class=\\"pi\\">[</span> <span class=\\"nv\\">main</span> <span class=\\"pi\\">]</span>\\n\\n<span class=\\"na\\">jobs</span><span class=\\"pi\\">:</span>\\n  <span class=\\"na\\">pull</span><span class=\\"pi\\">:</span>\\n    <span class=\\"na\\">runs-on</span><span class=\\"pi\\">:</span> <span class=\\"s\\">ubuntu-latest</span>\\n\\n    <span class=\\"na\\">steps</span><span class=\\"pi\\">:</span>\\n    <span class=\\"pi\\">-</span> <span class=\\"na\\">uses</span><span class=\\"pi\\">:</span> <span class=\\"s\\">actions/checkout@v2</span>\\n\\n    <span class=\\"pi\\">-</span> <span class=\\"na\\">name</span><span class=\\"pi\\">:</span> <span class=\\"s\\">Deploy and Commit</span>\\n      <span class=\\"na\\">env</span><span class=\\"pi\\">:</span>\\n        <span class=\\"na\\">HATENA_USER_ID</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.HATENA_USER }}</span>\\n        <span class=\\"na\\">HATENA_BLOG_ID</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.HATENA_BLOG_ID }}</span>\\n        <span class=\\"na\\">HATENA_API_KEY</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.HATENA_API_KEY }}</span>\\n        <span class=\\"na\\">GIT_NAME</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.GIT_NAME }}</span>\\n        <span class=\\"na\\">GIT_MAIL</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.GIT_MAIL }}</span>\\n        <span class=\\"na\\">REPO_OWNER</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ github.repository_owner }}</span>\\n      <span class=\\"na\\">run</span><span class=\\"pi\\">:</span> <span class=\\"pi\\">|</span>\\n        <span class=\\"s\\">cd ${GITHUB_WORKSPACE}</span>\\n\\n        <span class=\\"s\\"># コミットのためのgitの設定</span>\\n        <span class=\\"s\\">echo \'git initialize\'</span>\\n        <span class=\\"s\\">git config --global user.name \\"${GIT_NAME}\\"</span>\\n        <span class=\\"s\\">git config --global user.email \\"${GIT_MAIL}\\"</span>\\n        <span class=\\"s\\">git remote set-url origin \\"https://${REPO_OWNER}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\\"</span>\\n        <span class=\\"s\\">echo \'gimonfu initialize\'</span>\\n\\n        <span class=\\"s\\"># gimonfuの初期設定</span>\\n        <span class=\\"s\\">npm init -y &gt; /dev/null 2&gt;&amp;1</span>\\n        <span class=\\"s\\">npm install gimonfu</span>\\n        <span class=\\"s\\">echo \\"{\\\\\\"user_id\\\\\\":\\\\\\"${HATENA_USER_ID}\\\\\\",\\\\\\"blog_id\\\\\\":\\\\\\"${HATENA_BLOG_ID}\\\\\\",\\\\\\"api_key\\\\\\":\\\\\\"${HATENA_API_KEY}\\\\\\"}\\" &gt; .gimonfu.json</span>\\n\\n        <span class=\\"s\\"># 新しい/更新された記事をダウンロード</span>\\n        <span class=\\"s\\">echo \'gimonfu pull\'</span>\\n        <span class=\\"s\\">npx gimonfu --git-commit-date pull</span>\\n\\n        <span class=\\"s\\"># コミットを作成する</span>\\n        <span class=\\"s\\">git add entry</span>\\n        <span class=\\"s\\"># This script will not make a commit if there are no changes.</span>\\n        <span class=\\"s\\">if ! git diff --staged --exit-code --quiet; then \\\\</span>\\n          <span class=\\"s\\">git commit -m \\"Pull articles (automatic commit)\\" ;\\\\</span>\\n        <span class=\\"s\\">fi</span>\\n\\n        <span class=\\"s\\">git push origin HEAD:main</span>\\n</pre></div>\\n</div>\\n\\n<p>コミットが GitHub 上にプッシュされると、ワークフローが走ってリポジトリに記事が反映される。</p>\\n\\n<h2>\\n<span id=\\"5-記事をダウンロードするワークフローを定期実行させる\\" class=\\"fragment\\"></span><a href=\\"#5-%E8%A8%98%E4%BA%8B%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC%E3%82%92%E5%AE%9A%E6%9C%9F%E5%AE%9F%E8%A1%8C%E3%81%95%E3%81%9B%E3%82%8B\\"><i class=\\"fa fa-link\\"></i></a>5. 記事をダウンロードするワークフローを定期実行させる</h2>\\n\\n<p>先程は初回だったので「main ブランチにプッシュしたときにワークフローを実行する」(=&gt;はてなブログの内容を GitHub リポジトリに反映させる)設定にした。</p>\\n\\n<p>ここではワークフローの一部を書き換えて、1時間に一回ワークフローを実行させる。</p>\\n\\n<p><code>.github/workflows/pull.yaml</code> の内容を一部書き換える。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"diff\\"><div class=\\"highlight\\"><pre><span class=\\"gd\\">--- a/.github/workflows/pull.yaml\\n</span><span class=\\"gi\\">+++ b/.github/workflows/pull.yaml\\n</span><span class=\\"p\\">@@ -1,8 +1,8 @@</span>\\n name: Pull\\n\\n on:\\n<span class=\\"gd\\">-  push:\\n-    branches: [ main ]\\n</span><span class=\\"gi\\">+  schedule:\\n+    - cron: \'0 * * * *\'\\n</span>\\n jobs:\\n   pull:\\n</pre></div></div>\\n\\n<h2>\\n<span id=\\"6-記事をアップロードするワークフローを追加する\\" class=\\"fragment\\"></span><a href=\\"#6-%E8%A8%98%E4%BA%8B%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\\"><i class=\\"fa fa-link\\"></i></a>6. 記事をアップロードするワークフローを追加する</h2>\\n\\n<p><code>.github/workflows/push.yaml</code>に次の内容を記述してコミット、プッシュする。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"yaml\\">\\n<div class=\\"code-lang\\"><span class=\\"bold\\">github/workflows/push.yaml</span></div>\\n<div class=\\"highlight\\"><pre><span class=\\"na\\">name</span><span class=\\"pi\\">:</span> <span class=\\"s\\">Push</span>\\n\\n<span class=\\"na\\">on</span><span class=\\"pi\\">:</span>\\n  <span class=\\"na\\">push</span><span class=\\"pi\\">:</span>\\n    <span class=\\"na\\">branches</span><span class=\\"pi\\">:</span> <span class=\\"pi\\">[</span> <span class=\\"nv\\">main</span> <span class=\\"pi\\">]</span>\\n\\n<span class=\\"na\\">jobs</span><span class=\\"pi\\">:</span>\\n  <span class=\\"na\\">push</span><span class=\\"pi\\">:</span>\\n    <span class=\\"na\\">runs-on</span><span class=\\"pi\\">:</span> <span class=\\"s\\">ubuntu-latest</span>\\n\\n    <span class=\\"na\\">steps</span><span class=\\"pi\\">:</span>\\n    <span class=\\"pi\\">-</span> <span class=\\"na\\">uses</span><span class=\\"pi\\">:</span> <span class=\\"s\\">actions/checkout@v2</span>\\n\\n    <span class=\\"pi\\">-</span> <span class=\\"na\\">name</span><span class=\\"pi\\">:</span> <span class=\\"s\\">Deploy and Commit</span>\\n      <span class=\\"na\\">env</span><span class=\\"pi\\">:</span>\\n        <span class=\\"na\\">HATENA_USER_ID</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.HATENA_USER }}</span>\\n        <span class=\\"na\\">HATENA_BLOG_ID</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.HATENA_BLOG_ID }}</span>\\n        <span class=\\"na\\">HATENA_API_KEY</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.HATENA_API_KEY }}</span>\\n        <span class=\\"na\\">GIT_NAME</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.GIT_NAME }}</span>\\n        <span class=\\"na\\">GIT_MAIL</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ secrets.GIT_MAIL }}</span>\\n        <span class=\\"na\\">REPO_OWNER</span><span class=\\"pi\\">:</span> <span class=\\"s\\">${{ github.repository_owner }}</span>\\n      <span class=\\"na\\">run</span><span class=\\"pi\\">:</span> <span class=\\"pi\\">|</span>\\n        <span class=\\"s\\">cd ${GITHUB_WORKSPACE}</span>\\n\\n        <span class=\\"s\\"># コミットのためのgitの設定</span>\\n        <span class=\\"s\\">echo \'git initialize\'</span>\\n        <span class=\\"s\\">git config --global user.name \\"${GIT_NAME}\\"</span>\\n        <span class=\\"s\\">git config --global user.email \\"${GIT_MAIL}\\"</span>\\n        <span class=\\"s\\">git remote set-url origin \\"https://${REPO_OWNER}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\\"</span>\\n\\n        <span class=\\"s\\"># gimonfuの初期設定</span>\\n        <span class=\\"s\\">echo \'gimonfu initialize\'</span>\\n        <span class=\\"s\\">npm init -y &gt; /dev/null 2&gt;&amp;1</span>\\n        <span class=\\"s\\">npm install gimonfu</span>\\n        <span class=\\"s\\">echo \\"{\\\\\\"user_id\\\\\\":\\\\\\"${HATENA_USER_ID}\\\\\\",\\\\\\"blog_id\\\\\\":\\\\\\"${HATENA_BLOG_ID}\\\\\\",\\\\\\"api_key\\\\\\":\\\\\\"${HATENA_API_KEY}\\\\\\"}\\" &gt; .gimonfu.json</span>\\n\\n        <span class=\\"s\\"># 新しい/更新された記事をアップロード</span>\\n        <span class=\\"s\\">echo \'gimonfu push\'</span>\\n        <span class=\\"s\\">npx gimonfu --git-commit-date push</span>\\n        <span class=\\"s\\">git add entry</span>\\n\\n        <span class=\\"s\\"># コミットを作成する</span>\\n        <span class=\\"s\\"># This script will not make a commit if there are no changes.</span>\\n        <span class=\\"s\\">if ! git diff --staged --exit-code --quiet; then \\\\</span>\\n          <span class=\\"s\\">git commit -m \\"Pull articles (automatic commit)\\" ;\\\\</span>\\n        <span class=\\"s\\">fi</span>\\n\\n        <span class=\\"s\\">git push origin HEAD:main</span>\\n</pre></div>\\n</div>\\n\\n<h2>\\n<span id=\\"6-記事の投稿と更新\\" class=\\"fragment\\"></span><a href=\\"#6-%E8%A8%98%E4%BA%8B%E3%81%AE%E6%8A%95%E7%A8%BF%E3%81%A8%E6%9B%B4%E6%96%B0\\"><i class=\\"fa fa-link\\"></i></a>6. 記事の投稿と更新</h2>\\n\\n<p>以上の設定を行うと、GitHub のリポジトリとはてなブログの記事が同期できる。</p>\\n\\n<p>GitHub 上の Markdown ファイルを上書きすると記事が更新されるし、新しい Markdown ファイルを追加すると記事が投稿される。</p>\\n\\n<p>新規記事を投稿するときは、entry ディレクトリ以下に 次の記述で始まる Markdownファイル (拡張子<code>.md</code>) を追加する。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"md\\"><div class=\\"highlight\\"><pre><span class=\\"nn\\">---</span>\\n<span class=\\"na\\">title</span><span class=\\"pi\\">:</span> <span class=\\"s\\">タイトル</span>\\n<span class=\\"na\\">date</span><span class=\\"pi\\">:</span> <span class=\\"s\\">2019-09-18T12:50:00.000Z</span>\\n<span class=\\"na\\">id</span><span class=\\"pi\\">:</span> <span class=\\"s2\\">\\"</span><span class=\\"s\\">26006613576772424\\"</span>\\n<span class=\\"nn\\">---</span>\\n\\n記事本文が以降続く。\\n</pre></div></div>\\n\\n<p>記事の冒頭に <code>---</code> で挟んだYAML形式のメタ情報を付加する。<br>\\n<code>id:</code>の行は新規投稿時には記述しない。投稿されると自動で付加される。<br>\\n(時刻の行が無ければ現在時刻が、タイトル行が無ければ No Title が、それぞれ自動で付加される)</p>\\n\\n<h2>\\n<span id=\\"おわりに\\" class=\\"fragment\\"></span><a href=\\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\\"><i class=\\"fa fa-link\\"></i></a>おわりに</h2>\\n\\n<p>ブログ記事を Git で管理したいというモチベーションから CLI を作るまでに至った。</p>\\n\\n<p>GitHub Actions のワークフローを登録しておけば、ローカルに gimonfu をインストールせずに使えるが、インストールして使うこともできる。<br>\\n<code>$ npm install -g gimonfu</code>でインストールでき、使い方は <a href=\\"https://github.com/basd4g/gimonfu\\" rel=\\"nofollow noopener\\" target=\\"_blank\\">README</a> で説明している。</p>\\n\\n<hr>\\n\\n<p>ここまで読んでいただいてありがとうございました。<br>\\nあなたのはてなブログ生活が捗ることを願っています。(という記事をQiitaに投稿)</p>\\n","contentSnippet":"ブログ記事を Markdown で書きたい、さらにgitでバージョン管理したいと思うことはないだろうか？\\n私は上記のようなモチベーションで、はてなブログの記事を管理する CLI 「gimonfu」を作成した。\\ngimonfuは、はてなブログの記事をMarkdownファイルとしてダウンロードしたり、Markdownファイルを記事として投稿したりできる。\\n　　\\nつまり、Markdown ファイルを GitHub のリポジトリにプッシュするだけで、はてなブログに記事を公開できる。\\nGitHub Actions の YAML だけをみて設定できる方は、本記事の文章を飛ばして、私の GitHub にある YAML を確認いただきたい。\\n1. はてなブログの記事執筆設定を Markdown モードにする\\nはてなブログの設定ページから、設定 -> 編集モード を 「Markdownモード」に設定し「変更する」ボタンを押す\\nまずはてなブログの基本設定を開く。\\n\\n下へスクロールし、編集モードを Markdown モードにする。\\n\\n「変更する」ボタンを押して変更を反映する。\\n\\n(補足: 他モードでの動作確認はしていないので、もし Markdown 記法以外を利用する場合はご自身で試して欲しい。\\n2. はてなブログの API キーを確認する\\nはてなブログの設定ページから、設定 -> 詳細設定 に移動し、ユーザID, ブログID, API キー をメモする\\nまずはてなブログの詳細設定を開く。\\n\\n下へスクロールし、AtomPubの項目から、ユーザID, ブログID, APIキーを確認する。\\n\\n3. GitHub リポジトリを作り、ワークフローに使う Secrets を登録する\\nワークフローとは、GitHub Actions で実行する一連の内容を記したものである。\\nこの章では、GitHub で新しいリポジトリを作り、ワークフローで使う Secrets を登録する。\\nまずは、新しいリポジトリを作った後、Settings -> Secrets を開く\\n\\nワークフローで使う Name と Value の組み合わせを5組登録する\\n\\n登録する内容は次の通り。\\nName\\nValue\\nValue (例)\\n\\n\\n\\n\\nHATENA_USER\\n先程確認したはてなブログのユーザID\\nbasd4g\\n\\n\\nHATENA_BLOG_ID\\n先程確認したはてなブログのブログID\\nbasd4g.hatenablog.com\\n\\n\\nHATENA_API_KEY\\n先程確認したはてなブログのAPIキー\\nabcdef0123\\n\\n\\nGIT_NAME\\n(ワークフローで自動的に作られるコミットの)自分の名前\\nTaro Yamada\\n\\n\\nGIT_MAIL\\n(ワークフローで自動的に作られるコミットの)自分のメールアドレス\\nbasd4g@example.com\\n\\n\\n\\n\\n\\n4. 記事をダウンロードするワークフローを追加する\\n記事をダウンロードする GitHub Actions ワークフローを追加する。\\nワークフローは GitHub リポジトリのWebページ上からも追加できる。\\n\\n\\n.github/workflows/pull.yaml に次の内容を記述する\\npull.yaml\\nname: Pull\\n\\non:\\n  push:\\n    branches: [ main ]\\n\\njobs:\\n  pull:\\n    runs-on: ubuntu-latest\\n\\n    steps:\\n    - uses: actions/checkout@v2\\n\\n    - name: Deploy and Commit\\n      env:\\n        HATENA_USER_ID: ${{ secrets.HATENA_USER }}\\n        HATENA_BLOG_ID: ${{ secrets.HATENA_BLOG_ID }}\\n        HATENA_API_KEY: ${{ secrets.HATENA_API_KEY }}\\n        GIT_NAME: ${{ secrets.GIT_NAME }}\\n        GIT_MAIL: ${{ secrets.GIT_MAIL }}\\n        REPO_OWNER: ${{ github.repository_owner }}\\n      run: |\\n        cd ${GITHUB_WORKSPACE}\\n\\n        # コミットのためのgitの設定\\n        echo \'git initialize\'\\n        git config --global user.name \\"${GIT_NAME}\\"\\n        git config --global user.email \\"${GIT_MAIL}\\"\\n        git remote set-url origin \\"https://${REPO_OWNER}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\\"\\n        echo \'gimonfu initialize\'\\n\\n        # gimonfuの初期設定\\n        npm init -y > /dev/null 2>&1\\n        npm install gimonfu\\n        echo \\"{\\\\\\"user_id\\\\\\":\\\\\\"${HATENA_USER_ID}\\\\\\",\\\\\\"blog_id\\\\\\":\\\\\\"${HATENA_BLOG_ID}\\\\\\",\\\\\\"api_key\\\\\\":\\\\\\"${HATENA_API_KEY}\\\\\\"}\\" > .gimonfu.json\\n\\n        # 新しい/更新された記事をダウンロード\\n        echo \'gimonfu pull\'\\n        npx gimonfu --git-commit-date pull\\n\\n        # コミットを作成する\\n        git add entry\\n        # This script will not make a commit if there are no changes.\\n        if ! git diff --staged --exit-code --quiet; then \\\\\\n          git commit -m \\"Pull articles (automatic commit)\\" ;\\\\\\n        fi\\n\\n        git push origin HEAD:main\\n\\nコミットが GitHub 上にプッシュされると、ワークフローが走ってリポジトリに記事が反映される。\\n5. 記事をダウンロードするワークフローを定期実行させる\\n先程は初回だったので「main ブランチにプッシュしたときにワークフローを実行する」(=>はてなブログの内容を GitHub リポジトリに反映させる)設定にした。\\nここではワークフローの一部を書き換えて、1時間に一回ワークフローを実行させる。\\n.github/workflows/pull.yaml の内容を一部書き換える。\\n\\n--- a/.github/workflows/pull.yaml\\n+++ b/.github/workflows/pull.yaml\\n@@ -1,8 +1,8 @@\\n name: Pull\\n\\n on:\\n-  push:\\n-    branches: [ main ]\\n+  schedule:\\n+    - cron: \'0 * * * *\'\\n\\n jobs:\\n   pull:\\n\\n\\n\\n\\n6. 記事をアップロードするワークフローを追加する\\n.github/workflows/push.yamlに次の内容を記述してコミット、プッシュする。\\ngithub/workflows/push.yaml\\nname: Push\\n\\non:\\n  push:\\n    branches: [ main ]\\n\\njobs:\\n  push:\\n    runs-on: ubuntu-latest\\n\\n    steps:\\n    - uses: actions/checkout@v2\\n\\n    - name: Deploy and Commit\\n      env:\\n        HATENA_USER_ID: ${{ secrets.HATENA_USER }}\\n        HATENA_BLOG_ID: ${{ secrets.HATENA_BLOG_ID }}\\n        HATENA_API_KEY: ${{ secrets.HATENA_API_KEY }}\\n        GIT_NAME: ${{ secrets.GIT_NAME }}\\n        GIT_MAIL: ${{ secrets.GIT_MAIL }}\\n        REPO_OWNER: ${{ github.repository_owner }}\\n      run: |\\n        cd ${GITHUB_WORKSPACE}\\n\\n        # コミットのためのgitの設定\\n        echo \'git initialize\'\\n        git config --global user.name \\"${GIT_NAME}\\"\\n        git config --global user.email \\"${GIT_MAIL}\\"\\n        git remote set-url origin \\"https://${REPO_OWNER}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\\"\\n\\n        # gimonfuの初期設定\\n        echo \'gimonfu initialize\'\\n        npm init -y > /dev/null 2>&1\\n        npm install gimonfu\\n        echo \\"{\\\\\\"user_id\\\\\\":\\\\\\"${HATENA_USER_ID}\\\\\\",\\\\\\"blog_id\\\\\\":\\\\\\"${HATENA_BLOG_ID}\\\\\\",\\\\\\"api_key\\\\\\":\\\\\\"${HATENA_API_KEY}\\\\\\"}\\" > .gimonfu.json\\n\\n        # 新しい/更新された記事をアップロード\\n        echo \'gimonfu push\'\\n        npx gimonfu --git-commit-date push\\n        git add entry\\n\\n        # コミットを作成する\\n        # This script will not make a commit if there are no changes.\\n        if ! git diff --staged --exit-code --quiet; then \\\\\\n          git commit -m \\"Pull articles (automatic commit)\\" ;\\\\\\n        fi\\n\\n        git push origin HEAD:main\\n\\n6. 記事の投稿と更新\\n以上の設定を行うと、GitHub のリポジトリとはてなブログの記事が同期できる。\\nGitHub 上の Markdown ファイルを上書きすると記事が更新されるし、新しい Markdown ファイルを追加すると記事が投稿される。\\n新規記事を投稿するときは、entry ディレクトリ以下に 次の記述で始まる Markdownファイル (拡張子.md) を追加する。\\n\\n---\\ntitle: タイトル\\ndate: 2019-09-18T12:50:00.000Z\\nid: \\"26006613576772424\\"\\n---\\n\\n記事本文が以降続く。\\n\\n\\n\\n記事の冒頭に --- で挟んだYAML形式のメタ情報を付加する。\\nid:の行は新規投稿時には記述しない。投稿されると自動で付加される。\\nおわりに\\nブログ記事を Git で管理したいというモチベーションから CLI を作るまでに至った。\\nGitHub Actions のワークフローを登録しておけば、ローカルに gimonfu をインストールせずに使えるが、インストールして使うこともできる。\\n$ npm install -g gimonfuでインストールでき、使い方は README で説明している。\\nここまで読んでいただいてありがとうございました。\\nあなたのはてなブログ生活が捗ることを願っています。(という記事をQiitaに投稿)","id":"tag:qiita.com,2005:PublicArticle/1244365","isoDate":"2020-06-14T13:40:42.000Z"},{"title":"はてなブログに乗り換えた","link":"https://basd4g.hatenablog.com/entry/firebase2hatenablog","pubDate":"Sun, 14 Jun 2020 21:26:00 +0900","enclosure":{"url":"https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png","type":"image/png","length":"0"},"content":"<p>昨年に作ったブログの公開場所を<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA%A5%D6%A5%ED%A5%B0\\">はてなブログ</a>に変え、名前も「やんまーのブログ」と改名した。</p>\\n\\n<p>以前は Firebase Hosting 上に、 Nuxt.js の Generate モードで生成した HTML ファイルを公開していた。</p>\\n\\n<p>移行するにあたって次のことを行った。</p>\\n\\n<ol>\\n<li><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA%A5%D6%A5%ED%A5%B0\\">はてなブログ</a><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/CLI\\">CLI</a> gimonfu による記事管理</li>\\n<li>Zeit Nowを使った旧<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3\\">ドメイン</a>の転送処理</li>\\n</ol>\\n\\n\\n<h2>1. <a href=\\"https://github.com/basd4g/gimonfu\\">gimonfu</a> による記事管理</h2>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA%A5%D6%A5%ED%A5%B0\\">はてなブログ</a>は <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Markdown\\">Markdown</a> で記事を作成でき、これが乗り換える後押しになった。</p>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Markdown\\">Markdown</a> の記事は、以前のブログでも <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GitHub\\">GitHub</a> 上で記事を管理していたので、今回も同じことを行いたいと思っていた。</p>\\n\\n<p>そこで<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA%A5%D6%A5%ED%A5%B0\\">はてなブログ</a>の <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/CLI\\">CLI</a> を作り、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GitHub\\">GitHub</a>上の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA\\">リポジトリ</a>と同期するようにした。<br />\\n<a href=\\"http://developer.hatena.ne.jp/ja/documents/blog/apis/atom\\">はてなブログはAPIを公開しており</a>、これを使って <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Markdown\\">Markdown</a> ファイルをアップロード、ダウンロードしている。</p>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA%A5%D6%A5%ED%A5%B0\\">はてなブログ</a>の <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/CLI\\">CLI</a> には、既に <a href=\\"https://github.com/x-motemen/blogsync\\">blogsync</a> というソフトウェアがある。<br />\\n当初はこのソフトウェアを使おうと思っていたのだが、新規記事投稿の部分が自分の思うように行かず、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/API\\">API</a>を触っているうちに、全部作ったほうがいいのでは？という気持ちになり <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/CLI\\">CLI</a> が出来上がってしまった。</p>\\n\\n<p><a href=\\"https://github.com/x-motemen/blogsync\\">blogsync</a> と <a href=\\"https://github.com/basd4g/gimonfu\\">gimonfu</a> はどちらも1記事につき、1ファイルで、ファイル先頭に <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/YAML\\">YAML</a> Front matter といわれる <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/YAML\\">YAML</a> 形式の記事情報を含む。\\nまたURLの構造が記事ファイルの<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8\\">ディレクト</a>リ構造となる点も同じだ。</p>\\n\\n<p>一方で、記事の投稿に関しては異なる点がある。<br />\\nblogsync では、記事本文のみを標準入力で <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/CLI\\">CLI</a> に渡すが、 gimonfu では、対象<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8\\">ディレクト</a>リ内にある新しいファイルを新規記事として認識し投稿する。</p>\\n\\n<p>こうすると、CIを組み合わせれば、新規投稿時にも <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/CLI\\">CLI</a> を直<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%C0%DC%BF%A8\\">接触</a>らずに運用できる。</p>\\n\\n<p>現にこのブログも、新規投稿時にファイルを追加して <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GitHub\\">GitHub</a> に push すれば、自動的に<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA%A5%D6%A5%ED%A5%B0\\">はてなブログ</a>も更新されるようにしてある。 (逆に<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA%A5%D6%A5%ED%A5%B0\\">はてなブログ</a>が更新されたら<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GitHub\\">GitHub</a> にも反映されるワークフローも設定している。)</p>\\n\\n<p>gimonfu の使い方の詳細は <a href=\\"https://github.com/basd4g/gimonfu\\">README</a> に譲るが、<a href=\\"https://github.com/basd4g/basd4g.hatenablog.com/tree/master/.github/workflows\\">このブログのワークフロー</a>と同じものを <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GitHub\\">GitHub</a> Actions に指定すれば、記事管理がとても捗ると思うので是非活用して欲しい。\\n(なお、<a href=\\"https://qiita.com/basd4g/items/1a38857f6bafb20f065d\\">ワークフローの設定記事をQiitaに投稿した</a>)</p>\\n\\n<h2>2. Zeit now を使った旧<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3\\">ドメイン</a>の転送処理</h2>\\n\\n<p>旧<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3\\">ドメイン</a>の記事を公開していた URL は全て、express.js を使って、今の記事に 301 リダイレクトするように設定した。(<a href=\\"https://memo.basd4g.net/posts/zeit-now/\\">設定した内容</a>)<br />\\nNow を初めて使ったが、とても簡単にアプリケーションを公開できるので、さくっと作ったときなどに活用していきたい。</p>\\n\\n<hr />\\n\\n<p>というわけで、これから<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA%A5%D6%A5%ED%A5%B0\\">はてなブログ</a>で更新していきます。\\nよろしくお願いします。</p>\\n","contentSnippet":"昨年に作ったブログの公開場所をはてなブログに変え、名前も「やんまーのブログ」と改名した。\\n以前は Firebase Hosting 上に、 Nuxt.js の Generate モードで生成した HTML ファイルを公開していた。\\n移行するにあたって次のことを行った。\\nはてなブログCLI gimonfu による記事管理\\nZeit Nowを使った旧ドメインの転送処理\\n1. gimonfu による記事管理\\nはてなブログは Markdown で記事を作成でき、これが乗り換える後押しになった。\\nMarkdown の記事は、以前のブログでも GitHub 上で記事を管理していたので、今回も同じことを行いたいと思っていた。\\nそこではてなブログの CLI を作り、GitHub上のリポジトリと同期するようにした。\\nはてなブログはAPIを公開しており、これを使って Markdown ファイルをアップロード、ダウンロードしている。\\nはてなブログの CLI には、既に blogsync というソフトウェアがある。\\nAPIを触っているうちに、全部作ったほうがいいのでは？という気持ちになり CLI が出来上がってしまった。\\nblogsync と gimonfu はどちらも1記事につき、1ファイルで、ファイル先頭に YAML Front matter といわれる YAML 形式の記事情報を含む。\\nまたURLの構造が記事ファイルのディレクトリ構造となる点も同じだ。\\n一方で、記事の投稿に関しては異なる点がある。\\nCLI に渡すが、 gimonfu では、対象ディレクトリ内にある新しいファイルを新規記事として認識し投稿する。\\nこうすると、CIを組み合わせれば、新規投稿時にも CLI を直接触らずに運用できる。\\n現にこのブログも、新規投稿時にファイルを追加して GitHub に push すれば、自動的にはてなブログも更新されるようにしてある。 (逆にはてなブログが更新されたらGitHub にも反映されるワークフローも設定している。)\\ngimonfu の使い方の詳細は README に譲るが、このブログのワークフローと同じものを GitHub Actions に指定すれば、記事管理がとても捗ると思うので是非活用して欲しい。\\n(なお、ワークフローの設定記事をQiitaに投稿した)\\n2. Zeit now を使った旧ドメインの転送処理\\n旧ドメインの記事を公開していた URL は全て、express.js を使って、今の記事に 301 リダイレクトするように設定した。(設定した内容)\\nというわけで、これからはてなブログで更新していきます。\\nよろしくお願いします。","guid":"hatenablog://entry/26006613585136739","isoDate":"2020-06-14T12:26:00.000Z"},{"title":"はてなブログに乗り換えた","link":"https://memo.basd4g.net/posts/firebase2hatenablog/","pubDate":"Sun, 14 Jun 2020 21:26:00 +0900","content":"<p>昨年に作ったブログの公開場所をはてなブログに変え、名前も「やんまーのブログ」と改名した。</p>\\n<p>以前は Firebase Hosting 上に、 Nuxt.js の Generate モードで生成した HTML ファイルを公開していた。</p>\\n<p>移行するにあたって次のことを行った。</p>\\n<ol>\\n<li>はてなブログCLI gimonfu による記事管理</li>\\n<li>Zeit Nowを使った旧ドメインの転送処理</li>\\n</ol>\\n<h2 id=\\"1-gimonfuhttpsgithubcombasd4ggimonfu-による記事管理\\">1. <a href=\\"https://github.com/basd4g/gimonfu\\"target=\\"_blank\\">gimonfu</a> による記事管理</h2>\\n<p>はてなブログは Markdown で記事を作成でき、これが乗り換える後押しになった。</p>\\n<p>Markdown の記事は、以前のブログでも GitHub 上で記事を管理していたので、今回も同じことを行いたいと思っていた。</p>\\n<p>そこではてなブログの CLI を作り、GitHub上のリポジトリと同期するようにした。<br>\\n<a href=\\"http://developer.hatena.ne.jp/ja/documents/blog/apis/atom\\"target=\\"_blank\\">はてなブログはAPIを公開しており</a>、これを使って Markdown ファイルをアップロード、ダウンロードしている。</p>\\n<p>はてなブログの CLI には、既に <a href=\\"https://github.com/x-motemen/blogsync\\"target=\\"_blank\\">blogsync</a> というソフトウェアがある。<br>\\n当初はこのソフトウェアを使おうと思っていたのだが、新規記事投稿の部分が自分の思うように行かず、APIを触っているうちに、全部作ったほうがいいのでは？という気持ちになり CLI が出来上がってしまった。</p>\\n<p><a href=\\"https://github.com/x-motemen/blogsync\\"target=\\"_blank\\">blogsync</a> と <a href=\\"https://github.com/x-motemen/blogsync\\"target=\\"_blank\\">gimonfu</a> はどちらも1記事につき、1ファイルで、ファイル先頭に YAML Front matter といわれる YAML 形式の記事情報を含む。\\nまたURLの構造が記事ファイルのディレクトリ構造となる点も同じだ。</p>\\n<p>一方で、記事の投稿に関しては異なる点がある。<br>\\nblogsync では、記事本文のみを標準入力で CLI に渡すが、 gimonfu では、対象ディレクトリ内にある新しいファイルを新規記事として認識し投稿する。</p>\\n<p>こうすると、CIを組み合わせれば、新規投稿時にも CLI を直接触らずに運用できる。</p>\\n<p>現にこのブログも、新規投稿時にファイルを追加して GitHub に push すれば、自動的にはてなブログも更新されるようにしてある。 (逆にはてなブログが更新されたらGitHub にも反映されるワークフローも設定している。)</p>\\n<p>gimonfu の使い方の詳細は <a href=\\"https://github.com/basd4g/gimonfu\\"target=\\"_blank\\">README</a> に譲るが、<a href=\\"https://github.com/basd4g/basd4g.hatenablog.com/tree/master/.github/workflows\\"target=\\"_blank\\">このブログのワークフロー</a>と同じものを GitHub Actions に指定すれば、記事管理がとても捗ると思うので是非活用して欲しい。</p>\\n<h2 id=\\"2-zeit-now-を使った旧ドメインの転送処理\\">2. Zeit now を使った旧ドメインの転送処理</h2>\\n<p>旧ドメインの記事を公開していた URL は全て、express.js を使って、今の記事に 301 リダイレクトするように設定した。(<a href=\\"https://memo.basd4g.net/posts/zeit-now/\\">設定した内容</a>)</p>\\n<p>Now を初めて使ったが、とても簡単にアプリケーションを公開できるので、さくっと作ったときなどに活用していきたい。</p>\\n<hr>\\n<p>というわけで、これからはてなブログで更新していきます。\\nよろしくお願いします。(誰に)</p>\\n<hr>\\n<p>追記: (2020/10/04) ドメイン転送の記事へのリンクを相対リンクに修正</p>","contentSnippet":"昨年に作ったブログの公開場所をはてなブログに変え、名前も「やんまーのブログ」と改名した。\\n以前は Firebase Hosting 上に、 Nuxt.js の Generate モードで生成した HTML ファイルを公開していた。\\n移行するにあたって次のことを行った。\\nはてなブログCLI gimonfu による記事管理\\nZeit Nowを使った旧ドメインの転送処理\\n1. gimonfu による記事管理\\nはてなブログは Markdown で記事を作成でき、これが乗り換える後押しになった。\\nMarkdown の記事は、以前のブログでも GitHub 上で記事を管理していたので、今回も同じことを行いたいと思っていた。\\nそこではてなブログの CLI を作り、GitHub上のリポジトリと同期するようにした。\\nはてなブログはAPIを公開しており、これを使って Markdown ファイルをアップロード、ダウンロードしている。\\nはてなブログの CLI には、既に blogsync というソフトウェアがある。\\nblogsync と gimonfu はどちらも1記事につき、1ファイルで、ファイル先頭に YAML Front matter といわれる YAML 形式の記事情報を含む。\\nまたURLの構造が記事ファイルのディレクトリ構造となる点も同じだ。\\n一方で、記事の投稿に関しては異なる点がある。\\nこうすると、CIを組み合わせれば、新規投稿時にも CLI を直接触らずに運用できる。\\n現にこのブログも、新規投稿時にファイルを追加して GitHub に push すれば、自動的にはてなブログも更新されるようにしてある。 (逆にはてなブログが更新されたらGitHub にも反映されるワークフローも設定している。)\\ngimonfu の使い方の詳細は README に譲るが、このブログのワークフローと同じものを GitHub Actions に指定すれば、記事管理がとても捗ると思うので是非活用して欲しい。\\n2. Zeit now を使った旧ドメインの転送処理\\n旧ドメインの記事を公開していた URL は全て、express.js を使って、今の記事に 301 リダイレクトするように設定した。(設定した内容)\\nNow を初めて使ったが、とても簡単にアプリケーションを公開できるので、さくっと作ったときなどに活用していきたい。\\nというわけで、これからはてなブログで更新していきます。\\nよろしくお願いします。(誰に)\\n追記: (2020/10/04) ドメイン転送の記事へのリンクを相対リンクに修正","guid":"https://memo.basd4g.net/posts/firebase2hatenablog/","isoDate":"2020-06-14T12:26:00.000Z"},{"title":"gimonfu で、はてなブログの記事を GitHub と同期する","link":"https://memo.basd4g.net/posts/gimonfu/","pubDate":"Sun, 14 Jun 2020 21:23:06 +0900","content":"<p>ブログをはてなブログに移行するにあたり、記事を管理する CLI <a href=\\"https://github.com/basd4g/gimonfu\\"target=\\"_blank\\">「gimonfu」</a>を作成した。</p>\\n<p>本記事では、gimonfu と GitHub Actions を使って、GitHub のリポジトリとはてなブログを連携し、記事を git で管理できるように設定を行う。</p>\\n<p>記事の内容を設定すれば、Markdown ファイルを GitHub のリポジトリにプッシュするとはてなブログに記事を公開できたり、はてなの Web ページで記事を編集すると、GitHub のリポジトリに自動で反映されてバックアップを取ることができる。</p>\\n<p>最終的な GitHub Actions の設定は、<a href=\\"https://github.com/basd4g/basd4g.hatenablog.com/tree/master/.github/workflows\\"target=\\"_blank\\">私のブログの記事リポジトリ</a>にある yaml にて確認できる。</p>\\n<h2 id=\\"もくじ\\">もくじ</h2>\\n<p>次の流れで設定する</p>\\n<ol>\\n<li>はてなブログの記事執筆設定を Markdown モードにする</li>\\n<li>はてなブログの API キーを確認する</li>\\n<li>GitHub リポジトリを作り、ワークフローに使う Secrets を登録する</li>\\n<li>記事をダウンロードするワークフローを追加する</li>\\n<li>記事をダウンロードするワークフローを定期実行させる</li>\\n<li>記事をアップロードするワークフローを追加する</li>\\n</ol>\\n<h2 id=\\"1-はてなブログの記事執筆設定を-markdown-モードにする\\">1. はてなブログの記事執筆設定を Markdown モードにする</h2>\\n<p>はじめに、はてなブログの設定を変更し、記事執筆設定を Markdown モードにする。</p>\\n<p><a href=\\"https://blog.hatena.ne.jp/-/config\\"target=\\"_blank\\">はてなブログの設定ページ</a>から、設定 -&gt; 編集モード を 「Markdownモード」に設定し「変更する」ボタンを押す</p>\\n<p>まずはてなブログの基本設定を開く。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/gimonfu-1.png\\"><img src=\\"https://blob.basd4g.net/gimonfu-1.png\\"\\nalt=\\"はてなブログの基本設定を開く\\"/></a></p>\\n<p>下へスクロールし、編集モードを Markdown モードにする。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/gimonfu-2.png\\"><img src=\\"https://blob.basd4g.net/gimonfu-2.png\\"\\nalt=\\"編集モードを Markdown モードへ\\"/></a></p>\\n<p>「変更する」ボタンを押して変更を反映する。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/gimonfu-3.png\\"><img src=\\"https://blob.basd4g.net/gimonfu-3.png\\"\\nalt=\\"「変更する」ボタンを押して変更を反映する\\"/></a></p>\\n<p>(補足: 他のモードでも動作確認はしていないので、もし Markdown 記法以外を利用する場合はご自身で試して欲しい。</p>\\n<h2 id=\\"2-はてなブログの-api-キーを確認する\\">2. はてなブログの API キーを確認する</h2>\\n<p><a href=\\"https://blog.hatena.ne.jp/-/config\\"target=\\"_blank\\">はてなブログの設定ページ</a>から、設定 -&gt; 詳細設定 に移動し、ユーザID, ブログID, API キー をメモする</p>\\n<p>まずはてなブログの詳細設定を開く。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/gimonfu-4.png\\"><img src=\\"https://blob.basd4g.net/gimonfu-4.png\\"\\nalt=\\"詳細設定へ移動\\"/></a></p>\\n<p>下へスクロールし、AtomPubの項目から、ユーザID, ブログID, APIキーを確認する。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/gimonfu-5.png\\"><img src=\\"https://blob.basd4g.net/gimonfu-5.png\\"\\nalt=\\"APIキーをメモする\\"/></a></p>\\n<h2 id=\\"3-github-リポジトリを作りワークフローに使う-secrets-を登録する\\">3. GitHub リポジトリを作り、ワークフローに使う Secrets を登録する</h2>\\n<p>ワークフローとは、GitHub Actions で実行する一連の内容を記したものである。\\n指定した時間になったときや、GitHub に コミットをプッシュしたとき、事前に作成したワークフローを自動で実行できる。</p>\\n<p>この章では、GitHub で新しいリポジトリを作り、ワークフローで使う Secrets を登録する。</p>\\n<p>まずは、新しいリポジトリを作った後、Settings -&gt; Secrets を開く</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/gimonfu-6.png\\"><img src=\\"https://blob.basd4g.net/gimonfu-6.png\\"\\nalt=\\"Secrets 登録画面を開く\\"/></a></p>\\n<p>ワークフローで使う Name と Value の組み合わせを5組登録する</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/gimonfu-7.png\\"><img src=\\"https://blob.basd4g.net/gimonfu-7.png\\"\\nalt=\\"Secrets の Name と Value を登録する\\"/></a></p>\\n<p>登録する内容は次の通り。\\n例を参考に自分の文字列に置き換えてほしい。</p>\\n<table>\\n<thead>\\n<tr>\\n<th>Name</th>\\n<th>Value</th>\\n<th>Value (例)</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td><code>HATENA_USER</code></td>\\n<td>先程確認したはてなブログのユーザID</td>\\n<td>basd4g</td>\\n</tr>\\n<tr>\\n<td><code>HATENA_BLOG_ID</code></td>\\n<td>先程確認したはてなブログのブログID</td>\\n<td>basd4g.hatenablog.com</td>\\n</tr>\\n<tr>\\n<td><code>HATENA_API_KEY</code></td>\\n<td>先程確認したはてなブログのAPIキー</td>\\n<td>abcdef0123</td>\\n</tr>\\n<tr>\\n<td><code>GIT_NAME</code></td>\\n<td>(ワークフローで自動的に作られるコミットの)自分の名前</td>\\n<td>Taro Yamada</td>\\n</tr>\\n<tr>\\n<td><code>GIT_MAIL</code></td>\\n<td>(ワークフローで自動的に作られるコミットの)自分のメールアドレス</td>\\n<td><a href=\\"mailto:basd4g@example.com\\">basd4g@example.com</a></td>\\n</tr>\\n</tbody>\\n</table>\\n<h2 id=\\"4-記事をダウンロードするワークフローを追加する\\">4. 記事をダウンロードするワークフローを追加する</h2>\\n<p>記事をダウンロードする GitHub Actions ワークフローを追加する。</p>\\n<p>ワークフローは GitHub リポジトリのWebページ上からも追加できる。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/gimonfu-8.png\\"><img src=\\"https://blob.basd4g.net/gimonfu-8.png\\"\\nalt=\\"新しいワークフローを追加する\\"/></a></p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/gimonfu-9.png\\"><img src=\\"https://blob.basd4g.net/gimonfu-9.png\\"\\nalt=\\"記事をダウンロードするワークフローを追加する\\"/></a></p>\\n<p><code>.github/workflows/pull.yaml</code> に次の内容を記述する</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-pull.yaml\\" data-lang=\\"pull.yaml\\"><span class=\\"k\\">name</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>Pull<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"></span><span class=\\"k\\">on</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">push</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">branches</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span><span class=\\"p\\">[</span><span class=\\"w\\"> </span>master<span class=\\"w\\"> </span><span class=\\"p\\">]</span><span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"></span><span class=\\"k\\">jobs</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">pull</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">runs-on</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>ubuntu-latest<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">steps</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>- <span class=\\"k\\">uses</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>actions/checkout@v2<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>- <span class=\\"k\\">name</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>Deploy<span class=\\"w\\"> </span>and<span class=\\"w\\"> </span>Commit<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">env</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">HATENA_USER_ID</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.HATENA_USER<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">HATENA_BLOG_ID</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.HATENA_BLOG_ID<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">HATENA_API_KEY</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.HATENA_API_KEY<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">GIT_NAME</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.GIT_NAME<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">GIT_MAIL</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.GIT_MAIL<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">REPO_OWNER</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>github.repository_owner<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">run</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span><span class=\\"sd\\">|\\n</span><span class=\\"sd\\"> cd ${GITHUB_WORKSPACE}</span><span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># コミットのためのgitの設定</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>echo<span class=\\"w\\"> </span><span class=\\"s1\\">&#39;git initialize&#39;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>config<span class=\\"w\\"> </span>--global<span class=\\"w\\"> </span>user.name<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;${GIT_NAME}&#34;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>config<span class=\\"w\\"> </span>--global<span class=\\"w\\"> </span>user.email<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;${GIT_MAIL}&#34;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>remote<span class=\\"w\\"> </span>set-url<span class=\\"w\\"> </span>origin<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;https://${REPO_OWNER}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git&#34;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>echo<span class=\\"w\\"> </span><span class=\\"s1\\">&#39;gimonfu initialize&#39;</span><span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># gimonfuの初期設定</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>npm<span class=\\"w\\"> </span>init<span class=\\"w\\"> </span>-y<span class=\\"w\\"> </span>&gt;<span class=\\"w\\"> </span>/dev/<span class=\\"kc\\">null</span><span class=\\"w\\"> </span><span class=\\"m\\">2</span>&gt;<span class=\\"cp\\">&amp;1</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>npm<span class=\\"w\\"> </span>install<span class=\\"w\\"> </span>gimonfu<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>echo<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;{\\\\&#34;user_id\\\\&#34;:\\\\&#34;${HATENA_USER_ID}\\\\&#34;,\\\\&#34;blog_id\\\\&#34;:\\\\&#34;${HATENA_BLOG_ID}\\\\&#34;,\\\\&#34;api_key\\\\&#34;:\\\\&#34;${HATENA_API_KEY}\\\\&#34;}&#34;</span><span class=\\"w\\"> </span>&gt;<span class=\\"w\\"> </span>.gimonfu.json<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># 新しい/更新された記事をダウンロード</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>echo<span class=\\"w\\"> </span><span class=\\"s1\\">&#39;gimonfu pull&#39;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>npx<span class=\\"w\\"> </span>gimonfu<span class=\\"w\\"> </span>--git-commit-date<span class=\\"w\\"> </span>pull<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># コミットを作成する</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>add<span class=\\"w\\"> </span>entry<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># This script will not make a commit if there are no changes.</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>if<span class=\\"w\\"> </span>!<span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>diff<span class=\\"w\\"> </span>--staged<span class=\\"w\\"> </span>--exit-code<span class=\\"w\\"> </span>--quiet;<span class=\\"w\\"> </span>then<span class=\\"w\\"> </span>\\\\<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>commit<span class=\\"w\\"> </span>-m<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;Pull articles (automatic commit)&#34;</span><span class=\\"w\\"> </span>;\\\\<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>fi<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>push<span class=\\"w\\"> </span>origin<span class=\\"w\\"> </span>HEAD<span class=\\"p\\">:</span>master<span class=\\"w\\">\\n</span></code></pre></div><p>コミットが GitHub 上にプッシュされると、ワークフローが走ってリポジトリに記事が反映される。</p>\\n<h2 id=\\"5-記事をダウンロードするワークフローを定期実行させる\\">5. 記事をダウンロードするワークフローを定期実行させる</h2>\\n<p>先程は初回だったので「master ブランチにプッシュしたときにワークフローを実行する」(=&gt;はてなブログの内容を GitHub リポジトリに反映させる)設定にした。</p>\\n<p>ここではワークフローの一部を書き換えて、1時間に一回ワークフローを実行させる。</p>\\n<p><code>.github/workflows/pull.yaml</code> の内容を一部書き換える。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-diff\\" data-lang=\\"diff\\"><span class=\\"gd\\">--- a/.github/workflows/pull.yaml\\n</span><span class=\\"gd\\"></span><span class=\\"gi\\">+++ b/.github/workflows/pull.yaml\\n</span><span class=\\"gi\\"></span><span class=\\"gu\\">@@ -1,8 +1,8 @@\\n</span><span class=\\"gu\\"></span> name: Pull\\non:\\n<span class=\\"gd\\">- push:\\n</span><span class=\\"gd\\">- branches: [ master ]\\n</span><span class=\\"gd\\"></span><span class=\\"gi\\">+ schedule:\\n</span><span class=\\"gi\\">+ - cron: &#39;0 * * * *&#39;\\n</span><span class=\\"gi\\"></span>\\njobs:\\npull:\\n</code></pre></div><h2 id=\\"6-記事をアップロードするワークフローを追加する\\">6. 記事をアップロードするワークフローを追加する</h2>\\n<p><code>.github/workflows/push.yaml</code>に次の内容を記述してコミット、プッシュする。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-.github/workflows/push.yaml\\" data-lang=\\".github/workflows/push.yaml\\"><span class=\\"k\\">name</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>Push<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"></span><span class=\\"k\\">on</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">push</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">branches</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span><span class=\\"p\\">[</span><span class=\\"w\\"> </span>master<span class=\\"w\\"> </span><span class=\\"p\\">]</span><span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"></span><span class=\\"k\\">jobs</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">push</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">runs-on</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>ubuntu-latest<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">steps</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>- <span class=\\"k\\">uses</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>actions/checkout@v2<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>- <span class=\\"k\\">name</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>Deploy<span class=\\"w\\"> </span>and<span class=\\"w\\"> </span>Commit<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">env</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">HATENA_USER_ID</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.HATENA_USER<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">HATENA_BLOG_ID</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.HATENA_BLOG_ID<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">HATENA_API_KEY</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.HATENA_API_KEY<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">GIT_NAME</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.GIT_NAME<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">GIT_MAIL</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>secrets.GIT_MAIL<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">REPO_OWNER</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>${{<span class=\\"w\\"> </span>github.repository_owner<span class=\\"w\\"> </span>}}<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">run</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span><span class=\\"sd\\">|\\n</span><span class=\\"sd\\"> cd ${GITHUB_WORKSPACE}</span><span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># コミットのためのgitの設定</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>echo<span class=\\"w\\"> </span><span class=\\"s1\\">&#39;git initialize&#39;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>config<span class=\\"w\\"> </span>--global<span class=\\"w\\"> </span>user.name<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;${GIT_NAME}&#34;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>config<span class=\\"w\\"> </span>--global<span class=\\"w\\"> </span>user.email<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;${GIT_MAIL}&#34;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>remote<span class=\\"w\\"> </span>set-url<span class=\\"w\\"> </span>origin<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;https://${REPO_OWNER}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git&#34;</span><span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># gimonfuの初期設定</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>echo<span class=\\"w\\"> </span><span class=\\"s1\\">&#39;gimonfu initialize&#39;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>npm<span class=\\"w\\"> </span>init<span class=\\"w\\"> </span>-y<span class=\\"w\\"> </span>&gt;<span class=\\"w\\"> </span>/dev/<span class=\\"kc\\">null</span><span class=\\"w\\"> </span><span class=\\"m\\">2</span>&gt;<span class=\\"cp\\">&amp;1</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>npm<span class=\\"w\\"> </span>install<span class=\\"w\\"> </span>gimonfu<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>echo<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;{\\\\&#34;user_id\\\\&#34;:\\\\&#34;${HATENA_USER_ID}\\\\&#34;,\\\\&#34;blog_id\\\\&#34;:\\\\&#34;${HATENA_BLOG_ID}\\\\&#34;,\\\\&#34;api_key\\\\&#34;:\\\\&#34;${HATENA_API_KEY}\\\\&#34;}&#34;</span><span class=\\"w\\"> </span>&gt;<span class=\\"w\\"> </span>.gimonfu.json<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># 新しい/更新された記事をアップロード</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>echo<span class=\\"w\\"> </span><span class=\\"s1\\">&#39;gimonfu push&#39;</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>npx<span class=\\"w\\"> </span>gimonfu<span class=\\"w\\"> </span>--git-commit-date<span class=\\"w\\"> </span>push<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>add<span class=\\"w\\"> </span>entry<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># コミットを作成する</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"c\\"># This script will not make a commit if there are no changes.</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>if<span class=\\"w\\"> </span>!<span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>diff<span class=\\"w\\"> </span>--staged<span class=\\"w\\"> </span>--exit-code<span class=\\"w\\"> </span>--quiet;<span class=\\"w\\"> </span>then<span class=\\"w\\"> </span>\\\\<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>commit<span class=\\"w\\"> </span>-m<span class=\\"w\\"> </span><span class=\\"s2\\">&#34;Pull articles (automatic commit)&#34;</span><span class=\\"w\\"> </span>;\\\\<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>fi<span class=\\"w\\">\\n</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span>git<span class=\\"w\\"> </span>push<span class=\\"w\\"> </span>origin<span class=\\"w\\"> </span>HEAD<span class=\\"p\\">:</span>master<span class=\\"w\\">\\n</span></code></pre></div><h2 id=\\"6-記事の投稿と更新\\">6. 記事の投稿と更新</h2>\\n<p>以上の設定を行うと、GitHub のリポジトリとはてなブログの記事が同期できる。</p>\\n<p>GitHub 上の Markdown ファイルを上書きすると記事が更新されるし、新しい Markdown ファイルを追加すると記事が投稿される。</p>\\n<p>Markdownファイルは次のような記述で始まる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-md\\" data-lang=\\"md\\">---\\ntitle: タイトル\\ndate: 2019-09-18T12:50:00.000Z\\nid: &#34;26006613576772424&#34;\\n---\\n記事本文が以降続く。\\n</code></pre></div><p>記事の冒頭に <code>---</code> で挟んだYAML形式のメタ情報を付加する。\\n<code>id: </code>の行は新規投稿時には記述しない。投稿されると自動で付加される。</p>\\n<h2 id=\\"おわりに\\">おわりに</h2>\\n<p>ブログ記事を Git で管理したいというモチベーションから CLI を作るまでに至った。</p>\\n<p>GitHub Actions のワークフローを登録しておけば、ローカルに gimonfu をインストールせずに使えるが、インストールして使うこともできる。\\n<code>$ npm install -g gimonfu</code>でインストールでき、使い方は <a href=\\"https://github.com/basd4g/gimonfu\\"target=\\"_blank\\">README</a> で説明している。</p>\\n<hr>\\n<p>ここまで読んでいただいてありがとうございました。\\nあなたのはてなブログ生活が捗ることを願っています。</p>","contentSnippet":"ブログをはてなブログに移行するにあたり、記事を管理する CLI 「gimonfu」を作成した。\\n本記事では、gimonfu と GitHub Actions を使って、GitHub のリポジトリとはてなブログを連携し、記事を git で管理できるように設定を行う。\\n記事の内容を設定すれば、Markdown ファイルを GitHub のリポジトリにプッシュするとはてなブログに記事を公開できたり、はてなの Web ページで記事を編集すると、GitHub のリポジトリに自動で反映されてバックアップを取ることができる。\\n最終的な GitHub Actions の設定は、私のブログの記事リポジトリにある yaml にて確認できる。\\nもくじ\\n次の流れで設定する\\nはてなブログの記事執筆設定を Markdown モードにする\\nはてなブログの API キーを確認する\\nGitHub リポジトリを作り、ワークフローに使う Secrets を登録する\\n記事をダウンロードするワークフローを追加する\\n記事をダウンロードするワークフローを定期実行させる\\n記事をアップロードするワークフローを追加する\\n1. はてなブログの記事執筆設定を Markdown モードにする\\nはじめに、はてなブログの設定を変更し、記事執筆設定を Markdown モードにする。\\nはてなブログの設定ページから、設定 -> 編集モード を 「Markdownモード」に設定し「変更する」ボタンを押す\\nまずはてなブログの基本設定を開く。\\n\\n下へスクロールし、編集モードを Markdown モードにする。\\n\\n「変更する」ボタンを押して変更を反映する。\\n\\n(補足: 他のモードでも動作確認はしていないので、もし Markdown 記法以外を利用する場合はご自身で試して欲しい。\\n2. はてなブログの API キーを確認する\\nはてなブログの設定ページから、設定 -> 詳細設定 に移動し、ユーザID, ブログID, API キー をメモする\\nまずはてなブログの詳細設定を開く。\\n\\n下へスクロールし、AtomPubの項目から、ユーザID, ブログID, APIキーを確認する。\\n\\n3. GitHub リポジトリを作り、ワークフローに使う Secrets を登録する\\nワークフローとは、GitHub Actions で実行する一連の内容を記したものである。\\n指定した時間になったときや、GitHub に コミットをプッシュしたとき、事前に作成したワークフローを自動で実行できる。\\nこの章では、GitHub で新しいリポジトリを作り、ワークフローで使う Secrets を登録する。\\nまずは、新しいリポジトリを作った後、Settings -> Secrets を開く\\n\\nワークフローで使う Name と Value の組み合わせを5組登録する\\n\\n登録する内容は次の通り。\\n例を参考に自分の文字列に置き換えてほしい。\\nName\\nValue\\nValue (例)\\n\\n\\n\\n\\nHATENA_USER\\n先程確認したはてなブログのユーザID\\nbasd4g\\n\\n\\nHATENA_BLOG_ID\\n先程確認したはてなブログのブログID\\nbasd4g.hatenablog.com\\n\\n\\nHATENA_API_KEY\\n先程確認したはてなブログのAPIキー\\nabcdef0123\\n\\n\\nGIT_NAME\\n(ワークフローで自動的に作られるコミットの)自分の名前\\nTaro Yamada\\n\\n\\nGIT_MAIL\\n(ワークフローで自動的に作られるコミットの)自分のメールアドレス\\nbasd4g@example.com\\n\\n\\n\\n4. 記事をダウンロードするワークフローを追加する\\n記事をダウンロードする GitHub Actions ワークフローを追加する。\\nワークフローは GitHub リポジトリのWebページ上からも追加できる。\\n\\n\\n.github/workflows/pull.yaml に次の内容を記述する\\nname: Pull\\n\\non:\\n push:\\n branches: [ master ]\\n\\njobs:\\n pull:\\n runs-on: ubuntu-latest\\n\\n steps:\\n - uses: actions/checkout@v2\\n\\n - name: Deploy and Commit\\n env:\\n HATENA_USER_ID: ${{ secrets.HATENA_USER }}\\n HATENA_BLOG_ID: ${{ secrets.HATENA_BLOG_ID }}\\n HATENA_API_KEY: ${{ secrets.HATENA_API_KEY }}\\n GIT_NAME: ${{ secrets.GIT_NAME }}\\n GIT_MAIL: ${{ secrets.GIT_MAIL }}\\n REPO_OWNER: ${{ github.repository_owner }}\\n run: |\\n cd ${GITHUB_WORKSPACE}\\n\\n # コミットのためのgitの設定\\n echo \'git initialize\'\\n git config --global user.name \\"${GIT_NAME}\\"\\n git config --global user.email \\"${GIT_MAIL}\\"\\n git remote set-url origin \\"https://${REPO_OWNER}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\\"\\n echo \'gimonfu initialize\'\\n\\n # gimonfuの初期設定\\n npm init -y > /dev/null 2>&1\\n npm install gimonfu\\n echo \\"{\\\\\\"user_id\\\\\\":\\\\\\"${HATENA_USER_ID}\\\\\\",\\\\\\"blog_id\\\\\\":\\\\\\"${HATENA_BLOG_ID}\\\\\\",\\\\\\"api_key\\\\\\":\\\\\\"${HATENA_API_KEY}\\\\\\"}\\" > .gimonfu.json\\n\\n # 新しい/更新された記事をダウンロード\\n echo \'gimonfu pull\'\\n npx gimonfu --git-commit-date pull\\n\\n # コミットを作成する\\n git add entry\\n # This script will not make a commit if there are no changes.\\n if ! git diff --staged --exit-code --quiet; then \\\\\\n git commit -m \\"Pull articles (automatic commit)\\" ;\\\\\\n fi\\n\\n git push origin HEAD:master\\n\\n\\nコミットが GitHub 上にプッシュされると、ワークフローが走ってリポジトリに記事が反映される。\\n5. 記事をダウンロードするワークフローを定期実行させる\\n先程は初回だったので「master ブランチにプッシュしたときにワークフローを実行する」(=>はてなブログの内容を GitHub リポジトリに反映させる)設定にした。\\nここではワークフローの一部を書き換えて、1時間に一回ワークフローを実行させる。\\n.github/workflows/pull.yaml の内容を一部書き換える。\\n--- a/.github/workflows/pull.yaml\\n+++ b/.github/workflows/pull.yaml\\n@@ -1,8 +1,8 @@\\n name: Pull\\non:\\n- push:\\n- branches: [ master ]\\n+ schedule:\\n+ - cron: \'0 * * * *\'\\n\\njobs:\\npull:\\n\\n\\n6. 記事をアップロードするワークフローを追加する\\n.github/workflows/push.yamlに次の内容を記述してコミット、プッシュする。\\nname: Push\\n\\non:\\n push:\\n branches: [ master ]\\n\\njobs:\\n push:\\n runs-on: ubuntu-latest\\n\\n steps:\\n - uses: actions/checkout@v2\\n\\n - name: Deploy and Commit\\n env:\\n HATENA_USER_ID: ${{ secrets.HATENA_USER }}\\n HATENA_BLOG_ID: ${{ secrets.HATENA_BLOG_ID }}\\n HATENA_API_KEY: ${{ secrets.HATENA_API_KEY }}\\n GIT_NAME: ${{ secrets.GIT_NAME }}\\n GIT_MAIL: ${{ secrets.GIT_MAIL }}\\n REPO_OWNER: ${{ github.repository_owner }}\\n run: |\\n cd ${GITHUB_WORKSPACE}\\n\\n # コミットのためのgitの設定\\n echo \'git initialize\'\\n git config --global user.name \\"${GIT_NAME}\\"\\n git config --global user.email \\"${GIT_MAIL}\\"\\n git remote set-url origin \\"https://${REPO_OWNER}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\\"\\n\\n # gimonfuの初期設定\\n echo \'gimonfu initialize\'\\n npm init -y > /dev/null 2>&1\\n npm install gimonfu\\n echo \\"{\\\\\\"user_id\\\\\\":\\\\\\"${HATENA_USER_ID}\\\\\\",\\\\\\"blog_id\\\\\\":\\\\\\"${HATENA_BLOG_ID}\\\\\\",\\\\\\"api_key\\\\\\":\\\\\\"${HATENA_API_KEY}\\\\\\"}\\" > .gimonfu.json\\n\\n # 新しい/更新された記事をアップロード\\n echo \'gimonfu push\'\\n npx gimonfu --git-commit-date push\\n git add entry\\n\\n # コミットを作成する\\n # This script will not make a commit if there are no changes.\\n if ! git diff --staged --exit-code --quiet; then \\\\\\n git commit -m \\"Pull articles (automatic commit)\\" ;\\\\\\n fi\\n\\n git push origin HEAD:master\\n\\n\\n6. 記事の投稿と更新\\n以上の設定を行うと、GitHub のリポジトリとはてなブログの記事が同期できる。\\nGitHub 上の Markdown ファイルを上書きすると記事が更新されるし、新しい Markdown ファイルを追加すると記事が投稿される。\\nMarkdownファイルは次のような記述で始まる。\\n---\\ntitle: タイトル\\ndate: 2019-09-18T12:50:00.000Z\\nid: \\"26006613576772424\\"\\n---\\n記事本文が以降続く。\\n\\n\\n記事の冒頭に --- で挟んだYAML形式のメタ情報を付加する。\\nid: の行は新規投稿時には記述しない。投稿されると自動で付加される。\\nおわりに\\nブログ記事を Git で管理したいというモチベーションから CLI を作るまでに至った。\\nGitHub Actions のワークフローを登録しておけば、ローカルに gimonfu をインストールせずに使えるが、インストールして使うこともできる。\\n$ npm install -g gimonfuでインストールでき、使い方は README で説明している。\\nここまで読んでいただいてありがとうございました。\\nあなたのはてなブログ生活が捗ることを願っています。","guid":"https://memo.basd4g.net/posts/gimonfu/","isoDate":"2020-06-14T12:23:06.000Z"},{"title":"自作Cコンパイラの途中経過","link":"https://memo.basd4g.net/posts/willani-compliperbook-finished/","pubDate":"Tue, 09 Jun 2020 17:00:06 +0900","content":"<h2 id=\\"cコンパイラ自作の進捗\\">Cコンパイラ自作の進捗</h2>\\n<p><a href=\\"https://memo.basd4g.net/posts/willani-start/\\">以前の記事</a>に書いたとおり、C言語のコンパイラを自作している。</p>\\n<p>セルフホストには至ってないが、教科書であるオンラインブック<a href=\\"https://www.sigbus.info/compilerbook\\"target=\\"_blank\\">「低レイヤを知りたい人のためのCコンパイラ作成入門」</a>の内容が一通り実装し終わったので経過報告をする。</p>\\n<p>裏で最初は毎日記録をつけていたのだが、だんだん面倒くさくなってやめたので、コミット履歴を見ながら振り返る。</p>\\n<p>最初のコミットは19日前(5/21)なので、そろそろ三週間経ったところだ。\\n5/28-30の三日間以外は何かしらコミットしているので、継続的に開発できている。もっともバイトや授業に遮られることがなく、時間がたくさんあるのでできることであるが。</p>\\n<p>ここまでのマイルストーンとしては、次の機能開発があった。</p>\\n<ul>\\n<li>分岐,繰り返し処理ができる</li>\\n<li>関数定義ができる</li>\\n<li>型情報が付加される(完全なサブセットをコンパイルできるようになる)</li>\\n<li>テストをCで書き直す</li>\\n</ul>\\n<p>テストをCで書き直す(<a href=\\"https://www.sigbus.info/compilerbook#%E3%82%B9%E3%83%86%E3%83%83%E3%83%9728-%E3%83%86%E3%82%B9%E3%83%88%E3%82%92c%E3%81%A7%E6%9B%B8%E3%81%8D%E7%9B%B4%E3%81%99\\"target=\\"_blank\\">オンラインブックStep28</a>)\\nところでバグが結構見つかって一つ一つ潰すのに時間がかかった。<br>\\nでもこの頃はGDBの基本的な使い方に慣れてきて、更に当たりをつけてアセンブリを読むことができたので、最初の頃より全然楽だった。</p>\\n<p>テストファイルをCで書き直し、これを自作コンパイラでコンパイルすると10000万行(デバッグ情報含む)くらいのアセンブリになった。\\nこれくらいの規模のプログラムがうまく実行できると、人間を超えていく感じがして楽しい。</p>\\n<h2 id=\\"狭いスコープのローカル変数\\">狭いスコープのローカル変数</h2>\\n<p>ブロックスコープ内の変数の実装方法は自分で考えたものなのだが、結構うまくできたと思っている。</p>\\n<p><a href=\\"https://github.com/basd4g/willani\\"target=\\"_blank\\">willani</a>には変数一つを表す構造体があり、これをつなげた2つの単方向リストがそれぞれ、グローバル変数とローカル変数を表している。</p>\\n<p>スコープのある変数を実装するには次の2つのことを考慮する必要がある。</p>\\n<ol>\\n<li>変数を定義するときは、同じスコープの重複した変数名を許さない。</li>\\n<li>変数を呼び出すときは、同じ名前の変数のなかで、その式が属するスコープのうちもっとも狭いスコープの変数を指す。</li>\\n</ol>\\n<p>トークン列をパースするときに次のような方法で 1. 2. を実現した。<br>\\nなお、私の実装ではブロックスコープの変数はローカル変数の単方向リストに含む。</p>\\n<ol>\\n<li>\\n<p>新しいスコープに入るときに、その前最後に定義されたローカル変数をのポインタを<code>out_of_scope</code>として記録する。<br>\\n変数定義するときは、単方向リストを先頭(最新)から<code>out_of_scope</code>の前までみて、同じ名前のものがないか調べる。</p>\\n</li>\\n<li>\\n<p>変数を定義するとき、<code>Var.referable = true</code>というフラグを立てる。<br>\\nスコープを出るときに、そのスコープで定義した全ての変数 (<code>out_of_scope</code>より新しい定義の変数) のフラグを下げる。(<code>false</code>をセットする。)<br>\\n以後呼び出す変数を探すときにフラグが<code>false</code>なものをスキップさせる。</p>\\n</li>\\n</ol>\\n<p>こうすることで、最新に定義した変数から順番に調べていけば、「1. その変数を定義してよいか」「2. 同名の異なる変数のうちどの変数を指しているか」がわかる。</p>\\n<p>リストには全てのローカル変数が残っているので、コード生成時に変数の領域を確保するのが簡単だし、パース時にどの変数を指し示すか解釈しておけばコード生成時は変数名の重複を考える必要がない。</p>\\n<h2 id=\\"今後の展望\\">今後の展望</h2>\\n<p>植山類さんのコンパイラ実装である <a href=\\"https://github.com/rui314/9cc\\"target=\\"_blank\\">9cc</a> や <a href=\\"https://github.com/rui314/chibicc\\"target=\\"_blank\\">chibicc</a> 等のコミットログをみて、セルフホストをするためにはあと1倍くらい、完成まではさらに1倍くらいの手間がかかるのではないかと予想している。</p>\\n<p>セルフホストに必要そうな機能は次の通り。</p>\\n<ul>\\n<li>構造体</li>\\n<li>&lsquo;-&gt;&rsquo;</li>\\n<li>typedef</li>\\n<li>プリプロセス</li>\\n<li>bool型</li>\\n<li>void型</li>\\n<li>enum</li>\\n<li>char literal</li>\\n<li>(file scope function)</li>\\n<li>switch</li>\\n<li>&lsquo;++&rsquo;, &lsquo;&ndash;&rsquo;</li>\\n<li>&lsquo;+=&rsquo;</li>\\n<li>&lsquo;!&rsquo;</li>\\n<li>&lsquo;&amp;&amp;\', &lsquo;||&rsquo;</li>\\n<li>&lsquo;break&rsquo;</li>\\n<li>&lsquo;continue&rsquo;</li>\\n<li>&lsquo;extern&rsquo;</li>\\n<li>&lsquo;NULL&rsquo;</li>\\n<li>(3項演算子)</li>\\n<li>(可変長引数関数の定義)</li>\\n</ul>\\n<p>(括弧がついてるのはサボろうか迷っているもの。\\n特定の文法を自分のコードから削除して書き換えてしまえば、その文法に対応しなくてもセルフホストできてしまう)</p>\\n<p>構造体とプリプロセスが時間かかりそうだなと見ている。</p>\\n<p>Cの仕様書をどこまで実装するかは考えものだが、セルフホストはやっぱり楽しみ。</p>\\n<p>Webのフロントエンドをはじめとする物々にも手を付けねばと思っているし、研究室の論文も読まねばと思っているので、今後はバランスも考えてやっていきたい。</p>\\n<hr>\\n<p>追記: (2020/10/04) 以前の記事へのリンクを相対リンクに修正</p>","contentSnippet":"Cコンパイラ自作の進捗\\n以前の記事に書いたとおり、C言語のコンパイラを自作している。\\nセルフホストには至ってないが、教科書であるオンラインブック「低レイヤを知りたい人のためのCコンパイラ作成入門」の内容が一通り実装し終わったので経過報告をする。\\n裏で最初は毎日記録をつけていたのだが、だんだん面倒くさくなってやめたので、コミット履歴を見ながら振り返る。\\n最初のコミットは19日前(5/21)なので、そろそろ三週間経ったところだ。\\n5/28-30の三日間以外は何かしらコミットしているので、継続的に開発できている。もっともバイトや授業に遮られることがなく、時間がたくさんあるのでできることであるが。\\nここまでのマイルストーンとしては、次の機能開発があった。\\n分岐,繰り返し処理ができる\\n関数定義ができる\\n型情報が付加される(完全なサブセットをコンパイルできるようになる)\\nテストをCで書き直す\\nテストをCで書き直す(オンラインブックStep28)\\nところでバグが結構見つかって一つ一つ潰すのに時間がかかった。\\nテストファイルをCで書き直し、これを自作コンパイラでコンパイルすると10000万行(デバッグ情報含む)くらいのアセンブリになった。\\nこれくらいの規模のプログラムがうまく実行できると、人間を超えていく感じがして楽しい。\\n狭いスコープのローカル変数\\nブロックスコープ内の変数の実装方法は自分で考えたものなのだが、結構うまくできたと思っている。\\nwillaniには変数一つを表す構造体があり、これをつなげた2つの単方向リストがそれぞれ、グローバル変数とローカル変数を表している。\\nスコープのある変数を実装するには次の2つのことを考慮する必要がある。\\n変数を定義するときは、同じスコープの重複した変数名を許さない。\\n変数を呼び出すときは、同じ名前の変数のなかで、その式が属するスコープのうちもっとも狭いスコープの変数を指す。\\nトークン列をパースするときに次のような方法で 1. 2. を実現した。\\n新しいスコープに入るときに、その前最後に定義されたローカル変数をのポインタをout_of_scopeとして記録する。\\nout_of_scopeの前までみて、同じ名前のものがないか調べる。\\n変数を定義するとき、Var.referable = trueというフラグを立てる。\\nout_of_scopeより新しい定義の変数) のフラグを下げる。(falseをセットする。)\\nfalseなものをスキップさせる。\\nこうすることで、最新に定義した変数から順番に調べていけば、「1. その変数を定義してよいか」「2. 同名の異なる変数のうちどの変数を指しているか」がわかる。\\nリストには全てのローカル変数が残っているので、コード生成時に変数の領域を確保するのが簡単だし、パース時にどの変数を指し示すか解釈しておけばコード生成時は変数名の重複を考える必要がない。\\n今後の展望\\n植山類さんのコンパイラ実装である 9cc や chibicc 等のコミットログをみて、セルフホストをするためにはあと1倍くらい、完成まではさらに1倍くらいの手間がかかるのではないかと予想している。\\nセルフホストに必要そうな機能は次の通り。\\n構造体\\n‘->’\\ntypedef\\nプリプロセス\\nbool型\\nvoid型\\nenum\\nchar literal\\n(file scope function)\\nswitch\\n‘++’, ‘–’\\n‘+=’\\n‘!’\\n‘&&\', ‘||’\\n‘break’\\n‘continue’\\n‘extern’\\n‘NULL’\\n(3項演算子)\\n(可変長引数関数の定義)\\n(括弧がついてるのはサボろうか迷っているもの。\\n特定の文法を自分のコードから削除して書き換えてしまえば、その文法に対応しなくてもセルフホストできてしまう)\\n構造体とプリプロセスが時間かかりそうだなと見ている。\\nCの仕様書をどこまで実装するかは考えものだが、セルフホストはやっぱり楽しみ。\\nWebのフロントエンドをはじめとする物々にも手を付けねばと思っているし、研究室の論文も読まねばと思っているので、今後はバランスも考えてやっていきたい。\\n追記: (2020/10/04) 以前の記事へのリンクを相対リンクに修正","guid":"https://memo.basd4g.net/posts/willani-compliperbook-finished/","isoDate":"2020-06-09T08:00:06.000Z"},{"title":"Zeit Now を使って、express.jsで書かれたアプリケーションを独自ドメインで公開する","link":"https://memo.basd4g.net/posts/zeit-now/","pubDate":"Sun, 31 May 2020 16:44:33 +0900","content":"<p>now という PaaS がある。</p>\\n<p>Node.js で書かれたアプリケーションを、無料で3つまでホスティングできるらしい。</p>\\n<p>heroku を無料プランで使うと、dyno の立ち上げに30秒くらいかかるので、Web サーバとしては致命的に遅い。\\n一方 zeit はそのような待ち時間は発生しない。(どこかに、AWS Lambda を中で使っていると書いてあった気がする)</p>\\n<p>今回はシンプルな express.js のアプリケーションを now でホスティングする手順。</p>\\n<h2 id=\\"インストール\\">インストール</h2>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ mkdir now-app\\n$ <span class=\\"nb\\">cd</span> now-app\\n$ yarn init\\n$ yarn global add now\\n$ yarn add express\\n$ touch index.js\\n$ touch now.json\\n</code></pre></div><h2 id=\\"アプリケーションを作る\\">アプリケーションを作る</h2>\\n<p>index.js に次のように記入</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-index.js\\" data-lang=\\"index.js\\"><span class=\\"sb\\">`use strict`</span>\\n<span class=\\"kr\\">const</span> <span class=\\"nx\\">express</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">require</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;express&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"kr\\">const</span> <span class=\\"nx\\">app</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">express</span><span class=\\"p\\">();</span>\\n<span class=\\"nx\\">app</span><span class=\\"p\\">.</span><span class=\\"nx\\">get</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;/*&#39;</span><span class=\\"p\\">,</span> <span class=\\"p\\">(</span><span class=\\"nx\\">req</span><span class=\\"p\\">,</span><span class=\\"nx\\">res</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">res</span><span class=\\"p\\">.</span><span class=\\"nx\\">send</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello, world!&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">res</span><span class=\\"p\\">.</span><span class=\\"nx\\">end</span><span class=\\"p\\">();</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"kr\\">const</span> <span class=\\"nx\\">port</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">process</span><span class=\\"p\\">.</span><span class=\\"nx\\">env</span><span class=\\"p\\">.</span><span class=\\"nx\\">PORT</span> <span class=\\"o\\">||</span> <span class=\\"mi\\">3000</span><span class=\\"p\\">;</span>\\n<span class=\\"c1\\">// ポート番号は上記のように環境変数から読み込むこと\\n</span><span class=\\"c1\\"></span><span class=\\"nx\\">app</span><span class=\\"p\\">.</span><span class=\\"nx\\">listen</span><span class=\\"p\\">(</span><span class=\\"mi\\">3000</span><span class=\\"p\\">,</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"sb\\">`listening on port </span><span class=\\"si\\">${</span><span class=\\"nx\\">port</span><span class=\\"si\\">}</span><span class=\\"sb\\">`</span><span class=\\"p\\">));</span>\\n</code></pre></div><h2 id=\\"now-の設定\\">now の設定</h2>\\n<p>事前に、node.js のアプリケーションであることを指定しなければならない。</p>\\n<p>何もしないと静的ホスティングと判断され、アプリケーションのソースコードを写した Web ページがデプロイされる。</p>\\n<p>now.json に次のように記入</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-now.json\\" data-lang=\\"now.json\\"><span class=\\"p\\">{</span>\\n<span class=\\"nt\\">&#34;version&#34;</span><span class=\\"p\\">:</span> <span class=\\"mi\\">2</span><span class=\\"p\\">,</span>\\n<span class=\\"nt\\">&#34;builds&#34;</span><span class=\\"p\\">:</span> <span class=\\"p\\">[{</span> <span class=\\"nt\\">&#34;src&#34;</span><span class=\\"p\\">:</span> <span class=\\"s2\\">&#34;index.js&#34;</span><span class=\\"p\\">,</span> <span class=\\"nt\\">&#34;use&#34;</span><span class=\\"p\\">:</span> <span class=\\"s2\\">&#34;@now/node&#34;</span> <span class=\\"p\\">}],</span>\\n<span class=\\"nt\\">&#34;routes&#34;</span><span class=\\"p\\">:</span> <span class=\\"p\\">[{</span> <span class=\\"nt\\">&#34;src&#34;</span><span class=\\"p\\">:</span> <span class=\\"s2\\">&#34;(.*)&#34;</span><span class=\\"p\\">,</span> <span class=\\"nt\\">&#34;dest&#34;</span><span class=\\"p\\">:</span> <span class=\\"s2\\">&#34;index.js&#34;</span> <span class=\\"p\\">}]</span>\\n<span class=\\"p\\">}</span>\\n</code></pre></div><h2 id=\\"npm-scriptの設定\\">npm scriptの設定</h2>\\n<p>now が実行時に index.js を実行してくれるように、package.json に次の項目を追加</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-package.json\\" data-lang=\\"package.json\\"><span class=\\"p\\">{</span>\\n<span class=\\"nt\\">&#34;scripts&#34;</span><span class=\\"p\\">:</span> <span class=\\"p\\">{</span>\\n<span class=\\"nt\\">&#34;start&#34;</span><span class=\\"p\\">:</span> <span class=\\"s2\\">&#34;node index.js&#34;</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"p\\">}</span>\\n</code></pre></div><h2 id=\\"デプロイ\\">デプロイ</h2>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ now\\n<span class=\\"c1\\"># 対話にしたがってメールを入れると、ログインリンクのついたメールが届くので、クリックして認証。</span>\\n</code></pre></div><h2 id=\\"独自ドメインサブドメインを登録\\">独自ドメイン(サブドメイン)を登録</h2>\\n<p>以下、現在<code>hogehoge-hogehoge.now.sh</code>で公開されていて、<code>hogehoge.example.com</code>でアクセスできるようにするときの設定。</p>\\n<p>まずは親のドメインをzeitに登録する</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ now domains add example.com\\n</code></pre></div><p>ドメインの所有者認証を行う</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ now domains verify example.com\\n</code></pre></div><p>すると、DNSに何も設定していないので失敗する。\\nどう設定すべきか表示されるので 画面に表示される通り、DNSに登録する。\\nついでに先にお目当てのサブドメインの CNAME も登録しておく。</p>\\n<table>\\n<thead>\\n<tr>\\n<th>name</th>\\n<th>type</th>\\n<th>value</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>_now</td>\\n<td>TXT</td>\\n<td>表示されたキー</td>\\n</tr>\\n<tr>\\n<td>hogehoge</td>\\n<td>CNAME</td>\\n<td>alias.zeit.co</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>再度ドメインの所有者認証を行う</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ now domains verify example.com\\n</code></pre></div><p>サブドメインのエイリアスを設定する</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ now <span class=\\"nb\\">alias</span> https://hogehoge-hogehoge.now.sh hogehoge.example.com\\n</code></pre></div><h2 id=\\"おわりに\\">おわりに</h2>\\n<p>以上の手順と同様の作業で公開したリポジトリ: <a href=\\"https://github.com/basd4g/blog.yammer.fun\\"target=\\"_blank\\">blog.yammer.fun - GitHub basd4g</a></p>\\n<p>古いブログのURLをリダイレクトさせるために使った。</p>","contentSnippet":"now という PaaS がある。\\nNode.js で書かれたアプリケーションを、無料で3つまでホスティングできるらしい。\\nheroku を無料プランで使うと、dyno の立ち上げに30秒くらいかかるので、Web サーバとしては致命的に遅い。\\n一方 zeit はそのような待ち時間は発生しない。(どこかに、AWS Lambda を中で使っていると書いてあった気がする)\\n今回はシンプルな express.js のアプリケーションを now でホスティングする手順。\\nインストール\\n$ mkdir now-app\\n$ cd now-app\\n$ yarn init\\n$ yarn global add now\\n$ yarn add express\\n$ touch index.js\\n$ touch now.json\\n\\n\\nアプリケーションを作る\\nindex.js に次のように記入\\n`use strict`\\nconst express = require(\'express\');\\nconst app = express();\\napp.get(\'/*\', (req,res) => {\\nres.send(\'hello, world!\');\\nres.end();\\n})\\nconst port = process.env.PORT || 3000;\\n// ポート番号は上記のように環境変数から読み込むこと\\napp.listen(3000, () => console.log(`listening on port ${port}`));\\n\\n\\nnow の設定\\n事前に、node.js のアプリケーションであることを指定しなければならない。\\n何もしないと静的ホスティングと判断され、アプリケーションのソースコードを写した Web ページがデプロイされる。\\nnow.json に次のように記入\\n{\\n\\"version\\": 2,\\n\\"builds\\": [{ \\"src\\": \\"index.js\\", \\"use\\": \\"@now/node\\" }],\\n\\"routes\\": [{ \\"src\\": \\"(.*)\\", \\"dest\\": \\"index.js\\" }]\\n}\\n\\n\\nnpm scriptの設定\\nnow が実行時に index.js を実行してくれるように、package.json に次の項目を追加\\n{\\n\\"scripts\\": {\\n\\"start\\": \\"node index.js\\"\\n}\\n}\\n\\n\\nデプロイ\\n$ now\\n# 対話にしたがってメールを入れると、ログインリンクのついたメールが届くので、クリックして認証。\\n\\n\\n独自ドメイン(サブドメイン)を登録\\n以下、現在hogehoge-hogehoge.now.shで公開されていて、hogehoge.example.comでアクセスできるようにするときの設定。\\nまずは親のドメインをzeitに登録する\\n$ now domains add example.com\\n\\n\\nドメインの所有者認証を行う\\n$ now domains verify example.com\\n\\n\\nすると、DNSに何も設定していないので失敗する。\\nどう設定すべきか表示されるので 画面に表示される通り、DNSに登録する。\\nついでに先にお目当てのサブドメインの CNAME も登録しておく。\\nname\\ntype\\nvalue\\n\\n\\n\\n\\n_now\\nTXT\\n表示されたキー\\n\\n\\nhogehoge\\nCNAME\\nalias.zeit.co\\n\\n\\n\\n再度ドメインの所有者認証を行う\\n$ now domains verify example.com\\n\\n\\nサブドメインのエイリアスを設定する\\n$ now alias https://hogehoge-hogehoge.now.sh hogehoge.example.com\\n\\n\\nおわりに\\n以上の手順と同様の作業で公開したリポジトリ: blog.yammer.fun - GitHub basd4g\\n古いブログのURLをリダイレクトさせるために使った。","guid":"https://memo.basd4g.net/posts/zeit-now/","isoDate":"2020-05-31T07:44:33.000Z"},{"title":"デスクトップLinuxでCPUの状況を確認する","link":"https://memo.basd4g.net/posts/linux-cpu/","pubDate":"Sat, 30 May 2020 11:46:49 +0900","content":"<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ cat /proc/cpuinfo\\n<span class=\\"c1\\"># CPUの各スレッドごとの情報を含んだファイルを表示する</span>\\n$ nproc\\n<span class=\\"c1\\"># CPUのスレッド数(プロセッサの数)を表示する</span>\\n$ top\\n<span class=\\"c1\\"># CPU使用率の高い順にプロセスを表示する。定期的に内容は再描画される。</span>\\n</code></pre></div><p>参考: <a href=\\"https://youtu.be/etZrDmrD5Q0\\"target=\\"_blank\\">CPU and Linux - Youtube Satoru Takeuchi</a></p>","contentSnippet":"$ cat /proc/cpuinfo\\n# CPUの各スレッドごとの情報を含んだファイルを表示する\\n$ nproc\\n# CPUのスレッド数(プロセッサの数)を表示する\\n$ top\\n# CPU使用率の高い順にプロセスを表示する。定期的に内容は再描画される。\\n\\n\\n参考: CPU and Linux - Youtube Satoru Takeuchi","guid":"https://memo.basd4g.net/posts/linux-cpu/","isoDate":"2020-05-30T02:46:49.000Z"},{"title":"非同期のまえに同期処理を通してPromiseとasync/awaitを理解する","link":"https://qiita.com/basd4g/items/b1c96de727a53c4b4698","pubDate":"2020-05-29T17:00:50.000Z","author":"basd4g","content":"<p>JavaScript といえば非同期処理はつきものだが、非同期や Promise に苦手意識を持つ人も多いのではないだろうか。</p>\\n\\n<p>これらの最初の理解のハードルは結構高いと思う。私も理解できずに悶絶した。C言語のポインタよりむずくないか？。。。</p>\\n\\n<p>この記事の前半では一旦非同期のことは忘れる。<br>\\nまず記事前半は、同期処理をテーマに、コールバック, Promise, async/await について説明する。<br>\\n記事の後半は、これらを非同期処理を交えて説明する。</p>\\n\\n<p>Promise はよくわからないという方や、一度挫折した方などにぜひ読んでもらいたい。</p>\\n\\n<h2>\\n<span id=\\"対象読者\\" class=\\"fragment\\"></span><a href=\\"#%E5%AF%BE%E8%B1%A1%E8%AA%AD%E8%80%85\\"><i class=\\"fa fa-link\\"></i></a>対象読者</h2>\\n\\n<ul>\\n<li>JavaScript の基本的文法を知っている。(調べればわかる)</li>\\n<li>非同期処理, コールバック, Promise, async/awaitに苦手意識がある、よくわからない。</li>\\n</ul>\\n\\n<p>JavaScriptを1行も読んだことも書いたこともない人、プログラミングをしたことのない人は対象としない。<br>\\n逆に少しでも読み書きできればオーケー、のつもり。</p>\\n\\n<h2>\\n<span id=\\"目指すところ\\" class=\\"fragment\\"></span><a href=\\"#%E7%9B%AE%E6%8C%87%E3%81%99%E3%81%A8%E3%81%93%E3%82%8D\\"><i class=\\"fa fa-link\\"></i></a>目指すところ</h2>\\n\\n<ul>\\n<li>同期処理と非同期処理の違いがわかる</li>\\n<li>(非同期処理を対象とした) 他の Promise, async/await の解説記事を読んで理解が進む</li>\\n</ul>\\n\\n<h2>\\n<span id=\\"step0-アロー関数\\" class=\\"fragment\\"></span><a href=\\"#step0-%E3%82%A2%E3%83%AD%E3%83%BC%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>Step0 アロー関数</h2>\\n\\n<p>最近の JavaScript (ES6~) ではアロー関数という記法がある。<br>\\nアロー関数がわからない人も、この記事出てくるので簡単に抑えておきたい。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"c1\\">// 従来の書き方</span>\\n<span class=\\"kd\\">function</span> <span class=\\"nx\\">sum</span> <span class=\\"p\\">(</span> <span class=\\"nx\\">a</span><span class=\\"p\\">,</span> <span class=\\"nx\\">b</span> <span class=\\"p\\">)</span> <span class=\\"p\\">{</span>\\n  <span class=\\"k\\">return</span> <span class=\\"nx\\">a</span> <span class=\\"o\\">+</span> <span class=\\"nx\\">b</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">}</span>\\n\\n<span class=\\"c1\\">// アロー関数</span>\\n<span class=\\"kd\\">const</span> <span class=\\"nx\\">sum2</span> <span class=\\"o\\">=</span> <span class=\\"p\\">(</span> <span class=\\"nx\\">a</span><span class=\\"p\\">,</span> <span class=\\"nx\\">b</span> <span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"k\\">return</span> <span class=\\"nx\\">a</span> <span class=\\"o\\">+</span> <span class=\\"nx\\">b</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">};</span>\\n\\n<span class=\\"c1\\">// アロー関数 関数の中がreturn文だけのときは、{return}を省略できる</span>\\n<span class=\\"kd\\">const</span> <span class=\\"nx\\">sum3</span> <span class=\\"o\\">=</span> <span class=\\"p\\">(</span> <span class=\\"nx\\">a</span><span class=\\"p\\">,</span> <span class=\\"nx\\">b</span> <span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"nx\\">a</span> <span class=\\"o\\">+</span> <span class=\\"nx\\">b</span><span class=\\"p\\">;</span>\\n\\n<span class=\\"c1\\">// アロー関数 引数が1つのときだけ()が省略できる (0つ、2つ以上はダメ)</span>\\n<span class=\\"kd\\">const</span> <span class=\\"nx\\">twice</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">a</span> <span class=\\"o\\">=&gt;</span> <span class=\\"nx\\">a</span><span class=\\"o\\">*</span><span class=\\"mi\\">2</span><span class=\\"p\\">;</span>\\n</pre></div></div>\\n\\n<p>本記事では、上のように書けるということだけわかれば大丈夫。</p>\\n\\n<h2>\\n<span id=\\"step1-同期処理\\" class=\\"fragment\\"></span><a href=\\"#step1-%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86\\"><i class=\\"fa fa-link\\"></i></a>Step1 同期処理</h2>\\n\\n<p>まずは非同期のことはわすれて、とりあえず読み進めて欲しい。</p>\\n\\n<h3>\\n<span id=\\"step1-1-コールバック-同期関数\\" class=\\"fragment\\"></span><a href=\\"#step1-1-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF-%E5%90%8C%E6%9C%9F%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>Step1-1 コールバック (同期関数)</h3>\\n\\n<p>コールバックとは、関数自体を引数として与え、別の関数に実行してもらうしくみだ。<br>\\n電話を折り返すことに由来して名付けられた。<br>\\n由来の通り、関数自体を伝えて「あとで都合が良くなったら実行しておいて」と実行を押し付ける方式。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">function</span> <span class=\\"nx\\">callbackFunc</span><span class=\\"p\\">()</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">callback</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">}</span>\\n\\n<span class=\\"kd\\">function</span> <span class=\\"nx\\">callFunc</span> <span class=\\"p\\">(</span> <span class=\\"nx\\">func</span> <span class=\\"p\\">)</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">func</span><span class=\\"p\\">();</span>\\n<span class=\\"p\\">}</span>\\n\\n<span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">callbackFunc</span> <span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p>ふつう、関数callbackFuncを実行するなら<code>callbackFunc()</code>のようにするだろう。<br>\\nしかし上記では括弧をつけず<code>callbackFunc</code> を引数として渡している。</p>\\n\\n<p>括弧をつけないことで、引数として関数自体を渡すだけでその場では実行されない。<br>\\n後に callFunc 関数の中で、渡された関数<code>callbackFunc</code>を実行してもらっている。</p>\\n\\n<p>この「関数自体を渡す」というのがコールバックの肝である。<br>\\nコールバックとは(戻り値の)値渡しではなく、関数自体の参照を渡しているという表現もできる。</p>\\n\\n<p>次のような書き方では全く意味が変わってしまうので注意。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">callbackFunc</span><span class=\\"p\\">()</span> <span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p>これでは、callbackFunc 関数を実行し、その戻り値を callFunc 関数に引数として渡すという意味になってしまう。</p>\\n\\n<p>繰り返しになるが、コールバックは「関数自体を渡して」「あとで実行してもらう」しくみである。</p>\\n\\n<p>参考: <a href=\\"https://developer.mozilla.org/ja/docs/Glossary/Callback_function\\" rel=\\"nofollow noopener\\" target=\\"_blank\\">Callback function(コールバック関数) MDN web docs</a></p>\\n\\n<h4>\\n<span id=\\"補足-コールバックとアロー関数\\" class=\\"fragment\\"></span><a href=\\"#%E8%A3%9C%E8%B6%B3-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%A8%E3%82%A2%E3%83%AD%E3%83%BC%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>(補足) コールバックとアロー関数</h4>\\n\\n<p>ちなみに上述のコードはアロー関数を使って次のようにも書ける。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">callbackFunc</span> <span class=\\"o\\">=</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">callback</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">};</span>\\n\\n<span class=\\"kd\\">function</span> <span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">func</span> <span class=\\"p\\">)</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">func</span><span class=\\"p\\">();</span>\\n<span class=\\"p\\">}</span>\\n\\n<span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">callbackFunc</span> <span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p>さらに、一度変数に入れるのをやめると</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">function</span> <span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">func</span> <span class=\\"p\\">)</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">func</span><span class=\\"p\\">();</span>\\n<span class=\\"p\\">}</span>\\n\\n<span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">callback</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</pre></div></div>\\n\\n<p>引数を指定する中で関数を定義してしまうのだ。<br>\\nこのように関数自体を引数で渡すとき(即ちコールバック関数を渡すとき)、アロー関数でシンプルにかける。</p>\\n\\n<h3>\\n<span id=\\"step1-2-promise-同期関数\\" class=\\"fragment\\"></span><a href=\\"#step1-2-promise-%E5%90%8C%E6%9C%9F%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>Step1-2 Promise (同期関数)</h3>\\n\\n<p>Promise は英語で「約束する」という意味だ。<br>\\n名前の通り、あとで値を返すことを約束するような動作をする。(約束を破ることもある。)</p>\\n\\n<h4>\\n<span id=\\"promise-の状態\\" class=\\"fragment\\"></span><a href=\\"#promise-%E3%81%AE%E7%8A%B6%E6%85%8B\\"><i class=\\"fa fa-link\\"></i></a>Promise の状態</h4>\\n\\n<p>Promise には3つの状態がある。</p>\\n\\n<ul>\\n<li>pending ... 約束している状態(初期状態)</li>\\n<li>fulfilled ... 約束を守って値を返した状態</li>\\n<li>rejected ... 約束を破った状態</li>\\n</ul>\\n\\n<p>Promise オブジェクトはまず pending で始まり、あとで fulfilled や rejected に状態が変化する。</p>\\n\\n<h5>\\n<span id=\\"状態-pending\\" class=\\"fragment\\"></span><a href=\\"#%E7%8A%B6%E6%85%8B-pending\\"><i class=\\"fa fa-link\\"></i></a>状態: pending</h5>\\n\\n<p>とりあえず約束してみる。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"p\\">});</span>\\n<span class=\\"c1\\">// 何もしない関数を、new Promise() に渡している。</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p>pendingと表示されただろう。</p>\\n\\n<p><em>ここでの変数<code>promise</code>は、Promise の状態 pending といえる。</em></p>\\n\\n<h5>\\n<span id=\\"状態-fulfilled\\" class=\\"fragment\\"></span><a href=\\"#%E7%8A%B6%E6%85%8B-fulfilled\\"><i class=\\"fa fa-link\\"></i></a>状態: fulfilled</h5>\\n\\n<p>次は fulfilled の状態を作ってみる。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">resolve</span><span class=\\"p\\">();</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n<span class=\\"c1\\">// 実はresolve,rejectはそれぞれ、渡された(コールバック)関数を引数として受け取っている。</span>\\n</pre></div></div>\\n\\n<p>Promise resoleved と表示されただろう。これが fulfilled である。</p>\\n\\n<p>実は状態 fulfilled は値を持つ。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p><em>ここでの変数<code>promise</code>は、Promiseの状態 fulfilled であり、値<code>\'hello\'</code>を持つといえる。</em></p>\\n\\n<h5>\\n<span id=\\"状態-rejected\\" class=\\"fragment\\"></span><a href=\\"#%E7%8A%B6%E6%85%8B-rejected\\"><i class=\\"fa fa-link\\"></i></a>状態: rejected</h5>\\n\\n<p>rejected も fulfilled と同様に値を持つ。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">reject</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p><em>ここでの変数<code>promise</code>は、Promise の状態 rejected であり、値<code>\'hello\'</code>を持つといえる。</em></p>\\n\\n<p>rejected で渡される値(オブジェクト)は Error オブジェクトだったりする。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">reject</span><span class=\\"p\\">(</span><span class=\\"k\\">new</span> <span class=\\"nb\\">Error</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">error message</span><span class=\\"dl\\">\'</span><span class=\\"p\\">));</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p><em>ここでの変数<code>promise</code>は、Promise の状態 rejected であり、値に Error オブジェクトを持つといえる。</em></p>\\n\\n<h4>\\n<span id=\\"状態の変化\\" class=\\"fragment\\"></span><a href=\\"#%E7%8A%B6%E6%85%8B%E3%81%AE%E5%A4%89%E5%8C%96\\"><i class=\\"fa fa-link\\"></i></a>状態の変化</h4>\\n\\n<p>Promiseでは状態が変化する。<br>\\n初期状態では pending であるが、のちに fulfilled や rejected になる。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"c1\\">//この行が実行されるタイミングでは、変数promiseは状態pending</span>\\n  <span class=\\"k\\">if</span><span class=\\"p\\">(</span> <span class=\\"kc\\">true</span> <span class=\\"p\\">){</span>\\n    <span class=\\"c1\\">//この行が実行されるタイミングでも、まだ変数promiseは状態pending</span>\\n    <span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">resolveされた!</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n    <span class=\\"c1\\">//この行が実行されるタイミングでは、変数promiseは状態fulfilledで値\'resolveされた!\'を持つ</span>\\n    <span class=\\"k\\">return</span><span class=\\"p\\">;</span>\\n  <span class=\\"p\\">}</span>\\n  <span class=\\"c1\\">// ここから先は実行されない</span>\\n  <span class=\\"nx\\">reject</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">rejectされた</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</pre></div></div>\\n\\n<p>現在は同期処理を行っているので、fulfill または reject された状態に一瞬で変化してしまい、 pending の状態をみることはできない。</p>\\n\\n<p>しかし厳密にはもともとは pending で、 <code>resolve()</code>を実行すると fulfilled に、 <code>reject()</code> を実行すると rejected に、それぞれ状態が移行する。</p>\\n\\n<h4>\\n<span id=\\"thencatch-による-promise-チェーン\\" class=\\"fragment\\"></span><a href=\\"#thencatch-%E3%81%AB%E3%82%88%E3%82%8B-promise-%E3%83%81%E3%82%A7%E3%83%BC%E3%83%B3\\"><i class=\\"fa fa-link\\"></i></a>then/catch による Promise チェーン</h4>\\n\\n<p>さて、Promise には3状態あり、変化することがわかった。<br>\\n変化すると何ができるのか？ それをこの節で説明する。</p>\\n\\n<p>Promise オブジェクトのメソッドに、then と catch がある。</p>\\n\\n<p>これらはそれぞれ第一引数に関数をとり、Promise が fulfilled や rejected の状態になると引数関数を実行する。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n\\n<span class=\\"nx\\">promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// ここではhelloが表示される</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">then is called</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</pre></div></div>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">reject</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n\\n<span class=\\"nx\\">promise</span><span class=\\"p\\">.</span><span class=\\"k\\">catch</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// ここではhelloが表示される</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">catch is called</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</pre></div></div>\\n\\n<p>このように<code>.</code>でつないで then/catch メソッドを呼べば、それらを発火できる。</p>\\n\\n<p>さらに、then/catch メソッドの戻り値に promise を与えてやれば、更に繋げられる。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n\\n<span class=\\"nx\\">promise</span>\\n  <span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n    <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">then is called</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n    <span class=\\"k\\">return</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">resolve!</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n  <span class=\\"p\\">})</span>\\n  <span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n    <span class=\\"k\\">return</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">+</span> <span class=\\"dl\\">\'</span><span class=\\"s1\\">!</span><span class=\\"dl\\">\'</span> <span class=\\"p\\">);</span>\\n  <span class=\\"p\\">})</span>\\n  <span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n    <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// resolve!! と表示される。</span>\\n  <span class=\\"p\\">})</span>\\n\\n<span class=\\"c1\\">// Promise.resolve(\'resolve!\'); は、</span>\\n<span class=\\"c1\\">// new Promise( resolve =&gt; { resolve(\'resolve!\') }); と同じ。</span>\\n</pre></div></div>\\n\\n<p>上述の通り、then メソッドの戻り値に Promise を渡すと、更に後ろに<code>.then()</code>を繋げられる。<br>\\n(<code>.catch()</code>も繋げられる。)</p>\\n\\n<p>このように、Promise が解決 (fulfill/reject) されたら<code>.then()</code>メソッドが発火し、<br>\\n<code>.then()</code>メソッドがPromiseを返すと、解決されたらさらに後ろの<code>.then()</code>メソッドが発火し、、、</p>\\n\\n<p>このように数珠つなぎに徐々に Promise が渡ることを Promise チェーンと呼ぶ。</p>\\n\\n<hr>\\n\\n<p>ここまでで Promise を学んだ。<br>\\nコールバックや Promise を使う理由は非同期関数にあるので、読者の皆様にはややこしいことをしているようにしか見えないかもしれない。</p>\\n\\n<p>本当はこのあたりで非同期関数について説明し Promise のありがたみを理解していただくのもよいのだが、この記事はあくまで「まず同期関数で理解する。」ことが目的であり、非同期関数はもう少し後回しにする。</p>\\n\\n<hr>\\n\\n<h3>\\n<span id=\\"step1-3-asyncawait-同期関数\\" class=\\"fragment\\"></span><a href=\\"#step1-3-asyncawait-%E5%90%8C%E6%9C%9F%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>Step1-3 async/await (同期関数)</h3>\\n\\n<p>次は sync/await だ。</p>\\n\\n<p>そのまえに説明すべきことが2つほどあるので補足。</p>\\n\\n<h4>\\n<span id=\\"補足-即時関数\\" class=\\"fragment\\"></span><a href=\\"#%E8%A3%9C%E8%B6%B3-%E5%8D%B3%E6%99%82%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>補足: 即時関数</h4>\\n\\n<p>即時関数は定義と同時に実行する関数だ。<br>\\n関数定義を括弧でくくると即時実行される。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">Hello</span> <span class=\\"o\\">=</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span> <span class=\\"p\\">};</span>\\n<span class=\\"nx\\">Hello</span><span class=\\"p\\">();</span>\\n\\n<span class=\\"c1\\">// 上2行のコードは、次の行のコードと同じ。</span>\\n<span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span> <span class=\\"p\\">});</span>\\n\\n<span class=\\"c1\\">// アロー関数でなくても良い</span>\\n<span class=\\"p\\">(</span> <span class=\\"kd\\">function</span> <span class=\\"p\\">()</span> <span class=\\"p\\">{</span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span> <span class=\\"p\\">});</span>\\n</pre></div></div>\\n\\n<h4>\\n<span id=\\"補足-async-関数-asnyc-function\\" class=\\"fragment\\"></span><a href=\\"#%E8%A3%9C%E8%B6%B3-async-%E9%96%A2%E6%95%B0-asnyc-function\\"><i class=\\"fa fa-link\\"></i></a>補足: Async 関数 (asnyc function)</h4>\\n\\n<p>関数定義の前に<code>async</code>とつけて定義する。<br>\\nAsnyc 関数の中でのみ await が使える。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"c1\\">// 例</span>\\n<span class=\\"kd\\">const</span> <span class=\\"nx\\">arrowFunc</span> <span class=\\"o\\">=</span> <span class=\\"k\\">async</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"k\\">await</span> <span class=\\"nx\\">promise</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"k\\">async</span> <span class=\\"kd\\">function</span> <span class=\\"nx\\">func</span><span class=\\"p\\">()</span> <span class=\\"p\\">{</span>\\n  <span class=\\"k\\">await</span> <span class=\\"nx\\">promise</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">}</span>\\n</pre></div></div>\\n\\n<hr>\\n\\n<h4>\\n<span id=\\"改めて-asyncawait-同期関数\\" class=\\"fragment\\"></span><a href=\\"#%E6%94%B9%E3%82%81%E3%81%A6-asyncawait-%E5%90%8C%E6%9C%9F%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>改めて async/await (同期関数)</h4>\\n\\n<p>閑話休題。</p>\\n\\n<p>async/await は Promise を生成する構文と言っていい。<br>\\n先程の then を書かずともよくなる構文である。</p>\\n\\n<p>前節の Promise のコードを再掲する。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n\\n<span class=\\"nx\\">promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// ここではhelloが表示される</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">then is called</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</pre></div></div>\\n\\n<p>これを async/await に書き直すと</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n\\n<span class=\\"p\\">(</span><span class=\\"k\\">async</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"kd\\">const</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=</span> <span class=\\"k\\">await</span> <span class=\\"nx\\">promise</span><span class=\\"p\\">;</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// ここではhelloが表示される</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">then is called</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</pre></div></div>\\n\\n<p>このようになる。<br>\\nthen が消えたことがわかる。</p>\\n\\n<p>(即時実行のasync関数を使っている。)</p>\\n\\n<p><br></p>\\n\\n<p>もう一つ前節のコードを再掲し async/await に書き換えてみる。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">})</span>\\n\\n<span class=\\"nx\\">promise</span>\\n  <span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n    <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">then is called</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span>\\n    <span class=\\"k\\">return</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">resolve!</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span>\\n  <span class=\\"p\\">})</span>\\n  <span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n    <span class=\\"k\\">return</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">+</span> <span class=\\"dl\\">\'</span><span class=\\"s1\\">!</span><span class=\\"dl\\">\'</span> <span class=\\"p\\">)</span>\\n  <span class=\\"p\\">})</span>\\n  <span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n    <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// resolve!! と表示される。</span>\\n  <span class=\\"p\\">})</span>\\n</pre></div></div>\\n\\n<p>async/await に書き換えると</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">})</span>\\n\\n<span class=\\"p\\">(</span> <span class=\\"k\\">async</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"kd\\">let</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=</span> <span class=\\"k\\">await</span> <span class=\\"nx\\">promise</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">then is called</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span>\\n  <span class=\\"kd\\">let</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=</span> <span class=\\"k\\">await</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">resolve!</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span>\\n  <span class=\\"kd\\">let</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=</span> <span class=\\"k\\">await</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">+</span> <span class=\\"dl\\">\'</span><span class=\\"s1\\">!</span><span class=\\"dl\\">\'</span> <span class=\\"p\\">)</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// resolve!! と表示される。</span>\\n<span class=\\"p\\">})</span>\\n</pre></div></div>\\n\\n<p>今度は then がなくなったことで短く書けたことが伝わるのではないか。</p>\\n\\n<p><code>await</code>が現れると、Async 関数内の<code>await</code>より後ろの部分が全て<code>then()</code>の引数として包まれる、といった見方もできる。</p>\\n\\n<p>以上のように、async/await は Promise を簡潔に書く構文である。</p>\\n\\n<p><br></p>\\n\\n<h4>\\n<span id=\\"余談-promiseは必要か\\" class=\\"fragment\\"></span><a href=\\"#%E4%BD%99%E8%AB%87-promise%E3%81%AF%E5%BF%85%E8%A6%81%E3%81%8B\\"><i class=\\"fa fa-link\\"></i></a>余談: Promiseは必要か?</h4>\\n\\n<p>async/awaitで簡潔にかけるなら、Promiseなんて理解しなくて良いのでは？と思う方もいるだろう。<br>\\nしかし今の所そうも行かないのだ。</p>\\n\\n<p>複数のPromiseを同時に待つ処理をasync/awaitで書いてみる。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"p\\">(</span> <span class=\\"k\\">async</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"k\\">await</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">all</span><span class=\\"p\\">(</span> <span class=\\"p\\">[</span> <span class=\\"nx\\">promise1</span><span class=\\"p\\">,</span> <span class=\\"nx\\">promise2</span> <span class=\\"p\\">])</span>\\n<span class=\\"p\\">})</span>\\n</pre></div></div>\\n\\n<p>うお、Promise出てきた。。。</p>\\n\\n<p>コードの内容はおいておいて、Promise という単語が出てきたことに注目。<br>\\n解説は省くが、async/await は Promise を完全には隠しきれていないのだ。</p>\\n\\n<p>(気になる方はこの記事を読み終えてから<a href=\\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise/all\\" rel=\\"nofollow noopener\\" target=\\"_blank\\"><code>Promise.all</code></a>をみると良いだろう。</p>\\n\\n<p><br></p>\\n\\n<h2>\\n<span id=\\"step2-非同期処理\\" class=\\"fragment\\"></span><a href=\\"#step2-%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86\\"><i class=\\"fa fa-link\\"></i></a>Step2 非同期処理</h2>\\n\\n<p>さてさて、ここまで来ればゴールは近い。<br>\\nこの節では今まで苦労して覚えた謎構文 Promise と asnyc/await のありがたみがわかるようになる。</p>\\n\\n<h3>\\n<span id=\\"step2-1-同期関数と非同期関数\\" class=\\"fragment\\"></span><a href=\\"#step2-1-%E5%90%8C%E6%9C%9F%E9%96%A2%E6%95%B0%E3%81%A8%E9%9D%9E%E5%90%8C%E6%9C%9F%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>Step2-1 同期関数と非同期関数</h3>\\n\\n<p>同期関数と非同期関数について説明する。</p>\\n\\n<ul>\\n<li>同期関数とは、中の処理が完了するまで待ってから戻り値を返す関数のこと</li>\\n<li>非同期関数とは、中の処理にかかわらず、すぐに戻り値を返してしまう関数のこと</li>\\n</ul>\\n\\n<p>JavaScript の代表的な非同期関数に<code>setTimeOut()</code>がある。</p>\\n\\n<p>次のようなコードで考えてみよう。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">world</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p>JavaScript は、普通は(同期関数は)、上から順番に1行ずつ実行される。</p>\\n\\n<p>しかし上記のコードを実行すると<code>world</code>が表示された後に<code>hello</code>が表示される。<br>\\nこれは<code>setTimeOut()</code>関数が非同期関数だからだ。</p>\\n\\n<p>書き方を少し変えてみる。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"kd\\">function</span> <span class=\\"nx\\">Hello</span><span class=\\"p\\">()</span> <span class=\\"p\\">{</span> <span class=\\"c1\\">// 1</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">hello</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// 4</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"nx\\">Hello</span><span class=\\"p\\">,</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// 2</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">world</span><span class=\\"dl\\">\'</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// 3</span>\\n</pre></div></div>\\n\\n<p>さっきと同じ動作をするコードだ。</p>\\n\\n<p>コンピュータの気持ちになってみると</p>\\n\\n<ol>\\n<li>Hello 関数を定義するよ。Hello 関数は実行されたら<code>\'hello\'</code>と表示するよ。まだ定義だけで実行しないよ。</li>\\n<li>setTimeOut 関数を実行するよ。Hello 関数を 1000ms 後に実行するとを登録するよ。<strong>登録するだけで、すぐに戻り値を返すよ。</strong>\\n</li>\\n<li>\\n<code>\'world\'</code>と表示するよ。</li>\\n</ol>\\n\\n<p>... しばらく (1000ms) 経って ...</p>\\n\\n<ol>\\n<li>Hello 関数を実行するよ、<code>\'hello\'</code>と表示するよ。</li>\\n</ol>\\n\\n<p>このような順で動作する。<br>\\n同期関数はその行で処理が停止するのに対し、非同期関数はすぐに次の行が実行される。</p>\\n\\n<h2>\\n<span id=\\"step2-2-コールバック-非同期関数\\" class=\\"fragment\\"></span><a href=\\"#step2-2-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF-%E9%9D%9E%E5%90%8C%E6%9C%9F%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>Step2-2 コールバック (非同期関数)</h2>\\n\\n<p>先程の例で非同期関数を実現してるのがコールバックだ。</p>\\n\\n<p>あとで実行して欲しい関数を引数で伝えておいて、ときが来たら実行する。</p>\\n\\n<p>やりたいことはコールバックで実現できるものの、何重にも重なると次のようなコードにになってしまう。</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n    <span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n      <span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n        <span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n          <span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n            <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">6s later</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n          <span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n        <span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n      <span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n    <span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n  <span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">これはすぐに実行される</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p>コールバック関数を呼ぶたびにネストが深くなってしまい読みづらい。</p>\\n\\n<p>俗に言うコールバック地獄である。<br>\\nたとえばこの例だと、どの秒数がどの setTimeOut に対応するのかわかりづらい。</p>\\n\\n<p>(上記の例は全て一つの setTimeOut にまとめられるが)<br>\\n実際には次のような状況が考えられる。</p>\\n\\n<ol>\\n<li>サーバと通信して、記事のリストをとってくる。</li>\\n<li>記事のリストから該当の記事を探して、再度サーバと通信して本文をとってくる。</li>\\n</ol>\\n\\n<p>このように、複数の非同期処理が数珠つなぎになることもあるだろう。</p>\\n\\n<p>数珠つなぎ、、、</p>\\n\\n<h2>\\n<span id=\\"step2-3-promise-非同期関数\\" class=\\"fragment\\"></span><a href=\\"#step2-3-promise-%E9%9D%9E%E5%90%8C%E6%9C%9F%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>Step2-3 Promise (非同期関数)</h2>\\n\\n<p>そう、数珠つなぎならさっきの Promise チェーンと相性が良い。</p>\\n\\n<p>さっきの6秒待つ処理も</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"c1\\">// 事前に Promise 関数を作っておく。</span>\\n<span class=\\"c1\\">// ライブラリなどで用意されていたりするので、Promise を使う側は作る必要はない。</span>\\n<span class=\\"kd\\">function</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"nx\\">time</span><span class=\\"p\\">){</span>\\n  <span class=\\"k\\">return</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"nx\\">resolve</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n    <span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n  <span class=\\"p\\">});</span>\\n<span class=\\"p\\">}</span>\\n\\n<span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> \\n  <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span>\\n  <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span>\\n  <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span>\\n  <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span>\\n  <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">6s later</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">これはすぐに実行される</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p>ネストが解消されて、引数もコンパクトになって見やすくなった。</p>\\n\\n<h2>\\n<span id=\\"step2-4-asnycawait-非同期関数\\" class=\\"fragment\\"></span><a href=\\"#step2-4-asnycawait-%E9%9D%9E%E5%90%8C%E6%9C%9F%E9%96%A2%E6%95%B0\\"><i class=\\"fa fa-link\\"></i></a>Step2-4 asnyc/await (非同期関数)</h2>\\n\\n<p>さらに async/awaitで書き直すと</p>\\n\\n<div class=\\"code-frame\\" data-lang=\\"js\\"><div class=\\"highlight\\"><pre><span class=\\"c1\\">// 事前に Promise 関数を作っておく。</span>\\n<span class=\\"c1\\">// さっきと同じ。</span>\\n<span class=\\"kd\\">function</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"nx\\">time</span><span class=\\"p\\">){</span>\\n  <span class=\\"k\\">return</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"nx\\">resolve</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n    <span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n  <span class=\\"p\\">})</span>\\n<span class=\\"p\\">}</span>\\n\\n<span class=\\"p\\">(</span> <span class=\\"k\\">async</span> <span class=\\"p\\">()</span> <span class=\\"o\\">=&gt;</span> <span class=\\"p\\">{</span>\\n  <span class=\\"k\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n  <span class=\\"k\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n  <span class=\\"k\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n  <span class=\\"k\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n  <span class=\\"k\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n  <span class=\\"k\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n  <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">6s later</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"dl\\">\'</span><span class=\\"s1\\">これはすぐに実行される</span><span class=\\"dl\\">\'</span><span class=\\"p\\">);</span>\\n</pre></div></div>\\n\\n<p>これは見やすい！<br>\\n非同期関数を同期的に書けるようになった。</p>\\n\\n<p>await の行で停止しているかのように動作する。</p>\\n\\n<h2>\\n<span id=\\"さいごに\\" class=\\"fragment\\"></span><a href=\\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\\"><i class=\\"fa fa-link\\"></i></a>さいごに</h2>\\n\\n<p>本記事を読み次の2つを知れば、他の記事が格段に読みやすくなるだろう。</p>\\n\\n<ul>\\n<li>同期処理と非同期処理の違い</li>\\n<li>同期処理でPromiseがどういう動作をするか</li>\\n</ul>\\n\\n<p>これからは「コールバック地獄を解決するために Promise チェーンがある」「 async/await は Promise の生成だ」などと書かれた他の記事も読めるのではないだろうか。</p>\\n\\n<p>この記事を完全に理解できなくても、 読者の皆様はこれから JavaScript の非同期処理を深める土台ができているのではないかと思う。</p>\\n\\n<p>ここまでの長文に付き合いいただきありがたい。</p>\\n\\n<p>以上。</p>\\n","contentSnippet":"JavaScript といえば非同期処理はつきものだが、非同期や Promise に苦手意識を持つ人も多いのではないだろうか。\\nこれらの最初の理解のハードルは結構高いと思う。私も理解できずに悶絶した。C言語のポインタよりむずくないか？。。。\\nこの記事の前半では一旦非同期のことは忘れる。\\nPromise はよくわからないという方や、一度挫折した方などにぜひ読んでもらいたい。\\n対象読者\\nJavaScript の基本的文法を知っている。(調べればわかる)\\n非同期処理, コールバック, Promise, async/awaitに苦手意識がある、よくわからない。\\nJavaScriptを1行も読んだことも書いたこともない人、プログラミングをしたことのない人は対象としない。\\n目指すところ\\n同期処理と非同期処理の違いがわかる\\n(非同期処理を対象とした) 他の Promise, async/await の解説記事を読んで理解が進む\\nStep0 アロー関数\\n最近の JavaScript (ES6~) ではアロー関数という記法がある。\\n\\n// 従来の書き方\\nfunction sum ( a, b ) {\\n  return a + b;\\n}\\n\\n// アロー関数\\nconst sum2 = ( a, b ) => {\\n  return a + b;\\n};\\n\\n// アロー関数 関数の中がreturn文だけのときは、{return}を省略できる\\nconst sum3 = ( a, b ) => a + b;\\n\\n// アロー関数 引数が1つのときだけ()が省略できる (0つ、2つ以上はダメ)\\nconst twice = a => a*2;\\n\\n\\n\\n本記事では、上のように書けるということだけわかれば大丈夫。\\nStep1 同期処理\\nまずは非同期のことはわすれて、とりあえず読み進めて欲しい。\\nStep1-1 コールバック (同期関数)\\nコールバックとは、関数自体を引数として与え、別の関数に実行してもらうしくみだ。\\n\\nfunction callbackFunc() {\\n  console.log(\'callback\');\\n}\\n\\nfunction callFunc ( func ) {\\n  func();\\n}\\n\\ncallFunc( callbackFunc );\\n\\n\\n\\nふつう、関数callbackFuncを実行するならcallbackFunc()のようにするだろう。\\ncallbackFunc を引数として渡している。\\n括弧をつけないことで、引数として関数自体を渡すだけでその場では実行されない。\\ncallbackFuncを実行してもらっている。\\nこの「関数自体を渡す」というのがコールバックの肝である。\\n次のような書き方では全く意味が変わってしまうので注意。\\n\\ncallFunc( callbackFunc() );\\n\\n\\n\\nこれでは、callbackFunc 関数を実行し、その戻り値を callFunc 関数に引数として渡すという意味になってしまう。\\n繰り返しになるが、コールバックは「関数自体を渡して」「あとで実行してもらう」しくみである。\\n参考: Callback function(コールバック関数) MDN web docs\\n(補足) コールバックとアロー関数\\nちなみに上述のコードはアロー関数を使って次のようにも書ける。\\n\\nconst callbackFunc = () => {\\n  console.log(\'callback\');\\n};\\n\\nfunction callFunc( func ) {\\n  func();\\n}\\n\\ncallFunc( callbackFunc );\\n\\n\\n\\nさらに、一度変数に入れるのをやめると\\n\\nfunction callFunc( func ) {\\n  func();\\n}\\n\\ncallFunc( () => {\\n  console.log(\'callback\');\\n})\\n\\n\\n\\n引数を指定する中で関数を定義してしまうのだ。\\nStep1-2 Promise (同期関数)\\nPromise は英語で「約束する」という意味だ。\\nPromise の状態\\nPromise には3つの状態がある。\\npending ... 約束している状態(初期状態)\\nfulfilled ... 約束を守って値を返した状態\\nrejected ... 約束を破った状態\\nPromise オブジェクトはまず pending で始まり、あとで fulfilled や rejected に状態が変化する。\\n状態: pending\\nとりあえず約束してみる。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n});\\n// 何もしない関数を、new Promise() に渡している。\\nconsole.log( promise );\\n\\n\\n\\npendingと表示されただろう。\\nここでの変数promiseは、Promise の状態 pending といえる。\\n状態: fulfilled\\n次は fulfilled の状態を作ってみる。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  resolve();\\n})\\nconsole.log( promise );\\n// 実はresolve,rejectはそれぞれ、渡された(コールバック)関数を引数として受け取っている。\\n\\n\\n\\nPromise resoleved と表示されただろう。これが fulfilled である。\\n実は状態 fulfilled は値を持つ。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  resolve(\'hello\');\\n})\\nconsole.log( promise );\\n\\n\\n\\nここでの変数promiseは、Promiseの状態 fulfilled であり、値\'hello\'を持つといえる。\\n状態: rejected\\nrejected も fulfilled と同様に値を持つ。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  reject(\'hello\');\\n})\\nconsole.log( promise );\\n\\n\\n\\nここでの変数promiseは、Promise の状態 rejected であり、値\'hello\'を持つといえる。\\nrejected で渡される値(オブジェクト)は Error オブジェクトだったりする。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  reject(new Error(\'error message\'));\\n})\\nconsole.log( promise );\\n\\n\\n\\nここでの変数promiseは、Promise の状態 rejected であり、値に Error オブジェクトを持つといえる。\\n状態の変化\\nPromiseでは状態が変化する。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  //この行が実行されるタイミングでは、変数promiseは状態pending\\n  if( true ){\\n    //この行が実行されるタイミングでも、まだ変数promiseは状態pending\\n    resolve(\'resolveされた!\');\\n    //この行が実行されるタイミングでは、変数promiseは状態fulfilledで値\'resolveされた!\'を持つ\\n    return;\\n  }\\n  // ここから先は実行されない\\n  reject(\'rejectされた\');\\n})\\n\\n\\n\\n現在は同期処理を行っているので、fulfill または reject された状態に一瞬で変化してしまい、 pending の状態をみることはできない。\\nしかし厳密にはもともとは pending で、 resolve()を実行すると fulfilled に、 reject() を実行すると rejected に、それぞれ状態が移行する。\\nthen/catch による Promise チェーン\\nさて、Promise には3状態あり、変化することがわかった。\\nPromise オブジェクトのメソッドに、then と catch がある。\\nこれらはそれぞれ第一引数に関数をとり、Promise が fulfilled や rejected の状態になると引数関数を実行する。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  resolve(\'hello\');\\n})\\n\\npromise.then( arg => {\\n  console.log(arg); // ここではhelloが表示される\\n  console.log(\'then is called\');\\n})\\n\\n\\n\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  reject(\'hello\');\\n})\\n\\npromise.catch( arg => {\\n  console.log(arg); // ここではhelloが表示される\\n  console.log(\'catch is called\');\\n})\\n\\n\\n\\nこのように.でつないで then/catch メソッドを呼べば、それらを発火できる。\\nさらに、then/catch メソッドの戻り値に promise を与えてやれば、更に繋げられる。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  resolve(\'hello\');\\n})\\n\\npromise\\n  .then( () => {\\n    console.log(\'then is called\');\\n    return Promise.resolve(\'resolve!\');\\n  })\\n  .then( arg => {\\n    return Promise.resolve( arg + \'!\' );\\n  })\\n  .then( arg => {\\n    console.log(arg); // resolve!! と表示される。\\n  })\\n\\n// Promise.resolve(\'resolve!\'); は、\\n// new Promise( resolve => { resolve(\'resolve!\') }); と同じ。\\n\\n\\n\\n上述の通り、then メソッドの戻り値に Promise を渡すと、更に後ろに.then()を繋げられる。\\n.catch()も繋げられる。)\\nこのように、Promise が解決 (fulfill/reject) されたら.then()メソッドが発火し、\\n.then()メソッドがPromiseを返すと、解決されたらさらに後ろの.then()メソッドが発火し、、、\\nこのように数珠つなぎに徐々に Promise が渡ることを Promise チェーンと呼ぶ。\\nここまでで Promise を学んだ。\\n本当はこのあたりで非同期関数について説明し Promise のありがたみを理解していただくのもよいのだが、この記事はあくまで「まず同期関数で理解する。」ことが目的であり、非同期関数はもう少し後回しにする。\\nStep1-3 async/await (同期関数)\\n次は sync/await だ。\\nそのまえに説明すべきことが2つほどあるので補足。\\n補足: 即時関数\\n即時関数は定義と同時に実行する関数だ。\\n\\nconst Hello = () => { console.log(\'hello\') };\\nHello();\\n\\n// 上2行のコードは、次の行のコードと同じ。\\n( () => { console.log(\'hello\') });\\n\\n// アロー関数でなくても良い\\n( function () { console.log(\'hello\') });\\n\\n\\n\\n\\n補足: Async 関数 (asnyc function)\\n関数定義の前にasyncとつけて定義する。\\n\\n// 例\\nconst arrowFunc = async () => {\\n  await promise;\\n}\\nasync function func() {\\n  await promise;\\n}\\n\\n\\n\\n\\n\\n\\n改めて async/await (同期関数)\\n閑話休題。\\nasync/await は Promise を生成する構文と言っていい。\\n前節の Promise のコードを再掲する。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  resolve(\'hello\');\\n})\\n\\npromise.then( arg => {\\n  console.log(arg) // ここではhelloが表示される\\n  console.log(\'then is called\');\\n})\\n\\n\\n\\nこれを async/await に書き直すと\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  resolve(\'hello\');\\n})\\n\\n(async () => {\\n  const arg = await promise;\\n  console.log(arg); // ここではhelloが表示される\\n  console.log(\'then is called\');\\n})\\n\\n\\n\\nこのようになる。\\n(即時実行のasync関数を使っている。)\\n\\nもう一つ前節のコードを再掲し async/await に書き換えてみる。\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  resolve(\'hello\')\\n})\\n\\npromise\\n  .then( () => {\\n    console.log(\'then is called\')\\n    return Promise.resolve(\'resolve!\')\\n  })\\n  .then( arg => {\\n    return Promise.resolve( arg + \'!\' )\\n  })\\n  .then( arg => {\\n    console.log(arg) // resolve!! と表示される。\\n  })\\n\\n\\n\\nasync/await に書き換えると\\n\\nconst promise = new Promise( (resolve, reject) => {\\n  resolve(\'hello\')\\n})\\n\\n( async () => {\\n  let arg = await promise\\n  console.log(\'then is called\')\\n  let arg = await Promise.resolve(\'resolve!\')\\n  let arg = await Promise.resolve( arg + \'!\' )\\n  console.log(arg) // resolve!! と表示される。\\n})\\n\\n\\n\\n今度は then がなくなったことで短く書けたことが伝わるのではないか。\\nawaitが現れると、Async 関数内のawaitより後ろの部分が全てthen()の引数として包まれる、といった見方もできる。\\n以上のように、async/await は Promise を簡潔に書く構文である。\\n\\n余談: Promiseは必要か?\\nasync/awaitで簡潔にかけるなら、Promiseなんて理解しなくて良いのでは？と思う方もいるだろう。\\n複数のPromiseを同時に待つ処理をasync/awaitで書いてみる。\\n\\n( async () => {\\n  await Promise.all( [ promise1, promise2 ])\\n})\\n\\n\\n\\nうお、Promise出てきた。。。\\nコードの内容はおいておいて、Promise という単語が出てきたことに注目。\\n(気になる方はこの記事を読み終えてからPromise.allをみると良いだろう。\\n\\nStep2 非同期処理\\nさてさて、ここまで来ればゴールは近い。\\nStep2-1 同期関数と非同期関数\\n同期関数と非同期関数について説明する。\\n同期関数とは、中の処理が完了するまで待ってから戻り値を返す関数のこと\\n非同期関数とは、中の処理にかかわらず、すぐに戻り値を返してしまう関数のこと\\nJavaScript の代表的な非同期関数にsetTimeOut()がある。\\n次のようなコードで考えてみよう。\\n\\nsetTimeOut( () => {\\n  console.log(\'hello\');\\n}, 1000);\\nconsole.log(\'world\');\\n\\n\\n\\nJavaScript は、普通は(同期関数は)、上から順番に1行ずつ実行される。\\nしかし上記のコードを実行するとworldが表示された後にhelloが表示される。\\nsetTimeOut()関数が非同期関数だからだ。\\n書き方を少し変えてみる。\\n\\nfunction Hello() { // 1\\n  console.log(\'hello\'); // 4\\n}\\nsetTimeOut( Hello, 1000) // 2\\nconsole.log(\'world\') // 3\\n\\n\\n\\nさっきと同じ動作をするコードだ。\\nコンピュータの気持ちになってみると\\nHello 関数を定義するよ。Hello 関数は実行されたら\'hello\'と表示するよ。まだ定義だけで実行しないよ。\\nsetTimeOut 関数を実行するよ。Hello 関数を 1000ms 後に実行するとを登録するよ。登録するだけで、すぐに戻り値を返すよ。\\n\\n\\n\'world\'と表示するよ。\\n... しばらく (1000ms) 経って ...\\nHello 関数を実行するよ、\'hello\'と表示するよ。\\nこのような順で動作する。\\nStep2-2 コールバック (非同期関数)\\n先程の例で非同期関数を実現してるのがコールバックだ。\\nあとで実行して欲しい関数を引数で伝えておいて、ときが来たら実行する。\\nやりたいことはコールバックで実現できるものの、何重にも重なると次のようなコードにになってしまう。\\n\\nsetTimeOut( () => {\\n  setTimeOut( () => {\\n    setTimeOut( () => {\\n      setTimeOut( () => {\\n        setTimeOut( () => {\\n          setTimeOut( () => {\\n            console.log(\'6s later\');\\n          }, 1000);\\n        }, 1000);\\n      }, 1000);\\n    }, 1000);\\n  }, 1000);\\n}, 1000);\\n\\nconsole.log(\'これはすぐに実行される\');\\n\\n\\n\\nコールバック関数を呼ぶたびにネストが深くなってしまい読みづらい。\\n俗に言うコールバック地獄である。\\n(上記の例は全て一つの setTimeOut にまとめられるが)\\nサーバと通信して、記事のリストをとってくる。\\n記事のリストから該当の記事を探して、再度サーバと通信して本文をとってくる。\\nこのように、複数の非同期処理が数珠つなぎになることもあるだろう。\\n数珠つなぎ、、、\\nStep2-3 Promise (非同期関数)\\nそう、数珠つなぎならさっきの Promise チェーンと相性が良い。\\nさっきの6秒待つ処理も\\n\\n// 事前に Promise 関数を作っておく。\\n// ライブラリなどで用意されていたりするので、Promise を使う側は作る必要はない。\\nfunction setTimeOutPromise(time){\\n  return new Promise( resolve => {\\n    setTimeOut( resolve, 1000);\\n  });\\n}\\n\\nsetTimeOutPromise(1000)\\n.then( () => \\n  setTimeOutPromise(1000)\\n).then( () =>\\n  setTimeOutPromise(1000)\\n).then( () =>\\n  setTimeOutPromise(1000)\\n).then( () =>\\n  setTimeOutPromise(1000)\\n).then( () =>\\n  setTimeOutPromise(1000)\\n).then( () => {\\n  console.log(\'6s later\');\\n})\\n\\nconsole.log(\'これはすぐに実行される\');\\n\\n\\n\\nネストが解消されて、引数もコンパクトになって見やすくなった。\\nStep2-4 asnyc/await (非同期関数)\\nさらに async/awaitで書き直すと\\n\\n// 事前に Promise 関数を作っておく。\\n// さっきと同じ。\\nfunction setTimeOutPromise(time){\\n  return new Promise( resolve => {\\n    setTimeOut( resolve, 1000)\\n  })\\n}\\n\\n( async () => {\\n  await setTimeOutPromise(1000);\\n  await setTimeOutPromise(1000);\\n  await setTimeOutPromise(1000);\\n  await setTimeOutPromise(1000);\\n  await setTimeOutPromise(1000);\\n  await setTimeOutPromise(1000);\\n  console.log(\'6s later\');\\n})\\n\\nconsole.log(\'これはすぐに実行される\');\\n\\n\\n\\nこれは見やすい！\\nawait の行で停止しているかのように動作する。\\nさいごに\\n本記事を読み次の2つを知れば、他の記事が格段に読みやすくなるだろう。\\n同期処理と非同期処理の違い\\n同期処理でPromiseがどういう動作をするか\\nこれからは「コールバック地獄を解決するために Promise チェーンがある」「 async/await は Promise の生成だ」などと書かれた他の記事も読めるのではないだろうか。\\nこの記事を完全に理解できなくても、 読者の皆様はこれから JavaScript の非同期処理を深める土台ができているのではないかと思う。\\nここまでの長文に付き合いいただきありがたい。\\n以上。","id":"tag:qiita.com,2005:PublicArticle/1233230","isoDate":"2020-05-29T17:00:50.000Z"},{"title":"数日前からCコンパイラを書き始めた。","link":"https://memo.basd4g.net/posts/willani-start/","pubDate":"Mon, 25 May 2020 01:02:52 +0900","content":"<p>数日前からCコンパイラを書き始めた。(<a href=\\"https://github.com/basd4g/willani\\"target=\\"_blank\\">GitHub</a>)</p>\\n<p>植山類さんのオンラインブック、<a href=\\"https://www.sigbus.info/compilerbook\\"target=\\"_blank\\">低レイヤを知りたい人のためのCコンパイラ作成入門</a>を読みながら、概ね本の内容に沿って進めている。\\n自分の書いたコンパイラで自身をコンパイルするセルフホストを目指している。</p>\\n<p>コンパイラというのはある言語で書かれたプログラムを別の言語に変換するプログラムだ。\\nここではC言語をアセンブリに変換するものを指している。<br>\\nいきなりC言語をコンパイルするのは無理なので、徐々に複雑な入力を受け付けるように改良し、最終的にC言語を受け付けるようにする(したい)。\\n最初は入力をそのまま出力することから始まり、四則演算ができるようになり、いまは関数呼び出しができるようになった。</p>\\n<p>本はとても丁寧に書かれていて、参考として実装も2種類ほど存在する。\\nさらにSlackやYoutube Liveで質問ができるというとても恵まれた環境が揃っている。</p>\\n<p>実は昨年コンパイラの授業をとっていてコンパイラを少し触っていた。\\ncmmというCを一部切り取ったような言語と、PL0iという仮想マシン(とそのアセンブリ)に対して言語拡張をする、というようなことだった。\\nそのときはあまり真面目に実装に凝っていなくて、課題はパスして成績がそこそこもらえるくらいはやったが、実のところコンパイラってよくわからないなという気持ちのまま終わっていた。</p>\\n<p>このままではよくないという気持ちと、あとは単純な興味(プログラムをデータとして扱うことを体験できる)もあって始めてみた。</p>\\n<br/>\\n<p>はじめてまだ3日ほどだが、パーサについてがちょっと意外だった。\\n手書きでパーサを書くというのは事前に聞いていたが、LL(1)でいけるらしい。</p>\\n<p>LL(1)とは構文解析法のこと、つまり、文法がどんな構造になっているかを調べる手法の一つだ。\\n構文解析は事前にBNF記法などで規則が与えられており、その規則のどれが適用できるかを探す。\\n授業でLR(0), LR(1), LALR(1)などを扱ったが、LL(1)はそれらよりも単純で手書きでパーサを書くのに向いているらしい。</p>\\n<p>どうも最近のコンパイラ(gccやclang)はLL1らしい。\\n大学の授業では、「LALR1じゃないとまともにパースできない(世の中的には主流)(最近は違う場合もある)」といっていた気がして、それにしたがってLALR1の文法解析などをやった記憶があるのだが。(違ったらごめんなさい先生。)</p>\\n<p>なんだったんだあの勉強はという気持ちに少しなったが、教科書的にはああいうものなのだろう。\\n授業ではLL1をばっさり飛ばしたのでそんなに深追いしてなかったが、やってみればなるほどという感じ。</p>\\n<p>LALR1パーサジェネレータを書くなら当時の記憶を掘り返して結構頑張らないときつそうだけど、LL1で書くのは意外といけるものだ。</p>\\n<br/>\\n<p>そんなわけでトークナイザ(レキシカルアナライザと同義?)とパーサは結構スイスイ進む。\\nやることが見えているしデバッグ用にログを出せば何が起きているか目に見えてわかる。</p>\\n<p>そこまではいいのだけど、肝心のコード生成がちょっと大変。</p>\\n<p>アセンブリへの理解が浅い私である。\\nアセンブリを読むのは少しつらいなぁ、この量でこんなこと言ってたらこの先どうなることやらと思いながらデバッグしている。\\n今後アセンブリがすらすら読めるようになることを夢見て続けていきたい。</p>\\n<br/>\\n<p>C言語でそれなりのものを書くというのも実はいままであまりやってこなかったので、今回は絶好の機会だ。\\nいつまで飽きずにやれるかな。</p>","contentSnippet":"数日前からCコンパイラを書き始めた。(GitHub)\\n植山類さんのオンラインブック、低レイヤを知りたい人のためのCコンパイラ作成入門を読みながら、概ね本の内容に沿って進めている。\\n自分の書いたコンパイラで自身をコンパイルするセルフホストを目指している。\\nコンパイラというのはある言語で書かれたプログラムを別の言語に変換するプログラムだ。\\nここではC言語をアセンブリに変換するものを指している。\\n本はとても丁寧に書かれていて、参考として実装も2種類ほど存在する。\\nさらにSlackやYoutube Liveで質問ができるというとても恵まれた環境が揃っている。\\n実は昨年コンパイラの授業をとっていてコンパイラを少し触っていた。\\ncmmというCを一部切り取ったような言語と、PL0iという仮想マシン(とそのアセンブリ)に対して言語拡張をする、というようなことだった。\\nそのときはあまり真面目に実装に凝っていなくて、課題はパスして成績がそこそこもらえるくらいはやったが、実のところコンパイラってよくわからないなという気持ちのまま終わっていた。\\nこのままではよくないという気持ちと、あとは単純な興味(プログラムをデータとして扱うことを体験できる)もあって始めてみた。\\nはじめてまだ3日ほどだが、パーサについてがちょっと意外だった。\\n手書きでパーサを書くというのは事前に聞いていたが、LL(1)でいけるらしい。\\nLL(1)とは構文解析法のこと、つまり、文法がどんな構造になっているかを調べる手法の一つだ。\\n構文解析は事前にBNF記法などで規則が与えられており、その規則のどれが適用できるかを探す。\\n授業でLR(0), LR(1), LALR(1)などを扱ったが、LL(1)はそれらよりも単純で手書きでパーサを書くのに向いているらしい。\\nどうも最近のコンパイラ(gccやclang)はLL1らしい。\\n大学の授業では、「LALR1じゃないとまともにパースできない(世の中的には主流)(最近は違う場合もある)」といっていた気がして、それにしたがってLALR1の文法解析などをやった記憶があるのだが。(違ったらごめんなさい先生。)\\nなんだったんだあの勉強はという気持ちに少しなったが、教科書的にはああいうものなのだろう。\\n授業ではLL1をばっさり飛ばしたのでそんなに深追いしてなかったが、やってみればなるほどという感じ。\\nLALR1パーサジェネレータを書くなら当時の記憶を掘り返して結構頑張らないときつそうだけど、LL1で書くのは意外といけるものだ。\\nそんなわけでトークナイザ(レキシカルアナライザと同義?)とパーサは結構スイスイ進む。\\nやることが見えているしデバッグ用にログを出せば何が起きているか目に見えてわかる。\\nそこまではいいのだけど、肝心のコード生成がちょっと大変。\\nアセンブリへの理解が浅い私である。\\nアセンブリを読むのは少しつらいなぁ、この量でこんなこと言ってたらこの先どうなることやらと思いながらデバッグしている。\\n今後アセンブリがすらすら読めるようになることを夢見て続けていきたい。\\nC言語でそれなりのものを書くというのも実はいままであまりやってこなかったので、今回は絶好の機会だ。\\nいつまで飽きずにやれるかな。","guid":"https://memo.basd4g.net/posts/willani-start/","isoDate":"2020-05-24T16:02:52.000Z"},{"title":"npm publishの手順","link":"https://memo.basd4g.net/posts/npm-publish/","pubDate":"Thu, 21 May 2020 15:40:14 +0900","content":"<p>npm (Node Package Manager) とは、Node.js におけるパッケージ管理ツールである。</p>\\n<p>npm が GitHub に買収されたり、deno が正式リリースされたりしているこのご時世であるが、初めて npm にパッケージを公開したので手順と注意点を振り返る。</p>\\n<p>ちなみ公開したのは、はてなブログ記事管理ツールの <a href=\\"https://www.npmjs.com/package/gimonfu\\"target=\\"_blank\\">gimonfu</a>。</p>\\n<h2 id=\\"全体の流れ\\">全体の流れ</h2>\\n<p><code>$ npm publish</code>する作業をよしなにしてくれる CLI ツール <a href=\\"https://www.npmjs.com/package/np\\"target=\\"_blank\\">np</a> などもあるようだ。\\n今回は必要な作業を知る意味を込めて手動で行った。</p>\\n<p>私がやったのは以下の通り。細かくはこれから述べる。</p>\\n<ol>\\n<li>npm に登録する</li>\\n<li>内容を確認する</li>\\n<li>package.json の version を上げる</li>\\n<li><code>$ npm publish</code></li>\\n<li>GitHub の Web ページ上で Release を書く</li>\\n</ol>\\n<h2 id=\\"npmに登録する\\">npmに登録する</h2>\\n<ol>\\n<li>npm に登録する (<a href=\\"https://www.npmjs.com/signup\\">https://www.npmjs.com/signup</a>)</li>\\n<li>npm にログインする(<code>$ npm login</code>)</li>\\n<li>npm にログインしたことを確認する(<code>$ npm whoami</code>)</li>\\n</ol>\\n<h2 id=\\"packagejson-を振り返る\\">package.json を振り返る</h2>\\n<p>package.json の内容に不備がないか、各項目を確認していく。</p>\\n<p>一通り確認し終えたら <a href=\\"https://www.npmjs.com/package/fixpack\\"target=\\"_blank\\">fixpack</a> を使って、抜けがないかチェックする。</p>\\n<p>version については <a href=\\"https://docs.npmjs.com/about-semantic-versioning\\"target=\\"_blank\\">semantic versioning</a> に従う。\\n要するに <code>0.0.1</code> や <code>1.0.2</code> といった形式だ。\\n<code>$ npm version</code>でも上げることができるらしい。</p>\\n<p>( files キーについては次に述べる。)</p>\\n<h2 id=\\"配布するファイルを確認する\\">配布するファイルを確認する</h2>\\n<p>配布するファイルは次の項目で決まる。</p>\\n<h3 id=\\"packagejson-内の-files-キー\\">package.json 内の files キー</h3>\\n<p>文字列の配列を渡すと、ファイルやディレクトリを配布ファイルに含める。\\nホワイトリスト形式。</p>\\n<p>今回は次のように指定した。\\nTypeScriptでCLIツールを作るなら同じように指定できるのではないだろうか。</p>\\n<p>なお <a href=\\"https://docs.npmjs.com/files/package.json#files\\"target=\\"_blank\\">package.json などは自動で含めてくれる</a>ようなので指定しなくてよい。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-json\\" data-lang=\\"json\\"><span class=\\"p\\">{</span>\\n<span class=\\"nt\\">&#34;files&#34;</span><span class=\\"p\\">:</span> <span class=\\"p\\">[</span>\\n<span class=\\"s2\\">&#34;dist&#34;</span><span class=\\"p\\">,</span>\\n<span class=\\"s2\\">&#34;bin&#34;</span>\\n<span class=\\"p\\">],</span>\\n<span class=\\"p\\">}</span>\\n</code></pre></div><h3 id=\\"npmignore\\">.npmignore</h3>\\n<p>.gitignore と同じフォーマットで、ファイルやディレクトリを配布ファイルから除外する。\\nブラックリスト形式。</p>\\n<p><a href=\\"http://npm.github.io/publishing-pkgs-docs/publishing/the-npmignore-file.html\\"target=\\"_blank\\">npmのドキュメント</a>を読むと、.npmignore だけではなく .gitignore も読み込んで除外してくれそうな感じだ。</p>\\n<p>今回は package.json#files で指定したので使わなかった。</p>\\n<br/>\\n<p>配布するファイルは、特にTypeScriptのとき注意する必要がある。dist ディレクトリだ。</p>\\n<p>npm での配布コンパイル結果を含む必要がある。\\nしかし git ではコンパイル結果をリポジトリに含めないのが普通だ。\\n何も設定しないと .gitignore を解釈して dist ディレクトリは配布対象外となってしまう。</p>\\n<p>これを避けるためには、package.json#files で指定してあげる必要がある。</p>\\n<br/>\\n<p>ところで、<code>$npm link</code>を使うと手元のPCでグローバルインストールしたのと同様にpathを通してくれるらしい。</p>\\n<p>ただ、シンボリックリンクを貼るだけなので配布するファイルの確認には使えないことに注意。\\n配布対象外のファイルもローカルに存在するので動いてしまう。</p>\\n<h2 id=\\"ビルドとテストが通る\\">ビルドとテストが通る</h2>\\n<p>動かないファイルを公開するわけにはいかない。</p>\\n<p>間違えて公開してしまっても<a href=\\"https://docs.npmjs.com/cli/unpublish\\"target=\\"_blank\\">72時間以内なら<code>$npm unpublish</code>で取り消せる</a>。</p>\\n<p>それ以降はnpmのサポートにメールする必要がある。\\nパッケージが簡単に消せてしまうと依存関係に問題が生じるので、削除には慎重なようだ。</p>\\n<h2 id=\\"readmemdを読み直す\\">README.mdを読み直す</h2>\\n<p>README.md は npm のページにも表示されるので、改めて間違いがないかを確認する。</p>\\n<p>自分は Installation のところを間違えたまま公開してしまった。(現在は修正済み)</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># 間違い</span>\\n$ npm install --global basd4g/gimonfu\\n<span class=\\"c1\\"># 正しい</span>\\n<span class=\\"c1\\"># npm install --global gimonfu</span>\\n</code></pre></div><p>実は npm にパッケージを公開せずとも、install 時に [githubユーザ名]/[githubレポジトリ名] とすると、パッケージをインストールできる。\\nもともと README.md にこの方法が記述していた。</p>\\n<p>しかし今回はこの記述は間違い。\\nGithub リポジトリには TypeScript のコンパイル結果が含まれていないので、インストールできても動かない。</p>\\n<p>ちなみに英語の README.md は、DeepL と grammaly の力を借りて適当な GitHub リポジトリの README.md を参考にすることで作っている。\\n先人と文明は偉大。</p>\\n<h2 id=\\"-npm-publish\\"><code>$ npm publish</code></h2>\\n<p>問題ないことが確認できたらいよいよ公開する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"nv\\">$npm</span> publish\\n</code></pre></div><p>たった一行打つだけ。</p>\\n<p>公開したら、GitHub 上でも Release をつくる。</p>\\n<h2 id=\\"おわりに\\">おわりに</h2>\\n<p>はじめての<code>$ npm publish</code>はなんだか気分が良い。</p>\\n<p>npm のパッケージのページでは Download 数が見れるのだが、公開された瞬間に40くらいになっていた。\\n謎。\\nミラーだったりで自動取得されてるのかな。</p>\\n<p>そもそも Download 数ってそんなに正確である必要はないので、40など誤差の範囲内だが。</p>\\n<hr>\\n<p>追記: (2020/10/04) 不要な改行タグを削除</p>","contentSnippet":"npm (Node Package Manager) とは、Node.js におけるパッケージ管理ツールである。\\nnpm が GitHub に買収されたり、deno が正式リリースされたりしているこのご時世であるが、初めて npm にパッケージを公開したので手順と注意点を振り返る。\\nちなみ公開したのは、はてなブログ記事管理ツールの gimonfu。\\n全体の流れ\\n$ npm publishする作業をよしなにしてくれる CLI ツール np などもあるようだ。\\n今回は必要な作業を知る意味を込めて手動で行った。\\n私がやったのは以下の通り。細かくはこれから述べる。\\nnpm に登録する\\n内容を確認する\\npackage.json の version を上げる\\n$ npm publish\\nGitHub の Web ページ上で Release を書く\\nnpmに登録する\\nnpm に登録する (https://www.npmjs.com/signup)\\nnpm にログインする($ npm login)\\nnpm にログインしたことを確認する($ npm whoami)\\npackage.json を振り返る\\npackage.json の内容に不備がないか、各項目を確認していく。\\n一通り確認し終えたら fixpack を使って、抜けがないかチェックする。\\nversion については semantic versioning に従う。\\n要するに 0.0.1 や 1.0.2 といった形式だ。\\n$ npm versionでも上げることができるらしい。\\n( files キーについては次に述べる。)\\n配布するファイルを確認する\\n配布するファイルは次の項目で決まる。\\npackage.json 内の files キー\\n文字列の配列を渡すと、ファイルやディレクトリを配布ファイルに含める。\\nホワイトリスト形式。\\n今回は次のように指定した。\\nTypeScriptでCLIツールを作るなら同じように指定できるのではないだろうか。\\nなお package.json などは自動で含めてくれるようなので指定しなくてよい。\\n{\\n\\"files\\": [\\n\\"dist\\",\\n\\"bin\\"\\n],\\n}\\n\\n\\n.npmignore\\n.gitignore と同じフォーマットで、ファイルやディレクトリを配布ファイルから除外する。\\nブラックリスト形式。\\nnpmのドキュメントを読むと、.npmignore だけではなく .gitignore も読み込んで除外してくれそうな感じだ。\\n今回は package.json#files で指定したので使わなかった。\\n配布するファイルは、特にTypeScriptのとき注意する必要がある。dist ディレクトリだ。\\nnpm での配布コンパイル結果を含む必要がある。\\nしかし git ではコンパイル結果をリポジトリに含めないのが普通だ。\\n何も設定しないと .gitignore を解釈して dist ディレクトリは配布対象外となってしまう。\\nこれを避けるためには、package.json#files で指定してあげる必要がある。\\nところで、$npm linkを使うと手元のPCでグローバルインストールしたのと同様にpathを通してくれるらしい。\\nただ、シンボリックリンクを貼るだけなので配布するファイルの確認には使えないことに注意。\\n配布対象外のファイルもローカルに存在するので動いてしまう。\\nビルドとテストが通る\\n動かないファイルを公開するわけにはいかない。\\n間違えて公開してしまっても72時間以内なら$npm unpublishで取り消せる。\\nそれ以降はnpmのサポートにメールする必要がある。\\nパッケージが簡単に消せてしまうと依存関係に問題が生じるので、削除には慎重なようだ。\\nREADME.mdを読み直す\\nREADME.md は npm のページにも表示されるので、改めて間違いがないかを確認する。\\n自分は Installation のところを間違えたまま公開してしまった。(現在は修正済み)\\n# 間違い\\n$ npm install --global basd4g/gimonfu\\n# 正しい\\n# npm install --global gimonfu\\n\\n\\n実は npm にパッケージを公開せずとも、install 時に [githubユーザ名]/[githubレポジトリ名] とすると、パッケージをインストールできる。\\nもともと README.md にこの方法が記述していた。\\nしかし今回はこの記述は間違い。\\nGithub リポジトリには TypeScript のコンパイル結果が含まれていないので、インストールできても動かない。\\nちなみに英語の README.md は、DeepL と grammaly の力を借りて適当な GitHub リポジトリの README.md を参考にすることで作っている。\\n先人と文明は偉大。\\n$ npm publish\\n問題ないことが確認できたらいよいよ公開する。\\n$npm publish\\n\\n\\nたった一行打つだけ。\\n公開したら、GitHub 上でも Release をつくる。\\nおわりに\\nはじめての$ npm publishはなんだか気分が良い。\\nnpm のパッケージのページでは Download 数が見れるのだが、公開された瞬間に40くらいになっていた。\\n謎。\\nミラーだったりで自動取得されてるのかな。\\nそもそも Download 数ってそんなに正確である必要はないので、40など誤差の範囲内だが。\\n追記: (2020/10/04) 不要な改行タグを削除","guid":"https://memo.basd4g.net/posts/npm-publish/","isoDate":"2020-05-21T06:40:14.000Z"},{"title":"コンピュータの有名なエッセイ","link":"https://memo.basd4g.net/posts/computer-essay/","pubDate":"Wed, 20 May 2020 14:23:23 +0900","content":"<p>コンピュータの専門家を志すものとして、近いうちに読んでおきたい(読み直したい)エッセイ。\\nインターネット上に公開されているものも多く、日本語訳のリンクをつけている。</p>\\n<p>著者、訳者に感謝。</p>\\n<p>自分の今後の人生など知る由もないが、仕事になろうとそうでなかろうと、コンピューテーションが楽しいものだということを忘れずに、いや今よりもそう思えるような人間でありたい。</p>\\n<h2 id=\\"ハッカーと画家hackers--painters\\">ハッカーと画家(Hackers &amp; Painters)</h2>\\n<p>ポール・グレアム著。</p>\\n<p>エッセイ集。</p>\\n<p>いくつかの章は読んだ。強い表現のところもあったりしてクセのある、他方魅力的な文章。</p>\\n<ol>\\n<li><a href=\\"http://www.blog.net/nerds-jp.htm\\"target=\\"_blank\\">どうしてオタクはモテないか</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/hp-j.html\\"target=\\"_blank\\">ハッカーと画家</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/say-j.html\\"target=\\"_blank\\">口にできないこと</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/road-j.html\\"target=\\"_blank\\">もうひとつの未来への道</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/spam-j.html\\"target=\\"_blank\\">スパムへの対策</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/taste-j.html\\"target=\\"_blank\\">ものつくりのセンス</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/hundred-j.html\\"target=\\"_blank\\">百年の言語</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/beating-the-averages-j.html\\"target=\\"_blank\\">普通のやつらの上を行け</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/icad-j.html\\"target=\\"_blank\\">オタク野郎の復讐</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/being-popular-j.html\\"target=\\"_blank\\">夢の言語</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/desres-j.html\\"target=\\"_blank\\">デザインとリサーチ</a></li>\\n<li><a href=\\"http://practical-scheme.net/trans/gh-j.html\\"target=\\"_blank\\">素晴らしきハッカー</a></li>\\n</ol>\\n<ul>\\n<li><a href=\\"http://practical-scheme.net/wiliki/wiliki.cgi?naoya_t%3A%E3%83%9D%E3%83%BC%E3%83%AB%E3%83%BB%E3%82%B0%E3%83%AC%E3%82%A2%E3%83%A0%E3%81%AE%E3%82%A8%E3%83%83%E3%82%BB%E3%82%A4%E3%81%A8%E5%92%8C%E8%A8%B3%E4%B8%80%E8%A6%A7\\"target=\\"_blank\\">他を含む エッセイと和訳の一覧</a></li>\\n</ul>\\n<h2 id=\\"伽藍とバザールthe-cathedral-and-the-bazaarhttpscruelorgfreewarecathedralhtml\\"><a href=\\"https://cruel.org/freeware/cathedral.html\\"target=\\"_blank\\">伽藍とバザール(The Cathedral and the Bazaar)</a></h2>\\n<p>エリック・レイモンド著。</p>\\n<p>先日、TCP/IPに関する説明を大学の先生から受けたときに聞いた本。\\nオープンソースソフトウェアの発展に関する考察がされているようだ。</p>\\n<p>まだ読んでいない。</p>\\n<h2 id=\\"ハッカーになろうhow-to-become-a-hackerhttpscruelorgfreewarehackerhtmlbasic_skills\\"><a href=\\"https://cruel.org/freeware/hacker.html#basic_skills\\"target=\\"_blank\\">ハッカーになろう(How To Become A Hacker)</a></h2>\\n<p>こちらもエリック・レイモンド著。</p>\\n<p>ハッカーとしての志、考え方が書かれている。</p>\\n<p>一度読んだ。\\n私は全然ハッカーに近づけてはいないなと実感しながら。</p>\\n<h2 id=\\"プログラマが知るべき97のことhttpsjawikisourceorgwikie38397e383ade382b0e383a9e3839ee3818ce79fa5e3828be381b9e3818d97e381aee38193e381a8\\"><a href=\\"https://ja.wikisource.org/wiki/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%81%8C%E7%9F%A5%E3%82%8B%E3%81%B9%E3%81%8D97%E3%81%AE%E3%81%93%E3%81%A8\\"target=\\"_blank\\">プログラマが知るべき97のこと</a></h2>\\n<p>多数のプログラマが語るエッセイ集のようだ。</p>\\n<p>まだ一部しか読めていない。</p>\\n<h2 id=\\"情熱プログラマーhttpstatsu-zinecombookspassionate-programmer-ja\\"><a href=\\"https://tatsu-zine.com/books/passionate-programmer-ja\\"target=\\"_blank\\">情熱プログラマー</a></h2>\\n<p>Chad Fowler著のプログラマがキャリアを築くための方法を述べた書籍のようだ。</p>\\n<p>まだ読んでいない(買っていない)。</p>\\n<p><a href=\\"https://yuru28.com\\"target=\\"_blank\\">ゆるふわポッドキャスト</a>の<a href=\\"https://twitter.com/mktakuya\\"target=\\"_blank\\">@mktakuya</a>さんがTwitterでつぶやいて知った。</p>\\n<hr/>\\n<br/>\\n<p>エッセイではないが、<a href=\\"https://www.amazon.co.jp/UNIX%E3%81%A8%E3%81%84%E3%81%86%E8%80%83%E3%81%88%E6%96%B9%E2%80%95%E3%81%9D%E3%81%AE%E8%A8%AD%E8%A8%88%E6%80%9D%E6%83%B3%E3%81%A8%E5%93%B2%E5%AD%A6-Mike-Gancarz/dp/4274064069\\"target=\\"_blank\\">Unixという考え方 - その設計思想と哲学</a>も改めて読み直したい。</p>","contentSnippet":"コンピュータの専門家を志すものとして、近いうちに読んでおきたい(読み直したい)エッセイ。\\nインターネット上に公開されているものも多く、日本語訳のリンクをつけている。\\n著者、訳者に感謝。\\n自分の今後の人生など知る由もないが、仕事になろうとそうでなかろうと、コンピューテーションが楽しいものだということを忘れずに、いや今よりもそう思えるような人間でありたい。\\nハッカーと画家(Hackers & Painters)\\nポール・グレアム著。\\nエッセイ集。\\nいくつかの章は読んだ。強い表現のところもあったりしてクセのある、他方魅力的な文章。\\nどうしてオタクはモテないか\\nハッカーと画家\\n口にできないこと\\nもうひとつの未来への道\\nスパムへの対策\\nものつくりのセンス\\n百年の言語\\n普通のやつらの上を行け\\nオタク野郎の復讐\\n夢の言語\\nデザインとリサーチ\\n素晴らしきハッカー\\n他を含む エッセイと和訳の一覧\\n伽藍とバザール(The Cathedral and the Bazaar)\\nエリック・レイモンド著。\\n先日、TCP/IPに関する説明を大学の先生から受けたときに聞いた本。\\nオープンソースソフトウェアの発展に関する考察がされているようだ。\\nまだ読んでいない。\\nハッカーになろう(How To Become A Hacker)\\nこちらもエリック・レイモンド著。\\nハッカーとしての志、考え方が書かれている。\\n一度読んだ。\\n私は全然ハッカーに近づけてはいないなと実感しながら。\\nプログラマが知るべき97のこと\\n多数のプログラマが語るエッセイ集のようだ。\\nまだ一部しか読めていない。\\n情熱プログラマー\\nChad Fowler著のプログラマがキャリアを築くための方法を述べた書籍のようだ。\\nまだ読んでいない(買っていない)。\\nゆるふわポッドキャストの@mktakuyaさんがTwitterでつぶやいて知った。\\nエッセイではないが、Unixという考え方 - その設計思想と哲学も改めて読み直したい。","guid":"https://memo.basd4g.net/posts/computer-essay/","isoDate":"2020-05-20T05:23:23.000Z"},{"title":"Repositoryで振り返る2019年","link":"https://memo.basd4g.net/posts/2019-github-repositories/","pubDate":"Tue, 19 May 2020 21:44:57 +0900","content":"<p>2020年も中頃だが、2019年末〜2020年正月に書きかけた記事が出てきた。\\n捨てるのも何なのでここに放出。</p>\\n<p>以下。年末に1年を振り返るという記事の趣旨から各リポジトリにリンクをつけた以外は原文のまま。\\nリンク以外の追記部分はその旨を記述している。</p>\\n<hr/>\\n<h2 id=\\"なにをするか\\">なにをするか</h2>\\n<p>あけましておめでとうございます。\\n年越ししてしまいましたが、まだ正月なので昨年を振り返って今年に向けて身を引き締めたい。</p>\\n<p>今回はGitHubのリポジトリを総ざらいして自分がどんな開発をしたか振り返る。</p>\\n<h2 id=\\"準備githubのリポジトリ一覧を取得する\\">準備:GitHubのリポジトリ一覧を取得する</h2>\\n<p>githubのAPIを用いて、curlでリポジトリ情報を取得する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ curl -u basd4g <span class=\\"s2\\">&#34;https://api.github.com/users/basd4g/repos?per_page=100&amp;page=1&#34;</span> <span class=\\"p\\">|</span> grep <span class=\\"s1\\">&#39;&#34;name&#34;: &#34;&#39;</span> <span class=\\"p\\">|</span> awk -F <span class=\\"s1\\">&#39;&#34;&#39;</span> <span class=\\"s1\\">&#39;{print $4}&#39;</span> &gt; repos.txt\\n</code></pre></div><p>参考: <a href=\\"https://qiita.com/emergent/items/a557246a0c0bf9d50a11\\"target=\\"_blank\\">GitHubのリポジトリを一覧化する（public/private両対応）- Qiita</a></p>\\n<h2 id=\\"リポジトリ一覧-20191231現在\\">リポジトリ一覧 (2019/12/31現在)</h2>\\n<p>私(<a href=\\"https://github.com/basd4g\\"target=\\"_blank\\">basd4g</a>)のgithub上にあるpublicリポジトリは31個。\\nまともにGitHubを使い始めてから1年ほどというのもあり、すべて2019年に1コミット以上しているので、これらを振り返る。</p>\\n<h3 id=\\"純粋な個人趣味開発\\">純粋な個人趣味開発</h3>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/c-sharp-socket\\"target=\\"_blank\\">c-sharp-socket</a></li>\\n</ul>\\n<p>友人からの質問をきっかけにC#でソケット通信をしてみた、サンプルコード的なリポジトリ。</p>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/text2pdf\\"target=\\"_blank\\">text2pdf</a></li>\\n</ul>\\n<p>textデータをPDFファイルに出力できるアプリケーション。\\n2019年1月に、3日間で勢いで作った。実用で使うというより、プロモーションが中心だったので、表示自体は非常に簡素。\\nただし、node.js上で外部のライブラリやアプリケーションを用いず、PDFのファイル形式に従ってファイルへの文字列出力部分を自分で実装している。3日間にしては頑張ったな、という感じ。</p>\\n<p>日本語出力した際のフォントまわりが貧弱で、文字列が描画される位置が微妙である。\\n開発後半に、日本語出力をとってつけで開発したので、このあたりをしっかりすれば、もうすこし見た目が良くなるのではないかな。\\nPDFを開く環境による見た目の差異を検証したりすることが必要である。</p>\\n<p>もし文字データを手っ取り早くPDFにしたいのであれば、<a href=\\"https://dev.classmethod.jp/tool/md-to-pdf/\\"target=\\"_blank\\">md-to-pdf</a>がおすすめ。<a href=\\"https://dev.classmethod.jp/tool/md-to-pdf\\"target=\\"_blank\\">GitHub風CSSを当てる</a>と結構いい感じになる。</p>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/playqueue\\"target=\\"_blank\\">PlayQueue</a></li>\\n</ul>\\n<p>Youtubeを連続再生するWebアプリケーション。\\n2018年末から断続的に開発している。\\n個人開発のアプリケーションとしては自分の代表作で、就活でも自分を紹介する際に話す機会が多い。</p>\\n<h3 id=\\"大学の授業に関係した開発\\">大学の授業に関係した開発</h3>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/turingmachineonweb\\"target=\\"_blank\\">TuringMachineOnWeb</a></li>\\n</ul>\\n<p>2019年1月制作。\\nチューリング機械の状態遷移表を作成するエディタと、作成した状態遷移表を検証するシュミレータを作った。</p>\\n<p>レポートに書く状態遷移表をつくったときに、つくった状態遷移表が正しいのかを検証するために作った。</p>\\n<p>UIは簡素だけれど、当時やりたかったことは達成させられたので満足。</p>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/clustering.ai.2019.su\\"target=\\"_blank\\">clustering.AI.2019.SU</a></li>\\n</ul>\\n<p>ウォード法による階層的クラスタリングを扱ったレポートを書くために使ったスクリプト。</p>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/pl0i\\"target=\\"_blank\\">pl0i</a></li>\\n<li><a href=\\"https://github.com/basd4g/pl0i.js\\"target=\\"_blank\\">pl0i.js</a></li>\\n</ul>\\n<p>pl0 interpreterという仮想マシンと、TypeScriptによる再実装(未完)</p>\\n<p>簡易なアセンブリと、より高級な言語との対応を学ぶために、アセンブリを実行する仮想マシンをつくることで理解を深める試みであった。</p>\\n<p>TypeScriptで書いていたときは、最終的にブラウザでメモリの状態や実行している命令の位置なども表示しながらプログラムを実行できるようなWebアプリケーションをつくるつもりだったが、大学の課題と就活を優先した結果開発が進まぬまま課題の方を先に終わらせて提出した。以後開発が停止し未完。</p>\\n<h3 id=\\"夏インターン\\">夏インターン</h3>\\n<h4 id=\\"夏インターン準備\\">夏インターン準備</h4>\\n<p>夏インターンでNuxt.jsとTypeScriptを扱うと聞いたので、その準備としてそれらの勉強のために書籍やWebサイトを参考にサンプルアプリを作って動かしてみたリポジトリ群</p>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/ts-nuxt-tutorial\\"target=\\"_blank\\">ts-nuxt-tutorial</a></li>\\n<li><a href=\\"https://github.com/basd4g/green-turtle-org\\"target=\\"_blank\\">green-turtle-org</a></li>\\n<li><a href=\\"https://github.com/basd4g/typescript-tutorial1\\"target=\\"_blank\\">Typescript-tutorial1</a></li>\\n<li><a href=\\"https://github.com/basd4g/typescript-tutorial2\\"target=\\"_blank\\">Typescript-tutorial2</a></li>\\n<li><a href=\\"https://github.com/basd4g/chapter02-qiita-post.nuxt-tutorial\\"target=\\"_blank\\">chapter02-qiita-post.nuxt-tutorial</a></li>\\n<li><a href=\\"https://github.com/basd4g/chapter03-01-layout.nuxt-tutorial\\"target=\\"_blank\\">chapter03-01-layout.nuxt-tutorial</a></li>\\n<li><a href=\\"https://github.com/basd4g/chapter03-02-middleware.nuxt-tutorial\\"target=\\"_blank\\">chapter03-02-middleware.nuxt-tutorial</a></li>\\n</ul>\\n<h4 id=\\"夏インターン-1\\">夏インターン</h4>\\n<p>夏インターンのハッカソンで制作したWebアプリケーション。PHP製。</p>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/oshushume.20190807\\"target=\\"_blank\\">oshushume.20190807</a></li>\\n</ul>\\n<h4 id=\\"夏インターン後\\">夏インターン後</h4>\\n<p>夏インターンで扱ったNuxt.jsを生かして何かをしようと作っていたアプリケーションとその残骸。</p>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/green-turtle\\"target=\\"_blank\\">green-turtle (ブログのソースコード)</a></li>\\n<li><a href=\\"https://github.com/basd4g/nuxt.ts-blog\\"target=\\"_blank\\">nuxt.ts-blog</a></li>\\n<li><a href=\\"https://github.com/basd4g/nuxt.ts-blog.org\\"target=\\"_blank\\">nuxt.ts-blog.org</a></li>\\n<li><a href=\\"https://github.com/basd4g/nuxt.ts-template\\"target=\\"_blank\\">nuxt.ts-template</a></li>\\n<li><a href=\\"https://github.com/basd4g/nuxt.ts-template.org\\"target=\\"_blank\\">nuxt.ts-template.org</a></li>\\n</ul>\\n<p>最終的にこのブログとして形にして動いている。\\n(2020/05/19補足: <a href=\\"https://memo.basd4g.net\\"target=\\"_blank\\">memo.basd4g.net</a>ではなく<a href=\\"https://blog.yammer.fun\\"target=\\"_blank\\">Green Turtle</a>)</p>\\n<p>このブログ(<a href=\\"https://blog.yammer.fun\\"target=\\"_blank\\">Green Turtle</a>)のしくみは以下のようになっている。</p>\\n<p>mdファイルをgitリポジトリ(アプリケーションソースコードとは別のprivateリポジトリ)で管理している。\\nmasterにmergeすることで記事公開。</p>\\n<p>アプリケーションリポジトリも、記事リポジトリも、masterにmergeしたときにCircle CIが走ってデプロイするようになっている。</p>\\n<p>デプロイは次のような工程で行われる</p>\\n<ol>\\n<li>2つのリポジトリからソース、記事をclone</li>\\n<li>ソースコードのサンプル記事を破棄し、cloneした公開記事に置き換え</li>\\n<li>記事markdownをスクリプトでJSONに変換</li>\\n<li>Nuxt.jsをGenerateモードで動作させる</li>\\n<li>Nuxt.jsが記事ページを描画する際に、記事データが含まれるjsonファイルを読み込み、描画する。</li>\\n<li>Nuxt.jsにより静的なHTML,CSSファイルが生成される</li>\\n<li>Google Firebase Hostingに静的なHTML,CSSファイルをアップロード</li>\\n</ol>\\n<p>今後の展望</p>\\n<ul>\\n<li>トップページとaboutページが簡素なので、もう少しリッチなUIにしたい</li>\\n<li>過去記事へのリンクの経路が限られているので、記事下に「最近投稿した記事」などのリンクを置きたい。</li>\\n<li>(勉強も兼ねて)バックエンドも用意して、静的ファイルでの公開ではなく、SSRないしSPAで動作させたい。(表示速度は退化するので、完全に勉強目的)</li>\\n</ul>\\n<p>現在はブログというには簡素な状態だが、今後の拡張性はたくさん用意しているつもりである。\\nデプロイの手順も少々手間が混んでいるが、将来APIサーバを用意した際でも描画部分を使い回せるようにするためだったりする。\\nやりたいことはたくさんある。</p>\\n<h3 id=\\"swift--チーム開発でのiphoneアプリ製作-\\">Swift ( チーム開発でのiphoneアプリ製作 )</h3>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/ios-animals.enpit.2019.SU\\"target=\\"_blank\\">ios-animals.enpit.2019.SU</a></li>\\n<li><a href=\\"https://github.com/basd4g/ios-mymap.enpit.2019.SU\\"target=\\"_blank\\">ios-mymap.enpit.2019.SU</a></li>\\n<li><a href=\\"https://github.com/basd4g/ios-photo-viewer.enpit.2019.SU\\"target=\\"_blank\\">ios-photo-viewer.enpit.2019.SU</a></li>\\n<li><a href=\\"https://github.com/basd4g/ios-sample-calcurator.enpit.2019.SU\\"target=\\"_blank\\">ios-sample-calcurator.enpit.2019.SU</a></li>\\n<li><a href=\\"https://github.com/basd4g/ios-timer.enpit.2019.SU\\"target=\\"_blank\\">ios-timer.enpit.2019.SU</a></li>\\n<li><a href=\\"https://github.com/basd4g/PinsOfMap\\"target=\\"_blank\\">PinsOfMap</a></li>\\n<li><strike><a href=\\"https://github.com/basd4g/lovelab.heroku\\"target=\\"_blank\\">lovelab.heroku</a></strike>(2020/05/19追記: 現在の名前は<a href=\\"https://github.com/basd4g/lovelab-api\\"target=\\"_blank\\">lovelab-api</a>)</li>\\n<li><a href=\\"https://github.com/basd4g/lovelab.vue\\"target=\\"_blank\\">lovelab.vue</a></li>\\n</ul>\\n<p>9月から、学生どうしでチームを組むiPhoneアプリケーションの開発に関わっている。</p>\\n<p>上の5つはサンプルアプリケーションの実装。6つめはそれを生かした簡単な応用の位置情報保存アプリ。</p>\\n<p>7つめは10月より開発中のメインのアプリケーションのAPIサーバ。</p>\\n<p>8つめは10月より開発中のメインのアプリケーションのプロトタイプ。フロントエンドのWebアプリケーション</p>\\n<p>(2020/05/19追記: メインのiphoneアプリケーションのリポジトリはプライベートなのでここにリンクを貼っていない。)</p>\\n<h3 id=\\"rails-冬インターン\\">rails (冬インターン)</h3>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/bbs.rb\\"target=\\"_blank\\">bbs.rb</a></li>\\n<li><a href=\\"https://github.com/basd4g/rails-tutorial\\"target=\\"_blank\\">rails-tutorial</a></li>\\n<li><a href=\\"https://github.com/basd4g/rails-tutorial-toy_app\\"target=\\"_blank\\">rails-tutorial-toy_app</a></li>\\n</ul>\\n<p>冬インターンで</p>\\n<hr/>\\n<p>以上。 ここで止まっていた。\\nここからは2020年5月に書いている。</p>\\n<p>ちなみに冬インターンでRailsを使うものに参加したのでRailsを軽く触っていたのが最後の書きかけの項目。</p>\\n<p>今年度末は同じ内容の記事を書ききって公開したい。</p>","contentSnippet":"2020年も中頃だが、2019年末〜2020年正月に書きかけた記事が出てきた。\\n捨てるのも何なのでここに放出。\\n以下。年末に1年を振り返るという記事の趣旨から各リポジトリにリンクをつけた以外は原文のまま。\\nリンク以外の追記部分はその旨を記述している。\\nなにをするか\\nあけましておめでとうございます。\\n年越ししてしまいましたが、まだ正月なので昨年を振り返って今年に向けて身を引き締めたい。\\n今回はGitHubのリポジトリを総ざらいして自分がどんな開発をしたか振り返る。\\n準備:GitHubのリポジトリ一覧を取得する\\ngithubのAPIを用いて、curlでリポジトリ情報を取得する。\\n$ curl -u basd4g \\"https://api.github.com/users/basd4g/repos?per_page=100&page=1\\" | grep \'\\"name\\": \\"\' | awk -F \'\\"\' \'{print $4}\' > repos.txt\\n\\n\\n参考: GitHubのリポジトリを一覧化する（public/private両対応）- Qiita\\nリポジトリ一覧 (2019/12/31現在)\\n私(basd4g)のgithub上にあるpublicリポジトリは31個。\\nまともにGitHubを使い始めてから1年ほどというのもあり、すべて2019年に1コミット以上しているので、これらを振り返る。\\n純粋な個人趣味開発\\nc-sharp-socket\\n友人からの質問をきっかけにC#でソケット通信をしてみた、サンプルコード的なリポジトリ。\\ntext2pdf\\ntextデータをPDFファイルに出力できるアプリケーション。\\n2019年1月に、3日間で勢いで作った。実用で使うというより、プロモーションが中心だったので、表示自体は非常に簡素。\\nただし、node.js上で外部のライブラリやアプリケーションを用いず、PDFのファイル形式に従ってファイルへの文字列出力部分を自分で実装している。3日間にしては頑張ったな、という感じ。\\n日本語出力した際のフォントまわりが貧弱で、文字列が描画される位置が微妙である。\\n開発後半に、日本語出力をとってつけで開発したので、このあたりをしっかりすれば、もうすこし見た目が良くなるのではないかな。\\nPDFを開く環境による見た目の差異を検証したりすることが必要である。\\nもし文字データを手っ取り早くPDFにしたいのであれば、md-to-pdfがおすすめ。GitHub風CSSを当てると結構いい感じになる。\\nPlayQueue\\nYoutubeを連続再生するWebアプリケーション。\\n2018年末から断続的に開発している。\\n個人開発のアプリケーションとしては自分の代表作で、就活でも自分を紹介する際に話す機会が多い。\\n大学の授業に関係した開発\\nTuringMachineOnWeb\\n2019年1月制作。\\nチューリング機械の状態遷移表を作成するエディタと、作成した状態遷移表を検証するシュミレータを作った。\\nレポートに書く状態遷移表をつくったときに、つくった状態遷移表が正しいのかを検証するために作った。\\nUIは簡素だけれど、当時やりたかったことは達成させられたので満足。\\nclustering.AI.2019.SU\\nウォード法による階層的クラスタリングを扱ったレポートを書くために使ったスクリプト。\\npl0i\\npl0i.js\\npl0 interpreterという仮想マシンと、TypeScriptによる再実装(未完)\\n簡易なアセンブリと、より高級な言語との対応を学ぶために、アセンブリを実行する仮想マシンをつくることで理解を深める試みであった。\\nTypeScriptで書いていたときは、最終的にブラウザでメモリの状態や実行している命令の位置なども表示しながらプログラムを実行できるようなWebアプリケーションをつくるつもりだったが、大学の課題と就活を優先した結果開発が進まぬまま課題の方を先に終わらせて提出した。以後開発が停止し未完。\\n夏インターン\\n夏インターン準備\\n夏インターンでNuxt.jsとTypeScriptを扱うと聞いたので、その準備としてそれらの勉強のために書籍やWebサイトを参考にサンプルアプリを作って動かしてみたリポジトリ群\\nts-nuxt-tutorial\\ngreen-turtle-org\\nTypescript-tutorial1\\nTypescript-tutorial2\\nchapter02-qiita-post.nuxt-tutorial\\nchapter03-01-layout.nuxt-tutorial\\nchapter03-02-middleware.nuxt-tutorial\\n夏インターン\\n夏インターンのハッカソンで制作したWebアプリケーション。PHP製。\\noshushume.20190807\\n夏インターン後\\n夏インターンで扱ったNuxt.jsを生かして何かをしようと作っていたアプリケーションとその残骸。\\ngreen-turtle (ブログのソースコード)\\nnuxt.ts-blog\\nnuxt.ts-blog.org\\nnuxt.ts-template\\nnuxt.ts-template.org\\n最終的にこのブログとして形にして動いている。\\n(2020/05/19補足: memo.basd4g.netではなくGreen Turtle)\\nこのブログ(Green Turtle)のしくみは以下のようになっている。\\nmdファイルをgitリポジトリ(アプリケーションソースコードとは別のprivateリポジトリ)で管理している。\\nmasterにmergeすることで記事公開。\\nアプリケーションリポジトリも、記事リポジトリも、masterにmergeしたときにCircle CIが走ってデプロイするようになっている。\\nデプロイは次のような工程で行われる\\n2つのリポジトリからソース、記事をclone\\nソースコードのサンプル記事を破棄し、cloneした公開記事に置き換え\\n記事markdownをスクリプトでJSONに変換\\nNuxt.jsをGenerateモードで動作させる\\nNuxt.jsが記事ページを描画する際に、記事データが含まれるjsonファイルを読み込み、描画する。\\nNuxt.jsにより静的なHTML,CSSファイルが生成される\\nGoogle Firebase Hostingに静的なHTML,CSSファイルをアップロード\\n今後の展望\\nトップページとaboutページが簡素なので、もう少しリッチなUIにしたい\\n過去記事へのリンクの経路が限られているので、記事下に「最近投稿した記事」などのリンクを置きたい。\\n(勉強も兼ねて)バックエンドも用意して、静的ファイルでの公開ではなく、SSRないしSPAで動作させたい。(表示速度は退化するので、完全に勉強目的)\\n現在はブログというには簡素な状態だが、今後の拡張性はたくさん用意しているつもりである。\\nデプロイの手順も少々手間が混んでいるが、将来APIサーバを用意した際でも描画部分を使い回せるようにするためだったりする。\\nやりたいことはたくさんある。\\nSwift ( チーム開発でのiphoneアプリ製作 )\\nios-animals.enpit.2019.SU\\nios-mymap.enpit.2019.SU\\nios-photo-viewer.enpit.2019.SU\\nios-sample-calcurator.enpit.2019.SU\\nios-timer.enpit.2019.SU\\nPinsOfMap\\nlovelab.heroku(2020/05/19追記: 現在の名前はlovelab-api)\\nlovelab.vue\\n9月から、学生どうしでチームを組むiPhoneアプリケーションの開発に関わっている。\\n上の5つはサンプルアプリケーションの実装。6つめはそれを生かした簡単な応用の位置情報保存アプリ。\\n7つめは10月より開発中のメインのアプリケーションのAPIサーバ。\\n8つめは10月より開発中のメインのアプリケーションのプロトタイプ。フロントエンドのWebアプリケーション\\n(2020/05/19追記: メインのiphoneアプリケーションのリポジトリはプライベートなのでここにリンクを貼っていない。)\\nrails (冬インターン)\\nbbs.rb\\nrails-tutorial\\nrails-tutorial-toy_app\\n冬インターンで\\n以上。 ここで止まっていた。\\nここからは2020年5月に書いている。\\nちなみに冬インターンでRailsを使うものに参加したのでRailsを軽く触っていたのが最後の書きかけの項目。\\n今年度末は同じ内容の記事を書ききって公開したい。","guid":"https://memo.basd4g.net/posts/2019-github-repositories/","isoDate":"2020-05-19T12:44:57.000Z"},{"title":"非同期のまえに同期処理を通してPromiseとasync/awaitを理解する","link":"https://memo.basd4g.net/posts/promise/","pubDate":"Tue, 19 May 2020 16:50:47 +0900","content":"<p>JavaScript といえば非同期処理はつきものだが、非同期や Promise に苦手意識を持つ人も多いのではないだろうか。</p>\\n<p>これらの最初の理解のハードルは結構高いと思う。私も理解できずに悶絶した。C言語のポインタよりむずくないか？。。。</p>\\n<p>この記事の前半では一旦非同期のことは忘れる。\\nまず記事前半は、同期処理をテーマに、コールバック, Promise, async/await について説明する。\\n記事の後半は、これらを非同期処理を交えて説明する。</p>\\n<p>Promise はよくわからないという方や、一度挫折した方などにぜひ読んでもらいたい。</p>\\n<p>(2020/05/30補足: <a href=\\"https://qiita.com/basd4g/items/b1c96de727a53c4b4698\\"target=\\"_blank\\">Qiita投稿</a>に合わせて全体を修正済み。(<a href=\\"https://github.com/basd4g/memo.basd4g.net/blob/979b5576e05cb97e453b5cd3731e3802a0dc6fca/content/posts/promise.md\\"target=\\"_blank\\">旧版</a>))</p>\\n<h2 id=\\"対象読者\\">対象読者</h2>\\n<ul>\\n<li>JavaScript の基本的文法を知っている。(調べればわかる)</li>\\n<li>非同期処理, コールバック, Promise, async/awaitに苦手意識がある、よくわからない。</li>\\n</ul>\\n<p>JavaScriptを1行も読んだことも書いたこともない人、プログラミングをしたことのない人は対象としない。\\n逆に少しでも読み書きできればオーケー、のつもり。</p>\\n<h2 id=\\"目指すところ\\">目指すところ</h2>\\n<ul>\\n<li>同期処理と非同期処理の違いがわかる</li>\\n<li>(非同期処理を対象とした)他のPromise,async/awaitの解説記事を読んで理解が進む</li>\\n</ul>\\n<h2 id=\\"step0-準備\\">Step0 準備</h2>\\n<h3 id=\\"step0-1-mdn\\">Step0-1 MDN</h3>\\n<p>非同期処理もコールバックもPromiseもasync/awaitも関係ないが、まずMDNについて説明しておきたい。</p>\\n<p>JavaScriptでわからないことがあれば、まずは都度<a href=\\"https://developer.mozilla.org/ja/docs/Web/JavaScript\\"target=\\"_blank\\">MDN web docs</a>をみるとよい。</p>\\n<p>適当に検索して出てくる記事よりも、とりあえずここで確認しよう\\n(本記事も適当に検索して出てくる記事に該当するという矛盾がはらむ)。\\n一度理解して忘れていた記法などを確認するのにもとてもよい。</p>\\n<h3 id=\\"step0-2-chrome-developper-tool\\">Step0-2 Chrome Developper Tool</h3>\\n<p>以下JavaScirptの説明をするので、実際に動かしたくなる人もいるだろう。</p>\\n<p>PCにnode.jsが既にインストールされている人はそちらを使うのもよい。</p>\\n<p>しかし、インストールされていない人は、いちいちHTMLファイルを書いて、JavaScriptを読み込んで、、、とするのは面倒だろう。</p>\\n<p>もっと気軽にJavaScriptを試せる方法がある。\\nChrome developper Toolである。</p>\\n<p>ブラウザにGoogle Chromeを使っている人はウィンドウ右上の︙ &gt; その他のツール &gt; デベロッパーツール を開いてみよう。\\n画面上方の「Console」タブを開いて、文字を入力すると、JavaScriptがエンターキーを押すごとに実行されるはずだ。</p>\\n<h3 id=\\"step0-3-アロー関数\\">Step0-3 アロー関数</h3>\\n<p>ES6 (ES2015)以降の最近のJavaScriptでは、アロー関数という記法がある。\\nアロー関数がわからない人も、この記事出てくるので簡単に抑えておきたい。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"c1\\">// 従来の書き方\\n</span><span class=\\"c1\\"></span><span class=\\"kd\\">function</span> <span class=\\"nx\\">sum</span> <span class=\\"p\\">(</span> <span class=\\"nx\\">a</span><span class=\\"p\\">,</span> <span class=\\"nx\\">b</span> <span class=\\"p\\">)</span> <span class=\\"p\\">{</span>\\n<span class=\\"k\\">return</span> <span class=\\"nx\\">a</span> <span class=\\"o\\">+</span> <span class=\\"nx\\">b</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"c1\\">// アロー関数\\n</span><span class=\\"c1\\"></span><span class=\\"kr\\">const</span> <span class=\\"nx\\">sum2</span> <span class=\\"o\\">=</span> <span class=\\"p\\">(</span> <span class=\\"nx\\">a</span><span class=\\"p\\">,</span> <span class=\\"nx\\">b</span> <span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"k\\">return</span> <span class=\\"nx\\">a</span> <span class=\\"o\\">+</span> <span class=\\"nx\\">b</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">};</span>\\n<span class=\\"c1\\">// アロー関数 関数の中がreturn文だけのときは、{return}を省略できる\\n</span><span class=\\"c1\\"></span><span class=\\"kr\\">const</span> <span class=\\"nx\\">sum3</span> <span class=\\"o\\">=</span> <span class=\\"p\\">(</span> <span class=\\"nx\\">a</span><span class=\\"p\\">,</span> <span class=\\"nx\\">b</span> <span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"nx\\">a</span> <span class=\\"o\\">+</span> <span class=\\"nx\\">b</span><span class=\\"p\\">;</span>\\n<span class=\\"c1\\">// アロー関数 引数が1つのときだけ()が省略できる (0つ、2つ以上はダメ)\\n</span><span class=\\"c1\\"></span><span class=\\"kr\\">const</span> <span class=\\"nx\\">twice</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">a</span> <span class=\\"p\\">=&gt;</span> <span class=\\"nx\\">a</span><span class=\\"o\\">*</span><span class=\\"mi\\">2</span><span class=\\"p\\">;</span>\\n</code></pre></div><p>thisがbindされるかだとか他の違いは一旦忘れる。\\n上のように書けるということだけわかればよい。</p>\\n<p>さて、前置きが長くなったが準備が整った。</p>\\n<h2 id=\\"step1-同期処理\\">Step1 同期処理</h2>\\n<p>まずは非同期のことはわすれて、とりあえず読み進めて欲しい。</p>\\n<h3 id=\\"step1-1-コールバック-同期関数\\">Step1-1 コールバック (同期関数)</h3>\\n<p>コールバックとは、関数自体を引数として与え、別の関数に実行してもらうしくみだ。\\n電話を折り返すことに由来して名付けられた。\\n由来の通り、関数自体を伝えて「あとで都合が良くなったら実行しておいて」と実行を押し付ける方式。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kd\\">function</span> <span class=\\"nx\\">callbackFunc</span><span class=\\"p\\">()</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;callback&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"kd\\">function</span> <span class=\\"nx\\">callFunc</span> <span class=\\"p\\">(</span> <span class=\\"nx\\">func</span> <span class=\\"p\\">)</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">func</span><span class=\\"p\\">();</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">callbackFunc</span> <span class=\\"p\\">);</span>\\n</code></pre></div><p>ふつう、関数callbackFuncを実行するなら<code>callbackFunc()</code>のようにするだろう。\\nしかし上記では括弧をつけず<code>callbackFunc</code> を引数として渡している。</p>\\n<p>括弧をつけないことで、引数として関数自体を渡すだけでその場では実行されない。\\n後に callFunc 関数の中で、渡された関数 (<code>callbackFunc</code>)を実行してもらっている。</p>\\n<p>この「関数自体を渡す」というのがコールバックの肝である。\\nコールバックとは(戻り値の)値渡しではなく、関数自体の参照を渡しているという表現もできる。</p>\\n<p>次のような書き方では全く意味が変わってしまうので注意。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">callbackFunc</span><span class=\\"p\\">()</span> <span class=\\"p\\">);</span>\\n</code></pre></div><p>これでは、callbackFunc 関数を実行し、その戻り値を callFunc 関数に引数として渡すという意味になってしまう。</p>\\n<p>繰り返しになるが、コールバックは「関数自体を渡して」「あとで実行してもらう」しくみである。</p>\\n<p>参考: <a href=\\"https://developer.mozilla.org/ja/docs/Glossary/Callback_function\\"target=\\"_blank\\">Callback function(コールバック関数) MDN web docs</a></p>\\n<h4 id=\\"補足-コールバックとアロー関数\\">(補足) コールバックとアロー関数</h4>\\n<p>ちなみに上述のコードはアロー関数を使って次のようにも書ける。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">callbackFunc</span> <span class=\\"o\\">=</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;callback&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">};</span>\\n<span class=\\"kd\\">function</span> <span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">func</span> <span class=\\"p\\">)</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">func</span><span class=\\"p\\">();</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">callbackFunc</span> <span class=\\"p\\">);</span>\\n</code></pre></div><p>さらに、一度変数に入れるのをやめると</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kd\\">function</span> <span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"nx\\">func</span> <span class=\\"p\\">)</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">func</span><span class=\\"p\\">();</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"nx\\">callFunc</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;callback&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</code></pre></div><p>引数を指定する中で関数を定義してしまうのだ。\\nこのように関数自体を引数で渡すとき(即ちコールバック関数を渡すとき)、アロー関数でシンプルにかける。</p>\\n<h3 id=\\"step1-2-promise-同期関数\\">Step1-2 Promise (同期関数)</h3>\\n<p>Promise は英語で「約束する」という意味だ。\\n名前の通り、あとで値を返すことを約束するような動作をする。(約束を破ることもある。)</p>\\n<h4 id=\\"promise-の状態\\">Promise の状態</h4>\\n<p>Promise には3つの状態がある。</p>\\n<ul>\\n<li>pending &hellip; 約束している状態(初期状態)</li>\\n<li>fulfilled &hellip; 約束を守って値を返した状態</li>\\n<li>rejected &hellip; 約束を破った状態</li>\\n</ul>\\n<p>Promise オブジェクトはまず pending で始まり、あとで fulfilled や rejected に状態が変化する。</p>\\n<h5 id=\\"状態-pending\\">状態: pending</h5>\\n<p>とりあえず約束してみる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"p\\">});</span>\\n<span class=\\"c1\\">// 何もしない関数を、new Promise() に渡している。\\n</span><span class=\\"c1\\"></span><span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n</code></pre></div><p>pendingと表示されただろう。</p>\\n<p><em>ここでの変数<code>promise</code>は、Promise の状態 pending といえる。</em></p>\\n<h5 id=\\"状態-fulfilled\\">状態: fulfilled</h5>\\n<p>次は fulfilled の状態を作ってみる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">resolve</span><span class=\\"p\\">();</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n<span class=\\"c1\\">// 実はresolve,rejectはそれぞれ、渡された(コールバック)関数を引数として受け取っている。\\n</span></code></pre></div><p>Promise resoleved と表示されただろう。これが fulfilled である。</p>\\n<p>実は状態 fulfilled は値を持つ。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n</code></pre></div><p><em>ここでの変数<code>promise</code>は、Promiseの状態 fulfilled であり、値<code>\'hello\'</code>を持つといえる。</em></p>\\n<h5 id=\\"状態-rejected\\">状態: rejected</h5>\\n<p>rejected も fulfilled と同様に値を持つ。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">reject</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n</code></pre></div><p><em>ここでの変数<code>promise</code>は、Promise の状態 rejected であり、値<code>\'hello\'</code>を持つといえる。</em></p>\\n<p>rejected で渡される値(オブジェクト)は Error オブジェクトだったりする。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">reject</span><span class=\\"p\\">(</span><span class=\\"k\\">new</span> <span class=\\"nb\\">Error</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;error message&#39;</span><span class=\\"p\\">));</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span> <span class=\\"nx\\">promise</span> <span class=\\"p\\">);</span>\\n</code></pre></div><p><em>ここでの変数<code>promise</code>は、Promise の状態 rejected であり、値に Error オブジェクトを持つといえる。</em></p>\\n<h4 id=\\"状態の変化\\">状態の変化</h4>\\n<p>Promiseでは状態が変化する。\\n初期状態では pending であるが、のちに fulfilled や rejected になる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"c1\\">//この行が実行されるタイミングでは、変数promiseは状態pending\\n</span><span class=\\"c1\\"></span> <span class=\\"k\\">if</span><span class=\\"p\\">(</span> <span class=\\"kc\\">true</span> <span class=\\"p\\">){</span>\\n<span class=\\"c1\\">//この行が実行されるタイミングでも、まだ変数promiseは状態pending\\n</span><span class=\\"c1\\"></span> <span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;resolveされた!&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"c1\\">//この行が実行されるタイミングでは、変数promiseは状態fulfilledで値&#39;resolveされた!&#39;を持つ\\n</span><span class=\\"c1\\"></span> <span class=\\"k\\">return</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"c1\\">// ここから先は実行されない\\n</span><span class=\\"c1\\"></span> <span class=\\"nx\\">reject</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;rejectされた&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</code></pre></div><p>現在は同期処理を行っているので、fulfill または reject された状態に一瞬で変化してしまい、 pending の状態をみることはできない。</p>\\n<p>しかし厳密にはもともとは pending で、 <code>resolve()</code>を実行すると fulfilled に、 <code>reject()</code> を実行すると rejected に、それぞれ状態が移行する。</p>\\n<h4 id=\\"thencatch-による-promise-チェーン\\">then/catch による Promise チェーン</h4>\\n<p>さて、Promise には3状態あり、変化することがわかった。\\n変化すると何ができるのか？ それをこの節で説明する。</p>\\n<p>Promise オブジェクトのメソッドに、then と catch がある。</p>\\n<p>これらはそれぞれ第一引数に関数をとり、Promise が fulfilled や rejected の状態になると引数関数を実行する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// ここではhelloが表示される\\n</span><span class=\\"c1\\"></span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;then is called&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</code></pre></div><div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">reject</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">promise</span><span class=\\"p\\">.</span><span class=\\"k\\">catch</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// ここではhelloが表示される\\n</span><span class=\\"c1\\"></span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;catch is called&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</code></pre></div><p>このように<code>.</code>でつないで then/catch メソッドを呼べば、それらを発火できる。</p>\\n<p>さらに、then/catch メソッドの戻り値に promise を与えてやれば、更に繋げられる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">promise</span>\\n<span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;then is called&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"k\\">return</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;resolve!&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"k\\">return</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">+</span> <span class=\\"s1\\">&#39;!&#39;</span> <span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// resolve!! と表示される。\\n</span><span class=\\"c1\\"></span> <span class=\\"p\\">})</span>\\n<span class=\\"c1\\">// Promise.resolve(&#39;resolve!&#39;); は、\\n</span><span class=\\"c1\\">// new Promise( resolve =&gt; { resolve(&#39;resolve!&#39;) }); と同じ。\\n</span></code></pre></div><p>上述の通り、then メソッドの戻り値に Promise を渡すと、更に後ろに<code>.then()</code>を繋げられる。\\n(<code>.catch()</code>も繋げられる。)</p>\\n<p>このように、Promise が解決 (fulfill/reject) されたら<code>.then()</code>メソッドが発火し、\\n<code>.then()</code>メソッドがPromiseを返すと、解決されたらさらに後ろの<code>.then()</code>メソッドが発火し、、、</p>\\n<p>このように数珠つなぎに徐々に Promise が渡ることを Promise チェーンと呼ぶ。</p>\\n<hr/>\\n<p>ここまでで Promise を学んだ。\\nコールバックや Promise を使う理由は非同期関数にあるので、読者の皆様にはややこしいことをしているようにしか見えないかもしれない。</p>\\n<p>本当はこのあたりで非同期関数について説明し Promise のありがたみを理解していただくのもよいのだが、この記事はあくまで「まず同期関数で理解する。」ことが目的であり、非同期関数はもう少し後回しにする。</p>\\n<hr/>\\n<h3 id=\\"step1-3-asyncawait-同期関数\\">Step1-3 async/await (同期関数)</h3>\\n<p>次は sync/await だ。</p>\\n<p>そのまえに説明すべきことが2つほどあるので補足。</p>\\n<h4 id=\\"補足-即時関数\\">補足: 即時関数</h4>\\n<p>即時関数は定義と同時に実行する関数だ。\\n関数定義を括弧でくくると即時実行される。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">Hello</span> <span class=\\"o\\">=</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">)</span> <span class=\\"p\\">};</span>\\n<span class=\\"nx\\">Hello</span><span class=\\"p\\">();</span>\\n<span class=\\"c1\\">// 上2行のコードは、次の行のコードと同じ。\\n</span><span class=\\"c1\\"></span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">)</span> <span class=\\"p\\">});</span>\\n<span class=\\"c1\\">// アロー関数でなくても良い\\n</span><span class=\\"c1\\"></span><span class=\\"p\\">(</span> <span class=\\"kd\\">function</span> <span class=\\"p\\">()</span> <span class=\\"p\\">{</span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">)</span> <span class=\\"p\\">});</span>\\n</code></pre></div><h4 id=\\"補足-async-関数-asnyc-function\\">補足: Async 関数 (asnyc function)</h4>\\n<p>関数定義の前に<code>async</code>とつけて定義する。\\nAsnyc 関数の中でのみ await が使える。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"c1\\">// 例\\n</span><span class=\\"c1\\"></span><span class=\\"kr\\">const</span> <span class=\\"nx\\">arrowFunc</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">async</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">await</span> <span class=\\"nx\\">promise</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"nx\\">async</span> <span class=\\"kd\\">function</span> <span class=\\"nx\\">func</span><span class=\\"p\\">()</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">await</span> <span class=\\"nx\\">promise</span><span class=\\"p\\">;</span>\\n<span class=\\"p\\">}</span>\\n</code></pre></div><hr/>\\n<h4 id=\\"改めて-asyncawait-同期関数\\">改めて async/await (同期関数)</h4>\\n<p>閑話休題。</p>\\n<p>async/await は Promise を生成する構文と言っていい。\\n先程の then を書かずともよくなる構文である。</p>\\n<p>前節の Promise のコードを再掲する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// ここではhelloが表示される\\n</span><span class=\\"c1\\"></span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;then is called&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</code></pre></div><p>これを async/await に書き直すと</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"p\\">(</span><span class=\\"nx\\">async</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"kr\\">const</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">await</span> <span class=\\"nx\\">promise</span><span class=\\"p\\">;</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// ここではhelloが表示される\\n</span><span class=\\"c1\\"></span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;then is called&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n</code></pre></div><p>このようになる。\\nthen が消えたことがわかる。</p>\\n<p>(即時実行のasync関数を使っている。)</p>\\n<br/>\\n<p>もう一つ前節のコードを再掲し async/await に書き換えてみる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">promise</span>\\n<span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;then is called&#39;</span><span class=\\"p\\">)</span>\\n<span class=\\"k\\">return</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;resolve!&#39;</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"k\\">return</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">+</span> <span class=\\"s1\\">&#39;!&#39;</span> <span class=\\"p\\">)</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// resolve!! と表示される。\\n</span><span class=\\"c1\\"></span> <span class=\\"p\\">})</span>\\n</code></pre></div><p>async/await に書き換えると</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"p\\">(</span> <span class=\\"nx\\">async</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"kd\\">let</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">await</span> <span class=\\"nx\\">promise</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;then is called&#39;</span><span class=\\"p\\">)</span>\\n<span class=\\"kd\\">let</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">await</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;resolve!&#39;</span><span class=\\"p\\">)</span>\\n<span class=\\"kd\\">let</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">=</span> <span class=\\"nx\\">await</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">(</span> <span class=\\"nx\\">arg</span> <span class=\\"o\\">+</span> <span class=\\"s1\\">&#39;!&#39;</span> <span class=\\"p\\">)</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"nx\\">arg</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// resolve!! と表示される。\\n</span><span class=\\"c1\\"></span><span class=\\"p\\">})</span>\\n</code></pre></div><p>今度は then がなくなったことで短く書けたことが伝わるのではないか。</p>\\n<p><code>await</code>が現れると、Async 関数内の<code>await</code>より後ろの部分が全て<code>then()</code>の引数として包まれる、といった見方もできる。</p>\\n<p>以上のように、async/await は Promise を簡潔に書く構文である。</p>\\n<br/>\\n<h4 id=\\"余談-promiseは必要か\\">余談: Promiseは必要か?</h4>\\n<p>async/awaitで簡潔にかけるなら、Promiseなんて理解しなくて良いのでは？と思う方もいるだろう。\\nしかし今の所そうも行かないのだ。</p>\\n<p>複数のPromiseを同時に待つ処理をasync/awaitで書いてみる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"p\\">(</span> <span class=\\"nx\\">async</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">await</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">all</span><span class=\\"p\\">(</span> <span class=\\"p\\">[</span> <span class=\\"nx\\">promise1</span><span class=\\"p\\">,</span> <span class=\\"nx\\">promise2</span> <span class=\\"p\\">])</span>\\n<span class=\\"p\\">})</span>\\n</code></pre></div><p>うお、Promise出てきた。。。</p>\\n<p>コードの内容はおいておいて、Promise という単語が出てきたことに注目。\\n解説は省くが、async/await は Promise を完全には隠しきれていないのだ。</p>\\n<p>(気になる方はこの記事を読み終えてから<a href=\\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise/all\\"target=\\"_blank\\"><code>Promise.all</code></a>をみると良いだろう。</p>\\n<br/>\\n<h2 id=\\"step2-非同期処理\\">Step2 非同期処理</h2>\\n<p>さてさて、ここまで来ればゴールは近い。\\nこの節では今まで苦労して覚えた謎構文 Promise と asnyc/await のありがたみがわかるようになる。</p>\\n<h3 id=\\"step2-1-同期関数と非同期関数\\">Step2-1 同期関数と非同期関数</h3>\\n<p>同期関数と非同期関数について説明する。</p>\\n<ul>\\n<li>同期関数とは、中の処理が完了するまで待ってから戻り値を返す関数のこと</li>\\n<li>非同期関数とは、中の処理にかかわらず、すぐに戻り値を返してしまう関数のこと</li>\\n</ul>\\n<p>JavaScript の代表的な非同期関数に<code>setTimeOut()</code>がある。</p>\\n<p>次のようなコードで考えてみよう。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;world&#39;</span><span class=\\"p\\">);</span>\\n</code></pre></div><p>JavaScript は、普通は(同期関数は)、上から順番に1行ずつ実行される。</p>\\n<p>しかし上記のコードを実行すると<code>world</code>が表示された後に<code>hello</code>が表示される。\\nこれは<code>setTimeOut()</code>関数が非同期関数だからだ。</p>\\n<p>書き方を少し変えてみる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kd\\">function</span> <span class=\\"nx\\">Hello</span><span class=\\"p\\">()</span> <span class=\\"p\\">{</span> <span class=\\"c1\\">// 1\\n</span><span class=\\"c1\\"></span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;hello&#39;</span><span class=\\"p\\">);</span> <span class=\\"c1\\">// 4\\n</span><span class=\\"c1\\"></span><span class=\\"p\\">}</span>\\n<span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"nx\\">Hello</span><span class=\\"p\\">,</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// 2\\n</span><span class=\\"c1\\"></span><span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;world&#39;</span><span class=\\"p\\">)</span> <span class=\\"c1\\">// 3\\n</span></code></pre></div><p>さっきと同じ動作をするコードだ。</p>\\n<p>コンピュータの気持ちになってみると</p>\\n<ol>\\n<li>Hello 関数を定義するよ。Hello 関数は実行されたら<code>\'hello\'</code>と表示するよ。まだ定義だけで実行しないよ。</li>\\n<li>setTimeOut 関数を実行するよ。Hello 関数を 1000ms 後に実行するとを登録するよ。<strong>登録するだけで、すぐに戻り値を返すよ。</strong></li>\\n<li><code>\'world\'</code>と表示するよ。</li>\\n</ol>\\n<p>&hellip; しばらく (1000ms) 経って &hellip;</p>\\n<ol start=\\"4\\">\\n<li>Hello 関数を実行するよ、<code>\'hello\'</code>と表示するよ。</li>\\n</ol>\\n<p>このような順で動作する。\\n同期関数はその行で処理が停止するのに対し、非同期関数はすぐに次の行が実行される。</p>\\n<h2 id=\\"step2-2-コールバック-非同期関数\\">Step2-2 コールバック (非同期関数)</h2>\\n<p>先程の例で非同期関数を実現してるのがコールバックだ。</p>\\n<p>あとで実行して欲しい関数を引数で伝えておいて、ときが来たら実行する。</p>\\n<p>やりたいことはコールバックで実現できるものの、何重にも重なると次のようなコードにになってしまう。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;6s later&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;これはすぐに実行される&#39;</span><span class=\\"p\\">);</span>\\n</code></pre></div><p>コールバック関数を呼ぶたびにネストが深くなってしまい読みづらい。</p>\\n<p>俗に言うコールバック地獄である。\\nたとえばこの例だと、どの秒数がどの setTimeOut に対応するのかわかりづらい。</p>\\n<p>(上記の例は全て一つの setTimeOut にまとめられるが)\\n実際には次のような状況が考えられる。</p>\\n<ol>\\n<li>サーバと通信して、記事のリストをとってくる。</li>\\n<li>記事のリストから該当の記事を探して、再度サーバと通信して本文をとってくる。</li>\\n</ol>\\n<p>このように、複数の非同期処理が数珠つなぎになることもあるだろう。</p>\\n<p>数珠つなぎ、、、</p>\\n<h2 id=\\"step2-3-promise-非同期関数\\">Step2-3 Promise (非同期関数)</h2>\\n<p>そう、数珠つなぎならさっきの Promise チェーンと相性が良い。</p>\\n<p>さっきの6秒待つ処理も</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"c1\\">// 事前に Promise 関数を作っておく。\\n</span><span class=\\"c1\\">// ライブラリなどで用意されていたりするので、Promise を使う側は作る必要はない。\\n</span><span class=\\"c1\\"></span><span class=\\"kd\\">function</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"nx\\">time</span><span class=\\"p\\">){</span>\\n<span class=\\"k\\">return</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"nx\\">resolve</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">});</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span>\\n<span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span>\\n<span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span>\\n<span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span>\\n<span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span>\\n<span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">).</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;6s later&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;これはすぐに実行される&#39;</span><span class=\\"p\\">);</span>\\n</code></pre></div><p>ネストが解消されて、引数もコンパクトになって見やすくなった。</p>\\n<h2 id=\\"step2-4-asnycawait-非同期関数\\">Step2-4 asnyc/await (非同期関数)</h2>\\n<p>さらに async/awaitで書き直すと</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"c1\\">// 事前に Promise 関数を作っておく。\\n</span><span class=\\"c1\\">// さっきと同じ。\\n</span><span class=\\"c1\\"></span><span class=\\"kd\\">function</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"nx\\">time</span><span class=\\"p\\">){</span>\\n<span class=\\"k\\">return</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"nx\\">resolve</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">setTimeOut</span><span class=\\"p\\">(</span> <span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"p\\">(</span> <span class=\\"nx\\">async</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">await</span> <span class=\\"nx\\">setTimeOutPromise</span><span class=\\"p\\">(</span><span class=\\"mi\\">1000</span><span class=\\"p\\">);</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;6s later&#39;</span><span class=\\"p\\">);</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;これはすぐに実行される&#39;</span><span class=\\"p\\">);</span>\\n</code></pre></div><p>これは見やすい！\\n非同期関数を同期的に書けるようになった。</p>\\n<p>await の行で停止しているかのように動作する。</p>\\n<h2 id=\\"さいごに\\">さいごに</h2>\\n<p>本記事を読み次の2つを知れば、他の記事が格段に読みやすくなるだろう。</p>\\n<ul>\\n<li>同期処理と非同期処理の違い</li>\\n<li>同期処理でPromiseがどういう動作をするか</li>\\n</ul>\\n<p>これからは「コールバック地獄を解決するために Promise チェーンがある」「 async/await は Promise の生成だ」などと書かれた他の記事も読めるのではないだろうか。</p>\\n<p>この記事を完全に理解できなくても、 読者の皆様はこれから JavaScript の非同期処理を深める土台ができているのではないかと思う。</p>\\n<p>ここまでの長文に付き合いいただきありがたい。</p>\\n<p>以上。</p>","contentSnippet":"JavaScript といえば非同期処理はつきものだが、非同期や Promise に苦手意識を持つ人も多いのではないだろうか。\\nこれらの最初の理解のハードルは結構高いと思う。私も理解できずに悶絶した。C言語のポインタよりむずくないか？。。。\\nこの記事の前半では一旦非同期のことは忘れる。\\nまず記事前半は、同期処理をテーマに、コールバック, Promise, async/await について説明する。\\n記事の後半は、これらを非同期処理を交えて説明する。\\nPromise はよくわからないという方や、一度挫折した方などにぜひ読んでもらいたい。\\n(2020/05/30補足: Qiita投稿に合わせて全体を修正済み。(旧版))\\n対象読者\\nJavaScript の基本的文法を知っている。(調べればわかる)\\n非同期処理, コールバック, Promise, async/awaitに苦手意識がある、よくわからない。\\nJavaScriptを1行も読んだことも書いたこともない人、プログラミングをしたことのない人は対象としない。\\n逆に少しでも読み書きできればオーケー、のつもり。\\n目指すところ\\n同期処理と非同期処理の違いがわかる\\n(非同期処理を対象とした)他のPromise,async/awaitの解説記事を読んで理解が進む\\nStep0 準備\\nStep0-1 MDN\\n非同期処理もコールバックもPromiseもasync/awaitも関係ないが、まずMDNについて説明しておきたい。\\nJavaScriptでわからないことがあれば、まずは都度MDN web docsをみるとよい。\\n適当に検索して出てくる記事よりも、とりあえずここで確認しよう\\n(本記事も適当に検索して出てくる記事に該当するという矛盾がはらむ)。\\n一度理解して忘れていた記法などを確認するのにもとてもよい。\\nStep0-2 Chrome Developper Tool\\n以下JavaScirptの説明をするので、実際に動かしたくなる人もいるだろう。\\nPCにnode.jsが既にインストールされている人はそちらを使うのもよい。\\nしかし、インストールされていない人は、いちいちHTMLファイルを書いて、JavaScriptを読み込んで、、、とするのは面倒だろう。\\nもっと気軽にJavaScriptを試せる方法がある。\\nChrome developper Toolである。\\nブラウザにGoogle Chromeを使っている人はウィンドウ右上の︙ > その他のツール > デベロッパーツール を開いてみよう。\\n画面上方の「Console」タブを開いて、文字を入力すると、JavaScriptがエンターキーを押すごとに実行されるはずだ。\\nStep0-3 アロー関数\\nES6 (ES2015)以降の最近のJavaScriptでは、アロー関数という記法がある。\\nアロー関数がわからない人も、この記事出てくるので簡単に抑えておきたい。\\n// 従来の書き方\\nfunction sum ( a, b ) {\\nreturn a + b;\\n}\\n// アロー関数\\nconst sum2 = ( a, b ) => {\\nreturn a + b;\\n};\\n// アロー関数 関数の中がreturn文だけのときは、{return}を省略できる\\nconst sum3 = ( a, b ) => a + b;\\n// アロー関数 引数が1つのときだけ()が省略できる (0つ、2つ以上はダメ)\\nconst twice = a => a*2;\\n\\n\\nthisがbindされるかだとか他の違いは一旦忘れる。\\n上のように書けるということだけわかればよい。\\nさて、前置きが長くなったが準備が整った。\\nStep1 同期処理\\nまずは非同期のことはわすれて、とりあえず読み進めて欲しい。\\nStep1-1 コールバック (同期関数)\\nコールバックとは、関数自体を引数として与え、別の関数に実行してもらうしくみだ。\\n電話を折り返すことに由来して名付けられた。\\n由来の通り、関数自体を伝えて「あとで都合が良くなったら実行しておいて」と実行を押し付ける方式。\\nfunction callbackFunc() {\\nconsole.log(\'callback\');\\n}\\nfunction callFunc ( func ) {\\nfunc();\\n}\\ncallFunc( callbackFunc );\\n\\n\\nふつう、関数callbackFuncを実行するならcallbackFunc()のようにするだろう。\\nしかし上記では括弧をつけずcallbackFunc を引数として渡している。\\n括弧をつけないことで、引数として関数自体を渡すだけでその場では実行されない。\\n後に callFunc 関数の中で、渡された関数 (callbackFunc)を実行してもらっている。\\nこの「関数自体を渡す」というのがコールバックの肝である。\\nコールバックとは(戻り値の)値渡しではなく、関数自体の参照を渡しているという表現もできる。\\n次のような書き方では全く意味が変わってしまうので注意。\\ncallFunc( callbackFunc() );\\n\\n\\nこれでは、callbackFunc 関数を実行し、その戻り値を callFunc 関数に引数として渡すという意味になってしまう。\\n繰り返しになるが、コールバックは「関数自体を渡して」「あとで実行してもらう」しくみである。\\n参考: Callback function(コールバック関数) MDN web docs\\n(補足) コールバックとアロー関数\\nちなみに上述のコードはアロー関数を使って次のようにも書ける。\\nconst callbackFunc = () => {\\nconsole.log(\'callback\');\\n};\\nfunction callFunc( func ) {\\nfunc();\\n}\\ncallFunc( callbackFunc );\\n\\n\\nさらに、一度変数に入れるのをやめると\\nfunction callFunc( func ) {\\nfunc();\\n}\\ncallFunc( () => {\\nconsole.log(\'callback\');\\n})\\n\\n\\n引数を指定する中で関数を定義してしまうのだ。\\nこのように関数自体を引数で渡すとき(即ちコールバック関数を渡すとき)、アロー関数でシンプルにかける。\\nStep1-2 Promise (同期関数)\\nPromise は英語で「約束する」という意味だ。\\n名前の通り、あとで値を返すことを約束するような動作をする。(約束を破ることもある。)\\nPromise の状態\\nPromise には3つの状態がある。\\npending … 約束している状態(初期状態)\\nfulfilled … 約束を守って値を返した状態\\nrejected … 約束を破った状態\\nPromise オブジェクトはまず pending で始まり、あとで fulfilled や rejected に状態が変化する。\\n状態: pending\\nとりあえず約束してみる。\\nconst promise = new Promise( (resolve, reject) => {\\n});\\n// 何もしない関数を、new Promise() に渡している。\\nconsole.log( promise );\\n\\n\\npendingと表示されただろう。\\nここでの変数promiseは、Promise の状態 pending といえる。\\n状態: fulfilled\\n次は fulfilled の状態を作ってみる。\\nconst promise = new Promise( (resolve, reject) => {\\nresolve();\\n})\\nconsole.log( promise );\\n// 実はresolve,rejectはそれぞれ、渡された(コールバック)関数を引数として受け取っている。\\n\\n\\nPromise resoleved と表示されただろう。これが fulfilled である。\\n実は状態 fulfilled は値を持つ。\\nconst promise = new Promise( (resolve, reject) => {\\nresolve(\'hello\');\\n})\\nconsole.log( promise );\\n\\n\\nここでの変数promiseは、Promiseの状態 fulfilled であり、値\'hello\'を持つといえる。\\n状態: rejected\\nrejected も fulfilled と同様に値を持つ。\\nconst promise = new Promise( (resolve, reject) => {\\nreject(\'hello\');\\n})\\nconsole.log( promise );\\n\\n\\nここでの変数promiseは、Promise の状態 rejected であり、値\'hello\'を持つといえる。\\nrejected で渡される値(オブジェクト)は Error オブジェクトだったりする。\\nconst promise = new Promise( (resolve, reject) => {\\nreject(new Error(\'error message\'));\\n})\\nconsole.log( promise );\\n\\n\\nここでの変数promiseは、Promise の状態 rejected であり、値に Error オブジェクトを持つといえる。\\n状態の変化\\nPromiseでは状態が変化する。\\n初期状態では pending であるが、のちに fulfilled や rejected になる。\\nconst promise = new Promise( (resolve, reject) => {\\n//この行が実行されるタイミングでは、変数promiseは状態pending\\n if( true ){\\n//この行が実行されるタイミングでも、まだ変数promiseは状態pending\\n resolve(\'resolveされた!\');\\n//この行が実行されるタイミングでは、変数promiseは状態fulfilledで値\'resolveされた!\'を持つ\\n return;\\n}\\n// ここから先は実行されない\\n reject(\'rejectされた\');\\n})\\n\\n\\n現在は同期処理を行っているので、fulfill または reject された状態に一瞬で変化してしまい、 pending の状態をみることはできない。\\nしかし厳密にはもともとは pending で、 resolve()を実行すると fulfilled に、 reject() を実行すると rejected に、それぞれ状態が移行する。\\nthen/catch による Promise チェーン\\nさて、Promise には3状態あり、変化することがわかった。\\n変化すると何ができるのか？ それをこの節で説明する。\\nPromise オブジェクトのメソッドに、then と catch がある。\\nこれらはそれぞれ第一引数に関数をとり、Promise が fulfilled や rejected の状態になると引数関数を実行する。\\nconst promise = new Promise( (resolve, reject) => {\\nresolve(\'hello\');\\n})\\npromise.then( arg => {\\nconsole.log(arg); // ここではhelloが表示される\\n console.log(\'then is called\');\\n})\\n\\n\\nconst promise = new Promise( (resolve, reject) => {\\nreject(\'hello\');\\n})\\npromise.catch( arg => {\\nconsole.log(arg); // ここではhelloが表示される\\n console.log(\'catch is called\');\\n})\\n\\n\\nこのように.でつないで then/catch メソッドを呼べば、それらを発火できる。\\nさらに、then/catch メソッドの戻り値に promise を与えてやれば、更に繋げられる。\\nconst promise = new Promise( (resolve, reject) => {\\nresolve(\'hello\');\\n})\\npromise\\n.then( () => {\\nconsole.log(\'then is called\');\\nreturn Promise.resolve(\'resolve!\');\\n})\\n.then( arg => {\\nreturn Promise.resolve( arg + \'!\' );\\n})\\n.then( arg => {\\nconsole.log(arg); // resolve!! と表示される。\\n })\\n// Promise.resolve(\'resolve!\'); は、\\n// new Promise( resolve => { resolve(\'resolve!\') }); と同じ。\\n\\n\\n上述の通り、then メソッドの戻り値に Promise を渡すと、更に後ろに.then()を繋げられる。\\n(.catch()も繋げられる。)\\nこのように、Promise が解決 (fulfill/reject) されたら.then()メソッドが発火し、\\n.then()メソッドがPromiseを返すと、解決されたらさらに後ろの.then()メソッドが発火し、、、\\nこのように数珠つなぎに徐々に Promise が渡ることを Promise チェーンと呼ぶ。\\nここまでで Promise を学んだ。\\nコールバックや Promise を使う理由は非同期関数にあるので、読者の皆様にはややこしいことをしているようにしか見えないかもしれない。\\n本当はこのあたりで非同期関数について説明し Promise のありがたみを理解していただくのもよいのだが、この記事はあくまで「まず同期関数で理解する。」ことが目的であり、非同期関数はもう少し後回しにする。\\nStep1-3 async/await (同期関数)\\n次は sync/await だ。\\nそのまえに説明すべきことが2つほどあるので補足。\\n補足: 即時関数\\n即時関数は定義と同時に実行する関数だ。\\n関数定義を括弧でくくると即時実行される。\\nconst Hello = () => { console.log(\'hello\') };\\nHello();\\n// 上2行のコードは、次の行のコードと同じ。\\n( () => { console.log(\'hello\') });\\n// アロー関数でなくても良い\\n( function () { console.log(\'hello\') });\\n\\n\\n補足: Async 関数 (asnyc function)\\n関数定義の前にasyncとつけて定義する。\\nAsnyc 関数の中でのみ await が使える。\\n// 例\\nconst arrowFunc = async () => {\\nawait promise;\\n}\\nasync function func() {\\nawait promise;\\n}\\n\\n\\n改めて async/await (同期関数)\\n閑話休題。\\nasync/await は Promise を生成する構文と言っていい。\\n先程の then を書かずともよくなる構文である。\\n前節の Promise のコードを再掲する。\\nconst promise = new Promise( (resolve, reject) => {\\nresolve(\'hello\');\\n})\\npromise.then( arg => {\\nconsole.log(arg) // ここではhelloが表示される\\n console.log(\'then is called\');\\n})\\n\\n\\nこれを async/await に書き直すと\\nconst promise = new Promise( (resolve, reject) => {\\nresolve(\'hello\');\\n})\\n(async () => {\\nconst arg = await promise;\\nconsole.log(arg); // ここではhelloが表示される\\n console.log(\'then is called\');\\n})\\n\\n\\nこのようになる。\\nthen が消えたことがわかる。\\n(即時実行のasync関数を使っている。)\\nもう一つ前節のコードを再掲し async/await に書き換えてみる。\\nconst promise = new Promise( (resolve, reject) => {\\nresolve(\'hello\')\\n})\\npromise\\n.then( () => {\\nconsole.log(\'then is called\')\\nreturn Promise.resolve(\'resolve!\')\\n})\\n.then( arg => {\\nreturn Promise.resolve( arg + \'!\' )\\n})\\n.then( arg => {\\nconsole.log(arg) // resolve!! と表示される。\\n })\\n\\n\\nasync/await に書き換えると\\nconst promise = new Promise( (resolve, reject) => {\\nresolve(\'hello\')\\n})\\n( async () => {\\nlet arg = await promise\\nconsole.log(\'then is called\')\\nlet arg = await Promise.resolve(\'resolve!\')\\nlet arg = await Promise.resolve( arg + \'!\' )\\nconsole.log(arg) // resolve!! と表示される。\\n})\\n\\n\\n今度は then がなくなったことで短く書けたことが伝わるのではないか。\\nawaitが現れると、Async 関数内のawaitより後ろの部分が全てthen()の引数として包まれる、といった見方もできる。\\n以上のように、async/await は Promise を簡潔に書く構文である。\\n余談: Promiseは必要か?\\nasync/awaitで簡潔にかけるなら、Promiseなんて理解しなくて良いのでは？と思う方もいるだろう。\\nしかし今の所そうも行かないのだ。\\n複数のPromiseを同時に待つ処理をasync/awaitで書いてみる。\\n( async () => {\\nawait Promise.all( [ promise1, promise2 ])\\n})\\n\\n\\nうお、Promise出てきた。。。\\nコードの内容はおいておいて、Promise という単語が出てきたことに注目。\\n解説は省くが、async/await は Promise を完全には隠しきれていないのだ。\\n(気になる方はこの記事を読み終えてからPromise.allをみると良いだろう。\\nStep2 非同期処理\\nさてさて、ここまで来ればゴールは近い。\\nこの節では今まで苦労して覚えた謎構文 Promise と asnyc/await のありがたみがわかるようになる。\\nStep2-1 同期関数と非同期関数\\n同期関数と非同期関数について説明する。\\n同期関数とは、中の処理が完了するまで待ってから戻り値を返す関数のこと\\n非同期関数とは、中の処理にかかわらず、すぐに戻り値を返してしまう関数のこと\\nJavaScript の代表的な非同期関数にsetTimeOut()がある。\\n次のようなコードで考えてみよう。\\nsetTimeOut( () => {\\nconsole.log(\'hello\');\\n}, 1000);\\nconsole.log(\'world\');\\n\\n\\nJavaScript は、普通は(同期関数は)、上から順番に1行ずつ実行される。\\nしかし上記のコードを実行するとworldが表示された後にhelloが表示される。\\nこれはsetTimeOut()関数が非同期関数だからだ。\\n書き方を少し変えてみる。\\nfunction Hello() { // 1\\n console.log(\'hello\'); // 4\\n}\\nsetTimeOut( Hello, 1000) // 2\\nconsole.log(\'world\') // 3\\n\\n\\nさっきと同じ動作をするコードだ。\\nコンピュータの気持ちになってみると\\nHello 関数を定義するよ。Hello 関数は実行されたら\'hello\'と表示するよ。まだ定義だけで実行しないよ。\\nsetTimeOut 関数を実行するよ。Hello 関数を 1000ms 後に実行するとを登録するよ。登録するだけで、すぐに戻り値を返すよ。\\n\'world\'と表示するよ。\\n… しばらく (1000ms) 経って …\\nHello 関数を実行するよ、\'hello\'と表示するよ。\\nこのような順で動作する。\\n同期関数はその行で処理が停止するのに対し、非同期関数はすぐに次の行が実行される。\\nStep2-2 コールバック (非同期関数)\\n先程の例で非同期関数を実現してるのがコールバックだ。\\nあとで実行して欲しい関数を引数で伝えておいて、ときが来たら実行する。\\nやりたいことはコールバックで実現できるものの、何重にも重なると次のようなコードにになってしまう。\\nsetTimeOut( () => {\\nsetTimeOut( () => {\\nsetTimeOut( () => {\\nsetTimeOut( () => {\\nsetTimeOut( () => {\\nsetTimeOut( () => {\\nconsole.log(\'6s later\');\\n}, 1000);\\n}, 1000);\\n}, 1000);\\n}, 1000);\\n}, 1000);\\n}, 1000);\\nconsole.log(\'これはすぐに実行される\');\\n\\n\\nコールバック関数を呼ぶたびにネストが深くなってしまい読みづらい。\\n俗に言うコールバック地獄である。\\nたとえばこの例だと、どの秒数がどの setTimeOut に対応するのかわかりづらい。\\n(上記の例は全て一つの setTimeOut にまとめられるが)\\n実際には次のような状況が考えられる。\\nサーバと通信して、記事のリストをとってくる。\\n記事のリストから該当の記事を探して、再度サーバと通信して本文をとってくる。\\nこのように、複数の非同期処理が数珠つなぎになることもあるだろう。\\n数珠つなぎ、、、\\nStep2-3 Promise (非同期関数)\\nそう、数珠つなぎならさっきの Promise チェーンと相性が良い。\\nさっきの6秒待つ処理も\\n// 事前に Promise 関数を作っておく。\\n// ライブラリなどで用意されていたりするので、Promise を使う側は作る必要はない。\\nfunction setTimeOutPromise(time){\\nreturn new Promise( resolve => {\\nsetTimeOut( resolve, 1000);\\n});\\n}\\nsetTimeOutPromise(1000)\\n.then( () =>\\nsetTimeOutPromise(1000)\\n).then( () =>\\nsetTimeOutPromise(1000)\\n).then( () =>\\nsetTimeOutPromise(1000)\\n).then( () =>\\nsetTimeOutPromise(1000)\\n).then( () =>\\nsetTimeOutPromise(1000)\\n).then( () => {\\nconsole.log(\'6s later\');\\n})\\nconsole.log(\'これはすぐに実行される\');\\n\\n\\nネストが解消されて、引数もコンパクトになって見やすくなった。\\nStep2-4 asnyc/await (非同期関数)\\nさらに async/awaitで書き直すと\\n// 事前に Promise 関数を作っておく。\\n// さっきと同じ。\\nfunction setTimeOutPromise(time){\\nreturn new Promise( resolve => {\\nsetTimeOut( resolve, 1000)\\n})\\n}\\n( async () => {\\nawait setTimeOutPromise(1000);\\nawait setTimeOutPromise(1000);\\nawait setTimeOutPromise(1000);\\nawait setTimeOutPromise(1000);\\nawait setTimeOutPromise(1000);\\nawait setTimeOutPromise(1000);\\nconsole.log(\'6s later\');\\n})\\nconsole.log(\'これはすぐに実行される\');\\n\\n\\nこれは見やすい！\\n非同期関数を同期的に書けるようになった。\\nawait の行で停止しているかのように動作する。\\nさいごに\\n本記事を読み次の2つを知れば、他の記事が格段に読みやすくなるだろう。\\n同期処理と非同期処理の違い\\n同期処理でPromiseがどういう動作をするか\\nこれからは「コールバック地獄を解決するために Promise チェーンがある」「 async/await は Promise の生成だ」などと書かれた他の記事も読めるのではないだろうか。\\nこの記事を完全に理解できなくても、 読者の皆様はこれから JavaScript の非同期処理を深める土台ができているのではないかと思う。\\nここまでの長文に付き合いいただきありがたい。\\n以上。","guid":"https://memo.basd4g.net/posts/promise/","isoDate":"2020-05-19T07:50:47.000Z"},{"title":"Promiseのthenメソッドには第二引数がある","link":"https://memo.basd4g.net/posts/promise-then-arg2/","pubDate":"Tue, 19 May 2020 15:57:35 +0900","content":"<p>この記事は以下のツイートについて。</p>\\n<blockquote class=\\"twitter-tweet\\"><p lang=\\"ja\\" dir=\\"ltr\\">thenメソッドって第2引数でrejectedなときに実行する関数も指定できるのか、いつもcatchばかり使っていた。</p>&mdash; けーすけ@やんまー (@basd4g) <a href=\\"https://twitter.com/basd4g/status/1262637541028585475?ref_src=twsrc%5Etfw\\">May 19, 2020</a></blockquote> <script async src=\\"https://platform.twitter.com/widgets.js\\" charset=\\"utf-8\\"><\/script>\\n<p>きっかけは<a href=\\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise\\"target=\\"_blank\\">MDN web docsのPromiseについてのページ</a>を見ていたことに始まる。</p>\\n<p>以前、私がPromiseとaync/awaitを理解するときにとても役にたった記事があった。\\nQiitaにあった記事で同期処理でPromiseをしてみて理解しようと試みる記事だったのだが、いま探しても見つからない。</p>\\n<p>需要がありそうなので自分で書いているのだが、そんな中でMDNを見ていてthenメソッドに関する発見があった。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"kr\\">const</span> <span class=\\"nx\\">promise</span> <span class=\\"o\\">=</span> <span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span><span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"nx\\">setTimeout</span><span class=\\"p\\">(</span> <span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span>\\n<span class=\\"k\\">if</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nb\\">Date</span><span class=\\"p\\">.</span><span class=\\"nx\\">now</span><span class=\\"p\\">()</span><span class=\\"o\\">%</span><span class=\\"mi\\">2</span><span class=\\"p\\">)</span> <span class=\\"o\\">===</span> <span class=\\"mi\\">0</span> <span class=\\"p\\">){</span>\\n<span class=\\"nx\\">resolve</span><span class=\\"p\\">()</span>\\n<span class=\\"k\\">return</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"nx\\">reject</span><span class=\\"p\\">()</span>\\n<span class=\\"p\\">},</span> <span class=\\"mi\\">1000</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">})</span>\\n<span class=\\"nx\\">promise</span><span class=\\"p\\">.</span><span class=\\"nx\\">then</span><span class=\\"p\\">(</span>\\n<span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;fulfilled&#39;</span><span class=\\"p\\">)},</span>\\n<span class=\\"p\\">()</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{</span> <span class=\\"nx\\">console</span><span class=\\"p\\">.</span><span class=\\"nx\\">log</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;rejected&#39;</span><span class=\\"p\\">)}</span>\\n<span class=\\"p\\">)</span>\\n</code></pre></div><p>あなたの運(実行タイミング)によってfulfilledかrejectedが表示されるコードである。</p>\\n<ul>\\n<li>thenの第一引数は、promiseオブジェクトがfulfilled状態になったとき(上記コードでいえば<code>resolve()</code>が実行されたとき)、実行される関数である。</li>\\n</ul>\\n<p>これは理解していたが次だ。</p>\\n<ul>\\n<li>thenの第二引数は、promiseオブジェクトがrejected状態になったとき(上記コードでいえば<code>reject()</code>が実行されたとき)、に実行される関数である。</li>\\n</ul>\\n<p>これは見落としていた。\\nいつも<code>then(A).catch(B)</code>として拾っていたが、<code>then( A, B )</code>として書けるのだな。</p>\\n<p>書けることと見やすいことは別で、今の私の感情ではcatchと書いたほうが見やすいのでは？と思うのだが、実際のところどうなのだろう。\\nthenの第二引数がどれだけ使われているのか気になるところである。</p>\\n<br/>\\n<p>ところで、promiseの状態について、初期状態をpendingと表現し、それがfulfilledかrejectedに変化するのだが、fulfilledのことをついresolvedと表現したくなってしまう。</p>\\n<p>正確にはresolvedというと、fulfilledとrejectedをどちらも指すようで、promiseが成功したときはfulfilledと表現すべきらしい。\\n(resolvedと同じ意味でsettledという言葉も使われるようだ。)</p>\\n<p>なるほど区別するのは良いのだが、それならよく</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">resolve</span><span class=\\"p\\">,</span> <span class=\\"nx\\">relect</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{})</span>\\n</code></pre></div><p>と書いているのはどうなの。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-js\\" data-lang=\\"js\\"><span class=\\"k\\">new</span> <span class=\\"nb\\">Promise</span><span class=\\"p\\">(</span> <span class=\\"p\\">(</span><span class=\\"nx\\">fulfill</span><span class=\\"p\\">,</span> <span class=\\"nx\\">reject</span><span class=\\"p\\">)</span> <span class=\\"p\\">=&gt;</span> <span class=\\"p\\">{})</span>\\n</code></pre></div><p>と予め書いてあるほうが混乱を産まないと思うのだが。</p>\\n<br/>\\n<p>話がそれたが今日はPromiseのthenメソッド第二引数についてであった。\\nいつも使っている文でも知らないことが隠れていたりするので、ことあるごとに正しい文献に戻ることを心がけていきたい。</p>","contentSnippet":"この記事は以下のツイートについて。\\nthenメソッドって第2引数でrejectedなときに実行する関数も指定できるのか、いつもcatchばかり使っていた。\\n— けーすけ@やんまー (@basd4g) May 19, 2020\\n \\nきっかけはMDN web docsのPromiseについてのページを見ていたことに始まる。\\n以前、私がPromiseとaync/awaitを理解するときにとても役にたった記事があった。\\nQiitaにあった記事で同期処理でPromiseをしてみて理解しようと試みる記事だったのだが、いま探しても見つからない。\\n需要がありそうなので自分で書いているのだが、そんな中でMDNを見ていてthenメソッドに関する発見があった。\\nconst promise = new Promise( (resolve,reject) => {\\nsetTimeout( () => {\\nif( (Date.now()%2) === 0 ){\\nresolve()\\nreturn\\n}\\nreject()\\n}, 1000)\\n})\\npromise.then(\\n() => { console.log(\'fulfilled\')},\\n() => { console.log(\'rejected\')}\\n)\\n\\n\\nあなたの運(実行タイミング)によってfulfilledかrejectedが表示されるコードである。\\nthenの第一引数は、promiseオブジェクトがfulfilled状態になったとき(上記コードでいえばresolve()が実行されたとき)、実行される関数である。\\nこれは理解していたが次だ。\\nthenの第二引数は、promiseオブジェクトがrejected状態になったとき(上記コードでいえばreject()が実行されたとき)、に実行される関数である。\\nこれは見落としていた。\\nいつもthen(A).catch(B)として拾っていたが、then( A, B )として書けるのだな。\\n書けることと見やすいことは別で、今の私の感情ではcatchと書いたほうが見やすいのでは？と思うのだが、実際のところどうなのだろう。\\nthenの第二引数がどれだけ使われているのか気になるところである。\\nところで、promiseの状態について、初期状態をpendingと表現し、それがfulfilledかrejectedに変化するのだが、fulfilledのことをついresolvedと表現したくなってしまう。\\n正確にはresolvedというと、fulfilledとrejectedをどちらも指すようで、promiseが成功したときはfulfilledと表現すべきらしい。\\n(resolvedと同じ意味でsettledという言葉も使われるようだ。)\\nなるほど区別するのは良いのだが、それならよく\\nnew Promise( (resolve, relect) => {})\\n\\n\\nと書いているのはどうなの。\\nnew Promise( (fulfill, reject) => {})\\n\\n\\nと予め書いてあるほうが混乱を産まないと思うのだが。\\n話がそれたが今日はPromiseのthenメソッド第二引数についてであった。\\nいつも使っている文でも知らないことが隠れていたりするので、ことあるごとに正しい文献に戻ることを心がけていきたい。","guid":"https://memo.basd4g.net/posts/promise-then-arg2/","isoDate":"2020-05-19T06:57:35.000Z"},{"title":"Raspberry Pi Zeroをモニタレスで使うためのSetup","link":"https://memo.basd4g.net/posts/raspberry-pi-zero-setup/","pubDate":"Sat, 16 May 2020 01:21:46 +0900","content":"<p>2020/3/4のメモ。\\nRaspberry pi Zero を、購入後一切モニタにつなぐことなく無線LAN経由でSSHできるようセットアップする手順。</p>\\n<p>母艦は MacOS X で行っているが、SDカードへの書き込みができればなんでもよい。</p>\\n<p>肝となるのは、OSを書き込んだSDカードに次のように手を加えておくことだ。</p>\\n<ul>\\n<li>事前に無線LANのSSIDとパスワードを記述したファイルをおく</li>\\n<li>SSHを有効化する</li>\\n</ul>\\n<h2 id=\\"起動前\\">起動前</h2>\\n<h3 id=\\"micro-sd-cardのフォーマット\\">micro SD cardのフォーマット</h3>\\n<p><a href=\\"https://www.sdcard.org/jp/downloads/formatter_4/\\"target=\\"_blank\\">SD Association公式サイト</a>より、SDカードフォーマッターをダウンロードする。</p>\\n<p>ダウンロードしたSDカードフォーマッターでSDカードをフォーマットする。</p>\\n<p>( FAT, FAT32, exFAT)。 4GB以上(要出典)。</p>\\n<h3 id=\\"osイメージのダウンロード\\">OSイメージのダウンロード</h3>\\n<p><a href=\\"https://www.raspberrypi.org/downloads/raspbian/\\"target=\\"_blank\\">raspberry pi公式サイト</a>からraspbianをダウンロードする。</p>\\n<p>ここではGUIが必要ないので、[Raspbian Buster Lite]のzipをダウンロードする。</p>\\n<h3 id=\\"osイメージの書き込み\\">OSイメージの書き込み</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># ダウンロードしたzipを展開してimgファイルを得る</span>\\n$ unzip 2020-02-13-raspbian-buster-lite.zip\\n<span class=\\"c1\\"># デバイスを確認</span>\\n$ diskutil list\\n<span class=\\"c1\\"># フォーマット済みの書き込み先デバイス(ここでは/dev/disk2)をunmount</span>\\n$ diskutil unMountDisk /dev/disk2\\n<span class=\\"c1\\"># 書き込み</span>\\n$ sudo dd <span class=\\"nv\\">bs</span><span class=\\"o\\">=</span>1m <span class=\\"k\\">if</span><span class=\\"o\\">=</span>2020-02-13-raspbian-buster-lite.img <span class=\\"nv\\">of</span><span class=\\"o\\">=</span>/dev/disk2\\n</code></pre></div><h3 id=\\"wifiの事前設定とsshの有効化\\">wifiの事前設定とsshの有効化</h3>\\n<p>書き込み後のSDカードのbootドライブをマウントする。(/Volumes/boot)</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">cd</span> /Volumes/boot\\n<span class=\\"c1\\"># bootドライブちょっかいsshという名前のファイルが有ると、初期状態でsshが起動する</span>\\n$ touch ssh\\n<span class=\\"c1\\"># wifi設定を書き込む</span>\\n$ vim wpa_supplicant.conf\\n</code></pre></div><p><code>wpa_supplicant.conf</code>の中身は以下の通り</p>\\n<pre><code class=\\"language-wpa_supplicant.conf\\" data-lang=\\"wpa_supplicant.conf\\">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev\\nupdate_config=1\\ncountry=JP\\nnetwork={\\nssid=&quot;接続先アクセスポイントのSSID&quot;\\npsk=&quot;接続先アクセスポイントのパスワード&quot;\\n}\\n</code></pre><h2 id=\\"起動\\">起動</h2>\\n<p>micro SDカードを差し込み、PWRと書かれた方のmicro USB Bポートに電源ケーブルをつなぐと起動する。</p>\\n<h3 id=\\"ipアドレスとmacアドレスの確認とdhcpリースの固定\\">ipアドレスとmacアドレスの確認とDHCPリースの固定</h3>\\n<p>起動すると、自動でwifiに接続して22版ポートが開いてsshが立ち上がる(少し時間がかかる)</p>\\n<p>ルータの設定画面などをみて、新しく接続されたデバイスに注目する。raspberry piっぽい端末のmacアドレスを見つける。</p>\\n<p>DHCPリースを固定にして、このMACアドレスに対応するIPアドレスをわかりやすいものに固定しておく</p>\\n<h3 id=\\"sshで接続\\">sshで接続</h3>\\n<p><strong>クライアント側</strong></p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ ssh pi@192.168.0.13\\n<span class=\\"c1\\"># raspberry pi のIPアドレスを指定(ここでは 192.168.0.13 であるとする)</span>\\n<span class=\\"c1\\"># デフォルトのIDは pi</span>\\n<span class=\\"c1\\"># デフォルトのパスワードは raspberry</span>\\n</code></pre></div><h3 id=\\"設定\\">設定</h3>\\n<p><strong>raspberry pi側</strong></p>\\n<pre><code># visudoでnanoではなくvimを立ち上げる\\n# 参考: https://qiita.com/koara-local/items/35b999631b6ab41fdc9f\\n$ sudo update-alternatives --config editor\\n# vimをエイリアスとして登録\\n$ vim ~/.bashrc\\n</code></pre><p><code>.bashrc</code>に下記を追記</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-.bashrc\\" data-lang=\\".bashrc\\"><span class=\\"nb\\">alias</span> <span class=\\"nv\\">vim</span><span class=\\"o\\">=</span><span class=\\"s1\\">&#39;vi&#39;</span>\\n</code></pre></div><p>変更を読み込む</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"nb\\">source</span> ~/.bashrc\\n</code></pre></div><h2 id=\\"sshの設定\\">sshの設定</h2>\\n<h3 id=\\"ssh用ユーザの作成\\">ssh用ユーザの作成</h3>\\n<p><strong>raspberry pi側</strong></p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># yammerというユーザを作るとする</span>\\n$ sudo useradd yammer\\n$ sudo passwd yammer\\n$ sudo visudo\\n</code></pre></div><p>visudoによって、<code>/etc/sudoers</code>に下記を追記</p>\\n<pre><code class=\\"language-/etc/sudoers\\" data-lang=\\"/etc/sudoers\\">yammer ALL=(ALL) ALL\\n</code></pre><h3 id=\\"ssh用公開鍵の作成\\">ssh用公開鍵の作成</h3>\\n<p>ssh用の公開鍵を作る。</p>\\n<p><strong>クライアント側</strong></p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">cd</span> ~/.ssh\\n$ ssh-keygen -t rsa -b <span class=\\"m\\">4096</span> -C <span class=\\"s2\\">&#34;raspberry-pi&#34;</span> -f ~/.ssh/id_rsa_pi\\n</code></pre></div><h3 id=\\"sshのパーミッションを設定\\">sshのパーミッションを設定</h3>\\n<p><strong>raspberry pi側</strong></p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">cd</span> /home/yammer\\n$ chmod <span class=\\"m\\">700</span> .ssh\\n$ chmod <span class=\\"m\\">600</span> .ssh/authorized_keys\\n</code></pre></div><h3 id=\\"ssh公開鍵を送る\\">ssh公開鍵を送る</h3>\\n<p><strong>クライアント側</strong></p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ scp ~/.ssh/id_rsa_pi.pub yammer@192.168.0.13:/home/yammer/.ssh/authorized_keys\\n</code></pre></div><h3 id=\\"ssh設定\\">ssh設定</h3>\\n<p><strong>raspberry pi側</strong></p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ sudo vi /etc/ssh/sshd_config\\n</code></pre></div><pre><code class=\\"language-/etc/ssh/sshd_config\\" data-lang=\\"/etc/ssh/sshd_config\\">RSAAuthentication yes\\nPubkeyAuthentication yes\\nAuthorizedKeysFile .ssh/authorized_keys\\nAllowUsers yammer # ユーザ名を追加\\n</code></pre><div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ sudo /etc/init.d/sshd restart\\n</code></pre></div><h3 id=\\"接続できるか確認\\">接続できるか確認</h3>\\n<p><strong>クライアント側</strong></p>\\n<pre><code>$ ssh -i ~/.ssh/id_rsa_pi yammer@192.168.0.13\\n</code></pre><h2 id=\\"参考\\">参考</h2>\\n<ul>\\n<li><a href=\\"https://qiita.com/tattn/items/a03cbf7c185d7efa6769\\"target=\\"_blank\\">SSH用のユーザー追加手順と注意点のまとめ - Qiita</a></li>\\n</ul>","contentSnippet":"2020/3/4のメモ。\\nRaspberry pi Zero を、購入後一切モニタにつなぐことなく無線LAN経由でSSHできるようセットアップする手順。\\n母艦は MacOS X で行っているが、SDカードへの書き込みができればなんでもよい。\\n肝となるのは、OSを書き込んだSDカードに次のように手を加えておくことだ。\\n事前に無線LANのSSIDとパスワードを記述したファイルをおく\\nSSHを有効化する\\n起動前\\nmicro SD cardのフォーマット\\nSD Association公式サイトより、SDカードフォーマッターをダウンロードする。\\nダウンロードしたSDカードフォーマッターでSDカードをフォーマットする。\\n( FAT, FAT32, exFAT)。 4GB以上(要出典)。\\nOSイメージのダウンロード\\nraspberry pi公式サイトからraspbianをダウンロードする。\\nここではGUIが必要ないので、[Raspbian Buster Lite]のzipをダウンロードする。\\nOSイメージの書き込み\\n# ダウンロードしたzipを展開してimgファイルを得る\\n$ unzip 2020-02-13-raspbian-buster-lite.zip\\n# デバイスを確認\\n$ diskutil list\\n# フォーマット済みの書き込み先デバイス(ここでは/dev/disk2)をunmount\\n$ diskutil unMountDisk /dev/disk2\\n# 書き込み\\n$ sudo dd bs=1m if=2020-02-13-raspbian-buster-lite.img of=/dev/disk2\\n\\n\\nwifiの事前設定とsshの有効化\\n書き込み後のSDカードのbootドライブをマウントする。(/Volumes/boot)\\n$ cd /Volumes/boot\\n# bootドライブちょっかいsshという名前のファイルが有ると、初期状態でsshが起動する\\n$ touch ssh\\n# wifi設定を書き込む\\n$ vim wpa_supplicant.conf\\n\\n\\nwpa_supplicant.confの中身は以下の通り\\nctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev\\nupdate_config=1\\ncountry=JP\\nnetwork={\\nssid=\\"接続先アクセスポイントのSSID\\"\\npsk=\\"接続先アクセスポイントのパスワード\\"\\n}\\n\\n起動\\nmicro SDカードを差し込み、PWRと書かれた方のmicro USB Bポートに電源ケーブルをつなぐと起動する。\\nipアドレスとmacアドレスの確認とDHCPリースの固定\\n起動すると、自動でwifiに接続して22版ポートが開いてsshが立ち上がる(少し時間がかかる)\\nルータの設定画面などをみて、新しく接続されたデバイスに注目する。raspberry piっぽい端末のmacアドレスを見つける。\\nDHCPリースを固定にして、このMACアドレスに対応するIPアドレスをわかりやすいものに固定しておく\\nsshで接続\\nクライアント側\\n$ ssh pi@192.168.0.13\\n# raspberry pi のIPアドレスを指定(ここでは 192.168.0.13 であるとする)\\n# デフォルトのIDは pi\\n# デフォルトのパスワードは raspberry\\n\\n\\n設定\\nraspberry pi側\\n# visudoでnanoではなくvimを立ち上げる\\n# 参考: https://qiita.com/koara-local/items/35b999631b6ab41fdc9f\\n$ sudo update-alternatives --config editor\\n# vimをエイリアスとして登録\\n$ vim ~/.bashrc\\n\\n.bashrcに下記を追記\\nalias vim=\'vi\'\\n\\n\\n変更を読み込む\\nsource ~/.bashrc\\n\\n\\nsshの設定\\nssh用ユーザの作成\\nraspberry pi側\\n# yammerというユーザを作るとする\\n$ sudo useradd yammer\\n$ sudo passwd yammer\\n$ sudo visudo\\n\\n\\nvisudoによって、/etc/sudoersに下記を追記\\nyammer ALL=(ALL) ALL\\n\\nssh用公開鍵の作成\\nssh用の公開鍵を作る。\\nクライアント側\\n$ cd ~/.ssh\\n$ ssh-keygen -t rsa -b 4096 -C \\"raspberry-pi\\" -f ~/.ssh/id_rsa_pi\\n\\n\\nsshのパーミッションを設定\\nraspberry pi側\\n$ cd /home/yammer\\n$ chmod 700 .ssh\\n$ chmod 600 .ssh/authorized_keys\\n\\n\\nssh公開鍵を送る\\nクライアント側\\n$ scp ~/.ssh/id_rsa_pi.pub yammer@192.168.0.13:/home/yammer/.ssh/authorized_keys\\n\\n\\nssh設定\\nraspberry pi側\\n$ sudo vi /etc/ssh/sshd_config\\n\\n\\nRSAAuthentication yes\\nPubkeyAuthentication yes\\nAuthorizedKeysFile .ssh/authorized_keys\\nAllowUsers yammer # ユーザ名を追加\\n\\n\\n$ sudo /etc/init.d/sshd restart\\n\\n\\n接続できるか確認\\nクライアント側\\n$ ssh -i ~/.ssh/id_rsa_pi yammer@192.168.0.13\\n\\n参考\\nSSH用のユーザー追加手順と注意点のまとめ - Qiita","guid":"https://memo.basd4g.net/posts/raspberry-pi-zero-setup/","isoDate":"2020-05-15T16:21:46.000Z"},{"title":"Vimに入門したときの覚書","link":"https://memo.basd4g.net/posts/vim-intro/","pubDate":"Sat, 16 May 2020 01:07:44 +0900","content":"<p>昨年、Vimを使える人間になりたいという気持ちからVimに入門した。</p>\\n<p>まずvimtutorをやり、またVim以外のエディタを使うことを禁止して慣れるようにした。\\nvimtuorのあとは<a href=\\"https://www.amazon.co.jp/dp/B00HWLJI3U/ref=dp-kindle-redirect?_encoding=UTF8&amp;btkr=1\\"target=\\"_blank\\">実践Vim</a>を読んだりしながら日常使いの中でVimに慣れていった。\\nまた基本的にプラグインを追加することを禁止し、不用意な<code>.vimrc</code>の編集も禁止して、素の状態のVimに慣れるように気を配っていた。</p>\\n<p>そんなこんなでVimに慣れようとしていたわけだが、最初期vimtutorをやるだけではなかなかキーバインドが覚えられず、とても編集速度が遅かったので、同時にメモに書き出すことで覚えていたようである。</p>\\n<p>このときのメモをここに供養する。書いた日付は2019/10/28。</p>\\n<hr/>\\n<h2 id=\\"vim-help-日本語化\\">Vim :help 日本語化</h2>\\n<p>まず次のコマンドを実行</p>\\n<pre><code>% curl -fLo ~/.vim/autoload/plug.vim --create-dirs \\\\\\nhttps://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim\\n</code></pre><p>次に<code>~/.vimrc</code>に次の内容を追記</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-.vimrc\\" data-lang=\\".vimrc\\"><span class=\\"nx\\">call</span> <span class=\\"nx\\">plug</span>#<span class=\\"nx\\">begin</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;~/.vim/plugged&#39;</span><span class=\\"p\\">)</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">&#34; A project which translate Vim documents into Japanese.</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"nx\\">Plug</span> <span class=\\"s1\\">&#39;vim-jp/vimdoc-ja&#39;</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"nx\\">call</span> <span class=\\"nx\\">plug</span>#<span class=\\"nx\\">end</span><span class=\\"p\\">()</span><span class=\\"err\\">\\n</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"nx\\">set</span> <span class=\\"nx\\">helplang</span><span class=\\"p\\">=</span><span class=\\"nx\\">ja</span><span class=\\"p\\">,</span><span class=\\"nx\\">en</span><span class=\\"err\\">\\n</span></code></pre></div><p>次にVimを立ち上げて<code>:PlugInstall</code>と入力しプラグインをインストールする</p>\\n<p>参考: <a href=\\"https://qiita.com/issuy/items/919d76ac1b94dc56a77e\\"target=\\"_blank\\">Vimをちゃんと知りたい！だからHelpを日本語化する！</a></p>\\n<h2 id=\\"vimrcを無視する\\">.vimrcを無視する</h2>\\n<p>.vimrcを書き換えて起動しなくなったら</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ vim -u NONE -N\\n<span class=\\"c1\\"># -u None ... .vimrcを読み込まない vi互換モードにする</span>\\n<span class=\\"c1\\"># -N ...(nocompatible) vi互換モードをオフにする</span>\\n</code></pre></div><h2 id=\\"-直前の操作を繰り返す\\">. 直前の操作を繰り返す</h2>\\n<h3 id=\\"ノーマルモード\\">ノーマルモード</h3>\\n<p>直前のコマンドを繰り返す(カーソル移動はコマンドとみなされない) (ex.<code>x</code>, <code>dd</code>, <code>&gt;G</code>)</p>\\n<h3 id=\\"インサートモード\\">インサートモード</h3>\\n<p>挿入モードに入った瞬間(<code>i</code>を押す等)からノーマルモードに戻る(<code>&lt;Esc&gt;</code>を押す)までの間のキーストロークが記録されている<br>\\n.を押すことでこの一連の流れを再生できる</p>\\n<h2 id=\\"移動\\">移動</h2>\\n<ul>\\n<li><code>h</code> &hellip; ←</li>\\n<li><code>j</code> &hellip; ↓</li>\\n<li><code>k</code> &hellip; ↑</li>\\n<li><code>l</code> &hellip; →</li>\\n<li><code>$</code> &hellip; 行末に移動</li>\\n<li><code>w</code> &hellip; 次の単語へ移動</li>\\n<li><code>gg</code> &hellip; ファイル先頭へ移動</li>\\n<li><code>G</code> &hellip; ファイル末尾へ移動</li>\\n<li><code>{数字}G</code> &hellip; {数字}行目に移動</li>\\n<li><code>&lt;Ctrl&gt;G</code> &hellip; 現在のカーソル行を表示</li>\\n<li><code>&gt;G</code> &hellip; 現在の行からファイル末尾までのインデントを1段深くする</li>\\n</ul>\\n<h2 id=\\"基本操作\\">基本操作</h2>\\n<ul>\\n<li><code>x</code> &hellip; カーソル下の文字を削除</li>\\n<li><code>dd</code> &hellip; 行頭から行末まで削除</li>\\n<li><code>i</code> &hellip; インサートモードへ切り替え</li>\\n<li><code>a</code> &hellip; カーソルの右隣でインサートモードへ切り替え</li>\\n<li><code>A</code> &hellip; 行末に移動してインサートモードに切り替え</li>\\n<li><code>o</code> &hellip; 次行を作りインサートモードへ</li>\\n<li><code>O</code> &hellip; 前行を作りインサートモードへ</li>\\n<li><code>u</code> &hellip; アンドゥ 戻る</li>\\n<li><code>U</code> &hellip; 行単位でアンドゥ 戻る</li>\\n<li><code>&lt;Ctrl&gt;R</code> &hellip; リドゥ　戻るの取り消し</li>\\n<li><code>0</code> &hellip; 行頭へ移動</li>\\n<li><code>p</code> &hellip; 貼り付け (削除したものを貼り付け 例えば<code>dd</code>コマンドで削除した行等</li>\\n<li><code>r</code> &hellip; 置き換え カーソル下の文字を一文字消して次に入力した一文字で置き換える。なお置き換え後もノーマルモードを維持する</li>\\n<li><code>R</code> &hellip; 置換モード カーソル下を上書きして文字を挿入する escキーでノーマルモードに戻る</li>\\n<li><code>%</code> &hellip; 対応する括弧へ移動</li>\\n<li><code>yy</code> &hellip; 行をヤンク</li>\\n<li><code>yw</code> &hellip; カーソル後ろの空白を含む単語をヤンク</li>\\n</ul>\\n<h2 id=\\"モーション操作\\">モーション操作</h2>\\n<h3 id=\\"d\\"><code>d</code></h3>\\n<p>ノーマルモードでモーション操作を行うとカーソル移動</p>\\n<p><code>d{モーション}</code>を行うと現カーソルからモーション先まで削除</p>\\n<p><code>d{数字}{モーション}</code>ないし<code>{数字}d{モーション}</code>は等価で、数字個先のモーションの差示す場所まで削除する</p>\\n<h3 id=\\"e\\"><code>e</code></h3>\\n<p><code>c{モーション}</code>を行うと、現カーソルからモーション先まで削除して挿入モードに切り替え</p>\\n<h3 id=\\"モーション\\">モーション</h3>\\n<ul>\\n<li><code>w</code> &hellip; 空白を含む単語尾</li>\\n<li><code>e</code> &hellip; 空白を含まない単語尾</li>\\n<li><code>$</code> &hellip; 行末</li>\\n</ul>\\n<h2 id=\\"コマンド\\">コマンド</h2>\\n<h3 id=\\"終了\\">終了</h3>\\n<ul>\\n<li><code>:q!</code> &hellip; 内容を破棄して終了</li>\\n<li><code>:wq</code> &hellip; 内容を保存して終了</li>\\n</ul>\\n<h3 id=\\"書き込み\\">書き込み</h3>\\n<ul>\\n<li><code>:w filename</code> &hellip; ファイルfilenameへ書き込み</li>\\n</ul>\\n<h3 id=\\"検索\\">検索</h3>\\n<ul>\\n<li><code>/hoge</code> &hellip; hogeを前方検索</li>\\n<li><code>?hoge</code> &hellip; hogeを逆方向に検索</li>\\n<li>(検索した状態で)<code>n</code> &hellip; 次を検索</li>\\n<li>(検索した状態で)<code>&lt;Ctrl&gt;o</code> &hellip; 一つ前の検索結果に戻る</li>\\n</ul>\\n<h3 id=\\"置換\\">置換</h3>\\n<ul>\\n<li><code>:s/before/after</code> &hellip; カーソル行の１つ目のbeforeをafterへ置換</li>\\n<li><code>:s/before/after/g</code> &hellip; カーソル行の全てのbeforeをafterへ置換</li>\\n<li><code>:3,5s/before/after/g</code> &hellip; 3行目から5行目の全てのbeforeをafterへ置換</li>\\n<li><code>:%s/before/after/g</code> &hellip; ファイル内全てのbeforeをafterへ置換</li>\\n<li><code>:%s/before/after/gc</code> &hellip; ファイル内全てのbeforeを都度確認しながらafterへ置換</li>\\n</ul>\\n<h3 id=\\"検索置換のオプション\\">検索/置換のオプション</h3>\\n<ul>\\n<li><code>:set ic</code> &hellip; 検索時に大文字小文字を区別しない(ignorecase)</li>\\n<li><code>:set is</code> &hellip; 検索フレーズに部分マッチしている部分を表示する(incsearch)</li>\\n<li><code>:set hls</code> &hellip; マッチする全てを強調表示する(hlsearch)</li>\\n</ul>\\n<h3 id=\\"ターミナルコマンド実行\\">ターミナルコマンド実行</h3>\\n<ul>\\n<li><code>:!ls</code> &hellip; lsを実行(のちエンターでvimに戻る)</li>\\n</ul>\\n<h3 id=\\"挿入\\">挿入</h3>\\n<ul>\\n<li><code>:r filename</code> &hellip; filenameの内容をカーソル位置へ挿入</li>\\n<li><code>:r !ls</code> &hellip; lsの結果をカーソル位置へ挿入</li>\\n</ul>\\n<h3 id=\\"help\\">help</h3>\\n<ul>\\n<li><code>:help</code> &hellip; helpウィンドウを開く</li>\\n<li><code>:help hoge</code> &hellip; hogeに関するhelpを見る</li>\\n</ul>\\n<h3 id=\\"候補と保管\\">候補と保管</h3>\\n<ul>\\n<li><code>:e&lt;TAB&gt;</code> &hellip; eから始まるコマンドを補完</li>\\n<li><code>:e&lt;Ctrl&gt;d</code> &hellip; eから始まるコマンドを一覧表示</li>\\n</ul>\\n<h2 id=\\"visualモード\\">visualモード</h2>\\n<ul>\\n<li><code>v</code> &hellip; visualモードへ切り替え カーソルを移動させると、visualモード移行時のカーソルとの間が反転し選択される</li>\\n<li>(visualモードで短形選択時)<code>:\'&lt;,\'&gt;w filename</code>(<code>\'&lt;,\'&gt;</code>は自動で入力される) &hellip; 短形選択部分をfilenameへ書き出し</li>\\n<li>(visualモードで短形選択時)<code>y</code> &hellip; ヤンク(コピー)</li>\\n</ul>","contentSnippet":"昨年、Vimを使える人間になりたいという気持ちからVimに入門した。\\nまずvimtutorをやり、またVim以外のエディタを使うことを禁止して慣れるようにした。\\nvimtuorのあとは実践Vimを読んだりしながら日常使いの中でVimに慣れていった。\\nまた基本的にプラグインを追加することを禁止し、不用意な.vimrcの編集も禁止して、素の状態のVimに慣れるように気を配っていた。\\nそんなこんなでVimに慣れようとしていたわけだが、最初期vimtutorをやるだけではなかなかキーバインドが覚えられず、とても編集速度が遅かったので、同時にメモに書き出すことで覚えていたようである。\\nこのときのメモをここに供養する。書いた日付は2019/10/28。\\nVim :help 日本語化\\nまず次のコマンドを実行\\n% curl -fLo ~/.vim/autoload/plug.vim --create-dirs \\\\\\nhttps://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim\\n\\n次に~/.vimrcに次の内容を追記\\ncall plug#begin(\'~/.vim/plugged\')\\n\\" A project which translate Vim documents into Japanese.\\nPlug \'vim-jp/vimdoc-ja\'\\ncall plug#end()\\n\\nset helplang=ja,en\\n\\n\\n次にVimを立ち上げて:PlugInstallと入力しプラグインをインストールする\\n参考: Vimをちゃんと知りたい！だからHelpを日本語化する！\\n.vimrcを無視する\\n.vimrcを書き換えて起動しなくなったら\\n$ vim -u NONE -N\\n# -u None ... .vimrcを読み込まない vi互換モードにする\\n# -N ...(nocompatible) vi互換モードをオフにする\\n\\n\\n. 直前の操作を繰り返す\\nノーマルモード\\n直前のコマンドを繰り返す(カーソル移動はコマンドとみなされない) (ex.x, dd, >G)\\nインサートモード\\n挿入モードに入った瞬間(iを押す等)からノーマルモードに戻る(<Esc>を押す)までの間のキーストロークが記録されている\\n移動\\nh … ←\\nj … ↓\\nk … ↑\\nl … →\\n$ … 行末に移動\\nw … 次の単語へ移動\\ngg … ファイル先頭へ移動\\nG … ファイル末尾へ移動\\n{数字}G … {数字}行目に移動\\n<Ctrl>G … 現在のカーソル行を表示\\n>G … 現在の行からファイル末尾までのインデントを1段深くする\\n基本操作\\nx … カーソル下の文字を削除\\ndd … 行頭から行末まで削除\\ni … インサートモードへ切り替え\\na … カーソルの右隣でインサートモードへ切り替え\\nA … 行末に移動してインサートモードに切り替え\\no … 次行を作りインサートモードへ\\nO … 前行を作りインサートモードへ\\nu … アンドゥ 戻る\\nU … 行単位でアンドゥ 戻る\\n<Ctrl>R … リドゥ　戻るの取り消し\\n0 … 行頭へ移動\\np … 貼り付け (削除したものを貼り付け 例えばddコマンドで削除した行等\\nr … 置き換え カーソル下の文字を一文字消して次に入力した一文字で置き換える。なお置き換え後もノーマルモードを維持する\\nR … 置換モード カーソル下を上書きして文字を挿入する escキーでノーマルモードに戻る\\n% … 対応する括弧へ移動\\nyy … 行をヤンク\\nyw … カーソル後ろの空白を含む単語をヤンク\\nモーション操作\\nd\\nノーマルモードでモーション操作を行うとカーソル移動\\nd{モーション}を行うと現カーソルからモーション先まで削除\\nd{数字}{モーション}ないし{数字}d{モーション}は等価で、数字個先のモーションの差示す場所まで削除する\\ne\\nc{モーション}を行うと、現カーソルからモーション先まで削除して挿入モードに切り替え\\nモーション\\nw … 空白を含む単語尾\\ne … 空白を含まない単語尾\\n$ … 行末\\nコマンド\\n終了\\n:q! … 内容を破棄して終了\\n:wq … 内容を保存して終了\\n書き込み\\n:w filename … ファイルfilenameへ書き込み\\n検索\\n/hoge … hogeを前方検索\\n?hoge … hogeを逆方向に検索\\n(検索した状態で)n … 次を検索\\n(検索した状態で)<Ctrl>o … 一つ前の検索結果に戻る\\n置換\\n:s/before/after … カーソル行の１つ目のbeforeをafterへ置換\\n:s/before/after/g … カーソル行の全てのbeforeをafterへ置換\\n:3,5s/before/after/g … 3行目から5行目の全てのbeforeをafterへ置換\\n:%s/before/after/g … ファイル内全てのbeforeをafterへ置換\\n:%s/before/after/gc … ファイル内全てのbeforeを都度確認しながらafterへ置換\\n検索/置換のオプション\\n:set ic … 検索時に大文字小文字を区別しない(ignorecase)\\n:set is … 検索フレーズに部分マッチしている部分を表示する(incsearch)\\n:set hls … マッチする全てを強調表示する(hlsearch)\\nターミナルコマンド実行\\n:!ls … lsを実行(のちエンターでvimに戻る)\\n挿入\\n:r filename … filenameの内容をカーソル位置へ挿入\\n:r !ls … lsの結果をカーソル位置へ挿入\\nhelp\\n:help … helpウィンドウを開く\\n:help hoge … hogeに関するhelpを見る\\n候補と保管\\n:e<TAB> … eから始まるコマンドを補完\\n:e<Ctrl>d … eから始まるコマンドを一覧表示\\nvisualモード\\nv … visualモードへ切り替え カーソルを移動させると、visualモード移行時のカーソルとの間が反転し選択される\\n(visualモードで短形選択時):\'<,\'>w filename(\'<,\'>は自動で入力される) … 短形選択部分をfilenameへ書き出し\\n(visualモードで短形選択時)y … ヤンク(コピー)","guid":"https://memo.basd4g.net/posts/vim-intro/","isoDate":"2020-05-15T16:07:44.000Z"},{"title":"TypeScriptでプロジェクト内独自の型定義をまとめたファイルを読み込ませる方法。","link":"https://memo.basd4g.net/posts/my-type-of-typescript/","pubDate":"Sat, 16 May 2020 01:01:45 +0900","content":"<p>TypeScriptでプロジェクト内の型定義をするときのための過去のメモをここに供養する。\\n日付は2020/1/10。</p>\\n<h2 id=\\"やりたいこと\\">やりたいこと</h2>\\n<p>TypeScriptで、独自の型定義をプロジェクト内の複数のファイルで利用したい。</p>\\n<p><code>src/types/index.d.ts</code>で定義する型<code>DayOfWeek</code>をはじめとして、<code>src/types</code>ディレクトリ以下のファイルにある型定義をTypeScriptコンパイラに読み込ませて、プロジェクト内の任意のファイルで利用できるようにする。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-src/types/index.d.ts\\" data-lang=\\"src/types/index.d.ts\\"><span class=\\"nx\\">type</span> <span class=\\"nx\\">DayOfWeek</span> <span class=\\"o\\">=</span> <span class=\\"s2\\">&#34;Sunday&#34;</span> <span class=\\"o\\">|</span> <span class=\\"s2\\">&#34;Monday&#34;</span> <span class=\\"o\\">|</span> <span class=\\"s2\\">&#34;Tuesday&#34;</span> <span class=\\"o\\">|</span> <span class=\\"nx\\">Wednesday</span><span class=\\"s2\\">&#34; | &#34;</span><span class=\\"nx\\">Tursday</span><span class=\\"s2\\">&#34; | &#34;</span><span class=\\"nx\\">Friday</span><span class=\\"s2\\">&#34; | Saturday&#34;</span><span class=\\"p\\">;</span>\\n</code></pre></div><h2 id=\\"方法\\">方法</h2>\\n<p><code>tsconfig.json</code>に次を追記する</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-tsconfig.json\\" data-lang=\\"tsconfig.json\\"><span class=\\"p\\">{</span>\\n<span class=\\"nt\\">&#34;compilerOptions&#34;</span><span class=\\"p\\">:</span> <span class=\\"p\\">{</span>\\n<span class=\\"nt\\">&#34;typeRoots&#34;</span><span class=\\"p\\">:</span> <span class=\\"p\\">[</span>\\n<span class=\\"s2\\">&#34;node_modules/@types&#34;</span><span class=\\"p\\">,</span>\\n<span class=\\"s2\\">&#34;src/types&#34;</span>\\n<span class=\\"p\\">]</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"p\\">}</span>\\n</code></pre></div><p><code>tsconfig.json</code>内での<code>compilerOptions.typeRoots</code>は文字列の配列をおく。</p>\\n<p>文字列は型定義ファイルを置くディレクトリのパスを表す。</p>\\n<p>もともと、npmでインストールしたパッケージの型定義は<code>node_modules/@types</code>以下に配置され、<code>compilerOptions.typeRoots</code>が定義されていないときはデフォルトで読み込まれる。</p>\\n<p><code>compilerOptions.typeRoots</code>を記述する際には、自分の定義したい型ファイルのディレクトリと合わせて、デフォルトで読み込まれる型定義ファイルのパスも記述する必要がある。</p>\\n<h2 id=\\"発展して\\">発展して</h2>\\n<p>逆に、インストールした型定義を無視したい時は、<code>compilerOptions.typeRoots</code>に<code>node_modules/@types</code>を除いて記述すれば良い。</p>\\n<p>使うシチュエーションはあまりないかもしれないが。</p>\\n<h2 id=\\"感想\\">感想</h2>\\n<p>TypeScriptは毎回完全理解()しているので、チョットデキル人間になるために一度ちゃんと学び直す必要がありそう。</p>\\n<p>(この項目はメモをここに移したときに書いた)</p>","contentSnippet":"TypeScriptでプロジェクト内の型定義をするときのための過去のメモをここに供養する。\\n日付は2020/1/10。\\nやりたいこと\\nTypeScriptで、独自の型定義をプロジェクト内の複数のファイルで利用したい。\\nsrc/types/index.d.tsで定義する型DayOfWeekをはじめとして、src/typesディレクトリ以下のファイルにある型定義をTypeScriptコンパイラに読み込ませて、プロジェクト内の任意のファイルで利用できるようにする。\\ntype DayOfWeek = \\"Sunday\\" | \\"Monday\\" | \\"Tuesday\\" | Wednesday\\" | \\"Tursday\\" | \\"Friday\\" | Saturday\\";\\n\\n\\n方法\\ntsconfig.jsonに次を追記する\\n{\\n\\"compilerOptions\\": {\\n\\"typeRoots\\": [\\n\\"node_modules/@types\\",\\n\\"src/types\\"\\n]\\n}\\n}\\n\\n\\ntsconfig.json内でのcompilerOptions.typeRootsは文字列の配列をおく。\\n文字列は型定義ファイルを置くディレクトリのパスを表す。\\nもともと、npmでインストールしたパッケージの型定義はnode_modules/@types以下に配置され、compilerOptions.typeRootsが定義されていないときはデフォルトで読み込まれる。\\ncompilerOptions.typeRootsを記述する際には、自分の定義したい型ファイルのディレクトリと合わせて、デフォルトで読み込まれる型定義ファイルのパスも記述する必要がある。\\n発展して\\n逆に、インストールした型定義を無視したい時は、compilerOptions.typeRootsにnode_modules/@typesを除いて記述すれば良い。\\n使うシチュエーションはあまりないかもしれないが。\\n感想\\nTypeScriptは毎回完全理解()しているので、チョットデキル人間になるために一度ちゃんと学び直す必要がありそう。\\n(この項目はメモをここに移したときに書いた)","guid":"https://memo.basd4g.net/posts/my-type-of-typescript/","isoDate":"2020-05-15T16:01:45.000Z"},{"title":"TELNETでHTTP通信する","link":"https://memo.basd4g.net/posts/telnet-http/","pubDate":"Sat, 16 May 2020 00:43:55 +0900","content":"<p>TELNETでHTTP通信するだけの記事である。\\nすぐ終わる。</p>\\n<p>相手ホストやポート番号、手書きのHTTPヘッダを渡せば、 TELNET で HTTP 通信ができる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ telnet memo.basd4g.net <span class=\\"m\\">80</span>\\nTrying 2400:6180:0:d1::4df:d001...\\nConnected to memo-basd4g-net.netlify.com.\\nEscape character is <span class=\\"s1\\">&#39;^]&#39;</span>.\\nGET / HTTP/1.1\\nHost: memo.basd4g.net\\nConnection: close\\nHTTP/1.1 <span class=\\"m\\">301</span> Moved Permanently\\nCache-Control: public, max-age<span class=\\"o\\">=</span>0, must-revalidate\\nContent-Length: <span class=\\"m\\">40</span>\\nContent-Type: text/plain\\nDate: Fri, <span class=\\"m\\">15</span> May <span class=\\"m\\">2020</span> 15:46:22 GMT\\nLocation: https://memo.basd4g.net/\\nAge: <span class=\\"m\\">2</span>\\nConnection: close\\nServer: Netlify\\nX-NF-Request-ID: e38b7b4a-47e9-4306-8d60-e917e96c78cd-2547281\\nRedirecting to https://memo.basd4g.net/\\nConnection closed by foreign host.\\n</code></pre></div><p>IPv6でつないでくれている。</p>\\n<p>あいにく memo.basd4g.net は HTTP をリダイレクトしてしまうのでページの内容は取得できなかったが、通信できた。</p>\\n<p>たまには HTTP ヘッダを手書きしてみるのも趣があるのではなかろうか。(??)</p>\\n<p>以上。</p>","contentSnippet":"TELNETでHTTP通信するだけの記事である。\\nすぐ終わる。\\n相手ホストやポート番号、手書きのHTTPヘッダを渡せば、 TELNET で HTTP 通信ができる。\\n$ telnet memo.basd4g.net 80\\nTrying 2400:6180:0:d1::4df:d001...\\nConnected to memo-basd4g-net.netlify.com.\\nEscape character is \'^]\'.\\nGET / HTTP/1.1\\nHost: memo.basd4g.net\\nConnection: close\\nHTTP/1.1 301 Moved Permanently\\nCache-Control: public, max-age=0, must-revalidate\\nContent-Length: 40\\nContent-Type: text/plain\\nDate: Fri, 15 May 2020 15:46:22 GMT\\nLocation: https://memo.basd4g.net/\\nAge: 2\\nConnection: close\\nServer: Netlify\\nX-NF-Request-ID: e38b7b4a-47e9-4306-8d60-e917e96c78cd-2547281\\nRedirecting to https://memo.basd4g.net/\\nConnection closed by foreign host.\\n\\n\\nIPv6でつないでくれている。\\nあいにく memo.basd4g.net は HTTP をリダイレクトしてしまうのでページの内容は取得できなかったが、通信できた。\\nたまには HTTP ヘッダを手書きしてみるのも趣があるのではなかろうか。(??)\\n以上。","guid":"https://memo.basd4g.net/posts/telnet-http/","isoDate":"2020-05-15T15:43:55.000Z"},{"title":"インターネットとTCP/IP","link":"https://memo.basd4g.net/posts/internet-tcpip/","pubDate":"Fri, 15 May 2020 23:37:00 +0900","content":"<p>今日のインターネットの根幹をなすTCP/IPについての基本的な知識を説明する。</p>\\n<p>研究室の輪講で「マスタリングTCP/IP 入門編」を読んだことがきっかけ。</p>\\n<ul>\\n<li>参考文献: マスタリングTCP/IP入門編 第二章 pp60-80</li>\\n</ul>\\n<h2 id=\\"インターネット\\">インターネット</h2>\\n<p>今この文章もインターネットに公開され、インターネットを介して見ていることと思うが、インターネットとはそもそも何を指すのか。</p>\\n<p>Internet / The Internet とは、TCP/IPにより全世界を接続しているコンピュータネットワーク、ただ一つのことを指す。</p>\\n<p>語源は「複数のネットワークを結ぶ」ことを表す internet。\\n現在ではこの意味は internet ではなく internetworking という言葉で表される。</p>\\n<h3 id=\\"インターネットの構造\\">インターネットの構造</h3>\\n<p>インターネットは、小さなネットワークが相互接続し1つのネットワークを成し、これが複数接続して大きなネットワークを成し、、のように階層的な構造をもつ。</p>\\n<p>ISP (Internet Service Provider) のネットワーク内では、NOC (Network Operation Center) と呼ばれる施設を通じて接続し、ネットワークを構成している。\\nISP 同士の接続には、2者間接続を行うプライベートピアリングや、多数の ISP を IX (Internet Exchange) を通じてつなぐ IP トランジットがある。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/internet-tcpip-internet-construction.png\\"><img src=\\"https://blob.basd4g.net/internet-tcpip-internet-construction.png\\"\\nalt=\\"インターネットの構造\\"/></a></p>\\n<p>画像はインターネットの構造を表した図。</p>\\n<p>ISP 以外にも有志で運営される地域ネットといわれるネットワークも存在すると本に記載があるが、2020年現在の実態は不明。\\n過去にあった地域ネットとして<a href=\\"https://ja.wikipedia.org/wiki/%E6%9F%8F%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E3%83%A6%E3%83%8B%E3%82%AA%E3%83%B3\\"target=\\"_blank\\">柏インターネットユニオン</a>などがあるようだ。</p>\\n<h2 id=\\"tcpip\\">TCP/IP</h2>\\n<p>TCP/IP とは、パケット交換プロトコルである IP (Internet Protocol) を利用したり、 IP で通信したりするときに必要なプロトコル群の総称のことである。\\nインターネットで必要なプロトコルをまとめたものであることから、インターネットプロトコルスイートとも言われる。\\nTCP/IP という語を使うとき、 TCP プロトコルと IP プロトコルだけを指しているわけではない。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/internet-tcpip-internet-protocol-suite.png\\"><img src=\\"https://blob.basd4g.net/internet-tcpip-internet-protocol-suite.png\\"\\nalt=\\"TCP/IP に含むプロトコルの一例\\"/></a></p>\\n<h3 id=\\"パケット交換ネットワーク\\">パケット交換ネットワーク</h3>\\n<p>先程出てきたパケット交換について。\\nパケット交換ネットワークとは、電話に用いられるような回線交換型と対比されるネットワークの形式である。</p>\\n<p>一つの回線を複数が共有して使う。\\n代表的な利点として、回線の利用効率を高められること、分散型のネットワークの構築に向くことが挙げられる。</p>\\n<h3 id=\\"tcpip-の歴史\\">TCP/IP の歴史</h3>\\n<p>1960年代、米国防総省 (The Depertment of Defense) が中心に、分散型ネットワークによる通信技術の開発が行われた。\\nその中で学術機関4ノードを結ぶ、パケット交換の実用性を試験するための分散型ネットワーク ARPANET が誕生した。\\nARPANET は急速に発展し、3年間で34ノードにまで拡大し、パケット交換によるデータ通信に実用性があることがわかった。</p>\\n<p>その後、単なるパケット交換通信にとどまらず、各ノードのコンピュータ間での信頼性の高い通信手段を提供する総合的な通信プロトコルが実験、開発される。これがTCP/IPとなった。</p>\\n<p>TCP/IP は当時普及していた OS である BSD UNIX に実装され、利用がさらに加速する。\\nARPANET は拡大し、多数のネットワークと接続するようになる。\\nやがて ARPANET や後継の NSFnet に接続する TCP/IP による世界的なネットワークをインターネット (The Internet) と呼ぶようになった。</p>\\n<p>1995年ごろには ISP (Internet Service Provider) が乱立し、インターネットの商用化が進む。\\nこのような流れで今日に至り、世界中を TCP/IP によるネットワークであるインターネットが覆い尽している。</p>\\n<ul>\\n<li>1960s DoD による通信技術の研究</li>\\n<li>1969 ARPANET の誕生。パケット交換技術の開発</li>\\n<li>1972 TCP/IP の誕生</li>\\n<li>1975 TCP/IP の仕様決定と、 TCP/IP が実装された UNIX の提供</li>\\n<li>1982 ARPANET でのプロトコルがTCP/IPに統一</li>\\n<li>1989 LAN/WAN 上で TCP/IP が普及</li>\\n<li>1995 インターネットの商用化が進む</li>\\n</ul>\\n<h3 id=\\"tcpip-の標準化\\">TCP/IP の標準化</h3>\\n<p>TCP/IP はプロトコル群であり、通信のためには両者が同一のプロトコルを使用する必要がある。\\nそのためにTCP/IP にも標準が存在するが、 TCP/IP の標準化には次の2つの特徴があり、これがプロトコルの急速な実現と普及に影響した。</p>\\n<ul>\\n<li>オープンである</li>\\n<li>実用を重視する</li>\\n</ul>\\n<h4 id=\\"特徴オープンである\\">特徴:オープンである</h4>\\n<p>TCP/IP の仕様を議論する IETF (Internet Engineering Task Force) のメーリングリストには自由に参加できる。</p>\\n<p>また仕様や実装も公開されており、自由にアクセスできることもオープンであるという特徴を表している。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/internet-tcpip-ietf-maling-list.png\\"><img src=\\"https://blob.basd4g.net/internet-tcpip-ietf-maling-list.png\\"\\nalt=\\"IETF のWebページ\\"/></a></p>\\n<p>画像は<a href=\\"https://www.ietf.org/how/lists/\\"target=\\"_blank\\">IETF のあるWebページ</a>の冒頭部分である。\\n画像下部分に書かれているように、IETF の議論には、どんな個人でも参加できる。\\nこのページの更に下に行くと、実際にメーリングリストに参加する手順が書かれていた。</p>\\n<h4 id=\\"特徴実用を重視する\\">特徴:実用を重視する</h4>\\n<p>TCP/IP は仕様策定時に実装することを念頭において進む。\\nプロトコルの詳細仕様を決める際には既に通信できる実装が存在し、標準になる頃には既に製品に実装されている。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/internet-tcpip-tcpip-standardizatin.png\\"><img src=\\"https://blob.basd4g.net/internet-tcpip-tcpip-standardizatin.png\\"\\nalt=\\"TCP/IP 標準化の手続き\\"/></a></p>\\n<p>画像はTCP/IP 標準化の手続きを図示したものである。</p>\\n<p>以上のように、TCP/IP の標準化手続きには特徴がある。\\n普及した要因に、他のプロトコルと比べ、実用を重視したことで動作するプロトコルをはやく作れたこと、オープンな仕様策定の仕組みにより急速な技術革新に対応できたことが考えられる。</p>\\n<h4 id=\\"tcpip-の仕様\\">TCP/IP の仕様</h4>\\n<p>標準化しようとするプロトコルは RFC (Request For Comments) と呼ばれるドキュメントになり、<a href=\\"http://rfc-editor.org/rfc\\"target=\\"_blank\\">インターネット上で公開</a>される。\\n仕様だけでなく、実装や運用、実験に関する情報を含む。</p>\\n<p>RFC には番号をがつけられており、一度 RFC になると改定することはない。\\n拡張や廃止、新規のプロトコルを定める際には新たな RFC として公開される。\\nそのため通し番号は大きくなり、プロトコルごとに番号の統一性があるわけでもないので人間にはわかりづらいところがある。\\nこれを助けるため、複数の RFC を指す STD (STanDard), FYI (For Your Information) などの文書単位もある。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/internet-tcpip-rfc2616.png\\"><img src=\\"https://blob.basd4g.net/internet-tcpip-rfc2616.png\\"\\nalt=\\"rfc2616の冒頭\\"/></a></p>\\n<p>画像は <a href=\\"https://tools.ietf.org/html/rfc2616\\"target=\\"_blank\\">RFC2617</a> の冒頭である。</p>\\n<h3 id=\\"tcpip-の階層モデル\\">TCP/IP の階層モデル</h3>\\n<p>TCP/IP モデルは階層構造になっている。\\nネットワークの信頼のある通信を実現するには様々な機能を実装せねばならないので、各層に分けて他層を抽象化することが現実的には必須。</p>\\n<p>TCP/IP が普及した理由の一つに柔軟性が挙げられる。\\nIP が動作すればそれより下位層は何を使ってもよいし、 TCP / UDP 上で動作すればそれより上位のアプリケーションはなんでもよいのである。</p>\\n<p>以下では、 OSI 参照モデルと TCP/IP 階層モデルの対応を示した後、下位層から順に、代表的なプロトコルを示す。</p>\\n<h4 id=\\"osi-参照モデルとの対応\\">OSI 参照モデルとの対応</h4>\\n<p>TCP/IP の階層モデルは、アプリケーション層、トランスポート層、インターネット層、リンク層の4階層から成る。\\nOSI 参照モデル7階層に完全に対応するものではないが、対応するとしたらつぎのようになる。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/internet-tcpip-tcpip-protocol-stack.png\\"><img src=\\"https://blob.basd4g.net/internet-tcpip-tcpip-protocol-stack.png\\"\\nalt=\\"OSI 参照モデルと TCP/IP 階層モデルの対応\\"/></a></p>\\n<h4 id=\\"ハードウェア\\">ハードウェア</h4>\\n<p>OSI 参照モデルで物理層に当たる部分である。</p>\\n<p>ハードウェアついては、 TCP/IP プロトコルでは特に指定されていない。\\n通信する上での信頼性、セキュリテイ、帯域、遅延、無線/有線、電話回線やイーサネットなど、物理的なものには拘束されず、ネットワークで接続された装置間で通信できればよい。</p>\\n<hr/>\\n<p>余談だが、 TCP/IP におけるハードウェアとして伝書鳩を用いることもできる。\\nRFC にも、<a href=\\"https://tools.ietf.org/html/rfc1149\\"target=\\"_blank\\">RFC1149 鳥類キャリアによるIPデータグラムの伝送企画</a>としてきちんと仕様が存在する。</p>\\n<p>これはエイプリルフールに作られたようだが、このような<strike>ふざけた</strike>お茶目な RFC はジョーク RFC と呼ばれ、他にも次のようなものがある。</p>\\n<ul>\\n<li><a href=\\"https://tools.ietf.org/html/rfc2322\\"target=\\"_blank\\">RFC2322 洗濯バサミDHCPによるIPアドレスの管理手法</a>(<a href=\\"http://www.kt.rim.or.jp/~ksk/joke-RFC/rfc2322j.txt\\"target=\\"_blank\\">邦訳</a>)</li>\\n<li><a href=\\"https://www.ietf.org/rfc/rfc2324.txt\\"target=\\"_blank\\">RFC2324 ハイパーテクストコーヒーポット制御プロトコル</a></li>\\n</ul>\\n<p>等。 鳩を用意するのは厳しいが、後者2つは実装してみたい気もする。</p>\\n<hr/>\\n<h4 id=\\"リンク層\\">リンク層</h4>\\n<p>ネットワークインタフェース層とも。(マスタリングTCP/IP入門編より)</p>\\n<p>デバイスドライバが実装にあたる。(マスタリングTCP/IP入門編より)\\nハードウェアの違いを吸収し、上位層で IP が使えるようにする。</p>\\n<p>PPP (Point to Point Protocol) もここに含まれる。</p>\\n<h4 id=\\"インターネット層\\">インターネット層</h4>\\n<p>OSI 参照モデルの下から3番目であるネットワーク層に対応する。</p>\\n<p>経路制御を行う。\\n通信したいホスト間のデータリンクを上位層へ隠し、実際は Hop-by-Hop で行われている通信を End-to-End で行われているようにみせる役割がある。</p>\\n<p>代表的な3つのプロトコルを紹介する。</p>\\n<h5 id=\\"ip-internet-protocol\\">IP (Internet Protocol)</h5>\\n<p>パケットを転送するために用いられる、インターネット層で代表的なプロトコル。\\nIP アドレスでホストを識別し、通信相手までパケットを配送する。\\n通信経路の確立を行うが、データが正しく送られる保証はない。</p>\\n<h5 id=\\"icmp-internet-control-message-protocol\\">ICMP (Internet Control Message Protocol)</h5>\\n<p>IP によるパケット転送に誤りがあったり、失敗したときにこれを通知するために用いられる。\\n他に、ネットワークが正常に通信できるか診断する機能ももつ。\\nping コマンドや traceroute コマンドなどは ICMP パケットを送信することで実現している。</p>\\n<h5 id=\\"arp-address-resolution-protocol\\">ARP (Address Resolution Protocol)</h5>\\n<p>IP アドレスと MAC アドレスの対応関係を取得するためのプロトコル。IP が目的地へ通信するために、ARP を用いて途中の各通信経路の解決が行われる。</p>\\n<h4 id=\\"トランスポート層\\">トランスポート層</h4>\\n<p>OSI 参照モデルの下から4番目であるトランスポート層に対応する。\\nアプリケーション間のプログラムの通信を実現し、場合によってはデータの到達性も保証する。</p>\\n<h5 id=\\"tcp-transmission-control-protocol\\">TCP (Transmission Control Protocol)</h5>\\n<p>コネクション型のプロトコル。\\nデータの到達性を保証し、再送制御や輻輳制御を行う。\\nコネクションの確立に3パケット、切断に4パケットの通信が少なくとも必要である。</p>\\n<h5 id=\\"udp-user-datagram-protocol\\">UDP (User Datagram Protocol)</h5>\\n<p>コネクションレス型のプロトコル。\\nデータの到達性を保証しない。\\nパケット数の少ない通信、2者間ではないブロードキャスト/マルチキャスト通信, データが多少抜け落ちても問題ない動画や音声の通信に向く。</p>\\n<h4 id=\\"アプリケーション層\\">アプリケーション層</h4>\\n<p>OSI 参照モデルの5-7階層に相当する。\\nTCP/IP上では様々なアプリケーションを動かすことができる。\\n以下では、それぞれのアプリケーションごとに使われるプロトコルを紹介する。</p>\\n<h5 id=\\"www-world-wide-web\\">WWW (World Wide Web)</h5>\\n<p>HTML (Hyper Text Markup Language) 文書をはじめとするデータを、Webブラウザを介して HTTP (Hyper Text Transfer Protocol) / HTTPS ( - Secure) で受信し閲覧する。</p>\\n<p>(QUIC などの例外を除いて)主に TCP 上で動作する。</p>\\n<h5 id=\\"電子メール\\">電子メール</h5>\\n<p>MIME (Multipurpose Internet Mail Extensions) (マイム)形式のデータを、専用のプロトコルを用いて送受信する。</p>\\n<p>メールの送受信には SMTP (Simple Mail Transfer Protocol), POP3 (Post Office Protocol version 3), IMAP (Internet Message Access Protocol)などが用いられる。</p>\\n<p>送信者はメールを SMTP サーバを経由して相手方の POP3 / IMAP サーバへ送信する。\\n受信者は POP3 / IMAP サーバよりメールを受け取る。</p>\\n<p>TCP 上で動作する。</p>\\n<h5 id=\\"ファイル転送\\">ファイル転送</h5>\\n<p>FTP (File Transfer Protocol) / SFTP (Secure - )によりファイルを送受信する</p>\\n<p>TCP 上で動作する。</p>\\n<h5 id=\\"遠隔ログイン\\">遠隔ログイン</h5>\\n<p>TELNET (TELetypewriter NETwork) や SSH (Secure SHell) を用いて離れたコンピュータにログインする。</p>\\n<p>Linux で GUI を実現するためによく用いられる X Window System の X Protocol も TCP/IP 上で実現している。</p>\\n<p>TELNET や SSH 等は TCP 上で動作する。\\nX Protocol の中でも XDMCP (X Display Manager Control Protocol) は UDP。</p>\\n<h5 id=\\"ネットワーク管理\\">ネットワーク管理</h5>\\n<p>SNMP (Simple Network Management Protocol) など。</p>\\n<p>ネットワーク上のルータやスイッチなどの管理対象(SNMP エージェント)を管理端末(SNMP マネージャ)が管理する。\\nパケットの量や機器の温度などを管理できる。\\nネットワーク機器の動作を妨げないため、また通信に必要なパケットが少ないため、UDP で動作する。</p>\\n<h3 id=\\"実際の通信\\">実際の通信</h3>\\n<p>通信を行う際、送信側は上位層から順にその層で必要となる管理情報を含むヘッダを付加してカプセル化する。\\n受信側は下位層から順にヘッダを解釈して除去し上位層に渡す。</p>\\n<p>例えばWebページを閲覧する際は、サーバ側で HTML 文書に HTTP ヘッダを付加し、 TCP ヘッダを付加し、 IP ヘッダを付加し、イーサネットフレームのヘッダを付加し送信される。\\nクライアントはイーサネットフレームのヘッダを解釈し、 IP ヘッダを解釈し、 TCP ヘッダを解釈し、 HTTP ヘッダを解釈し、 HTML 文章を画面に描画する。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/internet-tcpip-encapsulation.png\\"><img src=\\"https://blob.basd4g.net/internet-tcpip-encapsulation.png\\"\\nalt=\\"実際の通信のカプセル化\\"/></a></p>\\n<h2 id=\\"まとめ\\">まとめ</h2>\\n<p>以上の内容をまとめると次のようになる。</p>\\n<ul>\\n<li>インターネットは TCP/IP で接続される世界全体のネットワークのこと</li>\\n<li>TCP/IP は IP をはじめとするプロトコル群</li>\\n<li>TCP/IP はオープンな議論で, 実用重視の仕様策定を行っている</li>\\n<li>TCP/IP の各プロトコルは階層モデルでわけることができる</li>\\n</ul>\\n<p>ネットワーク全体について俯瞰して振り返ることはあまりないので、スライドを作ったのに合わせて文章にも起こしてみた。\\nこういった復習を多く含む地道な勉強も、怠らずにやっていきたい。</p>\\n<hr>\\n<p>追記: (2020/10/04) 不要な改行タグを削除</p>","contentSnippet":"今日のインターネットの根幹をなすTCP/IPについての基本的な知識を説明する。\\n研究室の輪講で「マスタリングTCP/IP 入門編」を読んだことがきっかけ。\\n参考文献: マスタリングTCP/IP入門編 第二章 pp60-80\\nインターネット\\n今この文章もインターネットに公開され、インターネットを介して見ていることと思うが、インターネットとはそもそも何を指すのか。\\nInternet / The Internet とは、TCP/IPにより全世界を接続しているコンピュータネットワーク、ただ一つのことを指す。\\n語源は「複数のネットワークを結ぶ」ことを表す internet。\\n現在ではこの意味は internet ではなく internetworking という言葉で表される。\\nインターネットの構造\\nインターネットは、小さなネットワークが相互接続し1つのネットワークを成し、これが複数接続して大きなネットワークを成し、、のように階層的な構造をもつ。\\nISP (Internet Service Provider) のネットワーク内では、NOC (Network Operation Center) と呼ばれる施設を通じて接続し、ネットワークを構成している。\\nISP 同士の接続には、2者間接続を行うプライベートピアリングや、多数の ISP を IX (Internet Exchange) を通じてつなぐ IP トランジットがある。\\n\\n画像はインターネットの構造を表した図。\\nISP 以外にも有志で運営される地域ネットといわれるネットワークも存在すると本に記載があるが、2020年現在の実態は不明。\\n過去にあった地域ネットとして柏インターネットユニオンなどがあるようだ。\\nTCP/IP\\nTCP/IP とは、パケット交換プロトコルである IP (Internet Protocol) を利用したり、 IP で通信したりするときに必要なプロトコル群の総称のことである。\\nインターネットで必要なプロトコルをまとめたものであることから、インターネットプロトコルスイートとも言われる。\\nTCP/IP という語を使うとき、 TCP プロトコルと IP プロトコルだけを指しているわけではない。\\n\\nパケット交換ネットワーク\\n先程出てきたパケット交換について。\\nパケット交換ネットワークとは、電話に用いられるような回線交換型と対比されるネットワークの形式である。\\n一つの回線を複数が共有して使う。\\n代表的な利点として、回線の利用効率を高められること、分散型のネットワークの構築に向くことが挙げられる。\\nTCP/IP の歴史\\n1960年代、米国防総省 (The Depertment of Defense) が中心に、分散型ネットワークによる通信技術の開発が行われた。\\nその中で学術機関4ノードを結ぶ、パケット交換の実用性を試験するための分散型ネットワーク ARPANET が誕生した。\\nARPANET は急速に発展し、3年間で34ノードにまで拡大し、パケット交換によるデータ通信に実用性があることがわかった。\\nその後、単なるパケット交換通信にとどまらず、各ノードのコンピュータ間での信頼性の高い通信手段を提供する総合的な通信プロトコルが実験、開発される。これがTCP/IPとなった。\\nTCP/IP は当時普及していた OS である BSD UNIX に実装され、利用がさらに加速する。\\nARPANET は拡大し、多数のネットワークと接続するようになる。\\nやがて ARPANET や後継の NSFnet に接続する TCP/IP による世界的なネットワークをインターネット (The Internet) と呼ぶようになった。\\n1995年ごろには ISP (Internet Service Provider) が乱立し、インターネットの商用化が進む。\\nこのような流れで今日に至り、世界中を TCP/IP によるネットワークであるインターネットが覆い尽している。\\n1960s DoD による通信技術の研究\\n1969 ARPANET の誕生。パケット交換技術の開発\\n1972 TCP/IP の誕生\\n1975 TCP/IP の仕様決定と、 TCP/IP が実装された UNIX の提供\\n1982 ARPANET でのプロトコルがTCP/IPに統一\\n1989 LAN/WAN 上で TCP/IP が普及\\n1995 インターネットの商用化が進む\\nTCP/IP の標準化\\nTCP/IP はプロトコル群であり、通信のためには両者が同一のプロトコルを使用する必要がある。\\nそのためにTCP/IP にも標準が存在するが、 TCP/IP の標準化には次の2つの特徴があり、これがプロトコルの急速な実現と普及に影響した。\\nオープンである\\n実用を重視する\\n特徴:オープンである\\nTCP/IP の仕様を議論する IETF (Internet Engineering Task Force) のメーリングリストには自由に参加できる。\\nまた仕様や実装も公開されており、自由にアクセスできることもオープンであるという特徴を表している。\\n\\n画像はIETF のあるWebページの冒頭部分である。\\n画像下部分に書かれているように、IETF の議論には、どんな個人でも参加できる。\\nこのページの更に下に行くと、実際にメーリングリストに参加する手順が書かれていた。\\n特徴:実用を重視する\\nTCP/IP は仕様策定時に実装することを念頭において進む。\\nプロトコルの詳細仕様を決める際には既に通信できる実装が存在し、標準になる頃には既に製品に実装されている。\\n\\n画像はTCP/IP 標準化の手続きを図示したものである。\\n以上のように、TCP/IP の標準化手続きには特徴がある。\\n普及した要因に、他のプロトコルと比べ、実用を重視したことで動作するプロトコルをはやく作れたこと、オープンな仕様策定の仕組みにより急速な技術革新に対応できたことが考えられる。\\nTCP/IP の仕様\\n標準化しようとするプロトコルは RFC (Request For Comments) と呼ばれるドキュメントになり、インターネット上で公開される。\\n仕様だけでなく、実装や運用、実験に関する情報を含む。\\nRFC には番号をがつけられており、一度 RFC になると改定することはない。\\n拡張や廃止、新規のプロトコルを定める際には新たな RFC として公開される。\\nそのため通し番号は大きくなり、プロトコルごとに番号の統一性があるわけでもないので人間にはわかりづらいところがある。\\nこれを助けるため、複数の RFC を指す STD (STanDard), FYI (For Your Information) などの文書単位もある。\\n\\n画像は RFC2617 の冒頭である。\\nTCP/IP の階層モデル\\nTCP/IP モデルは階層構造になっている。\\nネットワークの信頼のある通信を実現するには様々な機能を実装せねばならないので、各層に分けて他層を抽象化することが現実的には必須。\\nTCP/IP が普及した理由の一つに柔軟性が挙げられる。\\nIP が動作すればそれより下位層は何を使ってもよいし、 TCP / UDP 上で動作すればそれより上位のアプリケーションはなんでもよいのである。\\n以下では、 OSI 参照モデルと TCP/IP 階層モデルの対応を示した後、下位層から順に、代表的なプロトコルを示す。\\nOSI 参照モデルとの対応\\nTCP/IP の階層モデルは、アプリケーション層、トランスポート層、インターネット層、リンク層の4階層から成る。\\nOSI 参照モデル7階層に完全に対応するものではないが、対応するとしたらつぎのようになる。\\n\\nハードウェア\\nOSI 参照モデルで物理層に当たる部分である。\\nハードウェアついては、 TCP/IP プロトコルでは特に指定されていない。\\n通信する上での信頼性、セキュリテイ、帯域、遅延、無線/有線、電話回線やイーサネットなど、物理的なものには拘束されず、ネットワークで接続された装置間で通信できればよい。\\n余談だが、 TCP/IP におけるハードウェアとして伝書鳩を用いることもできる。\\nRFC にも、RFC1149 鳥類キャリアによるIPデータグラムの伝送企画としてきちんと仕様が存在する。\\nこれはエイプリルフールに作られたようだが、このようなふざけたお茶目な RFC はジョーク RFC と呼ばれ、他にも次のようなものがある。\\nRFC2322 洗濯バサミDHCPによるIPアドレスの管理手法(邦訳)\\nRFC2324 ハイパーテクストコーヒーポット制御プロトコル\\n等。 鳩を用意するのは厳しいが、後者2つは実装してみたい気もする。\\nリンク層\\nネットワークインタフェース層とも。(マスタリングTCP/IP入門編より)\\nデバイスドライバが実装にあたる。(マスタリングTCP/IP入門編より)\\nハードウェアの違いを吸収し、上位層で IP が使えるようにする。\\nPPP (Point to Point Protocol) もここに含まれる。\\nインターネット層\\nOSI 参照モデルの下から3番目であるネットワーク層に対応する。\\n経路制御を行う。\\n通信したいホスト間のデータリンクを上位層へ隠し、実際は Hop-by-Hop で行われている通信を End-to-End で行われているようにみせる役割がある。\\n代表的な3つのプロトコルを紹介する。\\nIP (Internet Protocol)\\nパケットを転送するために用いられる、インターネット層で代表的なプロトコル。\\nIP アドレスでホストを識別し、通信相手までパケットを配送する。\\n通信経路の確立を行うが、データが正しく送られる保証はない。\\nICMP (Internet Control Message Protocol)\\nIP によるパケット転送に誤りがあったり、失敗したときにこれを通知するために用いられる。\\n他に、ネットワークが正常に通信できるか診断する機能ももつ。\\nping コマンドや traceroute コマンドなどは ICMP パケットを送信することで実現している。\\nARP (Address Resolution Protocol)\\nIP アドレスと MAC アドレスの対応関係を取得するためのプロトコル。IP が目的地へ通信するために、ARP を用いて途中の各通信経路の解決が行われる。\\nトランスポート層\\nOSI 参照モデルの下から4番目であるトランスポート層に対応する。\\nアプリケーション間のプログラムの通信を実現し、場合によってはデータの到達性も保証する。\\nTCP (Transmission Control Protocol)\\nコネクション型のプロトコル。\\nデータの到達性を保証し、再送制御や輻輳制御を行う。\\nコネクションの確立に3パケット、切断に4パケットの通信が少なくとも必要である。\\nUDP (User Datagram Protocol)\\nコネクションレス型のプロトコル。\\nデータの到達性を保証しない。\\nパケット数の少ない通信、2者間ではないブロードキャスト/マルチキャスト通信, データが多少抜け落ちても問題ない動画や音声の通信に向く。\\nアプリケーション層\\nOSI 参照モデルの5-7階層に相当する。\\nTCP/IP上では様々なアプリケーションを動かすことができる。\\n以下では、それぞれのアプリケーションごとに使われるプロトコルを紹介する。\\nWWW (World Wide Web)\\nHTML (Hyper Text Markup Language) 文書をはじめとするデータを、Webブラウザを介して HTTP (Hyper Text Transfer Protocol) / HTTPS ( - Secure) で受信し閲覧する。\\n(QUIC などの例外を除いて)主に TCP 上で動作する。\\n電子メール\\nMIME (Multipurpose Internet Mail Extensions) (マイム)形式のデータを、専用のプロトコルを用いて送受信する。\\nメールの送受信には SMTP (Simple Mail Transfer Protocol), POP3 (Post Office Protocol version 3), IMAP (Internet Message Access Protocol)などが用いられる。\\n送信者はメールを SMTP サーバを経由して相手方の POP3 / IMAP サーバへ送信する。\\n受信者は POP3 / IMAP サーバよりメールを受け取る。\\nTCP 上で動作する。\\nファイル転送\\nFTP (File Transfer Protocol) / SFTP (Secure - )によりファイルを送受信する\\nTCP 上で動作する。\\n遠隔ログイン\\nTELNET (TELetypewriter NETwork) や SSH (Secure SHell) を用いて離れたコンピュータにログインする。\\nLinux で GUI を実現するためによく用いられる X Window System の X Protocol も TCP/IP 上で実現している。\\nTELNET や SSH 等は TCP 上で動作する。\\nX Protocol の中でも XDMCP (X Display Manager Control Protocol) は UDP。\\nネットワーク管理\\nSNMP (Simple Network Management Protocol) など。\\nネットワーク上のルータやスイッチなどの管理対象(SNMP エージェント)を管理端末(SNMP マネージャ)が管理する。\\nパケットの量や機器の温度などを管理できる。\\nネットワーク機器の動作を妨げないため、また通信に必要なパケットが少ないため、UDP で動作する。\\n実際の通信\\n通信を行う際、送信側は上位層から順にその層で必要となる管理情報を含むヘッダを付加してカプセル化する。\\n受信側は下位層から順にヘッダを解釈して除去し上位層に渡す。\\n例えばWebページを閲覧する際は、サーバ側で HTML 文書に HTTP ヘッダを付加し、 TCP ヘッダを付加し、 IP ヘッダを付加し、イーサネットフレームのヘッダを付加し送信される。\\nクライアントはイーサネットフレームのヘッダを解釈し、 IP ヘッダを解釈し、 TCP ヘッダを解釈し、 HTTP ヘッダを解釈し、 HTML 文章を画面に描画する。\\n\\nまとめ\\n以上の内容をまとめると次のようになる。\\nインターネットは TCP/IP で接続される世界全体のネットワークのこと\\nTCP/IP は IP をはじめとするプロトコル群\\nTCP/IP はオープンな議論で, 実用重視の仕様策定を行っている\\nTCP/IP の各プロトコルは階層モデルでわけることができる\\nネットワーク全体について俯瞰して振り返ることはあまりないので、スライドを作ったのに合わせて文章にも起こしてみた。\\nこういった復習を多く含む地道な勉強も、怠らずにやっていきたい。\\n追記: (2020/10/04) 不要な改行タグを削除","guid":"https://memo.basd4g.net/posts/internet-tcpip/","isoDate":"2020-05-15T14:37:00.000Z"},{"title":"就活を終えて半年経って思うこと。","link":"https://memo.basd4g.net/posts/job-hunting-6-month-ago/","pubDate":"Wed, 13 May 2020 23:54:22 +0900","content":"<p>進路を迷っている知人に就活のことを聞かれ、自分が何を考えて決めたのかを、主に次の視点で綴ったので、ここにも記します。</p>\\n<ul>\\n<li>就職先の決め手</li>\\n<li>なぜエンジニアとして働くのか</li>\\n<li>なぜ大学院に進学しなかったのか</li>\\n</ul>\\n<h2 id=\\"就職先の決め手\\">就職先の決め手</h2>\\n<p>就活時に重視していたところはつぎのようなことがあります。</p>\\n<ul>\\n<li>文化</li>\\n<li>技術的な成長</li>\\n<li>会社のサービスに自分が貢献したいと思えるか</li>\\n</ul>\\n<p>会社を決めた理由は、ざっくりまとめると「自分が最も成長できそうだから」でしょうか。\\n就職予定の会社は、独特の企業文化が特徴です。これが自分が働くモチベーション高く保つことにつながると考えました。\\n技術が身につく環境でも、自分に合わない環境で働くのは長続きしないでしょう。しかしこの会社でなら正直に過ごせそう、自分が成長の努力をしながら楽しんで働けそうだと感じたからです。</p>\\n<p>新卒時点の給料はそこまで重視していなくて、技術が身につけばいくらでも給料を高められるだろうから、自分が成長できること(長期的に見て稼げること)のほうが大事だと考えていました。</p>\\n<p>あとは、会社規模も関係しています。決めた会社は社内のエンジニアコミュニティが強く、その中で高めあっているところが魅力に写りました。</p>\\n<p>他に受けていた会社で、エンジニアが数人ほどの企業もあったのですが、私の技術的な未熟さゆえに選考を断念しました。\\n(極端に言うと幅広い技術や一歩先の技術を身につける余裕を自分に持てないのではないかとの懸念がありました。)\\n規模が小さいほうが裁量があったり、ビジネスサイドにも足をつっこんだりしやすい側面はありそうです。この魅力を重視する方は私とは違う決断をするでしょう。)</p>\\n<p>逆にもっと大きな会社だと、細分化されすぎていて私には楽しくないようにみえました。(エンジニアリングに関してはいろんなことに足を突っ込んでみたい。)\\n会社規模は選考がある程度進んでから、比較するようになって考えだしました。</p>\\n<h2 id=\\"エンジニアになるかどうか\\">エンジニアになるかどうか</h2>\\n<p>私はわりと初期の段階でWebエンジニアに絞ってしまっていました。とりあえず行動してみて、納得できなければ変えるつもりでしたが、働くイメージが湧いてきたのでそのまま方向を変えずに就活をつづけました。</p>\\n<p>自分がどれだけ技術を好きになれるか、勉強を苦に思わないかが自分の中での判断基準です。世の中には自分よりコンピュータが好きな人はたくさんいるし、上を見たらきりはないので、現時点での技術力と熱意が他人に負けているからダメという選び方はしていません。\\n私にとって、他の仕事よりWebエンジニアとして働いたほうが、仕事を楽しめてかつ社会に出せる価値が多そうだと判断し決めました。</p>\\n<p>(Web)エンジニアになるのはある意味賭けで、専門的な技術は身につくけど、いざとなれば転職で入ってこれる業界でもあるので、難しいですね。</p>\\n<p>エンジニアといっても、ビジネスやデザインのわかるエンジニア、他方、技術に尖ったエンジニアをより欲しているところ、育てようとしているところはたくさんあるだろうし、非常に多種多様な姿があるだろうから、自分にあったキャリアを見つけるのは大変でしょう。さらに世の中には本当に様々な仕事があり、Webエンジニア、プログラマーだけをを見ているのは勿体無いかもしれません。</p>\\n<p>私なりにいくつかの選択肢を考える中で、自分に興味のある領域を深められる職・会社としていまの進路を選びました。</p>\\n<h2 id=\\"大学院に行くかどうか\\">大学院に行くかどうか</h2>\\n<p>就活を始めるときに、内心「良さげな企業に受かったら就職、うまく行かなかったら院にいこうか」と考えましたが、まず「とりあえず就職前提で動こう」(じゃないと何もしなそう)と自分に言い聞かせました。</p>\\n<p>就活をしていくうちに、良い会社に出会えたこと、(まだ始まっていなかったが)大学での研究よりもWeb周りのことを触っている方が楽しいだろうと思ったことから就職へ傾きました。\\n内心、面接が重なると早く就活を抜け出したい、(院卒で)もう一回やるのはちょっと大変という気持ちもありました。\\n就活は真剣にキャリアを考える機会として面白い面もあるのですが、続けていると気持ちが疲れてくる面もあります。</p>\\n<p>いまの会社に受かってなければ大学院に進学していたかもしれません。\\n真っ当な理由「研究がしたい」 はもちろん、就活を先延ばしにする意味でも大学院進学もありだったなとは今も思ってます。(院卒に怒られる)。</p>\\n<p>Web業界は新卒といえど、(私は経験ないですが)長期インターンに行っている人が結構いたり、ある程度の技術的素養が求められている会社もそこそこあるので、就活が先延ばしになると受かりやすくなる面はあるかもしれません。\\n(どこかで読みましたがインターンに受かるコツはインターンに受かることだそうです。)\\n大学院に進学すれば、インターンなどに参加する時間的な猶予ができるともとれます。</p>\\n<hr/>\\n<p>つたない文章ですが、私が考えていたことを思い返してみました。</p>\\n<p>就活をはじめてから、自分がどんな価値を見いだせるか、どんな環境で働きたいか、あらためて何度も考えました。\\n特に面接や面談はその考えが深まる、改まる場であって、このような機会を設けてくださった方々に感謝しています。</p>","contentSnippet":"進路を迷っている知人に就活のことを聞かれ、自分が何を考えて決めたのかを、主に次の視点で綴ったので、ここにも記します。\\n就職先の決め手\\nなぜエンジニアとして働くのか\\nなぜ大学院に進学しなかったのか\\n就職先の決め手\\n就活時に重視していたところはつぎのようなことがあります。\\n文化\\n技術的な成長\\n会社のサービスに自分が貢献したいと思えるか\\n会社を決めた理由は、ざっくりまとめると「自分が最も成長できそうだから」でしょうか。\\n就職予定の会社は、独特の企業文化が特徴です。これが自分が働くモチベーション高く保つことにつながると考えました。\\n技術が身につく環境でも、自分に合わない環境で働くのは長続きしないでしょう。しかしこの会社でなら正直に過ごせそう、自分が成長の努力をしながら楽しんで働けそうだと感じたからです。\\n新卒時点の給料はそこまで重視していなくて、技術が身につけばいくらでも給料を高められるだろうから、自分が成長できること(長期的に見て稼げること)のほうが大事だと考えていました。\\nあとは、会社規模も関係しています。決めた会社は社内のエンジニアコミュニティが強く、その中で高めあっているところが魅力に写りました。\\n他に受けていた会社で、エンジニアが数人ほどの企業もあったのですが、私の技術的な未熟さゆえに選考を断念しました。\\n(極端に言うと幅広い技術や一歩先の技術を身につける余裕を自分に持てないのではないかとの懸念がありました。)\\n規模が小さいほうが裁量があったり、ビジネスサイドにも足をつっこんだりしやすい側面はありそうです。この魅力を重視する方は私とは違う決断をするでしょう。)\\n逆にもっと大きな会社だと、細分化されすぎていて私には楽しくないようにみえました。(エンジニアリングに関してはいろんなことに足を突っ込んでみたい。)\\n会社規模は選考がある程度進んでから、比較するようになって考えだしました。\\nエンジニアになるかどうか\\n私はわりと初期の段階でWebエンジニアに絞ってしまっていました。とりあえず行動してみて、納得できなければ変えるつもりでしたが、働くイメージが湧いてきたのでそのまま方向を変えずに就活をつづけました。\\n自分がどれだけ技術を好きになれるか、勉強を苦に思わないかが自分の中での判断基準です。世の中には自分よりコンピュータが好きな人はたくさんいるし、上を見たらきりはないので、現時点での技術力と熱意が他人に負けているからダメという選び方はしていません。\\n私にとって、他の仕事よりWebエンジニアとして働いたほうが、仕事を楽しめてかつ社会に出せる価値が多そうだと判断し決めました。\\n(Web)エンジニアになるのはある意味賭けで、専門的な技術は身につくけど、いざとなれば転職で入ってこれる業界でもあるので、難しいですね。\\nエンジニアといっても、ビジネスやデザインのわかるエンジニア、他方、技術に尖ったエンジニアをより欲しているところ、育てようとしているところはたくさんあるだろうし、非常に多種多様な姿があるだろうから、自分にあったキャリアを見つけるのは大変でしょう。さらに世の中には本当に様々な仕事があり、Webエンジニア、プログラマーだけをを見ているのは勿体無いかもしれません。\\n私なりにいくつかの選択肢を考える中で、自分に興味のある領域を深められる職・会社としていまの進路を選びました。\\n大学院に行くかどうか\\n就活を始めるときに、内心「良さげな企業に受かったら就職、うまく行かなかったら院にいこうか」と考えましたが、まず「とりあえず就職前提で動こう」(じゃないと何もしなそう)と自分に言い聞かせました。\\n就活をしていくうちに、良い会社に出会えたこと、(まだ始まっていなかったが)大学での研究よりもWeb周りのことを触っている方が楽しいだろうと思ったことから就職へ傾きました。\\n内心、面接が重なると早く就活を抜け出したい、(院卒で)もう一回やるのはちょっと大変という気持ちもありました。\\n就活は真剣にキャリアを考える機会として面白い面もあるのですが、続けていると気持ちが疲れてくる面もあります。\\nいまの会社に受かってなければ大学院に進学していたかもしれません。\\n真っ当な理由「研究がしたい」 はもちろん、就活を先延ばしにする意味でも大学院進学もありだったなとは今も思ってます。(院卒に怒られる)。\\nWeb業界は新卒といえど、(私は経験ないですが)長期インターンに行っている人が結構いたり、ある程度の技術的素養が求められている会社もそこそこあるので、就活が先延ばしになると受かりやすくなる面はあるかもしれません。\\n(どこかで読みましたがインターンに受かるコツはインターンに受かることだそうです。)\\n大学院に進学すれば、インターンなどに参加する時間的な猶予ができるともとれます。\\nつたない文章ですが、私が考えていたことを思い返してみました。\\n就活をはじめてから、自分がどんな価値を見いだせるか、どんな環境で働きたいか、あらためて何度も考えました。\\n特に面接や面談はその考えが深まる、改まる場であって、このような機会を設けてくださった方々に感謝しています。","guid":"https://memo.basd4g.net/posts/job-hunting-6-month-ago/","isoDate":"2020-05-13T14:54:22.000Z"},{"title":"(余談) User Defaultsとproperty list(plist)","link":"https://memo.basd4g.net/posts/plist/","pubDate":"Sat, 02 May 2020 16:26:00 +0900","content":"<p>Mac OS XのUser Defaultsを変更するためのシェルスクリプトを作るツール <a href=\\"https://github.com/basd4g/pdef\\"target=\\"_blank\\">pdef</a>を制作した。(解説記事: <a href=\\"https://memo.basd4g.net/posts/pdef/\\">Macの設定を自動化するdefaultsコマンドと、それを助けるpdef</a>)</p>\\n<p>これを作る際にProperty listについて学んだことを記す。</p>\\n<h2 id=\\"user-defaults\\">User Defaults</h2>\\n<p>User Defaultsは、MacOSXやiOSにおける各アプリケーションが設定などを保持するためのデータベースである。\\nUser Defaultsは、各アプリケーション(正確にはアプリケーションの持つドメイン)ごとにProperty listとして記録される。\\n普段は各アプリケーションを通して読み書きされるが、ターミナル上からアクセスできる<code>$ defaults</code>コマンドも提供されている。(後述)</p>\\n<h2 id=\\"property-list\\">Property list</h2>\\n<p>User Defaultsに使われているproperty list(以下plist)は、Mac OS Xにおいてオブジェクトの永続化におけるファイル形式としてよく用いられている。\\n例えば、iOSアプリを開発する際に自動生成されてXcode上から見える<code>info.plist</code>がその例だ。</p>\\n<p>plistはNeXTSTEP時代から続く歴史あるフォーマットらしい。時代背景も相まってファイルの保存形式は多数ある(後述)。</p>\\n<h3 id=\\"論理構造\\">論理構造</h3>\\n<p>plistはJSON等と同様のキーバリュー形式の論理構造を取る。\\nキーに一対一対応する値が存在し、値は即値の他に入れ子状にデータを保持できる。</p>\\n<p>値のとりうる型は次の通り。</p>\\n<ul>\\n<li>辞書(dictionary)</li>\\n<li>配列(array)</li>\\n<li>文字列(string)</li>\\n<li>数値(number(integer and float))</li>\\n<li>日付(date)</li>\\n<li>バイナリ(binary data)</li>\\n<li>真偽値(Boolean value)</li>\\n</ul>\\n<p>この中でも辞書型と配列型は特殊で、辞書型はキーと値の組を、配列型は値を、子にもつことができる。</p>\\n<p>JSONに無い型(日付,バイナリ)が存在するので、完全な相互変換は不可。</p>\\n<p>参考: <a href=\\"https://developer.apple.com/library/archive/documentation/General/Conceptual/DevPedia-CocoaCore/PropertyList.html\\"target=\\"_blank\\">Property list - Apple Developper Documentation</a> (plist関する公式のドキュメント)</p>\\n<h3 id=\\"保存形式\\">保存形式</h3>\\n<h4 id=\\"old-style-ascii形式\\">old-style ASCII形式</h4>\\n<p>テキストベースで、可読性が高いのがこの形式。NeXT形式とも呼ばれる?。NeXTSTEP時代にできた。\\n作られた当時、文字列、配列、ディクショナリ、そしてバイナリデータのみを表現できたらしい。\\nシンプルなフォーマットであるが、型情報がなく、型の判別が難しい。</p>\\n<p><code>$ defaults read</code>コマンドで出力される形式であり、現在では主にここでみられる。</p>\\n<p>old-style ASCII形式の例として、あるplistをold-style ASCIIで表した表記を以下に示す。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-txt\\" data-lang=\\"txt\\">{\\n&#34;boolean-example&#34; = 0;\\nfuga = {\\np0y0p0y0 = 0;\\npunipuni = value;\\n};\\nhoge = helloworld;\\nwara = (\\n{length = 8, bytes = 0x0123456789abcdef},\\n123,\\n&#34;0.5&#34;,\\n1,\\n&#34;2019-09-16 05:45:42 +0000&#34;\\n);\\n}\\n</code></pre></div><h4 id=\\"xml形式\\">XML形式</h4>\\n<p>plistのデータ構造をXML形式で表現した形式。\\n前述のold-style ASCIIのように欠けた情報がなく、なおかつ人間にも読めるのでplistをこねくり回す際にはお世話になるだろう。</p>\\n<p>それぞれの型におけるxml上での表記は次の通り</p>\\n<ul>\\n<li>辞書: <code>&lt;dict&gt; &lt;key&gt;keystring&lt;/key&gt; [value] (繰り返し) &lt;/dict&gt;</code></li>\\n<li>配列: <code>&lt;array&gt; [vaule] (繰り返し) &lt;/array&gt;</code></li>\\n<li>文字列: <code>&lt;string&gt;value&lt;/string&gt;</code></li>\\n<li>数値(整数): <code>&lt;integer&gt;124234&lt;/integer&gt;</code></li>\\n<li>数値(浮動小数点数): <code>&lt;real&gt;0.43&lt;/real&gt;</code></li>\\n<li>日付: <code>&lt;date&gt;2019-09-16T05:45:42Z&lt;/date&gt;</code> (ISO8601と思われる)</li>\\n<li>バイナリ: <code>&lt;data&gt; ASNFZ4mrze8= &lt;/data&gt;</code> (base64でエンコード済みの文字列)</li>\\n<li>真偽値: <code>&lt;true/&gt;</code>または<code>&lt;false/&gt;</code></li>\\n</ul>\\n<p>XML形式の例として、先程示したplistをXMLで表した表記を以下に示す。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-xml\\" data-lang=\\"xml\\"><span class=\\"cp\\">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>\\n<span class=\\"cp\\">&lt;!DOCTYPE plist PUBLIC &#34;-//Apple//DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;</span>\\n<span class=\\"nt\\">&lt;plist</span> <span class=\\"na\\">version=</span><span class=\\"s\\">&#34;1.0&#34;</span><span class=\\"nt\\">&gt;</span>\\n<span class=\\"nt\\">&lt;dict&gt;</span>\\n<span class=\\"nt\\">&lt;key&gt;</span>hoge<span class=\\"nt\\">&lt;/key&gt;</span>\\n<span class=\\"nt\\">&lt;string&gt;</span>helloworld<span class=\\"nt\\">&lt;/string&gt;</span>\\n<span class=\\"nt\\">&lt;key&gt;</span>boolean-example<span class=\\"nt\\">&lt;/key&gt;</span>\\n<span class=\\"nt\\">&lt;false/&gt;</span>\\n<span class=\\"nt\\">&lt;key&gt;</span>wara<span class=\\"nt\\">&lt;/key&gt;</span>\\n<span class=\\"nt\\">&lt;array&gt;</span>\\n<span class=\\"nt\\">&lt;data&gt;</span>\\nASNFZ4mrze8=\\n<span class=\\"nt\\">&lt;/data&gt;</span>\\n<span class=\\"nt\\">&lt;integer&gt;</span>123<span class=\\"nt\\">&lt;/integer&gt;</span>\\n<span class=\\"nt\\">&lt;real&gt;</span>0.5<span class=\\"nt\\">&lt;/real&gt;</span>\\n<span class=\\"nt\\">&lt;true/&gt;</span>\\n<span class=\\"nt\\">&lt;date&gt;</span>2019-09-16T05:45:42Z<span class=\\"nt\\">&lt;/date&gt;</span>\\n<span class=\\"nt\\">&lt;/array&gt;</span>\\n<span class=\\"nt\\">&lt;key&gt;</span>fuga<span class=\\"nt\\">&lt;/key&gt;</span>\\n<span class=\\"nt\\">&lt;dict&gt;</span>\\n<span class=\\"nt\\">&lt;key&gt;</span>punipuni<span class=\\"nt\\">&lt;/key&gt;</span>\\n<span class=\\"nt\\">&lt;string&gt;</span>value<span class=\\"nt\\">&lt;/string&gt;</span>\\n<span class=\\"nt\\">&lt;key&gt;</span>p0y0p0y0<span class=\\"nt\\">&lt;/key&gt;</span>\\n<span class=\\"nt\\">&lt;string&gt;</span>0<span class=\\"nt\\">&lt;/string&gt;</span>\\n<span class=\\"nt\\">&lt;/dict&gt;</span>\\n<span class=\\"nt\\">&lt;/dict&gt;</span>\\n<span class=\\"nt\\">&lt;/plist&gt;</span>\\n</code></pre></div><h4 id=\\"binary形式\\">binary形式</h4>\\n<p>テキストベースではなく人間が用意に読めなくした代わりに、ファイルサイズの削減と読み書きを高速化ができる形式。</p>\\n<p>ここまでで述べたようにplistはバイナリデータも含むことができる。\\nそのため、大きなバイナリデータを含むplistについては、old-style ASCIIやxmlでの表現は冗長で、ファイルが大きくなる、読み書きが遅くなるなどの問題が生まれる。\\nこれを避けるためにバイナリ形式でデータを書き出すことができる。具体的な形式は未調査。</p>\\n<p>おそらくあまり出会うことはないが、バイナリ形式には現在使われていない古い別形式もあるらしい。</p>\\n<p>参考: Plistの歴史</p>\\n<ul>\\n<li><a href=\\"https://www.itmedia.co.jp/enterprise/articles/0705/14/news013_2.html\\"target=\\"_blank\\">第3回 plist（プロパティリスト）とFoundation【前編】 - ITmedia</a></li>\\n<li><a href=\\"https://www.itmedia.co.jp/enterprise/articles/0705/30/news011.html\\"target=\\"_blank\\">第4回 plist（プロパティリスト）とFoundation【後編】 - ITmedia</a></li>\\n</ul>\\n<h3 id=\\"plistを操作できるデフォルトツール\\">plistを操作できるデフォルトツール</h3>\\n<p>plistを検証、確認、変更するコマンドラインツールが、Mac OS Xにはデフォルトでいくつか入っている。</p>\\n<p><code>defaults</code>, <code>pl</code>, <code>plutil</code>, <code>/usr/libexec/PlistBuddy</code>を紹介する。</p>\\n<h4 id=\\"defaults\\">defaults</h4>\\n<p>User Defaultsを読み書きするためのツール</p>\\n<p>代表的な<code>read</code>,<code>write</code>,<code>import</code>,<code>export</code>のハマりどころを記す。</p>\\n<ul>\\n<li><code>$ defaults read</code></li>\\n</ul>\\n<p>&ldquo;ほぼ&quot;old-style ASCII形式で、User Defaultsを標準出力に出力する。\\nold-style ASCIIには型情報を含まないので、型のみを調べる<code>$ defaults read-type</code>もある。</p>\\n<p><strong>出力は正しい文法のold-style ASCII形式のplistとは限らない。大きなサイズのdata型の値は、一部省略して出力され、この部分は文法規則に反する。</strong>\\n(これが原因で最初plistを正しく読み込めずに困った)</p>\\n<p>readの後ろに引数を渡さないとすべてドメインのUser Defaultsを出力する。\\n1コマンドでまとめて出力できるのは筆者の知る限り<code>$ defaults read</code>のみ。</p>\\n<p>ネストしている深い値を指定して読むことはできない。</p>\\n<ul>\\n<li><code>$ defaults write</code></li>\\n</ul>\\n<p>引数にで値を指定して、User Defaultsに書き込める。\\n型を区別するオプションを指定できる。</p>\\n<p>data型は<code>-data</code>オプションをつけた上で、valueを16進数表記で記述する。</p>\\n<p>date型は<code>-date</code>オプションをつけた上で、valueをISO8601形式で記述する。</p>\\n<p>ネストしている深い値を指定して書き込むことはできない。</p>\\n<ul>\\n<li><code>$ defaults export</code></li>\\n</ul>\\n<p>特定のドメインのUser Defualtsをxml形式またはバイナリ形式で出力する。</p>\\n<p>ドメインは必ず指定する必要があり、<code>$ defaults read</code>のようにすべてのドメインのUser Defaultsを一括して出力することはできない。</p>\\n<ul>\\n<li><code>$ defaults import</code></li>\\n</ul>\\n<p>xml形式またはバイナリ形式でUser Defaultsに書き込める。</p>\\n<h4 id=\\"pl\\">pl</h4>\\n<p>old-style ASCII形式のplistの文法をチェックするツール。</p>\\n<h4 id=\\"plutil\\">plutil</h4>\\n<p>XML,binary形式のplistの文法をチェックするツール。</p>\\n<p>値の読み書き/削除ができるが、深いネストしている深い値を指定して操作することはできない。</p>\\n<ul>\\n<li><a href=\\"https://qiita.com/trakwkbys/items/a94c4d43342e96352bde\\"target=\\"_blank\\">コマンドラインでplistを操作（データ追加・編集・削除） - Qiita(@trakwkbys)</a></li>\\n</ul>\\n<h4 id=\\"usrlibexecplistbuddy\\">/usr/libexec/PlistBuddy</h4>\\n<p>ネストしている深い値を直接指定して読み書き/削除できるスグレモノ。</p>\\n<p>data型を書き込むときは、文字列がそのままbyte列として読み込まれるらしい。\\nよって書き込める値が制限される。\\nネストが深い場所にあるdata型の値を書き込む際は、xmlファイルに直接base64エンコードした文字列を書き込むなどすると良い。</p>\\n<p>date型を書き込むときは、<code>Mon Apr 20 20:52:00 2020 JST</code>のような形式を渡す。\\n(PlistBuddyのdata型の値書き込みに関するドキュメントは見つけられなかったが、<a href=\\"https://github.com/darlinghq/darling/blob/master/src/PlistBuddy/PlistBuddy.c\\"target=\\"_blank\\">darling</a>の実装を参考にして実験し見つけた。)</p>\\n<h2 id=\\"plistファイルを読み書きする際のswiftでの実装\\">plistファイルを読み書きする際の、Swiftでの実装</h2>\\n<p>今回作成した<a href=\\"https://github.com/basd4g/pdef\\"target=\\"_blank\\">pdef</a>において、Swiftでplistを扱う際に肝になった部分を実装を交えて紹介する。</p>\\n<p>ちなみにPythonでは<a href=\\"https://docs.python.org/ja/3/library/plistlib.html\\"target=\\"_blank\\">plistlib</a>が使えるようだ。</p>\\n<h3 id=\\"plistファイル全体をnsdictionaryとして読み込む\\">plistファイル全体をNSDictionaryとして読み込む</h3>\\n<p>plistファイルをSwiftの変数として扱えるように取り込むのは非常に簡単。\\n下記のサンプルコードのように一行で読み込める。</p>\\n<p>ファイル形式がold-style ASCIIだろうがxmlだろうがbinaryだろうが、勝手に判断してよしなにしてくれる。\\n(ただし<a href=\\"#defaults\\">ハマりどころ</a>に注意)</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-swift\\" data-lang=\\"swift\\"><span class=\\"c1\\">// https://github.com/basd4g/pdef/blob/516f0215306b6ca206ebad646190ba74bd5d4b17/src/loadFile.swift</span>\\n<span class=\\"c1\\">// 以上より一部抜粋</span>\\n<span class=\\"kd\\">import</span> <span class=\\"nc\\">Foundation</span>\\n<span class=\\"k\\">guard</span> <span class=\\"kd\\">let</span> <span class=\\"nv\\">plist</span> <span class=\\"p\\">=</span> <span class=\\"n\\">NSDictionary</span><span class=\\"p\\">(</span><span class=\\"n\\">contentsOfFile</span><span class=\\"p\\">:</span> <span class=\\"n\\">path</span><span class=\\"p\\">)</span> <span class=\\"k\\">else</span> <span class=\\"p\\">{</span>\\n<span class=\\"n\\">ErrorMessage</span><span class=\\"p\\">(</span><span class=\\"s\\">&#34;Failed to load property list &#39;</span><span class=\\"si\\">\\\\(</span><span class=\\"n\\">path</span><span class=\\"si\\">)</span><span class=\\"s\\">&#39;&#34;</span><span class=\\"p\\">)</span>\\n<span class=\\"n\\">exit</span><span class=\\"p\\">(</span><span class=\\"mi\\">1</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">}</span>\\n</code></pre></div><p>pdefをSwiftで実装したのはplistを扱うのが楽だろうからという目論見だったが、それが一番功を奏したのがこの部分。</p>\\n<h3 id=\\"型を判別する\\">型を判別する</h3>\\n<p>上記の方法でplistファイルをSwift内の変数として読み込んでも、型はすべてAnyとして扱われてしまう。\\nこれは困るので、値を次のサンプルコードの関数<code>GetPlistType(value: Any) -&gt; PlistType</code>に与えることで型を調べられる。\\n型がわかればキャストできるので、その後Swiftで扱うのが楽になる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-swift\\" data-lang=\\"swift\\"><span class=\\"c1\\">// https://github.com/basd4g/pdef/blob/516f0215306b6ca206ebad646190ba74bd5d4b17/src/plist.swift</span>\\n<span class=\\"c1\\">// 以上より一部抜粋、書き換え</span>\\n<span class=\\"kd\\">import</span> <span class=\\"nc\\">Foundation</span>\\n<span class=\\"kd\\">enum</span> <span class=\\"nc\\">PlistType</span><span class=\\"p\\">:</span> <span class=\\"nb\\">Int</span> <span class=\\"p\\">{</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">string</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">real</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">integer</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">bool</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">data</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">date</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">array</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">dict</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"kd\\">func</span> <span class=\\"nf\\">GetPlistType</span><span class=\\"p\\">(</span><span class=\\"n\\">value</span><span class=\\"p\\">:</span> <span class=\\"nb\\">Any</span><span class=\\"p\\">)</span> <span class=\\"p\\">-&gt;</span> <span class=\\"n\\">PlistType</span> <span class=\\"p\\">{</span>\\n<span class=\\"kd\\">let</span> <span class=\\"nv\\">typeID</span> <span class=\\"p\\">=</span> <span class=\\"n\\">CFGetTypeID</span><span class=\\"p\\">(</span><span class=\\"n\\">value</span> <span class=\\"k\\">as</span> <span class=\\"n\\">CFTypeRef</span><span class=\\"p\\">?)</span>\\n<span class=\\"k\\">switch</span> <span class=\\"n\\">typeID</span> <span class=\\"p\\">{</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">CFNumberGetTypeID</span><span class=\\"p\\">():</span>\\n<span class=\\"k\\">if</span> <span class=\\"n\\">value</span> <span class=\\"k\\">is</span> <span class=\\"n\\">NSInteger</span> <span class=\\"p\\">{</span>\\n<span class=\\"k\\">return</span> <span class=\\"p\\">.</span><span class=\\"n\\">integer</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"k\\">return</span> <span class=\\"p\\">.</span><span class=\\"n\\">real</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">CFArrayGetTypeID</span><span class=\\"p\\">():</span>\\n<span class=\\"k\\">return</span> <span class=\\"p\\">.</span><span class=\\"n\\">array</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">CFDictionaryGetTypeID</span><span class=\\"p\\">():</span>\\n<span class=\\"k\\">return</span> <span class=\\"p\\">.</span><span class=\\"n\\">dict</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">CFStringGetTypeID</span><span class=\\"p\\">():</span>\\n<span class=\\"k\\">return</span> <span class=\\"p\\">.</span><span class=\\"n\\">string</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">CFDataGetTypeID</span><span class=\\"p\\">():</span>\\n<span class=\\"k\\">return</span> <span class=\\"p\\">.</span><span class=\\"n\\">data</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">CFDateGetTypeID</span><span class=\\"p\\">():</span>\\n<span class=\\"k\\">return</span> <span class=\\"p\\">.</span><span class=\\"n\\">date</span>\\n<span class=\\"k\\">case</span> <span class=\\"n\\">CFBooleanGetTypeID</span><span class=\\"p\\">():</span>\\n<span class=\\"k\\">return</span> <span class=\\"p\\">.</span><span class=\\"n\\">bool</span>\\n<span class=\\"k\\">default</span><span class=\\"p\\">:</span>\\n<span class=\\"n\\">exit</span><span class=\\"p\\">(</span><span class=\\"mi\\">1</span><span class=\\"p\\">)</span>\\n<span class=\\"p\\">}</span>\\n<span class=\\"p\\">}</span>\\n</code></pre></div><p>参考:</p>\\n<ul>\\n<li><a href=\\"https://developer.apple.com/documentation/corefoundation/cftypeid\\"target=\\"_blank\\">CFTypeID - Apple Developper Documantation</a>(Property listの型をSwiftで判別する)</li>\\n<li><a href=\\"https://qiita.com/junpluse/items/e334e511457f8c133de9\\"target=\\"_blank\\">Swift.Any as? CFType - Qiita(@junpluse)</a>(Property listの型をSwiftで判別する)</li>\\n<li><a href=\\"https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFDesignConcepts/Articles/Inspecting.html\\"target=\\"_blank\\">Inspecting Objects - Apple Developper Docuumentation</a>(Property listの型をSwiftで判別する)</li>\\n</ul>\\n<h2 id=\\"おわりに\\">おわりに</h2>\\n<p>Swiftでplistを扱うための情報を集めるのに時間がかかったので、まとめる記事を書くに至った。</p>\\n<p>この記事は<a href=\\"https://memo.basd4g.net/posts/pdef/\\">Macの設定を自動化するdefaultsコマンドと、それを助けるpdef</a>(pdefの紹介記事)の余談と補足として作った。\\nここまでの内容を実装して作った、User Defaults書き換えを支援するツールである<a href=\\"https://github.com/basd4g/pdef\\"target=\\"_blank\\">pdef</a>も興味があれば使ってみてほしい。</p>\\n<p>User DefaultsだけでなくProperty listをSwiftで扱う際に、どこから手をつけてよいかわからない人が概要を掴むのにこの記事が役立てば幸いだ。</p>\\n<hr>\\n<p>追記: (2020/10/04) pdefの記事へのリンクを相対リンクに修正</p>","contentSnippet":"Mac OS XのUser Defaultsを変更するためのシェルスクリプトを作るツール pdefを制作した。(解説記事: Macの設定を自動化するdefaultsコマンドと、それを助けるpdef)\\nこれを作る際にProperty listについて学んだことを記す。\\nUser Defaults\\nUser Defaultsは、MacOSXやiOSにおける各アプリケーションが設定などを保持するためのデータベースである。\\nUser Defaultsは、各アプリケーション(正確にはアプリケーションの持つドメイン)ごとにProperty listとして記録される。\\n普段は各アプリケーションを通して読み書きされるが、ターミナル上からアクセスできる$ defaultsコマンドも提供されている。(後述)\\nProperty list\\nUser Defaultsに使われているproperty list(以下plist)は、Mac OS Xにおいてオブジェクトの永続化におけるファイル形式としてよく用いられている。\\n例えば、iOSアプリを開発する際に自動生成されてXcode上から見えるinfo.plistがその例だ。\\nplistはNeXTSTEP時代から続く歴史あるフォーマットらしい。時代背景も相まってファイルの保存形式は多数ある(後述)。\\n論理構造\\nplistはJSON等と同様のキーバリュー形式の論理構造を取る。\\nキーに一対一対応する値が存在し、値は即値の他に入れ子状にデータを保持できる。\\n値のとりうる型は次の通り。\\n辞書(dictionary)\\n配列(array)\\n文字列(string)\\n数値(number(integer and float))\\n日付(date)\\nバイナリ(binary data)\\n真偽値(Boolean value)\\nこの中でも辞書型と配列型は特殊で、辞書型はキーと値の組を、配列型は値を、子にもつことができる。\\nJSONに無い型(日付,バイナリ)が存在するので、完全な相互変換は不可。\\n参考: Property list - Apple Developper Documentation (plist関する公式のドキュメント)\\n保存形式\\nold-style ASCII形式\\nテキストベースで、可読性が高いのがこの形式。NeXT形式とも呼ばれる?。NeXTSTEP時代にできた。\\n作られた当時、文字列、配列、ディクショナリ、そしてバイナリデータのみを表現できたらしい。\\nシンプルなフォーマットであるが、型情報がなく、型の判別が難しい。\\n$ defaults readコマンドで出力される形式であり、現在では主にここでみられる。\\nold-style ASCII形式の例として、あるplistをold-style ASCIIで表した表記を以下に示す。\\n{\\n\\"boolean-example\\" = 0;\\nfuga = {\\np0y0p0y0 = 0;\\npunipuni = value;\\n};\\nhoge = helloworld;\\nwara = (\\n{length = 8, bytes = 0x0123456789abcdef},\\n123,\\n\\"0.5\\",\\n1,\\n\\"2019-09-16 05:45:42 +0000\\"\\n);\\n}\\n\\n\\nXML形式\\nplistのデータ構造をXML形式で表現した形式。\\n前述のold-style ASCIIのように欠けた情報がなく、なおかつ人間にも読めるのでplistをこねくり回す際にはお世話になるだろう。\\nそれぞれの型におけるxml上での表記は次の通り\\n辞書: <dict> <key>keystring</key> [value] (繰り返し) </dict>\\n配列: <array> [vaule] (繰り返し) </array>\\n文字列: <string>value</string>\\n数値(整数): <integer>124234</integer>\\n数値(浮動小数点数): <real>0.43</real>\\n日付: <date>2019-09-16T05:45:42Z</date> (ISO8601と思われる)\\nバイナリ: <data> ASNFZ4mrze8= </data> (base64でエンコード済みの文字列)\\n真偽値: <true/>または<false/>\\nXML形式の例として、先程示したplistをXMLで表した表記を以下に示す。\\n<?xml version=\\"1.0\\" encoding=\\"UTF-8\\"?>\\n<!DOCTYPE plist PUBLIC \\"-//Apple//DTD PLIST 1.0//EN\\" \\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\\">\\n<plist version=\\"1.0\\">\\n<dict>\\n<key>hoge</key>\\n<string>helloworld</string>\\n<key>boolean-example</key>\\n<false/>\\n<key>wara</key>\\n<array>\\n<data>\\nASNFZ4mrze8=\\n</data>\\n<integer>123</integer>\\n<real>0.5</real>\\n<true/>\\n<date>2019-09-16T05:45:42Z</date>\\n</array>\\n<key>fuga</key>\\n<dict>\\n<key>punipuni</key>\\n<string>value</string>\\n<key>p0y0p0y0</key>\\n<string>0</string>\\n</dict>\\n</dict>\\n</plist>\\n\\n\\nbinary形式\\nテキストベースではなく人間が用意に読めなくした代わりに、ファイルサイズの削減と読み書きを高速化ができる形式。\\nここまでで述べたようにplistはバイナリデータも含むことができる。\\nそのため、大きなバイナリデータを含むplistについては、old-style ASCIIやxmlでの表現は冗長で、ファイルが大きくなる、読み書きが遅くなるなどの問題が生まれる。\\nこれを避けるためにバイナリ形式でデータを書き出すことができる。具体的な形式は未調査。\\nおそらくあまり出会うことはないが、バイナリ形式には現在使われていない古い別形式もあるらしい。\\n参考: Plistの歴史\\n第3回 plist（プロパティリスト）とFoundation【前編】 - ITmedia\\n第4回 plist（プロパティリスト）とFoundation【後編】 - ITmedia\\nplistを操作できるデフォルトツール\\nplistを検証、確認、変更するコマンドラインツールが、Mac OS Xにはデフォルトでいくつか入っている。\\ndefaults, pl, plutil, /usr/libexec/PlistBuddyを紹介する。\\ndefaults\\nUser Defaultsを読み書きするためのツール\\n代表的なread,write,import,exportのハマりどころを記す。\\n$ defaults read\\n“ほぼ\\"old-style ASCII形式で、User Defaultsを標準出力に出力する。\\nold-style ASCIIには型情報を含まないので、型のみを調べる$ defaults read-typeもある。\\n出力は正しい文法のold-style ASCII形式のplistとは限らない。大きなサイズのdata型の値は、一部省略して出力され、この部分は文法規則に反する。\\n(これが原因で最初plistを正しく読み込めずに困った)\\nreadの後ろに引数を渡さないとすべてドメインのUser Defaultsを出力する。\\n1コマンドでまとめて出力できるのは筆者の知る限り$ defaults readのみ。\\nネストしている深い値を指定して読むことはできない。\\n$ defaults write\\n引数にで値を指定して、User Defaultsに書き込める。\\n型を区別するオプションを指定できる。\\ndata型は-dataオプションをつけた上で、valueを16進数表記で記述する。\\ndate型は-dateオプションをつけた上で、valueをISO8601形式で記述する。\\nネストしている深い値を指定して書き込むことはできない。\\n$ defaults export\\n特定のドメインのUser Defualtsをxml形式またはバイナリ形式で出力する。\\nドメインは必ず指定する必要があり、$ defaults readのようにすべてのドメインのUser Defaultsを一括して出力することはできない。\\n$ defaults import\\nxml形式またはバイナリ形式でUser Defaultsに書き込める。\\npl\\nold-style ASCII形式のplistの文法をチェックするツール。\\nplutil\\nXML,binary形式のplistの文法をチェックするツール。\\n値の読み書き/削除ができるが、深いネストしている深い値を指定して操作することはできない。\\nコマンドラインでplistを操作（データ追加・編集・削除） - Qiita(@trakwkbys)\\n/usr/libexec/PlistBuddy\\nネストしている深い値を直接指定して読み書き/削除できるスグレモノ。\\ndata型を書き込むときは、文字列がそのままbyte列として読み込まれるらしい。\\nよって書き込める値が制限される。\\nネストが深い場所にあるdata型の値を書き込む際は、xmlファイルに直接base64エンコードした文字列を書き込むなどすると良い。\\ndate型を書き込むときは、Mon Apr 20 20:52:00 2020 JSTのような形式を渡す。\\n(PlistBuddyのdata型の値書き込みに関するドキュメントは見つけられなかったが、darlingの実装を参考にして実験し見つけた。)\\nplistファイルを読み書きする際の、Swiftでの実装\\n今回作成したpdefにおいて、Swiftでplistを扱う際に肝になった部分を実装を交えて紹介する。\\nちなみにPythonではplistlibが使えるようだ。\\nplistファイル全体をNSDictionaryとして読み込む\\nplistファイルをSwiftの変数として扱えるように取り込むのは非常に簡単。\\n下記のサンプルコードのように一行で読み込める。\\nファイル形式がold-style ASCIIだろうがxmlだろうがbinaryだろうが、勝手に判断してよしなにしてくれる。\\n(ただしハマりどころに注意)\\n// https://github.com/basd4g/pdef/blob/516f0215306b6ca206ebad646190ba74bd5d4b17/src/loadFile.swift\\n// 以上より一部抜粋\\nimport Foundation\\nguard let plist = NSDictionary(contentsOfFile: path) else {\\nErrorMessage(\\"Failed to load property list \'\\\\(path)\'\\")\\nexit(1)\\n}\\n\\n\\npdefをSwiftで実装したのはplistを扱うのが楽だろうからという目論見だったが、それが一番功を奏したのがこの部分。\\n型を判別する\\n上記の方法でplistファイルをSwift内の変数として読み込んでも、型はすべてAnyとして扱われてしまう。\\nこれは困るので、値を次のサンプルコードの関数GetPlistType(value: Any) -> PlistTypeに与えることで型を調べられる。\\n型がわかればキャストできるので、その後Swiftで扱うのが楽になる。\\n// https://github.com/basd4g/pdef/blob/516f0215306b6ca206ebad646190ba74bd5d4b17/src/plist.swift\\n// 以上より一部抜粋、書き換え\\nimport Foundation\\nenum PlistType: Int {\\ncase string\\ncase real\\ncase integer\\ncase bool\\ncase data\\ncase date\\ncase array\\ncase dict\\n}\\nfunc GetPlistType(value: Any) -> PlistType {\\nlet typeID = CFGetTypeID(value as CFTypeRef?)\\nswitch typeID {\\ncase CFNumberGetTypeID():\\nif value is NSInteger {\\nreturn .integer\\n}\\nreturn .real\\ncase CFArrayGetTypeID():\\nreturn .array\\ncase CFDictionaryGetTypeID():\\nreturn .dict\\ncase CFStringGetTypeID():\\nreturn .string\\ncase CFDataGetTypeID():\\nreturn .data\\ncase CFDateGetTypeID():\\nreturn .date\\ncase CFBooleanGetTypeID():\\nreturn .bool\\ndefault:\\nexit(1)\\n}\\n}\\n\\n\\n参考:\\nCFTypeID - Apple Developper Documantation(Property listの型をSwiftで判別する)\\nSwift.Any as? CFType - Qiita(@junpluse)(Property listの型をSwiftで判別する)\\nInspecting Objects - Apple Developper Docuumentation(Property listの型をSwiftで判別する)\\nおわりに\\nSwiftでplistを扱うための情報を集めるのに時間がかかったので、まとめる記事を書くに至った。\\nこの記事はMacの設定を自動化するdefaultsコマンドと、それを助けるpdef(pdefの紹介記事)の余談と補足として作った。\\nここまでの内容を実装して作った、User Defaults書き換えを支援するツールであるpdefも興味があれば使ってみてほしい。\\nUser DefaultsだけでなくProperty listをSwiftで扱う際に、どこから手をつけてよいかわからない人が概要を掴むのにこの記事が役立てば幸いだ。\\n追記: (2020/10/04) pdefの記事へのリンクを相対リンクに修正","guid":"https://memo.basd4g.net/posts/plist/","isoDate":"2020-05-02T07:26:00.000Z"},{"title":"Macの設定を自動化するdefaultsコマンドと、それを助けるpdef","link":"https://memo.basd4g.net/posts/pdef/","pubDate":"Fri, 01 May 2020 00:52:47 +0900","content":"<p>tl;dr Mac OS XのUser Defaultsの差分をdefaultsコマンドの形式に変換するコマンドラインツール、<a href=\\"https://github.com/basd4g/pdef\\"target=\\"_blank\\">&ldquo;pdef&rdquo;</a>を作った。</p>\\n<p><a href=\\"#pdef%e3%81%a7%e3%82%b7%e3%82%a7%e3%83%ab%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e4%bd%9c%e3%82%8b\\">本題(pdefでシェルスクリプトを作る)まで飛ばす</a></p>\\n<h2 id=\\"defaultsコマンドでmacの設定を自動化する\\">defaultsコマンドでMacの設定を自動化する</h2>\\n<p>Macには、OSや各アプリの設定を保存するUser Defaultsというデータベースがある。\\n例えばドックの大きさやメニューバーに表示するアイコン、Safariの開発者ツールの有効化フラグ、(使用している場合は)サードパーティ製アプリケーションの設定情報なども記録されている。</p>\\n<p>これらのUser Defaultsの項目は普通、GUI上の設定画面を変更することでデータを読み書きするが、ターミナル上から操作するdefaultsコマンドなるものもMacに標準で入っている。</p>\\n<p>これを用いることで、Macの初期設定を自動化するシェルスクリプトがよく作られているようだ。</p>\\n<p>たとえば、次のスクリプトは、Finder(ファイラー)において、隠しファイル・隠しフォルダを表示する設定を有効にする。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"cp\\">#!/bin/bash\\n</span><span class=\\"cp\\"></span>defaults write com.apple.finder AppleShowAllFiles YES\\n</code></pre></div><p>(スクリプト実行後に<code>$ killall Finder</code>としてアプリケーションを再起動する必要がある。)</p>\\n<p>このようなdefaultsコマンドによる設定例はブログなどで見つけることができる。\\nそれらをまとめて自分用のシェルスクリプトを作っておけば、Macを初期設定する際にすぐに自分好みの環境にすることができるというわけだ。</p>\\n<p>GUIからの設定は項目が増えると手間がかかるし同じ環境を再現するのは大変なので、自動化できるのはありがたい。</p>\\n<p>様々なdefaultsコマンドの一例を記載したサイト</p>\\n<ul>\\n<li><a href=\\"https://neos21.hatenablog.com/entry/2019/01/10/080000\\"target=\\"_blank\\">MacOS で設定する defaults コマンドをまとめてみた - Corredor</a></li>\\n<li><a href=\\"https://qiita.com/ry0f/items/f2c75f0a77b1012182d6\\"target=\\"_blank\\">OS X を自分色に染める w/ defaults - Qiita(@ry0f)</a></li>\\n<li><a href=\\"https://qiita.com/idtkb/items/68c44c6f7ba1e15924bb\\"target=\\"_blank\\">Macの環境設定 - Qiita(@idtkb)</a></li>\\n<li><a href=\\"https://github.com/mathiasbynens/dotfiles/blob/master/.macos\\"target=\\"_blank\\">.macos - GitHub(mathiasbynens/dotfiles)</a></li>\\n</ul>\\n<h2 id=\\"defaultsコマンドの引数を調べる\\">defaultsコマンドの引数を調べる</h2>\\n<p>ところで、このdefaultsコマンドの引数はどのようにして知るのだろうか。\\n先程のサイトに載っているものはよいものの、他の設定項目はdefaultsコマンドにどんな引数を渡せばよいのだろうか。\\n私の調べた限りでは、公式なまとまった情報はないようだった。</p>\\n<p>しかし、愚直に調査する方法はある。</p>\\n<p>defaultsコマンドには、<code>$ defaults write</code>の他に<code>$ defaults read</code>というサブコマンドもある。これによりUser Defaultsを閲覧できる。\\nGUI上の操作によってUser Defaultsにどんな変更が加わるか、変更前後の<code>$ defaults read</code>の出力を比較すればわかる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ defaults <span class=\\"nb\\">read</span> &gt; before.txt\\n<span class=\\"c1\\"># GUI上で設定を変更する</span>\\n$ defaults <span class=\\"nb\\">read</span> &gt; after.txt\\n$ diff before.txt after.txt\\n</code></pre></div><p>diffで該当した部分を中心に、defaultsコマンドで指定する値を抜き出せばよい。</p>\\n<p>が、<code>$ defaults read</code>の出力結果を読むのが面倒なので、これを自動で行うツールを作成した。</p>\\n<p>(<code>$ defaults read</code>の出力形式は、property list(old-style ascii)である。\\n<a href=\\"https://memo.basd4g.net/posts/plist/\\">(余談) UserDefaultsとplistについて</a>として別記事にまとめたので、plistについてはこちらを参照してほしい。)</p>\\n<h2 id=\\"pdefでシェルスクリプトを作る\\">pdefでシェルスクリプトを作る</h2>\\n<p>閑話休題</p>\\n<h3 id=\\"pdefとは\\">pdefとは</h3>\\n<p><a href=\\"https://github.com/basd4g/pdef\\"target=\\"_blank\\">pdef</a> (pi:def) は、User Defaultsの設定前後の差分から、defaultsコマンドの引数を調べてくれる。</p>\\n<p>引数に<code>$ defaults read</code>の出力を記録したファイルのパスを与える。 (第一引数に設定前、第二引数に設定後)\\nすると、設定前後の差分から、シェルスクリプト(defaultsコマンドを並べたもの)を出力する。</p>\\n<h3 id=\\"インストール\\">インストール</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ git clone https://github.com/basd4g/pdef.git\\n$ <span class=\\"nb\\">cd</span> pdef\\n$ make\\n$ cp bin/pdef /user/local/bin\\n</code></pre></div><h3 id=\\"使用例\\">使用例</h3>\\n<p>次のように使う。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># 設定を記録する</span>\\n$ defaults <span class=\\"nb\\">read</span> &gt; before.txt\\n<span class=\\"c1\\"># [GUI上で設定を変更する]</span>\\n$ defaults <span class=\\"nb\\">read</span> &gt; after.txt\\n$ pdef before.txt after.txt &gt; patch.sh\\n<span class=\\"c1\\"># 設定を復元する</span>\\n$ bash patch.sh\\n</code></pre></div><p>使用例として、メニューバーの音量アイコンを表示/非表示している様子。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/pdef-demo.gif\\"><img src=\\"https://blob.basd4g.net/pdef-demo.gif\\"\\nalt=\\"使用例のスクリーンショット\\"/></a></p>\\n<p>Mac上で設定を変更するときに、前後で<code>$ defaults read</code>でUser Defaultsの内容を書き出しておくと、pdefを使って再設定が楽にできるという算段である。</p>\\n<h3 id=\\"オプション\\">オプション</h3>\\n<p><code>--domain</code>オプションをつけると、特定のアプリのUser Defaultsも比較できる。(<code>$ defaults export hogehoge -</code>の出力等)\\n<code>--domain</code>オプションをつけた際は、old-style asciiのplist以外にも、xmlやバイナリも読み込める。</p>\\n<p>実行例</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ defaults <span class=\\"nb\\">export</span> com.apple.systemuiserver - &gt; before.xml\\n<span class=\\"c1\\"># メニューバーの変更(音量アイコンの表示/非表示等)</span>\\n$ defaults <span class=\\"nb\\">export</span> com.apple.systemuiserver - &gt; after.xml\\n$ pdef --domain com.apple.systemuiserver before.xml after.xml\\n</code></pre></div><h3 id=\\"例外\\">例外</h3>\\n<p>pdefは現在は以下のようなものには対応していない。</p>\\n<ul>\\n<li>data型の長い値 ( &ndash;domainオプションを付加すれば可能)</li>\\n<li>keyのrename</li>\\n<li>追加と削除が混在した差分</li>\\n</ul>\\n<h2 id=\\"さいごに\\">さいごに</h2>\\n<p>インターネットの海に流れるdefaultsコマンドの設定例の他に、このツールで調べた設定を追加して、自分専用のMac設定用スクリプトの作成に役立てていただければ幸いだ。</p>\\n<p>私のdefaultsコマンドを集めた<a href=\\"https://github.com/basd4g/dotfiles/tree/master/bin/user-default\\"target=\\"_blank\\">シェルスクリプトはこちら</a>。</p>\\n<hr>\\n<p>追記: (2020/10/04) plistへの記事リンクを相対リンクに修正</p>","contentSnippet":"tl;dr Mac OS XのUser Defaultsの差分をdefaultsコマンドの形式に変換するコマンドラインツール、“pdef”を作った。\\n本題(pdefでシェルスクリプトを作る)まで飛ばす\\ndefaultsコマンドでMacの設定を自動化する\\nMacには、OSや各アプリの設定を保存するUser Defaultsというデータベースがある。\\n例えばドックの大きさやメニューバーに表示するアイコン、Safariの開発者ツールの有効化フラグ、(使用している場合は)サードパーティ製アプリケーションの設定情報なども記録されている。\\nこれらのUser Defaultsの項目は普通、GUI上の設定画面を変更することでデータを読み書きするが、ターミナル上から操作するdefaultsコマンドなるものもMacに標準で入っている。\\nこれを用いることで、Macの初期設定を自動化するシェルスクリプトがよく作られているようだ。\\nたとえば、次のスクリプトは、Finder(ファイラー)において、隠しファイル・隠しフォルダを表示する設定を有効にする。\\n#!/bin/bash\\ndefaults write com.apple.finder AppleShowAllFiles YES\\n\\n\\n(スクリプト実行後に$ killall Finderとしてアプリケーションを再起動する必要がある。)\\nこのようなdefaultsコマンドによる設定例はブログなどで見つけることができる。\\nそれらをまとめて自分用のシェルスクリプトを作っておけば、Macを初期設定する際にすぐに自分好みの環境にすることができるというわけだ。\\nGUIからの設定は項目が増えると手間がかかるし同じ環境を再現するのは大変なので、自動化できるのはありがたい。\\n様々なdefaultsコマンドの一例を記載したサイト\\nMacOS で設定する defaults コマンドをまとめてみた - Corredor\\nOS X を自分色に染める w/ defaults - Qiita(@ry0f)\\nMacの環境設定 - Qiita(@idtkb)\\n.macos - GitHub(mathiasbynens/dotfiles)\\ndefaultsコマンドの引数を調べる\\nところで、このdefaultsコマンドの引数はどのようにして知るのだろうか。\\n先程のサイトに載っているものはよいものの、他の設定項目はdefaultsコマンドにどんな引数を渡せばよいのだろうか。\\n私の調べた限りでは、公式なまとまった情報はないようだった。\\nしかし、愚直に調査する方法はある。\\ndefaultsコマンドには、$ defaults writeの他に$ defaults readというサブコマンドもある。これによりUser Defaultsを閲覧できる。\\nGUI上の操作によってUser Defaultsにどんな変更が加わるか、変更前後の$ defaults readの出力を比較すればわかる。\\n$ defaults read > before.txt\\n# GUI上で設定を変更する\\n$ defaults read > after.txt\\n$ diff before.txt after.txt\\n\\n\\ndiffで該当した部分を中心に、defaultsコマンドで指定する値を抜き出せばよい。\\nが、$ defaults readの出力結果を読むのが面倒なので、これを自動で行うツールを作成した。\\n($ defaults readの出力形式は、property list(old-style ascii)である。\\n(余談) UserDefaultsとplistについてとして別記事にまとめたので、plistについてはこちらを参照してほしい。)\\npdefでシェルスクリプトを作る\\n閑話休題\\npdefとは\\npdef (pi:def) は、User Defaultsの設定前後の差分から、defaultsコマンドの引数を調べてくれる。\\n引数に$ defaults readの出力を記録したファイルのパスを与える。 (第一引数に設定前、第二引数に設定後)\\nすると、設定前後の差分から、シェルスクリプト(defaultsコマンドを並べたもの)を出力する。\\nインストール\\n$ git clone https://github.com/basd4g/pdef.git\\n$ cd pdef\\n$ make\\n$ cp bin/pdef /user/local/bin\\n\\n\\n使用例\\n次のように使う。\\n# 設定を記録する\\n$ defaults read > before.txt\\n# [GUI上で設定を変更する]\\n$ defaults read > after.txt\\n$ pdef before.txt after.txt > patch.sh\\n# 設定を復元する\\n$ bash patch.sh\\n\\n\\n使用例として、メニューバーの音量アイコンを表示/非表示している様子。\\n\\nMac上で設定を変更するときに、前後で$ defaults readでUser Defaultsの内容を書き出しておくと、pdefを使って再設定が楽にできるという算段である。\\nオプション\\n--domainオプションをつけると、特定のアプリのUser Defaultsも比較できる。($ defaults export hogehoge -の出力等)\\n--domainオプションをつけた際は、old-style asciiのplist以外にも、xmlやバイナリも読み込める。\\n実行例\\n$ defaults export com.apple.systemuiserver - > before.xml\\n# メニューバーの変更(音量アイコンの表示/非表示等)\\n$ defaults export com.apple.systemuiserver - > after.xml\\n$ pdef --domain com.apple.systemuiserver before.xml after.xml\\n\\n\\n例外\\npdefは現在は以下のようなものには対応していない。\\ndata型の長い値 ( –domainオプションを付加すれば可能)\\nkeyのrename\\n追加と削除が混在した差分\\nさいごに\\nインターネットの海に流れるdefaultsコマンドの設定例の他に、このツールで調べた設定を追加して、自分専用のMac設定用スクリプトの作成に役立てていただければ幸いだ。\\n私のdefaultsコマンドを集めたシェルスクリプトはこちら。\\n追記: (2020/10/04) plistへの記事リンクを相対リンクに修正","guid":"https://memo.basd4g.net/posts/pdef/","isoDate":"2020-04-30T15:52:47.000Z"},{"title":"macOSでの各種設定を自動化するdefaultsコマンド","link":"https://memo.basd4g.net/posts/macos-defaults/","pubDate":"Mon, 13 Apr 2020 21:57:37 +0900","content":"<p>研究室や就職先などでのコンピュータのセットアップのために、3月頃から<a href=\\"https://github.com/basd4g/dotfiles\\"target=\\"_blank\\">dotfiles</a>を構築している。</p>\\n<p>その流れでdefaultsコマンドを知ったので、その記録と使い方、調べ方を残しておく。。</p>\\n<h2 id=\\"defaultsコマンドとは\\">defaultsコマンドとは</h2>\\n<p>macOSにおける環境設定や各アプリケーションの設定は.plist拡張子の<a href=\\"https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/AboutInformationPropertyListFiles.html\\"target=\\"_blank\\">プロパティリスト</a>と言われるファイルに記録される。\\nこのプロパティリストを読み書きするためにmacOSに標準で搭載されているのがdefaultsコマンドである。\\n(詳細は<code>$ man defaults</code>してください。)</p>\\n<p>これを利用して、OS全体の環境設定やアプリケーションの設定を自動化するスクリプトをつくっている。(<a href=\\"https://github.com/basd4g/dotfiles/blob/master/bin/macos-defaults.sh\\"target=\\"_blank\\">実際に作ったスクリプト - basd4g/dotfiles - GitHub</a>)</p>\\n<p>今回はこのスクリプトを構築するための話。</p>\\n<p>参考: <a href=\\"https://support.apple.com/ja-jp/guide/terminal/apda49a1bb2-577e-4721-8f25-ffc0836f6997/mac\\"target=\\"_blank\\">Macの「ターミナル」でプロパティリストを編集する - ターミナルユーザガイド - Apple</a></p>\\n<h2 id=\\"他人の設定を拝借する\\">他人の設定を拝借する</h2>\\n<p>ネット上に他の人がどのコマンドを叩くとどの設定が変更できるかを調べてすでにまとめてくれたものがある。これを拝借するのが第一の手。</p>\\n<p>公式でどこかに情報がまとまっていればよいのだが、「公式な」設定変更のやり方はGUIから変えることだからか、そんな丁寧なマニュアルはなさそう。</p>\\n<ul>\\n<li><a href=\\"https://amasuda.xyz/post/2016-10-23-mastering-mac-defaults-command/\\"target=\\"_blank\\">MacOS defaults コマンドをマスターする - Think Abstract</a></li>\\n<li><a href=\\"https://neos21.hatenablog.com/entry/2019/01/10/080000\\"target=\\"_blank\\">MacOS で設定する defaults コマンドをまとめてみた - Corredor</a></li>\\n<li><a href=\\"https://qiita.com/djmonta/items/17531dde1e82d9786816\\"target=\\"_blank\\">ターミナルから Mac を設定する（defaults write コマンド等） - Qiita</a></li>\\n<li><a href=\\"https://qiita.com/ryuichi1208/items/5905240f3bfce793b33d\\"target=\\"_blank\\">iMac/MacBook購入後に必ず設定したい設定項目 - Qiita</a></li>\\n<li><a href=\\"https://oki2a24.com/2019/01/21/nitial-setting-done-manually-and-setting-with-defaults-command-on-macbook-pro-2018/\\"target=\\"_blank\\">Macbook Pro 2018 で手動で行った初期設定と、defaults コマンドを使った設定のメモ - Just another oki2a24 ブロゴ</a></li>\\n<li><a href=\\"https://ottan.xyz/system-preferences-terminal-defaults-2-4643/\\"target=\\"_blank\\">システム環境設定をターミナル（defaultsコマンド）から設定する方法（一般） - OTTAN.XYZ</a></li>\\n<li><a href=\\"https://matsuokah.hateblo.jp/entry/2016/01/01/161753\\"target=\\"_blank\\">OSXのコマンドラインからすると捗った設定リスト - will and way</a></li>\\n<li><a href=\\"http://www.neko.ne.jp/~freewing/software/macos_mojave_speed_up_setting_tips/\\"target=\\"_blank\\">macOS Mojaveを高速化する 20の効果的な設定、Macを買ったら最初に設定する俺チューン設定項目 - FREE WINGの Androidと Windows、中国語の便利ソフト</a></li>\\n<li><a href=\\"http://wordpress.ideacompo.com/?p=4826\\"target=\\"_blank\\">Tips of Rubbish DIYとIoTをこよなく愛する、WEB関連やデジモノなどの雑多な情報ブログ</a></li>\\n</ul>\\n<p><em>注釈: defaultsコマンドを実行すると、設定変更が即座に反映されるわけではない。以下のように再起動するなどして設定を読み込ませると良い。</em></p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># Dockの設定変更を反映</span>\\n$ killall Dock\\n<span class=\\"c1\\"># finderの設定変更を反映</span>\\n$ killall Finder\\n<span class=\\"c1\\"># メニューバー(画面上部)の設定変更を反映</span>\\n$ killall SystemUIServer\\n<span class=\\"c1\\"># その他駄目なら再起動。</span>\\n$ sudo reboot\\n</code></pre></div><h2 id=\\"設定するコマンドを探す\\">設定するコマンドを探す</h2>\\n<p>ネットを探していても自分の思うような設定がみつからないことがある。そのときは以下の手順で調べると見つかるかもしれない。</p>\\n<h3 id=\\"defaultsコマンドの使い方\\">defaultsコマンドの使い方</h3>\\n<p>前提として、manual(<code>$ man defaults</code>)の通り、defaultsコマンドは次のように使う。\\n以下は簡略に示す。実際に実行する際はmanualを参照。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># すべて読む</span>\\n$ defaults <span class=\\"nb\\">read</span>\\n<span class=\\"c1\\"># 読む</span>\\n$ defaults <span class=\\"nb\\">read</span> DOMAIN KEY\\n$ defaults <span class=\\"nb\\">read</span> -g KEY\\n<span class=\\"c1\\"># 書き込む</span>\\n$ defaults write DOMAIN KEY VALUE\\n$ defaults write -g KEY VALUE\\n</code></pre></div><p>プロパティリストはkeyとvalueの対が原則で、jsonのようにvalueの中に入れ子でkeyとvalueのまとまりなどが入る。</p>\\n<p>valueにはstringやdata, int, float, bool, array, dictなどの形式がある。</p>\\n<p><code>$defaults write</code>する際にオプションで<code>-string</code>や<code>-array</code>, <code>-array-add</code>とすると希望のデータ型で値を書き込める。</p>\\n<h3 id=\\"探し方\\">探し方</h3>\\n<p>設定変更前後のプロパティリストの差分から、それっぽい設定項目を見つける。\\nその後実際に<code>$ defaults write</code>でプロパティリストを書き換えて、設定が反映されるかを確認する。</p>\\n<p>このとき、設定変更のためのGUIウィンドウは予め開いておいて、beforeとafterの記録をすると良い。\\nプロパティリストには我々が手動で設定した環境設定の他にも多用途に利用されているらしく、時間をあけるとあっという間にdiffが汚くなる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ defaults <span class=\\"nb\\">read</span> &gt; before\\n<span class=\\"c1\\"># GUI上で設定を変更する</span>\\n$ defaults <span class=\\"nb\\">read</span> &gt; after\\n$ diff before after\\n<span class=\\"c1\\"># colordiff(brew install colordiff)などを使うと捗る</span>\\n</code></pre></div><h3 id=\\"実際に探す一例\\">実際に探す一例</h3>\\n<p>一例として、メニューバーに音量アイコンを表示する設定を探す。</p>\\n<h4 id=\\"プロパティリストを読む\\">プロパティリストを読む</h4>\\n<p>GUIで設定する前後のプロパティリストを比較する。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/macos-defaults-read.gif\\"><img src=\\"https://blob.basd4g.net/macos-defaults-read.gif\\"\\nalt=\\"プロパティリストを読み込むスクリーンショット\\"/></a></p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ defaults <span class=\\"nb\\">read</span> &gt; before\\n<span class=\\"c1\\"># GUIで設定変更</span>\\n$ defaults <span class=\\"nb\\">read</span> &gt; after\\n$ diff before after\\n6504a6505\\n&gt; <span class=\\"s2\\">&#34;NSStatusItem Visible com.apple.menuextra.volume&#34;</span> <span class=\\"o\\">=</span> 1<span class=\\"p\\">;</span>\\n6511c6512,6513\\n&lt; <span class=\\"s2\\">&#34;/System/Library/CoreServices/Menu Extras/Bluetooth.menu&#34;</span>\\n---\\n&gt; <span class=\\"s2\\">&#34;/System/Library/CoreServices/Menu Extras/Bluetooth.menu&#34;</span>,\\n&gt; <span class=\\"s2\\">&#34;/System/Library/CoreServices/Menu Extras/Volume.menu&#34;</span>\\n</code></pre></div><p>差分を見ると、6500行目あたりに設定項目がありそう。</p>\\n<p>実際にafterの6500行目以降の数行を見てみる。</p>\\n<pre><code class=\\"language-after\\" data-lang=\\"after\\"> &quot;com.apple.systemuiserver&quot; = {\\n&quot;NSStatusItem Visible com.apple.menuextra.airport&quot; = 1;\\n&quot;NSStatusItem Visible com.apple.menuextra.battery&quot; = 1;\\n&quot;NSStatusItem Visible com.apple.menuextra.bluetooth&quot; = 1;\\n&quot;NSStatusItem Visible com.apple.menuextra.clock&quot; = 1;\\n&quot;NSStatusItem Visible com.apple.menuextra.volume&quot; = 1;\\n&quot;__NSEnableTSMDocumentWindowLevel&quot; = 1;\\n&quot;last-analytics-stamp&quot; = &quot;608273612.570469&quot;;\\nmenuExtras = (\\n&quot;/System/Library/CoreServices/Menu Extras/Clock.menu&quot;,\\n&quot;/System/Library/CoreServices/Menu Extras/Battery.menu&quot;,\\n&quot;/System/Library/CoreServices/Menu Extras/AirPort.menu&quot;,\\n&quot;/System/Library/CoreServices/Menu Extras/Bluetooth.menu&quot;,\\n&quot;/System/Library/CoreServices/Menu Extras/Volume.menu&quot;\\n);\\n};\\n</code></pre><p>以上より、設定は次の内容を書き込めば良さそう。</p>\\n<ul>\\n<li>ドメイン <code>com.apple.systemuiserver</code> 、キー <code>NSStatusItem Visible com.apple.menuextra.volume</code> に、値 <code>1</code> を設定する。</li>\\n<li>ドメイン <code>com.apple.systemuiserver</code> 、キー <code>menuExtra</code> の値の配列に、\\n<code>/System/Library/CoreServices/Menu Extras/Volume.menu</code> を追加。</li>\\n</ul>\\n<p>シェルスクリプトにまとめると次の通り。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-bash\\" data-lang=\\"bash\\"><span class=\\"cp\\">#!/bin/bash -e\\n</span><span class=\\"cp\\"></span>\\n<span class=\\"c1\\"># 音量アイコンをMenuBarに表示</span>\\ndefaults write com.apple.systemuiserver <span class=\\"se\\">\\\\\\n</span><span class=\\"se\\"></span> <span class=\\"s2\\">&#34;NSStatusItem Visible com.apple.menuextra.volume&#34;</span> <span class=\\"m\\">1</span>\\ndefaults write com.apple.systemuiserver <span class=\\"se\\">\\\\\\n</span><span class=\\"se\\"></span> menuExtras -array-add <span class=\\"s2\\">&#34;/System/Library/CoreServices/Menu Extras/Volume.menu&#34;</span>\\n<span class=\\"c1\\"># メニューバーを再起動</span>\\nkillall SystemUIServer\\n</code></pre></div><h4 id=\\"プロパティリストに書き込んで試す\\">プロパティリストに書き込んで試す</h4>\\n<p>実際に試してみると、反映されていることがわかる。</p>\\n<p><a target=\\"_blank\\" rel=\\"noopener noreferrer\\"\\nhref=\\"https://blob.basd4g.net/macos-defaults-write.gif\\"><img src=\\"https://blob.basd4g.net/macos-defaults-write.gif\\"\\nalt=\\"プロパティリストに書き込むスクリーンショット\\"/></a></p>\\n<h2 id=\\"なぜdefaultsコマンドを使うのか\\">なぜdefaultsコマンドを使うのか</h2>\\n<h3 id=\\"メリット\\">メリット</h3>\\n<ul>\\n<li>設定を自動化できる</li>\\n</ul>\\n<p>PCで新しく環境構築する際に、シェルスクリプトにまとまっているので一括で設定できる</p>\\n<ul>\\n<li>自分が行っていた設定を記録できる。</li>\\n</ul>\\n<p>自分がGUI上でどんな設定を行っているか、いたかをコードで示すことができる。\\nアプリケーションがプロパティリストとしてデータを持っているならば、サードパーティアプリケーションでも同様に設定を記録できる。</p>\\n<p>たとえば、私は<a href=\\"https://github.com/fikovnik/ShiftIt\\"target=\\"_blank\\">ShiftIt</a>というアプリケーションを使っている。\\nこのアプリケーションで使うキーバインドはGUI上から設定するのだが、自分がどんな設定をしているのかをコードとして記録できるのは、再設定だけでなく今後のなんらかのキーバインド設定の参考にもなる。</p>\\n<p>参考: <a href=\\"https://github.com/basd4g/dotfiles/blob/master/bin/shiftit-init.sh\\"target=\\"_blank\\">私の現在のShiftItのキーバインド設定</a></p>\\n<h3 id=\\"デメリット\\">デメリット</h3>\\n<ul>\\n<li>設定変更のたびに逐一調べてシェルスクリプトを更新しなければならない</li>\\n</ul>\\n<p>これはたしかに面倒だけどね。\\nプロパティリストをむやみに書き換えると、パソコンが上手く動かなくなる可能性もある。。</p>\\n<ul>\\n<li>OSのアップデートによって設定が適用できなくなるかもしれない</li>\\n</ul>\\n<p>GUIもアップデートで項目がなくなったりどこにいったかわからなくなったりするよね</p>\\n<h2 id=\\"まとめ\\">まとめ</h2>\\n<p>以下を使って頑張ってシェルスクリプトを書こう。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ defaults <span class=\\"nb\\">read</span> &gt; before\\n<span class=\\"c1\\"># GUIで設定変更</span>\\n$ defaults <span class=\\"nb\\">read</span> &gt; after\\n$ diff before after\\n$ man defaults\\n</code></pre></div><h2 id=\\"将来の自分へ\\">将来の自分へ</h2>\\n<p>diffを読み取ってdefaultsコマンドのシェルスクリプト形式にするのは自動化できるのでは？\\nと思ったが、<a href=\\"https://rcmdnk.com/blog/2015/03/22/computer-mac/\\"target=\\"_blank\\">先駆者がいたようだ</a></p>","contentSnippet":"研究室や就職先などでのコンピュータのセットアップのために、3月頃からdotfilesを構築している。\\nその流れでdefaultsコマンドを知ったので、その記録と使い方、調べ方を残しておく。。\\ndefaultsコマンドとは\\nmacOSにおける環境設定や各アプリケーションの設定は.plist拡張子のプロパティリストと言われるファイルに記録される。\\nこのプロパティリストを読み書きするためにmacOSに標準で搭載されているのがdefaultsコマンドである。\\n(詳細は$ man defaultsしてください。)\\nこれを利用して、OS全体の環境設定やアプリケーションの設定を自動化するスクリプトをつくっている。(実際に作ったスクリプト - basd4g/dotfiles - GitHub)\\n今回はこのスクリプトを構築するための話。\\n参考: Macの「ターミナル」でプロパティリストを編集する - ターミナルユーザガイド - Apple\\n他人の設定を拝借する\\nネット上に他の人がどのコマンドを叩くとどの設定が変更できるかを調べてすでにまとめてくれたものがある。これを拝借するのが第一の手。\\n公式でどこかに情報がまとまっていればよいのだが、「公式な」設定変更のやり方はGUIから変えることだからか、そんな丁寧なマニュアルはなさそう。\\nMacOS defaults コマンドをマスターする - Think Abstract\\nMacOS で設定する defaults コマンドをまとめてみた - Corredor\\nターミナルから Mac を設定する（defaults write コマンド等） - Qiita\\niMac/MacBook購入後に必ず設定したい設定項目 - Qiita\\nMacbook Pro 2018 で手動で行った初期設定と、defaults コマンドを使った設定のメモ - Just another oki2a24 ブロゴ\\nシステム環境設定をターミナル（defaultsコマンド）から設定する方法（一般） - OTTAN.XYZ\\nOSXのコマンドラインからすると捗った設定リスト - will and way\\nmacOS Mojaveを高速化する 20の効果的な設定、Macを買ったら最初に設定する俺チューン設定項目 - FREE WINGの Androidと Windows、中国語の便利ソフト\\nTips of Rubbish DIYとIoTをこよなく愛する、WEB関連やデジモノなどの雑多な情報ブログ\\n注釈: defaultsコマンドを実行すると、設定変更が即座に反映されるわけではない。以下のように再起動するなどして設定を読み込ませると良い。\\n# Dockの設定変更を反映\\n$ killall Dock\\n# finderの設定変更を反映\\n$ killall Finder\\n# メニューバー(画面上部)の設定変更を反映\\n$ killall SystemUIServer\\n# その他駄目なら再起動。\\n$ sudo reboot\\n\\n\\n設定するコマンドを探す\\nネットを探していても自分の思うような設定がみつからないことがある。そのときは以下の手順で調べると見つかるかもしれない。\\ndefaultsコマンドの使い方\\n前提として、manual($ man defaults)の通り、defaultsコマンドは次のように使う。\\n以下は簡略に示す。実際に実行する際はmanualを参照。\\n# すべて読む\\n$ defaults read\\n# 読む\\n$ defaults read DOMAIN KEY\\n$ defaults read -g KEY\\n# 書き込む\\n$ defaults write DOMAIN KEY VALUE\\n$ defaults write -g KEY VALUE\\n\\n\\nプロパティリストはkeyとvalueの対が原則で、jsonのようにvalueの中に入れ子でkeyとvalueのまとまりなどが入る。\\nvalueにはstringやdata, int, float, bool, array, dictなどの形式がある。\\n$defaults writeする際にオプションで-stringや-array, -array-addとすると希望のデータ型で値を書き込める。\\n探し方\\n設定変更前後のプロパティリストの差分から、それっぽい設定項目を見つける。\\nその後実際に$ defaults writeでプロパティリストを書き換えて、設定が反映されるかを確認する。\\nこのとき、設定変更のためのGUIウィンドウは予め開いておいて、beforeとafterの記録をすると良い。\\nプロパティリストには我々が手動で設定した環境設定の他にも多用途に利用されているらしく、時間をあけるとあっという間にdiffが汚くなる。\\n$ defaults read > before\\n# GUI上で設定を変更する\\n$ defaults read > after\\n$ diff before after\\n# colordiff(brew install colordiff)などを使うと捗る\\n\\n\\n実際に探す一例\\n一例として、メニューバーに音量アイコンを表示する設定を探す。\\nプロパティリストを読む\\nGUIで設定する前後のプロパティリストを比較する。\\n\\n$ defaults read > before\\n# GUIで設定変更\\n$ defaults read > after\\n$ diff before after\\n6504a6505\\n> \\"NSStatusItem Visible com.apple.menuextra.volume\\" = 1;\\n6511c6512,6513\\n< \\"/System/Library/CoreServices/Menu Extras/Bluetooth.menu\\"\\n---\\n> \\"/System/Library/CoreServices/Menu Extras/Bluetooth.menu\\",\\n> \\"/System/Library/CoreServices/Menu Extras/Volume.menu\\"\\n\\n\\n差分を見ると、6500行目あたりに設定項目がありそう。\\n実際にafterの6500行目以降の数行を見てみる。\\n \\"com.apple.systemuiserver\\" = {\\n\\"NSStatusItem Visible com.apple.menuextra.airport\\" = 1;\\n\\"NSStatusItem Visible com.apple.menuextra.battery\\" = 1;\\n\\"NSStatusItem Visible com.apple.menuextra.bluetooth\\" = 1;\\n\\"NSStatusItem Visible com.apple.menuextra.clock\\" = 1;\\n\\"NSStatusItem Visible com.apple.menuextra.volume\\" = 1;\\n\\"__NSEnableTSMDocumentWindowLevel\\" = 1;\\n\\"last-analytics-stamp\\" = \\"608273612.570469\\";\\nmenuExtras = (\\n\\"/System/Library/CoreServices/Menu Extras/Clock.menu\\",\\n\\"/System/Library/CoreServices/Menu Extras/Battery.menu\\",\\n\\"/System/Library/CoreServices/Menu Extras/AirPort.menu\\",\\n\\"/System/Library/CoreServices/Menu Extras/Bluetooth.menu\\",\\n\\"/System/Library/CoreServices/Menu Extras/Volume.menu\\"\\n);\\n};\\n\\n以上より、設定は次の内容を書き込めば良さそう。\\nドメイン com.apple.systemuiserver 、キー NSStatusItem Visible com.apple.menuextra.volume に、値 1 を設定する。\\nドメイン com.apple.systemuiserver 、キー menuExtra の値の配列に、\\n/System/Library/CoreServices/Menu Extras/Volume.menu を追加。\\nシェルスクリプトにまとめると次の通り。\\n#!/bin/bash -e\\n\\n# 音量アイコンをMenuBarに表示\\ndefaults write com.apple.systemuiserver \\\\\\n \\"NSStatusItem Visible com.apple.menuextra.volume\\" 1\\ndefaults write com.apple.systemuiserver \\\\\\n menuExtras -array-add \\"/System/Library/CoreServices/Menu Extras/Volume.menu\\"\\n# メニューバーを再起動\\nkillall SystemUIServer\\n\\n\\nプロパティリストに書き込んで試す\\n実際に試してみると、反映されていることがわかる。\\n\\nなぜdefaultsコマンドを使うのか\\nメリット\\n設定を自動化できる\\nPCで新しく環境構築する際に、シェルスクリプトにまとまっているので一括で設定できる\\n自分が行っていた設定を記録できる。\\n自分がGUI上でどんな設定を行っているか、いたかをコードで示すことができる。\\nアプリケーションがプロパティリストとしてデータを持っているならば、サードパーティアプリケーションでも同様に設定を記録できる。\\nたとえば、私はShiftItというアプリケーションを使っている。\\nこのアプリケーションで使うキーバインドはGUI上から設定するのだが、自分がどんな設定をしているのかをコードとして記録できるのは、再設定だけでなく今後のなんらかのキーバインド設定の参考にもなる。\\n参考: 私の現在のShiftItのキーバインド設定\\nデメリット\\n設定変更のたびに逐一調べてシェルスクリプトを更新しなければならない\\nこれはたしかに面倒だけどね。\\nプロパティリストをむやみに書き換えると、パソコンが上手く動かなくなる可能性もある。。\\nOSのアップデートによって設定が適用できなくなるかもしれない\\nGUIもアップデートで項目がなくなったりどこにいったかわからなくなったりするよね\\nまとめ\\n以下を使って頑張ってシェルスクリプトを書こう。\\n$ defaults read > before\\n# GUIで設定変更\\n$ defaults read > after\\n$ diff before after\\n$ man defaults\\n\\n\\n将来の自分へ\\ndiffを読み取ってdefaultsコマンドのシェルスクリプト形式にするのは自動化できるのでは？\\nと思ったが、先駆者がいたようだ","guid":"https://memo.basd4g.net/posts/macos-defaults/","isoDate":"2020-04-13T12:57:37.000Z"},{"title":"vim-lspを使った、Vim上でのTypeScript(JavaScript)の補完の実現","link":"https://memo.basd4g.net/posts/vim-lsp-init/","pubDate":"Wed, 01 Apr 2020 17:37:46 +0900","content":"<h2 id=\\"lspとは\\">LSPとは</h2>\\n<p><a href=\\"https://github.com/Microsoft/language-server-protocol\\"target=\\"_blank\\">LSP(Language Server Protocol)</a>とは、IDEと言語サーバとの通信用プロトコル。</p>\\n<p>IDEやテキストエディタが補完やコードジャンプなどの様々な機能を実現するために、以前はIDEやエディタのプラグイン内に内包されていた機能を、言語ごとにLanguage Serverとして切り出す。</p>\\n<p>これにより言語補完部分の製作はLanguage Serverさえ作ってしまえばたくさんのIDE(エディタ)に対応できるし、IDE(エディタ)開発側も、LSPにさえ対応してしまえば各言語への対応を独自実装しなくて済む。</p>\\n<p>2016年6月にMicrosoftが発表したらしい。</p>\\n<p>参考: <a href=\\"https://qiita.com/atsushieno/items/ce31df9bd88e98eec5c4\\"target=\\"_blank\\">language server protocolについて (前編) - Qiita</a></p>\\n<h2 id=\\"やること\\">やること</h2>\\n<p>今回はTypeScript,JavaScript用のLanguage Serverをインストールし、これをvim-lspにつないでvim上でLanguage Serverの支援が得られるようにする。</p>\\n<p>( <a href=\\"https://github.com/prabirshrestha/vim-lsp\\"target=\\"_blank\\">vim-lsp</a>はvimでLanguage Serverを利用できるようにするプラグイン )</p>\\n<h2 id=\\"環境\\">環境</h2>\\n<ul>\\n<li>macOS Mojave(10.14.6)</li>\\n<li>VIM 8.2 Compiled by Homebrew</li>\\n<li>dein.vimでプラグイン管理</li>\\n</ul>\\n<p>Vim8上で、dein.vimにプラグインを読み込ませる。</p>\\n<h2 id=\\"手順\\">手順</h2>\\n<ol>\\n<li>typescript-language-serverをインストールする</li>\\n</ol>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ npm install -g typescript typescript-language-server\\n<span class=\\"c1\\"># または</span>\\n$ yarn global add typescript typescript-language-server\\n</code></pre></div><p>typescript-language-serverはJavaScriptのLanguage Serverとしても動く</p>\\n<ol start=\\"2\\">\\n<li>各種vimプラグインを入れる</li>\\n</ol>\\n<p>dein.tomlに以下の記述を追記</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-dein.toml\\" data-lang=\\"dein.toml\\"><span class=\\"c\\">#========== vim-lsp とその関連プラグイン ==========</span>\\n<span class=\\"c\\">#vim-lspとLanguage Serverの連携に必要なプラグイン群</span>\\n<span class=\\"p\\">[[</span><span class=\\"nx\\">plugins</span><span class=\\"p\\">]]</span>\\n<span class=\\"nx\\">repo</span> <span class=\\"p\\">=</span> <span class=\\"s1\\">&#39;prabirshrestha/async.vim&#39;</span>\\n<span class=\\"p\\">[[</span><span class=\\"nx\\">plugins</span><span class=\\"p\\">]]</span>\\n<span class=\\"nx\\">repo</span> <span class=\\"p\\">=</span> <span class=\\"s1\\">&#39;prabirshrestha/asyncomplete.vim&#39;</span>\\n<span class=\\"p\\">[[</span><span class=\\"nx\\">plugins</span><span class=\\"p\\">]]</span>\\n<span class=\\"nx\\">repo</span> <span class=\\"p\\">=</span> <span class=\\"s1\\">&#39;prabirshrestha/asyncomplete-lsp.vim&#39;</span>\\n<span class=\\"c\\"># 事前にnpm install -g typescript typescript-language-server </span>\\n<span class=\\"p\\">[[</span><span class=\\"nx\\">plugins</span><span class=\\"p\\">]]</span>\\n<span class=\\"nx\\">repo</span> <span class=\\"p\\">=</span> <span class=\\"s1\\">&#39;prabirshrestha/vim-lsp&#39;</span>\\n<span class=\\"nx\\">hook_add</span> <span class=\\"p\\">=</span> <span class=\\"s1\\">&#39;&#39;&#39;\\n</span><span class=\\"s1\\">&#34; TypeScript, JavaScript\\n</span><span class=\\"s1\\">if executable(&#39;</span><span class=\\"nx\\">typescript</span><span class=\\"err\\">-</span><span class=\\"nx\\">language</span><span class=\\"err\\">-</span><span class=\\"nx\\">server</span><span class=\\"s1\\">&#39;)\\n</span><span class=\\"s1\\"> au User lsp_setup call lsp#register_server({\\n</span><span class=\\"s1\\"> \\\\ &#39;</span><span class=\\"nx\\">name</span><span class=\\"s1\\">&#39;: &#39;</span><span class=\\"nx\\">typescript</span><span class=\\"err\\">-</span><span class=\\"nx\\">language</span><span class=\\"err\\">-</span><span class=\\"nx\\">server</span><span class=\\"s1\\">&#39;,\\n</span><span class=\\"s1\\"> \\\\ &#39;</span><span class=\\"nx\\">cmd</span><span class=\\"s1\\">&#39;: {server_info-&gt;[&amp;shell, &amp;shellcmdflag, &#39;</span><span class=\\"nx\\">typescript</span><span class=\\"err\\">-</span><span class=\\"nx\\">language</span><span class=\\"err\\">-</span><span class=\\"nx\\">server</span> <span class=\\"err\\">--</span><span class=\\"nx\\">stdio</span><span class=\\"s1\\">&#39;]},\\n</span><span class=\\"s1\\"> \\\\ &#39;</span><span class=\\"nx\\">root_uri</span><span class=\\"s1\\">&#39;:{server_info-&gt;lsp#utils#path_to_uri(lsp#utils#find_nearest_parent_file_directory(lsp#utils#get_buffer_path(), &#39;</span><span class=\\"nx\\">package</span><span class=\\"p\\">.</span><span class=\\"nx\\">json</span><span class=\\"s1\\">&#39;))},\\n</span><span class=\\"s1\\">&#34; \\\\ &#39;</span><span class=\\"nx\\">root_uri</span><span class=\\"s1\\">&#39;:{server_info-&gt;lsp#utils#path_to_uri(lsp#utils#find_nearest_parent_file_directory(lsp#utils#get_buffer_path(), &#39;</span><span class=\\"nx\\">tsconfig</span><span class=\\"p\\">.</span><span class=\\"nx\\">json</span><span class=\\"s1\\">&#39;))},\\n</span><span class=\\"s1\\"> \\\\ &#39;</span><span class=\\"nx\\">whitelist</span><span class=\\"s1\\">&#39;: [&#39;</span><span class=\\"nx\\">typescript</span><span class=\\"s1\\">&#39;, &#39;</span><span class=\\"nx\\">typescript</span><span class=\\"p\\">.</span><span class=\\"nx\\">tsx</span><span class=\\"s1\\">&#39;, &#39;</span><span class=\\"nx\\">javascript</span><span class=\\"s1\\">&#39;, &#39;</span><span class=\\"nx\\">javascript</span><span class=\\"p\\">.</span><span class=\\"nx\\">jsx</span><span class=\\"s1\\">&#39;],\\n</span><span class=\\"s1\\"> \\\\ })\\n</span><span class=\\"s1\\">endif\\n</span><span class=\\"s1\\">\\n</span><span class=\\"s1\\">&#34; 他言語サーバの読み込みはここに挿入\\n</span><span class=\\"s1\\">&#39;&#39;&#39;</span>\\n<span class=\\"c\\">#vim-lspのキーバインドを設定</span>\\n<span class=\\"nx\\">後で書く</span>\\n</code></pre></div><ol start=\\"3\\">\\n<li>vimを起動</li>\\n</ol>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ vim\\n</code></pre></div>","contentSnippet":"LSPとは\\nLSP(Language Server Protocol)とは、IDEと言語サーバとの通信用プロトコル。\\nIDEやテキストエディタが補完やコードジャンプなどの様々な機能を実現するために、以前はIDEやエディタのプラグイン内に内包されていた機能を、言語ごとにLanguage Serverとして切り出す。\\nこれにより言語補完部分の製作はLanguage Serverさえ作ってしまえばたくさんのIDE(エディタ)に対応できるし、IDE(エディタ)開発側も、LSPにさえ対応してしまえば各言語への対応を独自実装しなくて済む。\\n2016年6月にMicrosoftが発表したらしい。\\n参考: language server protocolについて (前編) - Qiita\\nやること\\n今回はTypeScript,JavaScript用のLanguage Serverをインストールし、これをvim-lspにつないでvim上でLanguage Serverの支援が得られるようにする。\\n( vim-lspはvimでLanguage Serverを利用できるようにするプラグイン )\\n環境\\nmacOS Mojave(10.14.6)\\nVIM 8.2 Compiled by Homebrew\\ndein.vimでプラグイン管理\\nVim8上で、dein.vimにプラグインを読み込ませる。\\n手順\\ntypescript-language-serverをインストールする\\n$ npm install -g typescript typescript-language-server\\n# または\\n$ yarn global add typescript typescript-language-server\\n\\n\\ntypescript-language-serverはJavaScriptのLanguage Serverとしても動く\\n各種vimプラグインを入れる\\ndein.tomlに以下の記述を追記\\n#========== vim-lsp とその関連プラグイン ==========\\n#vim-lspとLanguage Serverの連携に必要なプラグイン群\\n[[plugins]]\\nrepo = \'prabirshrestha/async.vim\'\\n[[plugins]]\\nrepo = \'prabirshrestha/asyncomplete.vim\'\\n[[plugins]]\\nrepo = \'prabirshrestha/asyncomplete-lsp.vim\'\\n# 事前にnpm install -g typescript typescript-language-server \\n[[plugins]]\\nrepo = \'prabirshrestha/vim-lsp\'\\nhook_add = \'\'\'\\n\\" TypeScript, JavaScript\\nif executable(\'typescript-language-server\')\\n au User lsp_setup call lsp#register_server({\\n \\\\ \'name\': \'typescript-language-server\',\\n \\\\ \'cmd\': {server_info->[&shell, &shellcmdflag, \'typescript-language-server --stdio\']},\\n \\\\ \'root_uri\':{server_info->lsp#utils#path_to_uri(lsp#utils#find_nearest_parent_file_directory(lsp#utils#get_buffer_path(), \'package.json\'))},\\n\\" \\\\ \'root_uri\':{server_info->lsp#utils#path_to_uri(lsp#utils#find_nearest_parent_file_directory(lsp#utils#get_buffer_path(), \'tsconfig.json\'))},\\n \\\\ \'whitelist\': [\'typescript\', \'typescript.tsx\', \'javascript\', \'javascript.jsx\'],\\n \\\\ })\\nendif\\n\\n\\" 他言語サーバの読み込みはここに挿入\\n\'\'\'\\n#vim-lspのキーバインドを設定\\n後で書く\\n\\n\\nvimを起動\\n$ vim","guid":"https://memo.basd4g.net/posts/vim-lsp-init/","isoDate":"2020-04-01T08:37:46.000Z"},{"title":"今日欲しい物(2020/3/30)","link":"https://memo.basd4g.net/posts/20200330/","pubDate":"Mon, 30 Mar 2020 10:06:22 +0900","content":"<h2 id=\\"欲しい物\\">欲しい物</h2>\\n<p>ほしいと思ったものの記録。</p>\\n<ul>\\n<li>docomo系MVNOのSIM</li>\\n<li>60%の自作キーボード</li>\\n<li>ヘッドホン</li>\\n</ul>\\n<h2 id=\\"docomo系のmvnoのsim\\">docomo系のMVNOのSIM</h2>\\n<p>昨年macを買ったのに合わせて初めてiphoneを購入し、それ以降iphone7を使い続けているが、そろそろandroidに戻りたい気持ちが強くなってきた。</p>\\n<p><a href=\\"https://www.amazon.co.jp/dp/B072PS4Q3H/ref=sspa_dk_detail_0?psc=1&amp;pd_rd_i=B072PS4Q3H&amp;pd_rd_w=MtTuU&amp;pf_rd_p=6413bd85-d494-49e7-9f81-0e63e79171a9&amp;pd_rd_wg=eJADD&amp;pf_rd_r=9K6KRSP0W1DSTS5MQEPK&amp;pd_rd_r=f0f592c6-efca-451e-ad83-7a5fe8f4bfe2&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUExU1g2MENHQ0VZWEtGJmVuY3J5cHRlZElkPUEwNTQ2MDM2MklSSzVWVDlJQUFVQiZlbmNyeXB0ZWRBZElkPUE2V1UwTDFMNjBLM04md2lkZ2V0TmFtZT1zcF9kZXRhaWwmYWN0aW9uPWNsaWNrUmVkaXJlY3QmZG9Ob3RMb2dDbGljaz10cnVl\\"target=\\"_blank\\">ビッグローブの3GB音声通話有りのプラン</a>は、半年間400円で使えて2500円キャッシュバックが有るらしい。</p>\\n<p>iphone7に挿しているsimは最近UQmobileに乗り換えたばかりだし、UQmobileの回線速度は素晴らしいので、乗り換えるのは早計かなと思っている。</p>\\n<p>しかしUQmobileのsimが使える端末が手元にないので、とりあえずdocomo系のsimを契約して2台持ちにしようかと検討している。\\n今、お金をほとんど使わずに不満を解消できるのが2台持ち。</p>\\n<p>しばらくしたらUQmobileでも使えるandroidを買うか、androidへ乗り換える夢を諦めるか、メインの回線をdocomo系のMVNOに乗り換えるかしよう。</p>\\n<p>以下はiphoneを一年弱使った感想。</p>\\n<p>生粋のandroid人間だったので、操作感など最初は中々慣れなかった。</p>\\n<h3 id=\\"iphoneの不満\\">iphoneの不満</h3>\\n<ul>\\n<li>オートメーションで位置情報による自動実行、WIFI接続時の自動実行が出来ない。</li>\\n</ul>\\n<p>家の鍵(Sesami mini)を、帰宅/外出を自動検知しAPIを叩いて自動開閉をしたい。\\nandroidならIFTTTで実現できそう。</p>\\n<ul>\\n<li>OK googleしたい</li>\\n</ul>\\n<p>スマホの音声操作は車を運転するときに真価を発揮する。</p>\\n<p>Googleマップの検索と案内開始、音楽再生をどちらも音声操作だけで完結できるのでGoogleアシスタントを使いたい。</p>\\n<p>夏、特にダイビングに行くときに車を運転するので、今後もっとandroidが欲しくなるはず。</p>\\n<p>(注:Siriは○ソ。使えない。自明。)</p>\\n<ul>\\n<li>公式ストア外のアプリをインストールできない。</li>\\n</ul>\\n<p>セキュリティ的には良いところなのだが。(一般向けのスマートフォンOSの戦略としては正解だと思う)</p>\\n<p>私には自由が必要なのだ、androidのような自由が。</p>\\n<h3 id=\\"iphoneのいいところ\\">iphoneのいいところ</h3>\\n<ul>\\n<li>テザリング時にスマホを操作しなくて良い</li>\\n</ul>\\n<p>iphoneからmacへテザリングする際に、ポケットに入ったiphoneに指一本触れずにMac上からテザリングを有効化できる。Apple帝国に納税した分の福利厚生といったところか。</p>\\n<ul>\\n<li>セキュリティが安心</li>\\n</ul>\\n<p>政府要人でもないし抜かれる個人情報も大したこと無いけれど、国を敵に回してもiphoneには容易にはデータにアクセス出来なそう。\\n(ただし、端末内のデータにアクセスできないからと言って安全とは限らない。PCやWebサービスのデータベースの情報を抜かれるかもしれない)</p>\\n<h2 id=\\"60の自作キーボード\\">60%の自作キーボード</h2>\\n<p>ちょっと前はHHKBを狙っていたけれど、高いし、「あれ、俺がほしいのはHHKBではなくUS配列60%キーボードだ」と気づいた。</p>\\n<p>ここ1ヶ月ほどKarabinerでSandS(スペースバーを他キーと同時に押すとShiftキーとして扱う)を設定している。\\nこれに味をシメて、数字キーのShift動作を反転させて、普段は記号、Shiftキー(SandSなので実際はスペースバー)が押されているときは数字が入力されるようにしようとしていた。</p>\\n<p>こんなふうに配列をいじっていると、はたしてこのまま日本語配列でよいのかと思ってくる。\\nUSキーボードの配列に慣れておいたほうがキーボードの選択肢が広がる(自作キーボードをするとき)し、かっこいい(厨2)(要出典)し、エンターキー押しやすそうだし、記号も自然な配列と聞くので、さっさとUSにしないと。</p>\\n<p>KBDfansを見ていると頑張って安いものを選べば1.3万円くらいでできそう。</p>\\n<p>自分への誕生日プレゼントとしてひとつ組んでみようかな。</p>\\n<h2 id=\\"ヘッドホン\\">ヘッドホン</h2>\\n<p>5000円未満で音質が結構良いらしいヘッドホン、<a href=\\"https://www.amazon.co.jp/%E3%83%9E%E3%83%A9%E3%83%B3%E3%83%84%E3%83%97%E3%83%AD-Marantz-Professional-MPH-1-%E5%AF%86%E9%96%89%E5%9E%8B%E3%83%A2%E3%83%8B%E3%82%BF%E3%83%BC%E3%83%98%E3%83%83%E3%83%89%E3%83%9B%E3%83%B3/dp/B01E74L2L0?psc=1&amp;SubscriptionId=AKIAICDGYC76ENTD3PNA&amp;tag=menbou0202-22&amp;linkCode=xm2&amp;camp=2025&amp;creative=165953&amp;creativeASIN=B01E74L2L0\\"target=\\"_blank\\">マランツプロ MPH-1</a>。</p>\\n<p>今はSonyのXDR-XB950というヘッドホンを3年以上使っている。\\nbluetoothのヘッドホンは本当に素晴らしくて、無線は本当に快適。\\nバッテリーも公称40時間持つとかで、最近のワイヤレスイヤホンとは比較にならないほど持つ。</p>\\n<p>ただ、音質はそこまで良くないと思う。bluetoothということで、ホワイトノイズも目立つ。</p>\\n<p>次買うならSonyかboseの4万円くらいするワイヤレスヘッドホンなのだけれど、高いのでおいそれと手が出ない。</p>\\n<p>そんなときに下を見つけた。\\nギズモード・ジャパンの網藤さんのブログで見つけた、5000円のヘッドホン。</p>\\n<p><a href=\\"https://men-bou.net/mph-1-under-5000/\\"target=\\"_blank\\">アンダー5,000円のモニタリングヘッドホン「MPH-1」は脊髄で買っていいくらい高コスパ - MENBOU</a></p>\\n<p>この価格帯で推せるヘッドホンが有るのはアツイ。</p>\\n<p>2020年に有線ヘッドホンを買うかは迷いどころだけれど、机に座っているとき専用だったら有線でもまぁいいかな。</p>\\n<p>現状に困っているわけではないので、なんだかんだ買わない気もするけれど。</p>","contentSnippet":"欲しい物\\nほしいと思ったものの記録。\\ndocomo系MVNOのSIM\\n60%の自作キーボード\\nヘッドホン\\ndocomo系のMVNOのSIM\\n昨年macを買ったのに合わせて初めてiphoneを購入し、それ以降iphone7を使い続けているが、そろそろandroidに戻りたい気持ちが強くなってきた。\\nビッグローブの3GB音声通話有りのプランは、半年間400円で使えて2500円キャッシュバックが有るらしい。\\niphone7に挿しているsimは最近UQmobileに乗り換えたばかりだし、UQmobileの回線速度は素晴らしいので、乗り換えるのは早計かなと思っている。\\nしかしUQmobileのsimが使える端末が手元にないので、とりあえずdocomo系のsimを契約して2台持ちにしようかと検討している。\\n今、お金をほとんど使わずに不満を解消できるのが2台持ち。\\nしばらくしたらUQmobileでも使えるandroidを買うか、androidへ乗り換える夢を諦めるか、メインの回線をdocomo系のMVNOに乗り換えるかしよう。\\n以下はiphoneを一年弱使った感想。\\n生粋のandroid人間だったので、操作感など最初は中々慣れなかった。\\niphoneの不満\\nオートメーションで位置情報による自動実行、WIFI接続時の自動実行が出来ない。\\n家の鍵(Sesami mini)を、帰宅/外出を自動検知しAPIを叩いて自動開閉をしたい。\\nandroidならIFTTTで実現できそう。\\nOK googleしたい\\nスマホの音声操作は車を運転するときに真価を発揮する。\\nGoogleマップの検索と案内開始、音楽再生をどちらも音声操作だけで完結できるのでGoogleアシスタントを使いたい。\\n夏、特にダイビングに行くときに車を運転するので、今後もっとandroidが欲しくなるはず。\\n(注:Siriは○ソ。使えない。自明。)\\n公式ストア外のアプリをインストールできない。\\nセキュリティ的には良いところなのだが。(一般向けのスマートフォンOSの戦略としては正解だと思う)\\n私には自由が必要なのだ、androidのような自由が。\\niphoneのいいところ\\nテザリング時にスマホを操作しなくて良い\\niphoneからmacへテザリングする際に、ポケットに入ったiphoneに指一本触れずにMac上からテザリングを有効化できる。Apple帝国に納税した分の福利厚生といったところか。\\nセキュリティが安心\\n政府要人でもないし抜かれる個人情報も大したこと無いけれど、国を敵に回してもiphoneには容易にはデータにアクセス出来なそう。\\n(ただし、端末内のデータにアクセスできないからと言って安全とは限らない。PCやWebサービスのデータベースの情報を抜かれるかもしれない)\\n60%の自作キーボード\\nちょっと前はHHKBを狙っていたけれど、高いし、「あれ、俺がほしいのはHHKBではなくUS配列60%キーボードだ」と気づいた。\\nここ1ヶ月ほどKarabinerでSandS(スペースバーを他キーと同時に押すとShiftキーとして扱う)を設定している。\\nこれに味をシメて、数字キーのShift動作を反転させて、普段は記号、Shiftキー(SandSなので実際はスペースバー)が押されているときは数字が入力されるようにしようとしていた。\\nこんなふうに配列をいじっていると、はたしてこのまま日本語配列でよいのかと思ってくる。\\nUSキーボードの配列に慣れておいたほうがキーボードの選択肢が広がる(自作キーボードをするとき)し、かっこいい(厨2)(要出典)し、エンターキー押しやすそうだし、記号も自然な配列と聞くので、さっさとUSにしないと。\\nKBDfansを見ていると頑張って安いものを選べば1.3万円くらいでできそう。\\n自分への誕生日プレゼントとしてひとつ組んでみようかな。\\nヘッドホン\\n5000円未満で音質が結構良いらしいヘッドホン、マランツプロ MPH-1。\\n今はSonyのXDR-XB950というヘッドホンを3年以上使っている。\\nbluetoothのヘッドホンは本当に素晴らしくて、無線は本当に快適。\\nバッテリーも公称40時間持つとかで、最近のワイヤレスイヤホンとは比較にならないほど持つ。\\nただ、音質はそこまで良くないと思う。bluetoothということで、ホワイトノイズも目立つ。\\n次買うならSonyかboseの4万円くらいするワイヤレスヘッドホンなのだけれど、高いのでおいそれと手が出ない。\\nそんなときに下を見つけた。\\nギズモード・ジャパンの網藤さんのブログで見つけた、5000円のヘッドホン。\\nアンダー5,000円のモニタリングヘッドホン「MPH-1」は脊髄で買っていいくらい高コスパ - MENBOU\\nこの価格帯で推せるヘッドホンが有るのはアツイ。\\n2020年に有線ヘッドホンを買うかは迷いどころだけれど、机に座っているとき専用だったら有線でもまぁいいかな。\\n現状に困っているわけではないので、なんだかんだ買わない気もするけれど。","guid":"https://memo.basd4g.net/posts/20200330/","isoDate":"2020-03-30T01:06:22.000Z"},{"title":"すぐやる人に変わる方法","link":"https://memo.basd4g.net/posts/book-memo-do-now/","pubDate":"Sat, 28 Mar 2020 11:52:38 +0900","content":"<p>2017年11月頃のメモを移動。以下、\\n<a href=\\"https://www.amazon.co.jp/%E5%85%88%E9%80%81%E3%82%8A%E3%81%9B%E3%81%9A%E3%81%AB%E3%81%99%E3%81%90%E3%82%84%E3%82%8B%E4%BA%BA%E3%81%AB%E5%A4%89%E3%82%8F%E3%82%8B%E6%96%B9%E6%B3%95-%E4%B8%AD%E7%B5%8C%E3%81%AE%E6%96%87%E5%BA%AB-%E4%BD%90%E3%80%85%E6%9C%A8-%E6%AD%A3%E6%82%9F-ebook/dp/B00ARBMSQG\\"target=\\"_blank\\">先送りせずにすぐやる人に変わる方法 (中経の文庫)</a>を読んだ際のメモだと思われる。</p>\\n<ul>\\n<li>\\n<p>優先度を比較する「前」にやってしまう</p>\\n</li>\\n<li>\\n<p>「快楽を捨てること」と「苦痛を選択する」ということの2つのことを一度にやろうとしてはダメ まず「快楽を捨てる」ことだけに、全神経を集中</p>\\n</li>\\n<li>\\n<p>すぐに実行できるところまで分解する どんどん分解する癖がつけば自然と「すぐやる」人になれる</p>\\n</li>\\n<li>\\n<p>誘導タスクを設定する</p>\\n</li>\\n<li>\\n<p>メールは「下書き」をしておく</p>\\n</li>\\n<li>\\n<p>いまの状況を正直に伝える .. そういうときは、ざっと目を通して、簡単な感想を概ねポジティブに書いて出す</p>\\n</li>\\n<li>\\n<p>以下軽く目を通して考えてから採用すること</p>\\n</li>\\n<li>\\n<p>すぐやる人は肩の力が抜けている</p>\\n</li>\\n<li>\\n<p>やりたいことを増やさない</p>\\n</li>\\n<li>\\n<p>一気にやる快感に気をつける 溜める量を減らしていく</p>\\n</li>\\n<li>\\n<p>締め切りが無くても動ける方法を探す 自分で設定したデッドラインでできたという経験を多く持つ</p>\\n</li>\\n</ul>","contentSnippet":"2017年11月頃のメモを移動。以下、\\n先送りせずにすぐやる人に変わる方法 (中経の文庫)を読んだ際のメモだと思われる。\\n優先度を比較する「前」にやってしまう\\n「快楽を捨てること」と「苦痛を選択する」ということの2つのことを一度にやろうとしてはダメ まず「快楽を捨てる」ことだけに、全神経を集中\\nすぐに実行できるところまで分解する どんどん分解する癖がつけば自然と「すぐやる」人になれる\\n誘導タスクを設定する\\nメールは「下書き」をしておく\\nいまの状況を正直に伝える .. そういうときは、ざっと目を通して、簡単な感想を概ねポジティブに書いて出す\\n以下軽く目を通して考えてから採用すること\\nすぐやる人は肩の力が抜けている\\nやりたいことを増やさない\\n一気にやる快感に気をつける 溜める量を減らしていく\\n締め切りが無くても動ける方法を探す 自分で設定したデッドラインでできたという経験を多く持つ","guid":"https://memo.basd4g.net/posts/book-memo-do-now/","isoDate":"2020-03-28T02:52:38.000Z"},{"title":"仮想化","link":"https://memo.basd4g.net/posts/virtualization/","pubDate":"Sat, 28 Mar 2020 11:48:13 +0900","content":"<p>過去の自分向けメモを移動。以下、2019/4/27頃のメモである。</p>\\n<p>最近大学でOSの授業が始まった。</p>\\n<p>OSの基本的な役割として挙げられるのが、計算資源の管理とハードウェアの仮想化だそうな。</p>\\n<p>仮想化と聞くとVirtual Machineを使ったサーバー仮想化などあるが、それよりももっと前から仮想化という概念は存在していて。\\nCPUのハイパースレッディングテクノロジーなんかはCPUの仮想化。\\nデバイスドライバを介した入出力機器の仮想化。ファイルシステムによりデータを抽象的に操作できるハードディスクの仮想化。アドレスを意識する必要のないメモリの仮想化。</p>\\n<p>仮想化といわれると、以前はエミュレータなんかに近いものを想像していた。</p>\\n<p>しかしOSがハードウェアを仮想化しているということを意識すると言葉のイメージが変わった。\\n仮想化(=抽象化)というのは、カプセル化だったり、階層化という概念に近く、コンピュータの中でごく一般的に広く用いられている手法ではないか？</p>\\n<p>そこまで考えを広げたうえで、昨今のデータセンタ内の仮想化技術(サーバー、ストレージ、ネットワーク、、)は自然の流れとも言える。\\n今まで使っていたハードウェアないしレイヤーを更に仮想的に(抽象的に、ソフトウェア的に)扱いやすくした、レイヤーが一層加わっただけである。</p>\\n<p>大学1年のとき、某企業でデータセンタに関するソリューション提案のインターンをした。そのときは仮想化どころかデータセンタに関する知識が少なくて学ぶことばかりでついていくのもやっとだったけれど、概念の理解は当時より進んだと思う。</p>","contentSnippet":"過去の自分向けメモを移動。以下、2019/4/27頃のメモである。\\n最近大学でOSの授業が始まった。\\nOSの基本的な役割として挙げられるのが、計算資源の管理とハードウェアの仮想化だそうな。\\n仮想化と聞くとVirtual Machineを使ったサーバー仮想化などあるが、それよりももっと前から仮想化という概念は存在していて。\\nCPUのハイパースレッディングテクノロジーなんかはCPUの仮想化。\\nデバイスドライバを介した入出力機器の仮想化。ファイルシステムによりデータを抽象的に操作できるハードディスクの仮想化。アドレスを意識する必要のないメモリの仮想化。\\n仮想化といわれると、以前はエミュレータなんかに近いものを想像していた。\\nしかしOSがハードウェアを仮想化しているということを意識すると言葉のイメージが変わった。\\n仮想化(=抽象化)というのは、カプセル化だったり、階層化という概念に近く、コンピュータの中でごく一般的に広く用いられている手法ではないか？\\nそこまで考えを広げたうえで、昨今のデータセンタ内の仮想化技術(サーバー、ストレージ、ネットワーク、、)は自然の流れとも言える。\\n今まで使っていたハードウェアないしレイヤーを更に仮想的に(抽象的に、ソフトウェア的に)扱いやすくした、レイヤーが一層加わっただけである。\\n大学1年のとき、某企業でデータセンタに関するソリューション提案のインターンをした。そのときは仮想化どころかデータセンタに関する知識が少なくて学ぶことばかりでついていくのもやっとだったけれど、概念の理解は当時より進んだと思う。","guid":"https://memo.basd4g.net/posts/virtualization/","isoDate":"2020-03-28T02:48:13.000Z"},{"title":"さくらのVPSとdocker環境構築","link":"https://memo.basd4g.net/posts/sakura-vps-docker/","pubDate":"Sat, 28 Mar 2020 03:10:34 +0900","content":"<p>PCを整理していて発見したメモを移動して公開する。ファイルのタイムスタンプは2017/12/19。</p>\\n<p>windows10のPCから、さくらVPSでCentOS7のサーバでdockerを使えるようにする記録。</p>\\n<p>windows10にはあらかじめputty,WinSCPがインストールされていることを想定。</p>\\n<h2 id=\\"さくらvps初期設定\\">さくらVPS初期設定</h2>\\n<h3 id=\\"osインストール\\">OSインストール</h3>\\n<p>さくらVPS管理画面にて、&gt; サーバ一覧 &gt; (設定したいサーバ) &gt; 各種設定 &gt; OSインストール</p>\\n<ul>\\n<li>OSインストール形式の選択: 標準OS</li>\\n<li>インストールするOSを選んでください: CentOS7 x86_64</li>\\n<li>rootパスワード: 適当に設定</li>\\n<li>スタートアップスクリプト: 利用しない</li>\\n</ul>\\n<p>こんな感じでOSをインストールする。</p>\\n<h3 id=\\"一般ユーザーの作成\\">一般ユーザーの作成</h3>\\n<p>まず、さくらVPS管理画面にて、&gt;サーバ一覧 &gt;(設定したいサーバ) &gt; _コンソール &gt; _シリアルコンソール(β)版 から操作。</p>\\n<h4 id=\\"sampleuserの作成\\">sampleuserの作成</h4>\\n<p>以下、sampleuserは適当に自分の作りたいユーザー名に置き換える。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\">#rootでログイン</span>\\n$ useradd sampleuser <span class=\\"c1\\">#ユーザー作成</span>\\n$ passwd sampleuser <span class=\\"c1\\">#パスワード設定</span>\\n</code></pre></div><h4 id=\\"sampleuserがsudoできるようにする\\">sampleuserがsudoできるようにする</h4>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ visudo\\n</code></pre></div><p>visudoで/etc/sudoersを編集する。次の行のコメントアウトを外す。</p>\\n<pre><code>## Allows people in group wheel to run all commands\\n#%wheel ALL=(ALL) ALL\\n↓\\n## Allows people in group wheel to run all commands\\n%wheel ALL=(ALL) ALL\\n</code></pre><p>:wqで保存。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ usermod -aG wheel sampleuser\\n<span class=\\"c1\\">#ユーザーをwheelグループに追加</span>\\n$ <span class=\\"nb\\">exit</span>\\n$ login <span class=\\"c1\\">#sampleuserでlogin</span>\\n$ groups <span class=\\"c1\\">#自分の所属groupを確認</span>\\nsampleuser wheel\\n$ sudo su <span class=\\"c1\\">#sampleuserでsudoできるか確認</span>\\n<span class=\\"o\\">[</span>sudo<span class=\\"o\\">]</span> password <span class=\\"k\\">for</span> sampleuser:<span class=\\"o\\">{</span>sampleuserのパスワード<span class=\\"o\\">}</span>\\n$ whoami\\nroot\\n</code></pre></div><h4 id=\\"puttyからsshログインしてみる\\">puttyからsshログインしてみる</h4>\\n<p>putty.exeを起動。</p>\\n<ul>\\n<li>&gt;Session の Host Name : サーバのipアドレスorドメイン名</li>\\n<li>&gt;Session の Port : 22</li>\\n<li>&gt;Conection の Seconds to between keepalives(0 to turn off) : 30 <br>\\n(30秒ごとにnull文字が送信されることでしばらく操作が無くてもsshセッションが途絶えるのを防ぐ。)</li>\\n<li>&gt;Session の SavedSessions : sakura_vps_session</li>\\n</ul>\\n<p>Saveし、その後Openでssh接続できるか確認する。</p>\\n<h3 id=\\"セキュリティの強化\\">セキュリティの強化</h3>\\n<h4 id=\\"rootのsshログインを止める\\">rootのsshログインを止める</h4>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ vim sudo /etc/ssh/sshd_config\\n</code></pre></div><p>/etc/ssh/sshd_configを次のように編集する。</p>\\n<pre><code> #PermitRootLogin yes\\n↓\\nPermitRootLogin no\\n</code></pre><p>:wqで保存。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ systemctl restart sshd <span class=\\"c1\\">#設定を反映させる</span>\\n</code></pre></div><h4 id=\\"port番号変更とfirewall設定変更\\">port番号変更とfirewall設定変更</h4>\\n<p>sshポートを、標準である22から適当な値に変更する。ここでは2222に変更するが、セキュリティのためには各自適当な値を用いるべき。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ sudo vim /etc/ssh/sshd_config\\n</code></pre></div><p>/etc/ssh/sshd_configを次のように編集する。</p>\\n<pre><code>#Port22\\n↓\\nPort2222\\n</code></pre><p>:wqで保存。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ systemctl restart sshd <span class=\\"c1\\">#設定を反映させる</span>\\n</code></pre></div><p>そして、sshの設定でポートを変更したのち、<strong>firewallの設定も変更しなければならない。。。</strong> これに気づかず最初つまづいた。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ cp /usr/lib/firewalld/services/ssh.xml /etc/firewalld/services/ssh.xml\\n$ sudo vim /etc/firewalld/services/ssh.xml\\n</code></pre></div><p>firewallのデフォルト設定は/usr/lib/firewalld/にあるが、これは触らないこと。\\n編集する場合は、/etc/firewalld/以下にファイルを置くと、その部分だけシステム設定が上書きされるようになっているので、こちらに書き込む。</p>\\n<p>/etc/firewalld/services/ssh.xmlを次のように編集する。</p>\\n<pre><code>&lt;port protocol=&quot;tcp&quot; port=&quot;22&quot;/&gt;\\n↓\\n&lt;port protocol=&quot;tcp&quot; port=&quot;2222&quot;/&gt;\\n</code></pre><p>:wqで保存。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ firewall-cmd --reload <span class=\\"c1\\">#設定を反映させる</span>\\n</code></pre></div><p>putty.exeでも、ポート設定を変更しておく。\\nsakura_vps_session をLoadし、Portを2222に変えてSave。puttyから接続できるか確認しておく。</p>\\n<h4 id=\\"公開鍵認証\\">公開鍵認証</h4>\\n<p>puttygen.exeで公開鍵、秘密鍵のペアを作成する。\\nGenerateボタンを押した後、カーソルをウィンドウ上でランダムに動かすと鍵が作成できる。\\nKey passphraseを任意のものに設定する。\\n適当な場所に Save public key で sakura_rsa.pub として、Save private key sakura_rsa.ppk として保存。</p>\\n<p>公開鍵をサーバにアップロードする。\\nWinSCPで、新しいサイトから、</p>\\n<ul>\\n<li>編集プロトコル:SFTP</li>\\n<li>ホスト名:にサーバのipアドレスorドメイン名</li>\\n<li>ポート番号:2222</li>\\n<li>ユーザ名:sampleuser</li>\\n<li>パスワード:(sampleuserのパスワード)</li>\\n</ul>\\n<p>として保存、ログインする。\\nWinSCPでは画面左側にローカルの、画面右側にサーバのファイルが表示されており、ドラッグアンドドロップで相互に転送できる。\\n先ほどの\\nサーバの/home/sampleuser に先ほどの sakura_rsa.pub (公開鍵だけ)を転送する。</p>\\n<p>サーバに公開鍵を登録する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ login <span class=\\"c1\\">#sampleuserでloginする</span>\\n$ ssh-keygen -i -f sakura_rsa.pub &gt;&gt; authorized_keys <span class=\\"c1\\">#puttygen.exeで作成した公開鍵の形式を変換</span>\\n<span class=\\"c1\\">#/home/sampleuser/.ssh/にauthorized_keysを設置し、適切なユーザ権限を与える</span>\\n$ mkdir .ssh\\n$ chmod <span class=\\"m\\">700</span> .ssh\\n$ mv authorized_keys .ssh\\n$ chmod <span class=\\"m\\">600</span> .ssh/authorized_keys\\n$ rm -f sakura_rsa.pub <span class=\\"c1\\">#変換前の公開鍵を削除</span>\\n</code></pre></div><p>puttyに秘密鍵を登録する。</p>\\n<p>putty.exeで sakura_vps_session を Loadし、&gt;Conection&gt;SSH&gt;Auth の Private key fire authentication にsakura_rsa.ppk(秘密鍵)を設定する。\\n&gt;Sessionから 設定の変更をSaveする。\\nその後puttyで接続できるか確認。鍵を作成したときのパスフレーズをここで入力する必要があるはず。\\n問題なく接続できれば、晴れて公開鍵認証でssh接続できている。</p>\\n<p>パスワードログインの無効化をする。\\n公開鍵認証でログインできても、まだ従来のパスワードによるログインもできるのでセキュリティ向上にはなっていない。従来のパスワードによるログインを無効化する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ vim sudo /etc/ssh/sshd_config\\n</code></pre></div><p>/etc/ssh/sshd_configを次のように編集する。</p>\\n<pre><code>#PasswordAuthentication yes\\n↓\\nPasswordAuthentication no\\n</code></pre><p>:wqで保存。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ systemctl restart sshd <span class=\\"c1\\">#設定を反映させる</span>\\n</code></pre></div><h2 id=\\"docker構築\\">docker構築</h2>\\n<h3 id=\\"dockerのインストール\\">dockerのインストール</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ sudo yum update\\n$ sudo yum install docker-io\\n<span class=\\"c1\\">#dockerのインストール</span>\\n$ sudo systemctl start docker\\n<span class=\\"c1\\">#無事インストールされたか確認する</span>\\n$ sudo docker info\\n<span class=\\"c1\\">#インストールされていればつらつら現在の状況が表示される</span>\\n</code></pre></div><h3 id=\\"sampleuserがdockerを使えるようにする\\">sampleuserがdockerを使えるようにする</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ sudo groupadd docker <span class=\\"c1\\">#dockerグループの作成</span>\\n$ sudo gpasswd -a sampleuser docker\\n<span class=\\"c1\\">#sampleuserをdockerグループへ追加</span>\\n$ sudo systemctl restart docker\\n<span class=\\"c1\\">#dockerデーモンの再起動</span>\\n$ docker info\\n<span class=\\"c1\\">#sampleuserで動くことを確認</span>\\n</code></pre></div><h3 id=\\"moby-dockを表示してみる\\">Moby Dockを表示してみる</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ docker run docker/whalesay cowsay <span class=\\"s1\\">&#39;Congrats!!!&#39;</span>\\n</code></pre></div><h2 id=\\"参考文献\\">参考文献</h2>\\n<ul>\\n<li>CentOSでuserをsudo可能にする:<br>\\n<a href=\\"https://qiita.com/Esfahan/items/a159753d156d23baf180\\">https://qiita.com/Esfahan/items/a159753d156d23baf180</a></li>\\n<li>CentOS7のfirewalldでsshのポート番号を変更する方法:<br>\\n<a href=\\"https://qiita.com/DQNEO/items/5780d81b2e0af4cc1544\\">https://qiita.com/DQNEO/items/5780d81b2e0af4cc1544</a></li>\\n<li>PuTTYで公開鍵認証方式でのSSH接続を行う手順まとめ:<br>\\n<a href=\\"https://qiita.com/sugar_15678/items/55cb79d427b9ec21bac2\\">https://qiita.com/sugar_15678/items/55cb79d427b9ec21bac2</a></li>\\n<li>VPSにdocker環境構築:<br>\\n<a href=\\"https://qiita.com/t-mimura/items/c206d46f3af771292f89\\">https://qiita.com/t-mimura/items/c206d46f3af771292f89</a></li>\\n</ul>","contentSnippet":"PCを整理していて発見したメモを移動して公開する。ファイルのタイムスタンプは2017/12/19。\\nwindows10のPCから、さくらVPSでCentOS7のサーバでdockerを使えるようにする記録。\\nwindows10にはあらかじめputty,WinSCPがインストールされていることを想定。\\nさくらVPS初期設定\\nOSインストール\\nさくらVPS管理画面にて、> サーバ一覧 > (設定したいサーバ) > 各種設定 > OSインストール\\nOSインストール形式の選択: 標準OS\\nインストールするOSを選んでください: CentOS7 x86_64\\nrootパスワード: 適当に設定\\nスタートアップスクリプト: 利用しない\\nこんな感じでOSをインストールする。\\n一般ユーザーの作成\\nまず、さくらVPS管理画面にて、>サーバ一覧 >(設定したいサーバ) > _コンソール > _シリアルコンソール(β)版 から操作。\\nsampleuserの作成\\n以下、sampleuserは適当に自分の作りたいユーザー名に置き換える。\\n#rootでログイン\\n$ useradd sampleuser #ユーザー作成\\n$ passwd sampleuser #パスワード設定\\n\\n\\nsampleuserがsudoできるようにする\\n$ visudo\\n\\n\\nvisudoで/etc/sudoersを編集する。次の行のコメントアウトを外す。\\n## Allows people in group wheel to run all commands\\n#%wheel ALL=(ALL) ALL\\n↓\\n## Allows people in group wheel to run all commands\\n%wheel ALL=(ALL) ALL\\n\\n:wqで保存。\\n$ usermod -aG wheel sampleuser\\n#ユーザーをwheelグループに追加\\n$ exit\\n$ login #sampleuserでlogin\\n$ groups #自分の所属groupを確認\\nsampleuser wheel\\n$ sudo su #sampleuserでsudoできるか確認\\n[sudo] password for sampleuser:{sampleuserのパスワード}\\n$ whoami\\nroot\\n\\n\\nputtyからsshログインしてみる\\nputty.exeを起動。\\n>Session の Host Name : サーバのipアドレスorドメイン名\\n>Session の Port : 22\\n>Conection の Seconds to between keepalives(0 to turn off) : 30 \\n>Session の SavedSessions : sakura_vps_session\\nSaveし、その後Openでssh接続できるか確認する。\\nセキュリティの強化\\nrootのsshログインを止める\\n$ vim sudo /etc/ssh/sshd_config\\n\\n\\n/etc/ssh/sshd_configを次のように編集する。\\n #PermitRootLogin yes\\n↓\\nPermitRootLogin no\\n\\n:wqで保存。\\n$ systemctl restart sshd #設定を反映させる\\n\\n\\nport番号変更とfirewall設定変更\\nsshポートを、標準である22から適当な値に変更する。ここでは2222に変更するが、セキュリティのためには各自適当な値を用いるべき。\\n$ sudo vim /etc/ssh/sshd_config\\n\\n\\n/etc/ssh/sshd_configを次のように編集する。\\n#Port22\\n↓\\nPort2222\\n\\n:wqで保存。\\n$ systemctl restart sshd #設定を反映させる\\n\\n\\nそして、sshの設定でポートを変更したのち、firewallの設定も変更しなければならない。。。 これに気づかず最初つまづいた。\\n$ cp /usr/lib/firewalld/services/ssh.xml /etc/firewalld/services/ssh.xml\\n$ sudo vim /etc/firewalld/services/ssh.xml\\n\\n\\nfirewallのデフォルト設定は/usr/lib/firewalld/にあるが、これは触らないこと。\\n編集する場合は、/etc/firewalld/以下にファイルを置くと、その部分だけシステム設定が上書きされるようになっているので、こちらに書き込む。\\n/etc/firewalld/services/ssh.xmlを次のように編集する。\\n<port protocol=\\"tcp\\" port=\\"22\\"/>\\n↓\\n<port protocol=\\"tcp\\" port=\\"2222\\"/>\\n\\n:wqで保存。\\n$ firewall-cmd --reload #設定を反映させる\\n\\n\\nputty.exeでも、ポート設定を変更しておく。\\nsakura_vps_session をLoadし、Portを2222に変えてSave。puttyから接続できるか確認しておく。\\n公開鍵認証\\nputtygen.exeで公開鍵、秘密鍵のペアを作成する。\\nGenerateボタンを押した後、カーソルをウィンドウ上でランダムに動かすと鍵が作成できる。\\nKey passphraseを任意のものに設定する。\\n適当な場所に Save public key で sakura_rsa.pub として、Save private key sakura_rsa.ppk として保存。\\n公開鍵をサーバにアップロードする。\\nWinSCPで、新しいサイトから、\\n編集プロトコル:SFTP\\nホスト名:にサーバのipアドレスorドメイン名\\nポート番号:2222\\nユーザ名:sampleuser\\nパスワード:(sampleuserのパスワード)\\nとして保存、ログインする。\\nWinSCPでは画面左側にローカルの、画面右側にサーバのファイルが表示されており、ドラッグアンドドロップで相互に転送できる。\\n先ほどの\\nサーバの/home/sampleuser に先ほどの sakura_rsa.pub (公開鍵だけ)を転送する。\\nサーバに公開鍵を登録する。\\n$ login #sampleuserでloginする\\n$ ssh-keygen -i -f sakura_rsa.pub >> authorized_keys #puttygen.exeで作成した公開鍵の形式を変換\\n#/home/sampleuser/.ssh/にauthorized_keysを設置し、適切なユーザ権限を与える\\n$ mkdir .ssh\\n$ chmod 700 .ssh\\n$ mv authorized_keys .ssh\\n$ chmod 600 .ssh/authorized_keys\\n$ rm -f sakura_rsa.pub #変換前の公開鍵を削除\\n\\n\\nputtyに秘密鍵を登録する。\\nputty.exeで sakura_vps_session を Loadし、>Conection>SSH>Auth の Private key fire authentication にsakura_rsa.ppk(秘密鍵)を設定する。\\n>Sessionから 設定の変更をSaveする。\\nその後puttyで接続できるか確認。鍵を作成したときのパスフレーズをここで入力する必要があるはず。\\n問題なく接続できれば、晴れて公開鍵認証でssh接続できている。\\nパスワードログインの無効化をする。\\n公開鍵認証でログインできても、まだ従来のパスワードによるログインもできるのでセキュリティ向上にはなっていない。従来のパスワードによるログインを無効化する。\\n$ vim sudo /etc/ssh/sshd_config\\n\\n\\n/etc/ssh/sshd_configを次のように編集する。\\n#PasswordAuthentication yes\\n↓\\nPasswordAuthentication no\\n\\n:wqで保存。\\n$ systemctl restart sshd #設定を反映させる\\n\\n\\ndocker構築\\ndockerのインストール\\n$ sudo yum update\\n$ sudo yum install docker-io\\n#dockerのインストール\\n$ sudo systemctl start docker\\n#無事インストールされたか確認する\\n$ sudo docker info\\n#インストールされていればつらつら現在の状況が表示される\\n\\n\\nsampleuserがdockerを使えるようにする\\n$ sudo groupadd docker #dockerグループの作成\\n$ sudo gpasswd -a sampleuser docker\\n#sampleuserをdockerグループへ追加\\n$ sudo systemctl restart docker\\n#dockerデーモンの再起動\\n$ docker info\\n#sampleuserで動くことを確認\\n\\n\\nMoby Dockを表示してみる\\n$ docker run docker/whalesay cowsay \'Congrats!!!\'\\n\\n\\n参考文献\\nCentOSでuserをsudo可能にする:\\nhttps://qiita.com/Esfahan/items/a159753d156d23baf180\\nCentOS7のfirewalldでsshのポート番号を変更する方法:\\nhttps://qiita.com/DQNEO/items/5780d81b2e0af4cc1544\\nPuTTYで公開鍵認証方式でのSSH接続を行う手順まとめ:\\nhttps://qiita.com/sugar_15678/items/55cb79d427b9ec21bac2\\nVPSにdocker環境構築:\\nhttps://qiita.com/t-mimura/items/c206d46f3af771292f89","guid":"https://memo.basd4g.net/posts/sakura-vps-docker/","isoDate":"2020-03-27T18:10:34.000Z"},{"title":"お名前.comで取得したドメインをさくらVPSで使う。","link":"https://memo.basd4g.net/posts/sakura-vps-dns/","pubDate":"Sat, 28 Mar 2020 03:03:08 +0900","content":"<p>PCを整理していて発見したメモを移動して公開する。ファイルのタイムスタンプは2017/12/19。</p>\\n<p>お名前.comで取得したドメインをさくらVPSで使う。DNSサーバーはさくらのものを利用する。</p>\\n<h2 id=\\"お名前com側の設定\\">お名前.com側の設定</h2>\\n<p>&gt; ドメイン &gt; ドメイン設定 &gt; ネームサーバーの設定 &gt; ネームサーバーの変更</p>\\n<p>目的のドメイン名にチェックを入れて 登録情報は正しいので、手続きを進める をクリック。</p>\\n<p>他のネームサーバーを利用 のタブにして</p>\\n<ul>\\n<li>1プライマリネームサーバー(必須) : ns1.dns.ne.jp</li>\\n<li>2セカンダリネームサーバー(必須) : ns2.dns.ne.jp</li>\\n</ul>\\n<p>として確認画面へ進み、設定を適用する。</p>\\n<p>これでネームサーバーはさくらインターネットのものが使われる</p>\\n<h2 id=\\"さくらvps側の設定\\">さくらVPS側の設定</h2>\\n<p>&gt; さくらのVPSコントロールパネル &gt; ネームサーバ登録</p>\\n<ul>\\n<li>ドメイン名:example.com (目的のドメイン名)\\n送信する をクリックして設定を適用する。</li>\\n</ul>\\n<p>&gt; 会員メニュー &gt; ドメイン &gt; 管理ドメインとネームサーバの一覧<br>\\nにてドメイン名:example.comの ゾーン編集 をクリック\\n左側の 変更 から</p>\\n<ul>\\n<li>エントリ名: 空欄</li>\\n<li>種別: IPアドレス(A)</li>\\n<li>値: 192.0.43.10 (サーバのIPアドレス)</li>\\n<li>DNSチェック: する</li>\\n<li>TTLの指定: (チェックしない)</li>\\n</ul>\\n<p>として新規登録</p>\\n<p>もう一度<br>\\n&gt; 会員メニュー &gt; ドメイン &gt; 管理ドメインとネームサーバの一覧<br>\\nにてドメイン名:example.comの ゾーン編集 をクリックし、左側の 変更 から</p>\\n<ul>\\n<li>エントリ名: www</li>\\n<li>種別: 別名(CNAME)</li>\\n<li>値: @</li>\\n<li>DNSチェック: する</li>\\n<li>TTLの指定: (チェックしない)</li>\\n</ul>\\n<p>として新規登録</p>\\n<p>以上で完了となる。</p>","contentSnippet":"PCを整理していて発見したメモを移動して公開する。ファイルのタイムスタンプは2017/12/19。\\nお名前.comで取得したドメインをさくらVPSで使う。DNSサーバーはさくらのものを利用する。\\nお名前.com側の設定\\n> ドメイン > ドメイン設定 > ネームサーバーの設定 > ネームサーバーの変更\\n目的のドメイン名にチェックを入れて 登録情報は正しいので、手続きを進める をクリック。\\n他のネームサーバーを利用 のタブにして\\n1プライマリネームサーバー(必須) : ns1.dns.ne.jp\\n2セカンダリネームサーバー(必須) : ns2.dns.ne.jp\\nとして確認画面へ進み、設定を適用する。\\nこれでネームサーバーはさくらインターネットのものが使われる\\nさくらVPS側の設定\\n> さくらのVPSコントロールパネル > ネームサーバ登録\\nドメイン名:example.com (目的のドメイン名)\\n送信する をクリックして設定を適用する。\\n> 会員メニュー > ドメイン > 管理ドメインとネームサーバの一覧\\nエントリ名: 空欄\\n種別: IPアドレス(A)\\n値: 192.0.43.10 (サーバのIPアドレス)\\nDNSチェック: する\\nTTLの指定: (チェックしない)\\nとして新規登録\\nもう一度\\nエントリ名: www\\n種別: 別名(CNAME)\\n値: @\\nDNSチェック: する\\nTTLの指定: (チェックしない)\\nとして新規登録\\n以上で完了となる。","guid":"https://memo.basd4g.net/posts/sakura-vps-dns/","isoDate":"2020-03-27T18:03:08.000Z"},{"title":"androidの架電アプリによる各種制御プログラムの起動","link":"https://memo.basd4g.net/posts/android-phone-call-command/","pubDate":"Sat, 28 Mar 2020 02:45:25 +0900","content":"<h2 id=\\"まえがき\\">まえがき</h2>\\n<p>PC内のデータを整理していたら過去に自分向けに書いていたメモが出てきたので、ここ記す形で移動する。\\nタイムスタンプをみるに、2017/11/22頃に書かれたものだ。</p>\\n<p>androidでは、端末の細かい挙動の設定を変更する際、電話アプリで以下に有るようなコマンドを打ち込むと行えることがある。</p>\\n<p>過去のメモなので、どの機種、環境だと利用できるのか確認していないが、<a href=\\"https://memo.basd4g.net/posts/sol26-sim-unlock/\\">SOL26simロック解除</a>に用いていることから、少なくとも左の記事のような環境で利用できそうである。</p>\\n<h2 id=\\"メモ\\">メモ</h2>\\n<pre><code>Open Android Mobile Programs Using Commend\\nCommands Usages\\n*#06# = IMEI Android serial number\\n*#8999*523# = LCD Brightness\\n*#1234# = To check Software and Hardware information, PDA, CSC,MODEM.\\n*#2222# = it will open H/W Version\\n*#*#4636#*#*= user statistics and Phone Info\\n*#0011# = Displays status information for the GSM\\n*2767*3855# = Full factory reset (Don’t dial unless you have problem, it does not ask you to confirm)\\n*#12580*369# = SW &amp; HW Info\\n#*#8377466# = S/W Version &amp; H/W Version\\n#*5376# = DELETE ALL SMS!!!!\\n*#197328640# = Service Mode\\n*#0228# = Battery status (ADC, RSSI reading)\\n*#32489# = Service mode (Ciphering Info)\\n*#2255# = Call List\\n#*3888# = BLUETOOTH Test mode\\n#*7828# = Task screen\\n*#5282837# = Java Version\\n*#232331# = Bluetooth Test Mode\\n*#232338# = WLAN MAC Address\\n*#232339# = WLAN Test Mode\\n*#8999*8378# = Test Menu\\n*#0842# = Vibrate Motor Test Mode\\n*#0782# = Real Time Clock Test\\n*#0673# = Audio Test Mode\\n*#0*# = General Test Mode\\n*#2263# = RF Band Selection / Network modes select\\n*#9090# = Diagnostic Configuration\\n*#7284# = USB I2C Mode Control\\n*#872564# = USB Logging Control\\n*#4238378# = GCF Configuration\\n*#0283# = Audio Loopback Control\\n*#1575# = GPS Control Menu\\n*#3214789650# = LBS Test Mode\\n*#745# = RIL Dump Menu\\n*#746# = Debug Dump Menu\\n*#9900# = Takes you to System Dump, where Disabling Fast Dormancy gives a boost to your network speed on some networks (both Wi-Fi and Gpr), same code to re-enable it\\n*#44336# = Software Version Info\\n*#0289# = Melody Test Mode\\n*#2663# = TSP / TSK firmware update\\n*#03# = NAND Flash S/N\\n*#0589# = Light Sensor Test Mode\\n*#0588# = Proximity Sensor Test Mode\\n*#273283*255*3282*# = Data Create Menu\\n*#7594# = Remap Shutdown to End Call TSK\\n*#7465625# = View Phone Lock Status\\n*7465625*638*# = Configure Network Lock MCC/MNC\\n#7465625*638*# = Insert Network Lock Key code\\n*7465625*782*# = Configure Network Lock NSP\\n#7465625*782*# = Insert Partial Network Lock key code\\n*7465625*77*# = Insert Network Lock key code SP\\n#7465625*77*# = Insert Operator Lock key code\\n*7465625*27*# = Insert Network Lock key code NSP/CP\\n#7465625*27*# = Insert Content Provider key code\\n*#272*IMEI# = then we will get buyer code (For Samsung galaxy six code)\\n*#*#7780#*#* = Factory data reset – Clears Google-account data, system and program settings and\\n*2767*3855# = Format phone\\nThe Most Useful Cods on Android Mobile\\n– Disables Network Lock : #7465625*638*00000000#\\n– Disables SIM Lock : #7465625*746*00000000#\\n– Disables SP lock : #7465625*77*00000000#\\n– Disables Subset Lock : #7465625*782*00000000#\\n</code></pre><p>参考: <a href=\\"http://www.commandshow.com/open-android-programs-using-command/\\">http://www.commandshow.com/open-android-programs-using-command/</a></p>","contentSnippet":"まえがき\\nPC内のデータを整理していたら過去に自分向けに書いていたメモが出てきたので、ここ記す形で移動する。\\nタイムスタンプをみるに、2017/11/22頃に書かれたものだ。\\nandroidでは、端末の細かい挙動の設定を変更する際、電話アプリで以下に有るようなコマンドを打ち込むと行えることがある。\\n過去のメモなので、どの機種、環境だと利用できるのか確認していないが、SOL26simロック解除に用いていることから、少なくとも左の記事のような環境で利用できそうである。\\nメモ\\nOpen Android Mobile Programs Using Commend\\nCommands Usages\\n*#06# = IMEI Android serial number\\n*#8999*523# = LCD Brightness\\n*#1234# = To check Software and Hardware information, PDA, CSC,MODEM.\\n*#2222# = it will open H/W Version\\n*#*#4636#*#*= user statistics and Phone Info\\n*#0011# = Displays status information for the GSM\\n*2767*3855# = Full factory reset (Don’t dial unless you have problem, it does not ask you to confirm)\\n*#12580*369# = SW & HW Info\\n#*#8377466# = S/W Version & H/W Version\\n#*5376# = DELETE ALL SMS!!!!\\n*#197328640# = Service Mode\\n*#0228# = Battery status (ADC, RSSI reading)\\n*#32489# = Service mode (Ciphering Info)\\n*#2255# = Call List\\n#*3888# = BLUETOOTH Test mode\\n#*7828# = Task screen\\n*#5282837# = Java Version\\n*#232331# = Bluetooth Test Mode\\n*#232338# = WLAN MAC Address\\n*#232339# = WLAN Test Mode\\n*#8999*8378# = Test Menu\\n*#0842# = Vibrate Motor Test Mode\\n*#0782# = Real Time Clock Test\\n*#0673# = Audio Test Mode\\n*#0*# = General Test Mode\\n*#2263# = RF Band Selection / Network modes select\\n*#9090# = Diagnostic Configuration\\n*#7284# = USB I2C Mode Control\\n*#872564# = USB Logging Control\\n*#4238378# = GCF Configuration\\n*#0283# = Audio Loopback Control\\n*#1575# = GPS Control Menu\\n*#3214789650# = LBS Test Mode\\n*#745# = RIL Dump Menu\\n*#746# = Debug Dump Menu\\n*#9900# = Takes you to System Dump, where Disabling Fast Dormancy gives a boost to your network speed on some networks (both Wi-Fi and Gpr), same code to re-enable it\\n*#44336# = Software Version Info\\n*#0289# = Melody Test Mode\\n*#2663# = TSP / TSK firmware update\\n*#03# = NAND Flash S/N\\n*#0589# = Light Sensor Test Mode\\n*#0588# = Proximity Sensor Test Mode\\n*#273283*255*3282*# = Data Create Menu\\n*#7594# = Remap Shutdown to End Call TSK\\n*#7465625# = View Phone Lock Status\\n*7465625*638*# = Configure Network Lock MCC/MNC\\n#7465625*638*# = Insert Network Lock Key code\\n*7465625*782*# = Configure Network Lock NSP\\n#7465625*782*# = Insert Partial Network Lock key code\\n*7465625*77*# = Insert Network Lock key code SP\\n#7465625*77*# = Insert Operator Lock key code\\n*7465625*27*# = Insert Network Lock key code NSP/CP\\n#7465625*27*# = Insert Content Provider key code\\n*#272*IMEI# = then we will get buyer code (For Samsung galaxy six code)\\n*#*#7780#*#* = Factory data reset – Clears Google-account data, system and program settings and\\n*2767*3855# = Format phone\\nThe Most Useful Cods on Android Mobile\\n– Disables Network Lock : #7465625*638*00000000#\\n– Disables SIM Lock : #7465625*746*00000000#\\n– Disables SP lock : #7465625*77*00000000#\\n– Disables Subset Lock : #7465625*782*00000000#\\n\\n参考: http://www.commandshow.com/open-android-programs-using-command/","guid":"https://memo.basd4g.net/posts/android-phone-call-command/","isoDate":"2020-03-27T17:45:25.000Z"},{"title":"shellでhistoryを使う","link":"https://memo.basd4g.net/posts/sh-history/","pubDate":"Thu, 26 Mar 2020 00:13:29 +0900","content":"<h2 id=\\"過去に実行したコマンドを再度実行する\\">過去に実行したコマンドを再度実行する</h2>\\n<p>history &hellip; unix系OSでshellに存在する組み込みコマンドだ。</p>\\n<p>過去に実行したコマンドを表示できる。</p>\\n<p>historyコマンドで表示されたコマンドの番号を!と合わせて入力すると、そのコマンドを実行できる。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">history</span>\\n<span class=\\"m\\">1</span> ls\\n<span class=\\"m\\">2</span> <span class=\\"nb\\">pwd</span>\\n<span class=\\"m\\">3</span> <span class=\\"nb\\">cd</span> /etc\\n$ !1\\nls\\nhogedir/ fugafile\\n</code></pre></div><p>以下のようにして全履歴を表示できる。</p>\\n<p>出力した後はgrepで煮るなり焼くなりするのが良いかと。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">history</span> -E <span class=\\"m\\">1</span>\\n<span class=\\"c1\\"># 履歴を全て表示する</span>\\n</code></pre></div><h2 id=\\"zshrcでの設定\\">.zshrcでの設定</h2>\\n<p><code>.zshrc</code>でhistoryに関する設定をしておく</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-.zshrc\\" data-lang=\\".zshrc\\"><span class=\\"nv\\">HISTSIZE</span><span class=\\"o\\">=</span><span class=\\"m\\">50000</span> <span class=\\"c1\\"># メモリに保存するコマンド数</span>\\n<span class=\\"nv\\">HISTFILE</span><span class=\\"o\\">=</span>~/.zsh_history\\n<span class=\\"nv\\">SAVEHIST</span><span class=\\"o\\">=</span><span class=\\"m\\">100000</span> <span class=\\"c1\\"># ヒストリファイルに保存するコマンド数</span>\\n<span class=\\"nb\\">alias</span> <span class=\\"nv\\">history</span><span class=\\"o\\">=</span><span class=\\"s2\\">&#34;history -i&#34;</span>\\n<span class=\\"k\\">function</span> history-all <span class=\\"o\\">{</span> <span class=\\"nb\\">history</span> -E <span class=\\"m\\">1</span> <span class=\\"o\\">}</span>\\n<span class=\\"c1\\"># 重複するコマンド行は古い方を削除</span>\\nsetopt hist_ignore_all_dups\\n<span class=\\"c1\\"># 直前と同じコマンドラインはヒストリに追加しない</span>\\nsetopt hist_ignore_dups\\n<span class=\\"c1\\"># コマンド履歴ファイルを共有する</span>\\nsetopt share_history\\n<span class=\\"c1\\"># 履歴を追加 (毎回 .zsh_history を作るのではなく)</span>\\nsetopt append_history\\n<span class=\\"c1\\"># 履歴をインクリメンタルに追加</span>\\nsetopt inc_append_history\\n<span class=\\"c1\\"># ヒストリを呼び出してから実行する間に一旦編集可能</span>\\nsetopt hist_verify\\n<span class=\\"c1\\"># 余分な空白は詰めて記録</span>\\nsetopt hist_reduce_blanks\\n<span class=\\"c1\\"># historyコマンドは履歴に登録しない</span>\\nsetopt hist_no_store\\n</code></pre></div>","contentSnippet":"過去に実行したコマンドを再度実行する\\nhistory … unix系OSでshellに存在する組み込みコマンドだ。\\n過去に実行したコマンドを表示できる。\\nhistoryコマンドで表示されたコマンドの番号を!と合わせて入力すると、そのコマンドを実行できる。\\n$ history\\n1 ls\\n2 pwd\\n3 cd /etc\\n$ !1\\nls\\nhogedir/ fugafile\\n\\n\\n以下のようにして全履歴を表示できる。\\n出力した後はgrepで煮るなり焼くなりするのが良いかと。\\n$ history -E 1\\n# 履歴を全て表示する\\n\\n\\n.zshrcでの設定\\n.zshrcでhistoryに関する設定をしておく\\nHISTSIZE=50000 # メモリに保存するコマンド数\\nHISTFILE=~/.zsh_history\\nSAVEHIST=100000 # ヒストリファイルに保存するコマンド数\\nalias history=\\"history -i\\"\\nfunction history-all { history -E 1 }\\n# 重複するコマンド行は古い方を削除\\nsetopt hist_ignore_all_dups\\n# 直前と同じコマンドラインはヒストリに追加しない\\nsetopt hist_ignore_dups\\n# コマンド履歴ファイルを共有する\\nsetopt share_history\\n# 履歴を追加 (毎回 .zsh_history を作るのではなく)\\nsetopt append_history\\n# 履歴をインクリメンタルに追加\\nsetopt inc_append_history\\n# ヒストリを呼び出してから実行する間に一旦編集可能\\nsetopt hist_verify\\n# 余分な空白は詰めて記録\\nsetopt hist_reduce_blanks\\n# historyコマンドは履歴に登録しない\\nsetopt hist_no_store","guid":"https://memo.basd4g.net/posts/sh-history/","isoDate":"2020-03-25T15:13:29.000Z"},{"title":"UbuntuをダウンロードしてInstallする","link":"https://memo.basd4g.net/posts/download-ubuntu/","pubDate":"Sat, 21 Mar 2020 23:18:47 +0900","content":"<h2 id=\\"download\\">Download</h2>\\n<p><a href=\\"https://www.ubuntulinux.jp/download/ja-remix\\"target=\\"_blank\\">Ubuntu Desktop 日本語 Remix</a>をダウンロードする</p>\\n<p>Torrentを利用するために、uTorrent classicを使用した。\\nただし、catalinaがサポート外と書かれていたのでもしかしたら32bitアプリケーションかもしれない。\\nTorrentについては別途要検討</p>\\n<h2 id=\\"check\\">Check</h2>\\n<p>macでは次のようにしてmd5ハッシュを確認できる\\nダウンロードページのhashと比較して、ダウンロードが正しく行われたことを確認する</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ md5 -q path/to/file\\n<span class=\\"c1\\"># manによると、-qオプションはQuiet modeらしい。md5ハッシュのみ出力する。</span>\\n<span class=\\"c1\\"># ので、次のように比較するのが良いかな</span>\\n$ md5 -q path/to/file <span class=\\"p\\">|</span> diff hash/text/file/path -\\n<span class=\\"c1\\"># diffの第二引数&#34;-&#34;は、標準入力の意</span>\\n</code></pre></div><h2 id=\\"copy\\">Copy</h2>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\"><span class=\\"c1\\"># Convert iso to img</span>\\n$ hdutil convert -format UDRW -o hoge.img hoge.iso\\n$ mv hoge.img.dmg hoge.img\\n<span class=\\"c1\\"># USBメモリの確認</span>\\n$ diskutil list\\n<span class=\\"c1\\"># Mountされていたら</span>\\n$ diskutil unMountDisk path/to/device\\n<span class=\\"c1\\"># ex) $ diskutil unMountDisk /dev/disk1</span>\\n$ sudo dd <span class=\\"k\\">if</span><span class=\\"o\\">=</span>hoge.img <span class=\\"nv\\">of</span><span class=\\"o\\">=</span>path/to/device <span class=\\"nv\\">bs</span><span class=\\"o\\">=</span>1m\\n$ sudo diskutil eject path/to/device\\n</code></pre></div>","contentSnippet":"Download\\nUbuntu Desktop 日本語 Remixをダウンロードする\\nTorrentを利用するために、uTorrent classicを使用した。\\nただし、catalinaがサポート外と書かれていたのでもしかしたら32bitアプリケーションかもしれない。\\nTorrentについては別途要検討\\nCheck\\nmacでは次のようにしてmd5ハッシュを確認できる\\nダウンロードページのhashと比較して、ダウンロードが正しく行われたことを確認する\\n$ md5 -q path/to/file\\n# manによると、-qオプションはQuiet modeらしい。md5ハッシュのみ出力する。\\n# ので、次のように比較するのが良いかな\\n$ md5 -q path/to/file | diff hash/text/file/path -\\n# diffの第二引数\\"-\\"は、標準入力の意\\n\\n\\nCopy\\n# Convert iso to img\\n$ hdutil convert -format UDRW -o hoge.img hoge.iso\\n$ mv hoge.img.dmg hoge.img\\n# USBメモリの確認\\n$ diskutil list\\n# Mountされていたら\\n$ diskutil unMountDisk path/to/device\\n# ex) $ diskutil unMountDisk /dev/disk1\\n$ sudo dd if=hoge.img of=path/to/device bs=1m\\n$ sudo diskutil eject path/to/device","guid":"https://memo.basd4g.net/posts/download-ubuntu/","isoDate":"2020-03-21T14:18:47.000Z"},{"title":"dein.vimの導入","link":"https://memo.basd4g.net/posts/install-dein-vim/","pubDate":"Tue, 17 Mar 2020 00:13:35 +0900","content":"<p>dotfiles環境下でvimのプラグイン管理に<a href=\\"https://github.com/Shougo/dein.vim\\"target=\\"_blank\\">dein.vim</a>を導入する。</p>\\n<h2 id=\\"前提\\">前提</h2>\\n<ul>\\n<li><code>~/dotfiles</code>で<code>.vimrc</code>を管理している</li>\\n<li>dein.vimも<code>~/dotfiles</code>で管理する</li>\\n</ul>\\n<h2 id=\\"下準備\\">下準備</h2>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">cd</span> ~/dotfiles\\n$ mkdir dein\\n$ touch dein/load.vim\\n</code></pre></div><h2 id=\\"vimrcに追記\\">.vimrcに追記</h2>\\n<p><code>~/dotfiles/.vimrc</code>の先頭に次を記載</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-.vimrc\\" data-lang=\\".vimrc\\"><span class=\\"c\\">&#34;===== dein.vim =====</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">if</span> <span class=\\"nx\\">filereadable</span><span class=\\"p\\">(</span><span class=\\"nx\\">expand</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;dein/load.vim&#39;</span><span class=\\"p\\">))</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">source</span> <span class=\\"nx\\">dein</span>/<span class=\\"nx\\">load</span>.<span class=\\"nx\\">vim</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">endif</span><span class=\\"err\\">\\n</span></code></pre></div><h2 id=\\"loadvimに記述\\">load.vimに記述</h2>\\n<p><code>~/dotfiles/dein/load.vim</code>に次の内容を記述</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-~/dotfiles/dein/load.vim\\" data-lang=\\"~/dotfiles/dein/load.vim\\"><span class=\\"c\\">&#34;&#34;&#34;===== dein.vim ======</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">\\n</span><span class=\\"c\\">&#34;dein.vim dark power</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">let</span> <span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_dir</span> <span class=\\"p\\">=</span> <span class=\\"nx\\">expand</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;~/dotfiles/dein&#39;</span><span class=\\"p\\">)</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">&#34; s:dein_dirとg:rc-dirは一致させること。dein.tomlとdein-lazy.tomlをtouchしている</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">&#34;</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">let</span> <span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_repo_dir</span> <span class=\\"p\\">=</span> <span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_dir</span> . <span class=\\"s1\\">&#39;/repos/github.com/Shougo/dein.vim&#39;</span><span class=\\"err\\">\\n</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"nx\\">set</span> <span class=\\"nx\\">nocompatible</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">&#34; dein.vim をインストールしていない場合は自動インストール</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">if</span> <span class=\\"p\\">!</span><span class=\\"nx\\">isdirectory</span><span class=\\"p\\">(</span><span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_repo_dir</span><span class=\\"p\\">)</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">echo</span> <span class=\\"s2\\">&#34;install dein.vim...&#34;</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">execute</span> <span class=\\"s1\\">&#39;!git clone git://github.com/Shougo/dein.vim&#39;</span> <span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_repo_dir</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">execute</span> <span class=\\"s1\\">&#39;!touch -m &#39;</span> . <span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_dir</span> . <span class=\\"s1\\">&#39;/dein.toml&#39;</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">execute</span> <span class=\\"s1\\">&#39;!touch -m &#39;</span> . <span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_dir</span> . <span class=\\"s1\\">&#39;/dein_lazy.toml&#39;</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">endif</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"nx\\">execute</span> <span class=\\"s1\\">&#39;set runtimepath^=&#39;</span> . <span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_repo_dir</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">\\n</span><span class=\\"c\\">&#34;---------------------------</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">&#34; Start dein.vim Settings.</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">&#34;---------------------------</span><span class=\\"err\\">\\n</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">if</span> <span class=\\"nx\\">dein</span>#<span class=\\"nx\\">load_state</span><span class=\\"p\\">(</span><span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_dir</span><span class=\\"p\\">)</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">call</span> <span class=\\"nx\\">dein</span>#<span class=\\"nx\\">begin</span><span class=\\"p\\">(</span><span class=\\"nx\\">s</span>:<span class=\\"nx\\">dein_dir</span><span class=\\"p\\">)</span><span class=\\"err\\">\\n</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"k\\">let</span> <span class=\\"nx\\">g</span>:<span class=\\"nx\\">rc_dir</span> <span class=\\"p\\">=</span> <span class=\\"nx\\">expand</span><span class=\\"p\\">(</span><span class=\\"s1\\">&#39;~/dotfiles/dein&#39;</span><span class=\\"p\\">)</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"k\\">let</span> <span class=\\"nx\\">s</span>:<span class=\\"nx\\">toml</span> <span class=\\"p\\">=</span> <span class=\\"nx\\">g</span>:<span class=\\"nx\\">rc_dir</span> . <span class=\\"s1\\">&#39;/dein.toml&#39;</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"k\\">let</span> <span class=\\"nx\\">s</span>:<span class=\\"nx\\">lazy_toml</span> <span class=\\"p\\">=</span> <span class=\\"nx\\">g</span>:<span class=\\"nx\\">rc_dir</span> . <span class=\\"s1\\">&#39;/dein_lazy.toml&#39;</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">\\n</span><span class=\\"c\\"> &#34; TOMLファイルにpluginを記述</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">call</span> <span class=\\"nx\\">dein</span>#<span class=\\"nx\\">load_toml</span><span class=\\"p\\">(</span><span class=\\"nx\\">s</span>:<span class=\\"nx\\">toml</span><span class=\\"p\\">,</span> {<span class=\\"s1\\">&#39;lazy&#39;</span>: <span class=\\"m\\">0</span>}<span class=\\"p\\">)</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">call</span> <span class=\\"nx\\">dein</span>#<span class=\\"nx\\">load_toml</span><span class=\\"p\\">(</span><span class=\\"nx\\">s</span>:<span class=\\"nx\\">lazy_toml</span><span class=\\"p\\">,</span> {<span class=\\"s1\\">&#39;lazy&#39;</span>: <span class=\\"m\\">1</span>}<span class=\\"p\\">)</span><span class=\\"err\\">\\n</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">call</span> <span class=\\"nx\\">dein</span>#<span class=\\"nx\\">end</span><span class=\\"p\\">()</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">call</span> <span class=\\"nx\\">dein</span>#<span class=\\"nx\\">save_state</span><span class=\\"p\\">()</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">endif</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">\\n</span><span class=\\"c\\">&#34; 未インストールを確認</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">if</span> <span class=\\"nx\\">dein</span>#<span class=\\"nx\\">check_install</span><span class=\\"p\\">()</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span> <span class=\\"nx\\">call</span> <span class=\\"nx\\">dein</span>#<span class=\\"nx\\">install</span><span class=\\"p\\">()</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"k\\">endif</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">\\n</span><span class=\\"c\\">&#34;---------------------------</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">&#34; End dein.vim Settings.</span><span class=\\"err\\">\\n</span><span class=\\"err\\"></span><span class=\\"c\\">&#34;---------------------------</span><span class=\\"err\\">\\n</span></code></pre></div><h2 id=\\"vimを起動\\">vimを起動</h2>\\n<p><code>.vimrc</code>の記述により、vim起動によりdein.vimがinstallされる。\\n(ただし、gitが必要)</p>\\n<h2 id=\\"参考\\">参考</h2>\\n<ul>\\n<li><a href=\\"https://github.com/basd4g/dotfiles\\"target=\\"_blank\\">basd4g/dotfiles -GitHub</a></li>\\n</ul>","contentSnippet":"dotfiles環境下でvimのプラグイン管理にdein.vimを導入する。\\n前提\\n~/dotfilesで.vimrcを管理している\\ndein.vimも~/dotfilesで管理する\\n下準備\\n$ cd ~/dotfiles\\n$ mkdir dein\\n$ touch dein/load.vim\\n\\n\\n.vimrcに追記\\n~/dotfiles/.vimrcの先頭に次を記載\\n\\"===== dein.vim =====\\nif filereadable(expand(\'dein/load.vim\'))\\n source dein/load.vim\\nendif\\n\\n\\nload.vimに記述\\n~/dotfiles/dein/load.vimに次の内容を記述\\n\\"\\"\\"===== dein.vim ======\\n\\n\\"dein.vim dark power\\nlet s:dein_dir = expand(\'~/dotfiles/dein\')\\n\\" s:dein_dirとg:rc-dirは一致させること。dein.tomlとdein-lazy.tomlをtouchしている\\n\\"\\nlet s:dein_repo_dir = s:dein_dir . \'/repos/github.com/Shougo/dein.vim\'\\n\\nset nocompatible\\n\\" dein.vim をインストールしていない場合は自動インストール\\nif !isdirectory(s:dein_repo_dir)\\n echo \\"install dein.vim...\\"\\n execute \'!git clone git://github.com/Shougo/dein.vim\' s:dein_repo_dir\\n execute \'!touch -m \' . s:dein_dir . \'/dein.toml\'\\n execute \'!touch -m \' . s:dein_dir . \'/dein_lazy.toml\'\\nendif\\nexecute \'set runtimepath^=\' . s:dein_repo_dir\\n\\n\\"---------------------------\\n\\" Start dein.vim Settings.\\n\\"---------------------------\\n\\nif dein#load_state(s:dein_dir)\\n call dein#begin(s:dein_dir)\\n\\n let g:rc_dir = expand(\'~/dotfiles/dein\')\\n let s:toml = g:rc_dir . \'/dein.toml\'\\n let s:lazy_toml = g:rc_dir . \'/dein_lazy.toml\'\\n\\n \\" TOMLファイルにpluginを記述\\n call dein#load_toml(s:toml, {\'lazy\': 0})\\n call dein#load_toml(s:lazy_toml, {\'lazy\': 1})\\n\\n call dein#end()\\n call dein#save_state()\\nendif\\n\\n\\" 未インストールを確認\\nif dein#check_install()\\n call dein#install()\\nendif\\n\\n\\"---------------------------\\n\\" End dein.vim Settings.\\n\\"---------------------------\\n\\n\\nvimを起動\\n.vimrcの記述により、vim起動によりdein.vimがinstallされる。\\n(ただし、gitが必要)\\n参考\\nbasd4g/dotfiles -GitHub","guid":"https://memo.basd4g.net/posts/install-dein-vim/","isoDate":"2020-03-16T15:13:35.000Z"},{"title":"Shell Scriptにおける、カレントディレクトリの固定","link":"https://memo.basd4g.net/posts/shell-pwd/","pubDate":"Mon, 16 Mar 2020 22:23:27 +0900","content":"<h2 id=\\"前提\\">前提</h2>\\n<p>shell script内では、shell scriptを起動する前のカレントディレクトリが引き継がれる。</p>\\n<p>例えば、次のような<code>pwd.sh</code>を実行する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-pwd.sh\\" data-lang=\\"pwd.sh\\"><span class=\\"cp\\">#!/bin/sh\\n</span><span class=\\"cp\\"></span><span class=\\"nb\\">pwd</span>\\n</code></pre></div><p>次のように、shell scriptを呼び出す際のカレントディレクトリにより、shell scriptの挙動が変化する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">pwd</span>\\n/Users/hoge\\n$ ls -F\\npwd.sh* dir/\\n$ sh pwd.sh\\n/Users/hoge\\n$ <span class=\\"nb\\">cd</span> dir\\n$ sh ../pwd.sh\\n/Users/hoge/dir\\n</code></pre></div><h2 id=\\"解決策\\">解決策</h2>\\n<p>shell scriptの前方に、2行追加する。</p>\\n<pre><code class=\\"language-pwd\\" data-lang=\\"pwd\\">#!/bin/sh\\n# change directory to the shell file\'s directory\\nSCRIPT_DIR=`dirname $0`\\ncd $SCRIPT_DIR\\npwd\\n</code></pre><p>これにより、shell scriptを呼び出す際のカレントディレクトリに関わらず、shell scriptでのカレントディレクトリが、shell scriptが配置されたディレクトリに固定される。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ <span class=\\"nb\\">pwd</span>\\n/Users/hoge\\n$ ls -F\\npwd.sh* dir/\\n$ sh pwd.sh\\n/Users/hoge\\n$ <span class=\\"nb\\">cd</span> dir\\n$ sh ../pwd.sh\\n/Users/hoge\\n</code></pre></div><h2 id=\\"その他の解決策\\">その他の解決策</h2>\\n<p>shell script内のpathを、<code>&quot;$HOME&quot;</code>などの変数を使って絶対パスで記載する。</p>\\n<h2 id=\\"まとめ\\">まとめ</h2>\\n<p>以下のテンプレートをshell scriptの先頭に追加すると良い。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sample.sh\\" data-lang=\\"sample.sh\\"><span class=\\"cp\\">#!/bin/sh\\n</span><span class=\\"cp\\"></span><span class=\\"nv\\">SCRIPT_DIR</span><span class=\\"o\\">=</span><span class=\\"sb\\">`</span>dirname <span class=\\"nv\\">$0</span><span class=\\"sb\\">`</span>\\n<span class=\\"nb\\">cd</span> <span class=\\"nv\\">$SCRIPT_DIR</span>\\n</code></pre></div><h2 id=\\"追記-20200319\\">追記 (2020/03/19)</h2>\\n<p><code>$SCRIPT_DIR</code>にフルパスを格納するなら以下の通り</p>\\n<pre><code>SCRIPT_DIR=$(cd $(dirname $0); pwd)\\ncd $SCRIPT_DIR\\n</code></pre>","contentSnippet":"前提\\nshell script内では、shell scriptを起動する前のカレントディレクトリが引き継がれる。\\n例えば、次のようなpwd.shを実行する。\\n#!/bin/sh\\npwd\\n\\n\\n次のように、shell scriptを呼び出す際のカレントディレクトリにより、shell scriptの挙動が変化する。\\n$ pwd\\n/Users/hoge\\n$ ls -F\\npwd.sh* dir/\\n$ sh pwd.sh\\n/Users/hoge\\n$ cd dir\\n$ sh ../pwd.sh\\n/Users/hoge/dir\\n\\n\\n解決策\\nshell scriptの前方に、2行追加する。\\n#!/bin/sh\\n# change directory to the shell file\'s directory\\nSCRIPT_DIR=`dirname $0`\\ncd $SCRIPT_DIR\\npwd\\n\\nこれにより、shell scriptを呼び出す際のカレントディレクトリに関わらず、shell scriptでのカレントディレクトリが、shell scriptが配置されたディレクトリに固定される。\\n$ pwd\\n/Users/hoge\\n$ ls -F\\npwd.sh* dir/\\n$ sh pwd.sh\\n/Users/hoge\\n$ cd dir\\n$ sh ../pwd.sh\\n/Users/hoge\\n\\n\\nその他の解決策\\nshell script内のpathを、\\"$HOME\\"などの変数を使って絶対パスで記載する。\\nまとめ\\n以下のテンプレートをshell scriptの先頭に追加すると良い。\\n#!/bin/sh\\nSCRIPT_DIR=`dirname $0`\\ncd $SCRIPT_DIR\\n\\n\\n追記 (2020/03/19)\\n$SCRIPT_DIRにフルパスを格納するなら以下の通り\\nSCRIPT_DIR=$(cd $(dirname $0); pwd)\\ncd $SCRIPT_DIR","guid":"https://memo.basd4g.net/posts/shell-pwd/","isoDate":"2020-03-16T13:23:27.000Z"},{"title":"Hexoによる静的サイトの構築","link":"https://memo.basd4g.net/posts/hexo/","pubDate":"Mon, 16 Mar 2020 09:09:00 +0900","content":"<h2 id=\\"hexoによる静的サイトの構築\\">Hexoによる静的サイトの構築</h2>\\n<p><a href=\\"https://hexo.io/\\"target=\\"_blank\\">Hexo</a>は、node.jsを使った静的サイトジェネレータ。</p>\\n<p>markdown形式の記事を静的サイトに簡単に公開できる。</p>\\n<h3 id=\\"hexoの導入\\">Hexoの導入</h3>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ npm install hexo-cli\\n$ npx hexo init ../memo.basd4g.net\\n$ <span class=\\"nb\\">cd</span> ../memo.basd4g.net\\n$ npm install\\n$ hexo server\\n<span class=\\"c1\\"># ローカルでサイトの確認</span>\\n</code></pre></div><h3 id=\\"hexoの設定について\\">Hexoの設定について</h3>\\n<p>設定は基本的に<code>_config.yml</code>に書き込む。</p>\\n<p>例えば、このサイトの<a href=\\"https://github.com/basd4g/memo.basd4g.net/blob/master/_config.yml\\"target=\\"_blank\\"><code>_config.yml</code></a>が一例。</p>\\n<h3 id=\\"テーマの導入\\">テーマの導入</h3>\\n<p>Hexoはサードパーティで公開された様々なテーマを導入できる。</p>\\n<p><a href=\\"https://hexo.io/themes/\\"target=\\"_blank\\">公式サイトのテーマ一覧</a>にあるように、様々なものが選べる。</p>\\n<p>今回は<a href=\\"https://github.com/aircloud/hexo-theme-aircloud\\"target=\\"_blank\\">air-cloud</a>を導入した。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ git clone https://github.com/aircloud/hexo-theme-aircloud.git theme/air-cloud\\n</code></pre></div><p>テーマ特有の設定は、<a href=\\"https://github.com/aircloud/hexo-aircloud-blog\\"target=\\"_blank\\">Demo</a>の<a href=\\"https://github.com/aircloud/hexo-aircloud-blog/blob/master/_config.yml\\"target=\\"_blank\\"><code>_config.yml</code></a>が参考になる。</p>\\n<h3 id=\\"特別なページの設置\\">特別なページの設置</h3>\\n<h4 id=\\"自己紹介ページの追加\\">自己紹介ページの追加</h4>\\n<pre><code>$ npx hexo new page about\\n</code></pre><p><code>source/about/index.md</code>を次の内容に編集する。</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-md\\" data-lang=\\"md\\">---\\nlayout: about\\ntitle: About Me\\ndate: &#34;2020-03-16 11:22:00&#34;\\n---\\n<span class=\\"gu\\">## About Me\\n</span><span class=\\"gu\\"></span>\\nbasd4gの雑多なメモ。\\n<span class=\\"k\\">-</span> twitter: [<span class=\\"nt\\">@basd4g</span>](<span class=\\"na\\">https://twitter.com/basd4g</span>)\\n<span class=\\"k\\">-</span> GitHub: [<span class=\\"nt\\">@basd4g</span>](<span class=\\"na\\">https://github.com/basd4g</span>)\\n<span class=\\"k\\">-</span> [<span class=\\"nt\\">blog</span>](<span class=\\"na\\">https://blog.yammer.fun</span>)\\n</code></pre></div><h4 id=\\"タグページの追加\\">タグページの追加</h4>\\n<p>次のコマンドで、tagページを作る</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ npx hexo new page <span class=\\"s2\\">&#34;tags&#34;</span>\\n</code></pre></div><p><code>source/tags/index.md</code>を次のように書き換える</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-md\\" data-lang=\\"md\\">---\\ntitle: All tags\\ntype: &#34;tags&#34;\\n---\\n</code></pre></div><h4 id=\\"検索機能の追加\\">検索機能の追加</h4>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-sh\\" data-lang=\\"sh\\">$ npm i hexo-generator-search --save\\n</code></pre></div><p><code>_config.yml</code>に次の内容を記載する</p>\\n<div class=\\"highlight\\"><pre class=\\"chroma\\"><code class=\\"language-_config.yml\\" data-lang=\\"_config.yml\\"><span class=\\"k\\">search</span><span class=\\"p\\">:</span><span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">path</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>search.json<span class=\\"w\\">\\n</span><span class=\\"w\\"> </span><span class=\\"k\\">field</span><span class=\\"p\\">:</span><span class=\\"w\\"> </span>post<span class=\\"w\\">\\n</span></code></pre></div>","contentSnippet":"Hexoによる静的サイトの構築\\nHexoは、node.jsを使った静的サイトジェネレータ。\\nmarkdown形式の記事を静的サイトに簡単に公開できる。\\nHexoの導入\\n$ npm install hexo-cli\\n$ npx hexo init ../memo.basd4g.net\\n$ cd ../memo.basd4g.net\\n$ npm install\\n$ hexo server\\n# ローカルでサイトの確認\\n\\n\\nHexoの設定について\\n設定は基本的に_config.ymlに書き込む。\\n例えば、このサイトの_config.ymlが一例。\\nテーマの導入\\nHexoはサードパーティで公開された様々なテーマを導入できる。\\n公式サイトのテーマ一覧にあるように、様々なものが選べる。\\n今回はair-cloudを導入した。\\n$ git clone https://github.com/aircloud/hexo-theme-aircloud.git theme/air-cloud\\n\\n\\nテーマ特有の設定は、Demoの_config.ymlが参考になる。\\n特別なページの設置\\n自己紹介ページの追加\\n$ npx hexo new page about\\n\\nsource/about/index.mdを次の内容に編集する。\\n---\\nlayout: about\\ntitle: About Me\\ndate: \\"2020-03-16 11:22:00\\"\\n---\\n## About Me\\n\\nbasd4gの雑多なメモ。\\n- twitter: [@basd4g](https://twitter.com/basd4g)\\n- GitHub: [@basd4g](https://github.com/basd4g)\\n- [blog](https://blog.yammer.fun)\\n\\n\\nタグページの追加\\n次のコマンドで、tagページを作る\\n$ npx hexo new page \\"tags\\"\\n\\n\\nsource/tags/index.mdを次のように書き換える\\n---\\ntitle: All tags\\ntype: \\"tags\\"\\n---\\n\\n\\n検索機能の追加\\n$ npm i hexo-generator-search --save\\n\\n\\n_config.ymlに次の内容を記載する\\nsearch:\\n path: search.json\\n field: post","guid":"https://memo.basd4g.net/posts/hexo/","isoDate":"2020-03-16T00:09:00.000Z"},{"title":"VirtualBoxでUSB機器を認識させる","link":"https://basd4g.hatenablog.com/entry/virtualBoxUSB","pubDate":"Thu, 12 Mar 2020 17:08:00 +0900","enclosure":{"url":"https://blob.basd4g.net/oracle-vm-virtualbox-manager.png","type":"image/png","length":"0"},"content":"<h2>前提</h2>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VirtualBox\\">VirtualBox</a>は、ホストマシンにつながったUSB機器をゲストOSで利用できる。\\nまた、ホスト側でドライバを用意しなくても、ゲストOS側でドライバを導入すれば利用できる。</p>\\n\\n<p>ただし、以下の手順を踏んでUSBデ<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%D0%A5%A4%A5%B9\\">バイス</a>を有効化する必要がある。</p>\\n\\n<p>ここでは、<a href=\\"https://www.amazon.co.jp/gp/product/B007SI18VW/ref=ppx_yo_dt_b_asin_title_o06_s00?ie=UTF8&amp;psc=1\\">USBシリアル変換ケーブル</a>を使ったシリアル通信機器を認識させることを目的として作業する。</p>\\n\\n<ul>\\n<li>ホストOS: <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/macOS\\">macOS</a> Mojave 10.14.6</li>\\n<li><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VirtualBox\\">VirtualBox</a>: 6.0.14 r133895 (Qt5.6.3)</li>\\n<li>ゲストOS: <a href=\\"https://app.vagrantup.com/bento/boxes/ubuntu-18.04\\">bento/ubuntu-18.04</a></li>\\n</ul>\\n\\n\\n<h2>作業</h2>\\n\\n<h3>1. Extension Packの導入</h3>\\n\\n<p>(2020/03/24追記: homebrew caskにて導入できることを確認しました。<code>$ brew cask install virtualbox-extension-pack</code>)</p>\\n\\n<p><a href=\\"https://www.virtualbox.org/wiki/Downloads\\">Download VirtualBox</a>から<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Oracle\\">Oracle</a> <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VM\\">VM</a> <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VirtualBox\\">VirtualBox</a> Extension Packをダウンロードする。</p>\\n\\n<p>最新版は、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VirtualBox\\">VirtualBox</a> x.x.x <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Oracle\\">Oracle</a> <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VM\\">VM</a> <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VirtualBox\\">VirtualBox</a> Extension Packの1行下のAll supported platformsがリンクになっている。\\nバージョンは自分のPCにインストールされている<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VirtualBox\\">VirtualBox</a>に合わせること。\\n違うバージョンのものはインストールに失敗する。</p>\\n\\n<p><a href=\\"https://www.virtualbox.org/wiki/Download_Old_Builds_6_0\\">VirtualBox6.0のDownloadページ</a>や<a href=\\"https://www.virtualbox.org/wiki/Download_Old_Builds_5_2\\">VirtualBox5.2のDownloadページ</a>から、各バージョンのExtension Packがダウンロードできる。\\n今回は6.0.14用のExtension Packをダウンロードした。</p>\\n\\n<p>ダウンロードしたファイルをダブルクリックすると、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VirtualBox\\">VirtualBox</a>のウィンドウが立ち上がりインストールが始まる。</p>\\n\\n<h3>2. USBデ<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%D0%A5%A4%A5%B9\\">バイス</a>フィルターに機器を追加</h3>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Oracle\\">Oracle</a> <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VM\\">VM</a> <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VirtualBox\\">VirtualBox</a>マネージャーを開き、目的の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VM\\">VM</a>にカーソルを合わせて右クリック -> 設定 を開く。</p>\\n\\n<p><img src=\\"https://blob.basd4g.net/oracle-vm-virtualbox-manager.png\\" alt=\\"Oracle VM VirtualBoxマネージャー\\" /></p>\\n\\n<p>ポート -> USB を開く</p>\\n\\n<p>USBコントローラを有効化にチェックを入れる。</p>\\n\\n<p>USBデ<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%D0%A5%A4%A5%B9\\">バイス</a>フィルター -> 右横の+アイコンをクリック -> 目的のデ<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%D0%A5%A4%A5%B9\\">バイス</a>を選択する。</p>\\n\\n<p><img src=\\"usb-device-filter.png\\" alt=\\"USBデバイスフィルター\\" /></p>\\n\\n<h3>3. <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/VM\\">VM</a>を起動(再起動)する</h3>\\n","contentSnippet":"前提\\nVirtualBoxは、ホストマシンにつながったUSB機器をゲストOSで利用できる。\\nまた、ホスト側でドライバを用意しなくても、ゲストOS側でドライバを導入すれば利用できる。\\nただし、以下の手順を踏んでUSBデバイスを有効化する必要がある。\\nここでは、USBシリアル変換ケーブルを使ったシリアル通信機器を認識させることを目的として作業する。\\nホストOS: macOS Mojave 10.14.6\\nVirtualBox: 6.0.14 r133895 (Qt5.6.3)\\nゲストOS: bento/ubuntu-18.04\\n作業\\n1. Extension Packの導入\\n(2020/03/24追記: homebrew caskにて導入できることを確認しました。$ brew cask install virtualbox-extension-pack)\\nDownload VirtualBoxからOracle VM VirtualBox Extension Packをダウンロードする。\\n最新版は、VirtualBox x.x.x Oracle VM VirtualBox Extension Packの1行下のAll supported platformsがリンクになっている。\\nバージョンは自分のPCにインストールされているVirtualBoxに合わせること。\\n違うバージョンのものはインストールに失敗する。\\nVirtualBox6.0のDownloadページやVirtualBox5.2のDownloadページから、各バージョンのExtension Packがダウンロードできる。\\n今回は6.0.14用のExtension Packをダウンロードした。\\nダウンロードしたファイルをダブルクリックすると、VirtualBoxのウィンドウが立ち上がりインストールが始まる。\\n2. USBデバイスフィルターに機器を追加\\nOracle VM VirtualBoxマネージャーを開き、目的のVMにカーソルを合わせて右クリック -> 設定 を開く。\\n\\nポート -> USB を開く\\nUSBコントローラを有効化にチェックを入れる。\\nUSBデバイスフィルター -> 右横の+アイコンをクリック -> 目的のデバイスを選択する。\\n\\n3. VMを起動(再起動)する","guid":"hatenablog://entry/26006613576772429","isoDate":"2020-03-12T08:08:00.000Z"},{"title":"Javascriptにおける、forとforEachの比較","link":"https://basd4g.hatenablog.com/entry/forAndForEachWithJavascript","pubDate":"Tue, 14 Jan 2020 18:23:00 +0900","enclosure":{"url":"https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png","type":"image/png","length":"0"},"content":"<p>知人に質問された内容への回答を兼ねて、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Javascript\\">Javascript</a>における繰り返し文の記法を振り返る。</p>\\n\\n<p>この記事では、同じ結果を出力する繰り返し文を、次の２つの文法で記述し比較する。\\n- <a href=\\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/for\\">for文</a>\\n- <a href=\\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach\\">forEach()メソッド</a></p>\\n\\n<p>他の記法には言及しない。</p>\\n\\n<h2>配列の要素を出力する</h2>\\n\\n<p>for文と同様に、forEach()メソッドも繰り返し処理をすることができる。</p>\\n\\n<p>しかし記述方法は異なり、forEach()は配列のメソッドである。\\n引数にはコールバック関数(今回はitemを引数とするアロー関数)を渡す。</p>\\n\\n<p>渡されたコールバック関数を配列の各要素に対し実行することで、繰り返し処理が実現できる。</p>\\n\\n<pre class=\\"code js\\" data-lang=\\"js\\" data-unlink>// for文で要素を羅列\\nconst items = [ &#34;hello&#34;, 32, true ];\\n\\nfor( let i=0; i&lt; items.length; i++ ){\\n  console.log( items[i] );\\n}</pre>\\n\\n\\n\\n\\n<pre class=\\"code js\\" data-lang=\\"js\\" data-unlink>// forEach()メソッドで要素を羅列\\nconst items = [ &#34;hello&#34;, 32, true ];\\n\\nitems.forEach( item =&gt; {\\n  console.log(item);\\n});</pre>\\n\\n\\n<p>上記２つの実行結果は一致し、以下を出力する。</p>\\n\\n<pre class=\\"code\\" data-lang=\\"\\" data-unlink>hello\\n32\\ntrue</pre>\\n\\n\\n<h2>配列の添字と配列の要素を出力する</h2>\\n\\n<p>forEach()メソッドにわたすコールバック関数で、配列の要素だけでなく添字も受け取る方法を示す。</p>\\n\\n<pre class=\\"code js\\" data-lang=\\"js\\" data-unlink>const items = [ &#34;hello&#34;, 32, true ];\\n\\nfor( let i=0; i&lt;items.length; i++ ){\\n  console.log(`${i} : ${items[i]}`);\\n}</pre>\\n\\n\\n\\n\\n<pre class=\\"code js\\" data-lang=\\"js\\" data-unlink>const items = [ &#34;hello&#34;, 32, true ];\\n\\nitems.forEach( (item, index) =&gt; {\\n  console.log(`${index} : ${item}`);\\n})</pre>\\n\\n\\n<p>上記２つの実行結果は一致し、以下を出力する。</p>\\n\\n<pre class=\\"code\\" data-lang=\\"\\" data-unlink>0 : hello\\n1 : 32\\n2 : true</pre>\\n\\n\\n<p>上記のように、forEach()メソッドに渡すコールバック関数の、第一引数は配列の要素、第二引数は配列の添字を受け取るようになっている。</p>\\n\\n<p>補足: console.log内で定義している文字列は<a href=\\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/template_strings\\">テンプレートリテラル</a>を利用し、変数の値を埋め込んだ文字列をつくっている。</p>\\n\\n<h2>まとめ</h2>\\n\\n<p>for文もforEach()メソッドも繰り返し処理を表記できるが、forEach()メソッドのほうが簡潔に表記できるので、ES6が認められる環境であれば、forEach()メソッドを使うのが好ましい。</p>\\n\\n<p>ちなみに、forEach()メソッドだけでなく、filter()メソッドやfind()メソッド、map()メソッド等が使える場合は、こちらのほうが更に簡潔に書けるため好ましい。</p>\\n\\n<p>その他、<a href=\\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/for...in\\">for...in</a>文や<a href=\\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/for...of\\">for...of</a>文もあるが、ここでは言及しない。</p>\\n\\n<h2>参照</h2>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9\\">ソースコード</a>をおいてあるgist<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA\\">リポジトリ</a>: <a href=\\"https://gist.github.com/basd4g/546dd9e378f93f6c24b8c8abab6fe187\\">https://gist.github.com/basd4g/546dd9e378f93f6c24b8c8abab6fe187</a></p>\\n","contentSnippet":"知人に質問された内容への回答を兼ねて、Javascriptにおける繰り返し文の記法を振り返る。\\nこの記事では、同じ結果を出力する繰り返し文を、次の２つの文法で記述し比較する。\\n- for文\\n- forEach()メソッド\\n他の記法には言及しない。\\n配列の要素を出力する\\nfor文と同様に、forEach()メソッドも繰り返し処理をすることができる。\\nしかし記述方法は異なり、forEach()は配列のメソッドである。\\n引数にはコールバック関数(今回はitemを引数とするアロー関数)を渡す。\\n渡されたコールバック関数を配列の各要素に対し実行することで、繰り返し処理が実現できる。\\n// for文で要素を羅列\\nconst items = [ \\"hello\\", 32, true ];\\n\\nfor( let i=0; i< items.length; i++ ){\\n  console.log( items[i] );\\n}\\n// forEach()メソッドで要素を羅列\\nconst items = [ \\"hello\\", 32, true ];\\n\\nitems.forEach( item => {\\n  console.log(item);\\n});\\n上記２つの実行結果は一致し、以下を出力する。\\nhello\\n32\\ntrue\\n配列の添字と配列の要素を出力する\\nforEach()メソッドにわたすコールバック関数で、配列の要素だけでなく添字も受け取る方法を示す。\\nconst items = [ \\"hello\\", 32, true ];\\n\\nfor( let i=0; i<items.length; i++ ){\\n  console.log(`${i} : ${items[i]}`);\\n}\\nconst items = [ \\"hello\\", 32, true ];\\n\\nitems.forEach( (item, index) => {\\n  console.log(`${index} : ${item}`);\\n})\\n上記２つの実行結果は一致し、以下を出力する。\\n0 : hello\\n1 : 32\\n2 : true\\n上記のように、forEach()メソッドに渡すコールバック関数の、第一引数は配列の要素、第二引数は配列の添字を受け取るようになっている。\\n補足: console.log内で定義している文字列はテンプレートリテラルを利用し、変数の値を埋め込んだ文字列をつくっている。\\nまとめ\\nfor文もforEach()メソッドも繰り返し処理を表記できるが、forEach()メソッドのほうが簡潔に表記できるので、ES6が認められる環境であれば、forEach()メソッドを使うのが好ましい。\\nちなみに、forEach()メソッドだけでなく、filter()メソッドやfind()メソッド、map()メソッド等が使える場合は、こちらのほうが更に簡潔に書けるため好ましい。\\nその他、for...in文やfor...of文もあるが、ここでは言及しない。\\n参照\\nソースコードをおいてあるgistリポジトリ: https://gist.github.com/basd4g/546dd9e378f93f6c24b8c8abab6fe187","guid":"hatenablog://entry/26006613576772421","categories":["javascript","es6"],"isoDate":"2020-01-14T09:23:00.000Z"},{"title":"mixi git challenge 12に参加した","link":"https://basd4g.hatenablog.com/entry/mixiGitChallenge","pubDate":"Wed, 20 Nov 2019 19:40:00 +0900","enclosure":{"url":"https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png","type":"image/png","length":"0"},"content":"<p>2019/10/26、株式会社<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%DF%A5%AF%A5%B7%A5%A3\\">ミクシィ</a>の主催する <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/mixi\\">mixi</a> git challenge #12 に参加した。</p>\\n\\n<h2>株式会社ミクシイ</h2>\\n\\n<p>皆さんご存知、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/SNS\\">SNS</a>の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/mixi\\">mixi</a>やモンストを提供しているインターネット企業。\\n「コミュニケーション」を軸に様々な事業を展開している。</p>\\n\\n<h2><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/mixi\\">mixi</a> git challenge</h2>\\n\\n<p>株式会社<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%DF%A5%AF%A5%B7%A5%A3\\">ミクシィ</a>が主催する、学生向けのgitを使ったコンテスト。\\n当日出会った人と2人でチームを組み、gitに関する問題を解く。</p>\\n\\n<p>3時間半ほどの競技時間の中で、問題を起こした<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA\\">リポジトリ</a>の数々が提供され、それを調査、復旧する。\\n問題を解くと難易度に応じたポイントを獲得でき、時間内に最も多くポイントを獲得することを競う。</p>\\n\\n<p>2015年から開催しているようで、今回で第12回であった。</p>\\n\\n<h2>当日の流れ</h2>\\n\\n<p>午前中は</p>\\n\\n<ul>\\n<li><a href=\\"https://github.com/mixi-git-challenge/git-challenge-tutorial\\">git challenge チュートリアル</a></li>\\n<li><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%DF%A5%AF%A5%B7%A5%A3\\">ミクシィ</a>社員さんからのLT2本(gitクライアントの<a href=\\"https://github.com/jonas/tig\\">Tig</a>について)(社内のモバイルチームでのCI/CD活用)</li>\\n</ul>\\n\\n\\n<p>だった。</p>\\n\\n<p>お昼を挟んで競技開始。競技内容は公開できないが、過去問題が公開されているのでどんなことをするのかは以下が参考になる。</p>\\n\\n<ul>\\n<li><a href=\\"https://alpha.mixi.co.jp/entry/2015/11/24/083300\\">第1回git challengeの出題内容を一部公開します</a></li>\\n<li><a href=\\"https://github.com/mixi-git-challenge/git-challenge-is-order-an-adding\\">問題: なぜか新しいファイルを追加できないリポジトリ（難易度: EASY）</a></li>\\n<li><a href=\\"https://github.com/mixi-git-challenge/git-challenge-minesweeper\\">問題: Minesweeper（難易度: NORMAL）</a></li>\\n</ul>\\n\\n\\n<p>難易度ごとの問題を簡単なものから解いていった。チームメンバーと一緒に考えたり、分担したりを適宜組み合わせて進めた。<br />\\n前半はそこそこのペースで進めたものの、競技後半は得点が伸びず勝利することは出来なかった。</p>\\n\\n<p>3.5-4時間ほどの競技時間の後、解説、<a href=\\"https://github.com/shumon84/GitQuiz\\">gitに関するクイズ</a>、そして懇親会が行われた。\\n疲れたあとのご飯は美味しい(小並感)。</p>\\n\\n<h2>参加しての感想</h2>\\n\\n<p>gitはとても奥が深い。\\n今までgitの一部分しか使っていなかったことを痛感した。沢山の学びを得ることが出来たので、これからもっとgitを知ろうと思う。</p>\\n\\n<p>ちなみに、翌日自分の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA\\">リポジトリ</a>で、git challengeで学んだコマンドを用いてdangling commitを復旧しなければならない事態が訪れた。早速バリューが出ている。(自分が悪い)</p>\\n\\n<h2>学び</h2>\\n\\n<p>(問題の公開を避けるため詳細は省くが、)問題からgitを使った様々なトラブルの対処や便利な使い方を知ることが出来た。</p>\\n\\n<p>Pro Gitという書籍の翻訳版が無料で公開されており、gitについての理解が深まると思うので、これから参加する方は是非参考にしてほしい。</p>\\n\\n<p><a href=\\"https://git-scm.com/book/ja/v2\\">Pro Git book</a></p>\\n\\n<h2>参考</h2>\\n\\n<p>他参加者のブログ</p>\\n\\n<ul>\\n<li><a href=\\"https://blog.koffein.dev/git-challenge-12/\\">git challenge #12に参加しました - カフェイン中毒</a></li>\\n<li><a href=\\"https://chouxcreams.hatenablog.com/entry/2019/10/29/011636\\">git challenge#12に参加してきた - chouxcreamsのブログ</a></li>\\n<li><a href=\\"https://dionomusuko.hatenablog.com/entry/2019/11/03/022344\\">mixi git challenge #12 に参加してきました。 - dionomusukoのブログ</a></li>\\n</ul>\\n\\n","contentSnippet":"2019/10/26、株式会社ミクシィの主催する mixi git challenge #12 に参加した。\\n株式会社ミクシイ\\n皆さんご存知、SNSのmixiやモンストを提供しているインターネット企業。\\n「コミュニケーション」を軸に様々な事業を展開している。\\nmixi git challenge\\n株式会社ミクシィが主催する、学生向けのgitを使ったコンテスト。\\n当日出会った人と2人でチームを組み、gitに関する問題を解く。\\n3時間半ほどの競技時間の中で、問題を起こしたリポジトリの数々が提供され、それを調査、復旧する。\\n問題を解くと難易度に応じたポイントを獲得でき、時間内に最も多くポイントを獲得することを競う。\\n2015年から開催しているようで、今回で第12回であった。\\n当日の流れ\\n午前中は\\ngit challenge チュートリアル\\nミクシィ社員さんからのLT2本(gitクライアントのTigについて)(社内のモバイルチームでのCI/CD活用)\\nだった。\\nお昼を挟んで競技開始。競技内容は公開できないが、過去問題が公開されているのでどんなことをするのかは以下が参考になる。\\n第1回git challengeの出題内容を一部公開します\\n問題: なぜか新しいファイルを追加できないリポジトリ（難易度: EASY）\\n問題: Minesweeper（難易度: NORMAL）\\n難易度ごとの問題を簡単なものから解いていった。チームメンバーと一緒に考えたり、分担したりを適宜組み合わせて進めた。\\n3.5-4時間ほどの競技時間の後、解説、gitに関するクイズ、そして懇親会が行われた。\\n疲れたあとのご飯は美味しい(小並感)。\\n参加しての感想\\ngitはとても奥が深い。\\n今までgitの一部分しか使っていなかったことを痛感した。沢山の学びを得ることが出来たので、これからもっとgitを知ろうと思う。\\nちなみに、翌日自分のリポジトリで、git challengeで学んだコマンドを用いてdangling commitを復旧しなければならない事態が訪れた。早速バリューが出ている。(自分が悪い)\\n学び\\n(問題の公開を避けるため詳細は省くが、)問題からgitを使った様々なトラブルの対処や便利な使い方を知ることが出来た。\\nPro Gitという書籍の翻訳版が無料で公開されており、gitについての理解が深まると思うので、これから参加する方は是非参考にしてほしい。\\nPro Git book\\n参考\\n他参加者のブログ\\ngit challenge #12に参加しました - カフェイン中毒\\ngit challenge#12に参加してきた - chouxcreamsのブログ\\nmixi git challenge #12 に参加してきました。 - dionomusukoのブログ","guid":"hatenablog://entry/26006613576772426","categories":["mixi","git"],"isoDate":"2019-11-20T10:40:00.000Z"},{"title":"TypeScriptでprivate methodを外部から呼ぶ","link":"https://basd4g.hatenablog.com/entry/privateMethodTest","pubDate":"Thu, 17 Oct 2019 11:50:00 +0900","enclosure":{"url":"https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png","type":"image/png","length":"0"},"content":"<p>題名通りの話。</p>\\n\\n<p>TypeScriptにてprivate methodを<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%C3%B1%C2%CE%A5%C6%A5%B9%A5%C8\\">単体テスト</a>するとき、直接呼べないので困ることがある。\\nprivate methodを外部から呼べないのは正しいふるまいだが、テストプログラム側からも呼べないのは不便だ。裏技的ではあるが、TypeScriptの制限を回避して呼ぶ方法があるので紹介する。</p>\\n\\n<h2>前提 TypeScriptのprivate</h2>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/JavaScript\\">JavaScript</a>(ES6~)では、class記法が使える。<br />\\nTypeScriptではclass記法で書かれたmethodにprivate修飾子をつけることが出来る。\\nprivate修飾子をつけると、同じクラス内<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A4%AB%A4%E9%A4%B7\\">からし</a>かmethodを呼べない。</p>\\n\\n<p>具体的な記法は下の例を参照のこと。</p>\\n\\n<h2>解決策</h2>\\n\\n<p>TypeScriptのprivate修飾子によるアクセス制限を回避する方法は2つある。</p>\\n\\n<p><code>hogeClass.privateMethod()</code>だと呼べないときを例に取ると</p>\\n\\n<h3>1. <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/brackets\\">brackets</a>記法</h3>\\n\\n<p><code>hogeClass[\'privateMethod\']()</code>と呼ぶ。</p>\\n\\n<h3>2. クラスをanyでキャストする</h3>\\n\\n<p><code>;(hogeClass as any).privateMethod()</code>と呼ぶ。</p>\\n\\n<p>前文との間に<code>;</code>を入れないとエラーを出すので注意。</p>\\n\\n<h2>例</h2>\\n\\n<pre class=\\"code ts\\" data-lang=\\"ts\\" data-unlink>// TypeScript v3.5.3\\n\\nclass HogeClass {\\n\\n  private privateMethod (): void {\\n    console.log(&#34;private method&#34;)\\n  }\\n\\n  public publicMethod ():void {\\n    console.log(&#39;public method&#39;)\\n\\n    //呼べる\\n    this.privateMethod()\\n  }\\n}\\n\\nconst hogeClass = new HogeClass()\\n\\n// 呼べる\\nhogeClass.publicMethod()\\n\\n// 呼べない コンパイルエラー\\n// hogeClass.privateMethod()\\n\\n// 呼べる\\nhogeClass[&#39;privateMethod&#39;]()\\n\\n// 呼べる セミコロンが必要\\n;(hogeClass as any).publicMethod()</pre>\\n\\n\\n<h2>注意</h2>\\n\\n<p>TypeScriptの制限をすり抜けるということは、methodが存在するかどうか評価されないので、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/typo\\">typo</a>したり存在しないmethodを呼ぶ危険性がある。</p>\\n\\n<p>テストで使うのは仕方ないかもしれないけれど、基本はあまり使うべきではなさそう。</p>\\n\\n<h2>感想</h2>\\n\\n<p>anyでキャストして呼べるのはまだいいとして、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/brackets\\">brackets</a>記法で呼べてしまうのは裏技感がすごい。\\n最近TypeScriptに入門したが、型があるのはありがたいといっても、意外と実行時にこのような抜けがあると感じてしまうことがあったり。</p>\\n\\n<p>まぁjsやからな。</p>\\n\\n<h2>参考</h2>\\n\\n<ul>\\n<li><a href=\\"qiita.com/hitochan777/items/f68e77f13becd24e2691\\">Typescriptでprivateメソッドをテストする</a></li>\\n</ul>\\n\\n","contentSnippet":"題名通りの話。\\nTypeScriptにてprivate methodを単体テストするとき、直接呼べないので困ることがある。\\nprivate methodを外部から呼べないのは正しいふるまいだが、テストプログラム側からも呼べないのは不便だ。裏技的ではあるが、TypeScriptの制限を回避して呼ぶ方法があるので紹介する。\\n前提 TypeScriptのprivate\\nJavaScript(ES6~)では、class記法が使える。\\nからしかmethodを呼べない。\\n具体的な記法は下の例を参照のこと。\\n解決策\\nTypeScriptのprivate修飾子によるアクセス制限を回避する方法は2つある。\\nhogeClass.privateMethod()だと呼べないときを例に取ると\\n1. brackets記法\\nhogeClass[\'privateMethod\']()と呼ぶ。\\n2. クラスをanyでキャストする\\n;(hogeClass as any).privateMethod()と呼ぶ。\\n前文との間に;を入れないとエラーを出すので注意。\\n例\\n\\n// TypeScript v3.5.3\\n\\nclass HogeClass {\\n\\n  private privateMethod (): void {\\n    console.log(\\"private method\\")\\n  }\\n\\n  public publicMethod ():void {\\n    console.log(\'public method\')\\n\\n    //呼べる\\n    this.privateMethod()\\n  }\\n}\\n\\nconst hogeClass = new HogeClass()\\n\\n// 呼べる\\nhogeClass.publicMethod()\\n\\n// 呼べない コンパイルエラー\\n// hogeClass.privateMethod()\\n\\n// 呼べる\\nhogeClass[\'privateMethod\']()\\n\\n// 呼べる セミコロンが必要\\n;(hogeClass as any).publicMethod()\\n注意\\nTypeScriptの制限をすり抜けるということは、methodが存在するかどうか評価されないので、typoしたり存在しないmethodを呼ぶ危険性がある。\\nテストで使うのは仕方ないかもしれないけれど、基本はあまり使うべきではなさそう。\\n感想\\nanyでキャストして呼べるのはまだいいとして、brackets記法で呼べてしまうのは裏技感がすごい。\\n最近TypeScriptに入門したが、型があるのはありがたいといっても、意外と実行時にこのような抜けがあると感じてしまうことがあったり。\\nまぁjsやからな。\\n参考\\nTypescriptでprivateメソッドをテストする","guid":"hatenablog://entry/26006613576772420","categories":["TypeScript","JavaScript","テスト"],"isoDate":"2019-10-17T02:50:00.000Z"},{"title":"GMOペパボのインターンシップに参加した","link":"https://basd4g.hatenablog.com/entry/GMOpepaboInternship","pubDate":"Wed, 16 Oct 2019 10:51:00 +0900","enclosure":{"url":"https://blob.basd4g.net/pepabo-intern6.jpg","type":"image/jpeg","length":"0"},"content":"<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GMO%A5%DA%A5%D1%A5%DC\\">GMOペパボ</a>株式会社(以下ペパボと表記させていただく) 福岡オフィスの2019年 夏<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>に参加した。<br />\\n2019/8/21から2019/8/30の平日8日間、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%E0%A1%BC%A5%E0%A1%BC%A5%C9%A5%E1%A5%A4%A5%F3\\">ムームードメイン</a>チームのフロントエンドエンジニアとして開発させていただいたので、その記録である。</p>\\n\\n<p><img src=\\"https://blob.basd4g.net/pepabo-intern6.jpg\\" alt=\\"ペパボ福岡オフィスの入り口\\" />\\n↑オフィスの入口。</p>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>最終日にパートナーさん<a id=\\"annotation-from-1\\" href=\\"#annotation-to-1\\">^1</a>の前で成果発表会をしたのだが、話しきれなかった部分もあるのでそれを消化する意味もある。\\n長文失礼したい。</p>\\n\\n<h2>ペパボと<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%E0%A1%BC%A5%E0%A1%BC%A5%C9%A5%E1%A5%A4%A5%F3\\">ムームードメイン</a></h2>\\n\\n<h3>ペパボとは</h3>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GMO%A5%DA%A5%D1%A5%DC\\">GMOペパボ</a>株式会社は東京・福岡・鹿児島にオフィスを構える<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GMO\\">GMO</a>グループの企業の一つ。「インターネットで可能性をつなげる、ひろげる」をミッションに、インターネットで個人の表現活動をする人を支援するサービスを展開している。\\n<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%BF%A5%EB%A5%B5%A1%BC%A5%D0\\">レンタルサーバ</a>ー「<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%ED%A5%EA%A5%DD%A5%C3%A5%D7\\">ロリポップ</a>」、ハンドメイドマーケット「minne」等のサービスがある。</p>\\n\\n<p>丁度<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>期間中に企業紹介動画<a id=\\"annotation-from-2\\" href=\\"#annotation-to-2\\">^2</a>が公開された。( <a href=\\"https://twitter.com/achamixx/status/1167253538595954688\\">別ver</a>もある。)</p>\\n\\n<iframe width=\\"560\\" height=\\"315\\" src=\\"https://www.youtube.com/embed/ANXs_ZdQtt4\\" frameborder=\\"0\\" allow=\\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\\" allowfullscreen></iframe>\\n\\n\\n<p>ちなみに私は<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>でDiscover New Something<a id=\\"annotation-from-3\\" href=\\"#annotation-to-3\\">^3</a>した。</p>\\n\\n<p>福岡オフィスでは<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%DB%A5%B9%A5%C6%A5%A3%A5%F3%A5%B0\\">ホスティング</a>系サービスの開発を行っていて、今回はその中の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%E0%A1%BC%A5%E0%A1%BC%A5%C9%A5%E1%A5%A4%A5%F3\\">ムームードメイン</a>チームに参加させていただいた。</p>\\n\\n<h3><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%E0%A1%BC%A5%E0%A1%BC%A5%C9%A5%E1%A5%A4%A5%F3\\">ムームードメイン</a>とは</h3>\\n\\n<p><a href=\\"https://muumuu-domain.com\\">ムームードメイン</a>とは、インターネットの<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%C6%C8%BC%AB%A5%C9%A5%E1%A5%A4%A5%F3\\">独自ドメイン</a>取得サービスとしてペパボの中でも古くから続いているサービスの一つ。私も利用している。</p>\\n\\n<h2><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>でしたこと</h2>\\n\\n<p>Nuxt.jsで作られているページへの機能追加を行った。</p>\\n\\n<p><a href=\\"https://muumuu-domain.com/domain/price\\">ドメインの価格一覧ページ</a>に価格によるソート機能を追加した。\\n<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3\\">ドメイン</a>一覧表のヘッダ箇所にボタンが追加され、昇順・降順ソートが出来るようになった。</p>\\n\\n<blockquote class=\\"twitter-tweet\\"><p lang=\\"ja\\" dir=\\"ltr\\">価格一覧の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3\\">ドメイン</a>を新規取得、更新、移管の価格順に並び替えることができるようになりました。ご予算に合った<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3\\">ドメイン</a>を見つけやすくなります。<a href=\\"https://t.co/QL670SQXx0\\">https://t.co/QL670SQXx0</a> <a href=\\"https://t.co/wLcWnas2Cm\\">pic.twitter.com/wLcWnas2Cm</a></p>&mdash; <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%E0%A1%BC%A5%E0%A1%BC%A5%C9%A5%E1%A5%A4%A5%F3\\">ムームードメイン</a> (@muumuu_domain) <a href=\\"https://twitter.com/muumuu_domain/status/1169492805137256449?ref_src=twsrc%5Etfw\\">September 5, 2019</a></blockquote>\\n\\n\\n<p> <script async src=\\"https://platform.twitter.com/widgets.js\\" charset=\\"utf-8\\"><\/script></p>\\n\\n<p>他の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3\\">インターン</a>参加者は次のようなことをやっていたようだ。各々のスキルに合わせて、チームに配属され実際の業務に加わる形式で<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>が進む。</p>\\n\\n<ul>\\n<li>研究所でデータ解析</li>\\n<li>CIツール周りをごにょごにょ</li>\\n<li><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Web%A5%B5%A1%BC%A5%D3%A5%B9\\">Webサービス</a>に機能追加</li>\\n<li><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/API\\">API</a>を書く</li>\\n</ul>\\n\\n\\n<h2>学んだこと - 技術の話</h2>\\n\\n<h3>コードリーディング</h3>\\n\\n<p>今回の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>では新たなページの追加ではなく既存ページへの機能追加を行ったことから、既に完成している<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3\\">ドメイン</a>の価格を表示するロジックに手を加えることになった。\\n既存の実装の意図を汲みながら、他ページへの影響を与えないよう設計することに注意した。</p>\\n\\n<p>コードを呼んでロジックとデータの流れを追うことは、経験が少なかったので新鮮だった。コードを読むのは面白かったが、実装の意図を汲むのは結構難しかった。似たような機能を持つ<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/OSS\\">OSS</a>ライブラリも見てみたりしながら設計を固めた。</p>\\n\\n<p><img src=\\"https://blob.basd4g.net/pepabo-intern7.jpg\\" alt=\\"名言\\" />\\n↑かの有名なお言葉。</p>\\n\\n<h3>実際に動いているサービス</h3>\\n\\n<p>サービスの規模感、エンジニアや関わる人の人数、サーバーの構成や使用されている技術スタックを知れた。1つのサービスを俯瞰して、どのように動いているのかを学べたのは貴重な経験である。</p>\\n\\n<p>またデザイナーさんとの分業の仕方やディレクターさんとの仕様の確認など、チームとしてサービスを支えている姿をみることができ、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>の中で経験することもできた。</p>\\n\\n<h3>issueとPullRequest</h3>\\n\\n<p>恥ずかしながらチーム開発を今夏まで経験してこなかったので、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GitHub\\">GitHub</a>のissueとPullreqを使う機会がなかった。\\nソフトウェアの実装に関する相談やまとめ、記録としても非常に有用で期間中たくさんお世話になった。</p>\\n\\n<p>コードレビューは学ぶことがとても多く、これからの私のコードにたくさん取り入れていきたい。(既に恩恵を享受している。)</p>\\n\\n<p>PullRequestを出す際に参考にしたいのがこちら↓。私が出したプルリクがこれにどこまで沿えていたかはおいておいて(笑)、自戒の念としても今後の参考のためにも残しておく。\\n特に私のようなプルリク歴の浅い方にお勧めしたい。</p>\\n\\n<script async class=\\"speakerdeck-embed\\" data-id=\\"5ea4a551f0334f888cbb13ab81b8f860\\" data-ratio=\\"1.77777777777778\\" src=\\"//speakerdeck.com/assets/embed.js\\"><\/script>\\n\\n\\n<p>\\n<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%BB%B2%BE%C8%B8%B5\\">参照元</a>: <a href=\\"https://kimromi.github.io/2017-08-31/pull-request.html\\">ぼくのかんがえたさいきょうのPullRequest</a></p>\\n\\n<h3>テスト</h3>\\n\\n<p>個人で開発しているとテストを書くという発想に至らず、今までテストを書いてこなかった。そのため、今回の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>でテストを書いたのもとても良い経験だった。\\nVue<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%DD%A1%BC%A5%CD%A5%F3%A5%C8\\">コンポーネント</a>を自在に手のひらで転がせるよう、転がれ転がれと念じながら過ごした(嘘)。</p>\\n\\n<p>テストを書くといいことが沢山ある。他人のためになるだけでなく、既存の実装や構造を振り返るいい機会にもなるし、自分がのちに実装するときに恩恵(正しい動作を保証できる<a id=\\"annotation-from-4\\" href=\\"#annotation-to-4\\">^4</a>)を享受できる(した)。</p>\\n\\n<h2>感じたこと - ペパボの話</h2>\\n\\n<p>ペパボは次の<a href=\\"https://recruit.pepabo.com/info/important/\\">「わたしたちが大切にしている3つのこと」</a>を掲げている。</p>\\n\\n<ul>\\n<li>みんなと仲良くすること</li>\\n<li>ファンを増やすこと</li>\\n<li>アウトプットすること</li>\\n</ul>\\n\\n\\n<p>パートナー皆さんにこれが浸透していて、日々実践されているのを感じた。</p>\\n\\n<h3>みんなと仲良くすること</h3>\\n\\n<p>まずパートナーさんが優しい。<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3\\">インターン</a>生に対してだけでなく、職種やチームの壁を超えてそれぞれが仲が良い、(いい距離感だ)と感じた。\\n<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>期間中、私を<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3\\">インターン</a>生と知らないパートナーさんが声をかけてくださってお話したり、社内のシニアエンジニアの方に実装について聞いたり、いろんなパートナーさんと接する機会があったがどの方も親切だった。</p>\\n\\n<p><img src=\\"https://blob.basd4g.net/pepabo-intern2.jpg\\" alt=\\"づっきーさんと私\\" /><br />\\n↑サポーターのづっきーさんに助けられている姿。づっきーさんにも沢山仲良くしていただいた。そして沢山助けけていただいた。</p>\\n\\n<h3>ファンを増やすこと</h3>\\n\\n<p>会社やサービスを好きな人が多い。(観測範囲において。) しかし会社に魅力があるだけでなく、パートナーさんにファンになってしまうような惹きつける力がある。これこそ「ファンを増やすこと」を実践されている姿だと感じた。</p>\\n\\n<p><img src=\\"https://blob.basd4g.net/pepabo-intern4.jpg\\" alt=\\"スリスリくん\\" /><br />\\n↑<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3\\">インターン</a>生が貰えるsuzuri<a id=\\"annotation-from-5\\" href=\\"#annotation-to-5\\">^5</a>のキャ<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%E9%A5%AF\\">ラク</a>ター「スリスリくん」のぬいぐるみ。非売品でパートナーさんも簡単には手に入れられないらしい。</p>\\n\\n<h3>アウトプットすること</h3>\\n\\n<p>開発で<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GitHub\\">GitHub</a> Enterpriseを利用しており、issueやPullreqもアウトプットの形だと思う。\\nそこに過去の経緯が残されていることで、今回も開発の資料としてとても参考になった。</p>\\n\\n<p>その他<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>中に紹介された参考資料がパートナーさんが社外に公開したスライドであったことや(<a href=\\"#issue%E3%81%A8PullRequest\\">先程のさいきょうのPullReq</a>もその一つ)、パートナーの方が登壇する技術イベントに参加させていただいたこと等、アウトプットされているのを肌に感じた。</p>\\n\\n<p>LT経験の浅い私のためにLTの機会を増やして頂き、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>期間中に合わせて3回発表をした。issueもPullreqも書いたし、私もパートナーさんを見習ってもっとアウトプットしていきたい。</p>\\n\\n<h2>感じたこと - 福岡の話</h2>\\n\\n<p>人生初の九州上陸だったが、福岡は住みやすそうな街だった。</p>\\n\\n<h3><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%AF%A5%C8%A5%B7%A5%C6%A5%A3\\">コンパクトシティ</a></h3>\\n\\n<p>空港から街が近い、というよりも街に空港があるので移動が楽。(成田空港、お前のことだぞ。<a id=\\"annotation-from-6\\" href=\\"#annotation-to-6\\">^6</a>)</p>\\n\\n<h3>食べ物が美味しい</h3>\\n\\n<p>ペパボの福岡<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>で、日報にご飯が美味かったと書かれるのはあるあるらしい。もちろん私も書いた。\\n一つ一つ紹介しているとそれだけで記事になってしまうので、写真でまとめて振り返る。</p>\\n\\n<p><img src=\\"https://blob.basd4g.net/pepabo-intern5.jpg\\" alt=\\"福岡で食べたおいしいもの\\" /></p>\\n\\n<p>帰りに空港でお土産をみて、明太子とごまさばを食べそびれたことに気づいた。</p>\\n\\n<h2>まとめ</h2>\\n\\n<p>上述の通り、技術を学ぶことと会社を知ることの2側面ともに得るものが多かった。</p>\\n\\n<p>実は応募前は私の技術力が通用するのか不安だった。しかし、ペパボの皆さんに本当に優しく丁寧にフォローしていただいて、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>期間内に機能をリリースできた。</p>\\n\\n<p>また同じ期間に他チームへ配属されていた<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3\\">インターン</a>生にもよい刺激を受けた。特に私が新しい技術分野に触れていくモチベーションに繋がった。同年代の強い人すごい、みんなすごい(小並感)。</p>\\n\\n<p>次は冬にも同様の就業型<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>を予定しているそうなので、この業界を考えてる人にぜひ勧めたい。</p>\\n\\n<h2>おわりに</h2>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>中に関わらせていただいたた皆さんにとてもお世話になりました。\\n特にサポーターのづっきーさんには技術面で沢山サポートしていただきました。初日緊張してパスワードを永遠に<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/typo\\">typo</a>していたのが懐かしいです。<br />\\n本当にありがとうございました。</p>\\n\\n<p><img src=\\"https://blob.basd4g.net/pepabo-intern1.jpg\\" alt=\\"集合写真\\" />\\n↑パートナーさんと我々<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3\\">インターン</a>生。最高の夏。</p>\\n\\n<hr class=\\"gt-article-annotation-horizontalrule\\"/>\\n\\n\\n\\n\\n<ul class=\\"gt-article-annotation-list\\">\\n<li><a id=\\"annotation-to-1\\" href=\\"#annotation-from-1\\">^1</a>: ペパボで働く人のこと</li>\\n<li><a id=\\"annotation-to-2\\" href=\\"#annotation-from-2\\">^2</a>: 正確にはペパボ協賛の技術イベント<a href=\\"https://builderscon.io\\">builderscon2019</a>の幕割CM</li>\\n<li><a id=\\"annotation-to-3\\" href=\\"#annotation-from-3\\">^3</a>: 記事中の<a href=\\"https://www.youtube.com/watch?v=ANXs_ZdQtt4\\">動画</a>を参照。buildersconのコンセプトらしい。(<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>とbuildersconに直接の関係はない。)</li>\\n<li><a id=\\"annotation-to-4\\" href=\\"#annotation-from-4\\">^4</a>: もちろん、テストはテストコードとして書かれた動作しか保証できないので、ある程度正しい動作を保証できるようなテストを書くこと、テストで何が保証されているのかを理解しておくことが必要がある。</li>\\n<li><a id=\\"annotation-to-5\\" href=\\"#annotation-from-5\\">^5</a>: ペパボが運営するオリジナルグッズの作成・販売サービス。<a href=\\"https://suzuri.jp\\">suzuri</a>。</li>\\n<li><a id=\\"annotation-to-6\\" href=\\"#annotation-from-6\\">^6</a>: さいたまに住んでいると羽田も遠い。</li>\\n</ul>\\n\\n","contentSnippet":"GMOペパボ株式会社(以下ペパボと表記させていただく) 福岡オフィスの2019年 夏インターンシップに参加した。\\nムームードメインチームのフロントエンドエンジニアとして開発させていただいたので、その記録である。\\n\\n↑オフィスの入口。\\nインターンシップ最終日にパートナーさん^1の前で成果発表会をしたのだが、話しきれなかった部分もあるのでそれを消化する意味もある。\\n長文失礼したい。\\nペパボとムームードメイン\\nペパボとは\\nGMOペパボ株式会社は東京・福岡・鹿児島にオフィスを構えるGMOグループの企業の一つ。「インターネットで可能性をつなげる、ひろげる」をミッションに、インターネットで個人の表現活動をする人を支援するサービスを展開している。\\nレンタルサーバー「ロリポップ」、ハンドメイドマーケット「minne」等のサービスがある。\\n丁度インターンシップ期間中に企業紹介動画^2が公開された。( 別verもある。)\\n\\n\\n\\nちなみに私はインターンシップでDiscover New Something^3した。\\n福岡オフィスではホスティング系サービスの開発を行っていて、今回はその中のムームードメインチームに参加させていただいた。\\nムームードメインとは\\nムームードメインとは、インターネットの独自ドメイン取得サービスとしてペパボの中でも古くから続いているサービスの一つ。私も利用している。\\nインターンシップでしたこと\\nNuxt.jsで作られているページへの機能追加を行った。\\nドメインの価格一覧ページに価格によるソート機能を追加した。\\nドメイン一覧表のヘッダ箇所にボタンが追加され、昇順・降順ソートが出来るようになった。\\n価格一覧のドメインを新規取得、更新、移管の価格順に並び替えることができるようになりました。ご予算に合ったドメインを見つけやすくなります。https://t.co/QL670SQXx0 pic.twitter.com/wLcWnas2Cm\\n— ムームードメイン (@muumuu_domain) September 5, 2019\\n \\n他のインターン参加者は次のようなことをやっていたようだ。各々のスキルに合わせて、チームに配属され実際の業務に加わる形式でインターンシップが進む。\\n研究所でデータ解析\\nCIツール周りをごにょごにょ\\nWebサービスに機能追加\\nAPIを書く\\n学んだこと - 技術の話\\nコードリーディング\\n今回のインターンシップでは新たなページの追加ではなく既存ページへの機能追加を行ったことから、既に完成しているドメインの価格を表示するロジックに手を加えることになった。\\n既存の実装の意図を汲みながら、他ページへの影響を与えないよう設計することに注意した。\\nコードを呼んでロジックとデータの流れを追うことは、経験が少なかったので新鮮だった。コードを読むのは面白かったが、実装の意図を汲むのは結構難しかった。似たような機能を持つOSSライブラリも見てみたりしながら設計を固めた。\\n\\n↑かの有名なお言葉。\\n実際に動いているサービス\\nサービスの規模感、エンジニアや関わる人の人数、サーバーの構成や使用されている技術スタックを知れた。1つのサービスを俯瞰して、どのように動いているのかを学べたのは貴重な経験である。\\nまたデザイナーさんとの分業の仕方やディレクターさんとの仕様の確認など、チームとしてサービスを支えている姿をみることができ、インターンシップの中で経験することもできた。\\nissueとPullRequest\\n恥ずかしながらチーム開発を今夏まで経験してこなかったので、GitHubのissueとPullreqを使う機会がなかった。\\nソフトウェアの実装に関する相談やまとめ、記録としても非常に有用で期間中たくさんお世話になった。\\nコードレビューは学ぶことがとても多く、これからの私のコードにたくさん取り入れていきたい。(既に恩恵を享受している。)\\nPullRequestを出す際に参考にしたいのがこちら↓。私が出したプルリクがこれにどこまで沿えていたかはおいておいて(笑)、自戒の念としても今後の参考のためにも残しておく。\\n特に私のようなプルリク歴の浅い方にお勧めしたい。\\n\\n\\n\\n\\n参照元: ぼくのかんがえたさいきょうのPullRequest\\nテスト\\n個人で開発しているとテストを書くという発想に至らず、今までテストを書いてこなかった。そのため、今回のインターンシップでテストを書いたのもとても良い経験だった。\\nVueコンポーネントを自在に手のひらで転がせるよう、転がれ転がれと念じながら過ごした(嘘)。\\nテストを書くといいことが沢山ある。他人のためになるだけでなく、既存の実装や構造を振り返るいい機会にもなるし、自分がのちに実装するときに恩恵(正しい動作を保証できる^4)を享受できる(した)。\\n感じたこと - ペパボの話\\nペパボは次の「わたしたちが大切にしている3つのこと」を掲げている。\\nみんなと仲良くすること\\nファンを増やすこと\\nアウトプットすること\\nパートナー皆さんにこれが浸透していて、日々実践されているのを感じた。\\nみんなと仲良くすること\\nまずパートナーさんが優しい。インターン生に対してだけでなく、職種やチームの壁を超えてそれぞれが仲が良い、(いい距離感だ)と感じた。\\nインターンシップ期間中、私をインターン生と知らないパートナーさんが声をかけてくださってお話したり、社内のシニアエンジニアの方に実装について聞いたり、いろんなパートナーさんと接する機会があったがどの方も親切だった。\\n\\nファンを増やすこと\\n会社やサービスを好きな人が多い。(観測範囲において。) しかし会社に魅力があるだけでなく、パートナーさんにファンになってしまうような惹きつける力がある。これこそ「ファンを増やすこと」を実践されている姿だと感じた。\\n\\nインターン生が貰えるsuzuri^5のキャラクター「スリスリくん」のぬいぐるみ。非売品でパートナーさんも簡単には手に入れられないらしい。\\nアウトプットすること\\n開発でGitHub Enterpriseを利用しており、issueやPullreqもアウトプットの形だと思う。\\nそこに過去の経緯が残されていることで、今回も開発の資料としてとても参考になった。\\nその他インターンシップ中に紹介された参考資料がパートナーさんが社外に公開したスライドであったことや(先程のさいきょうのPullReqもその一つ)、パートナーの方が登壇する技術イベントに参加させていただいたこと等、アウトプットされているのを肌に感じた。\\nLT経験の浅い私のためにLTの機会を増やして頂き、インターンシップ期間中に合わせて3回発表をした。issueもPullreqも書いたし、私もパートナーさんを見習ってもっとアウトプットしていきたい。\\n感じたこと - 福岡の話\\n人生初の九州上陸だったが、福岡は住みやすそうな街だった。\\nコンパクトシティ\\n空港から街が近い、というよりも街に空港があるので移動が楽。(成田空港、お前のことだぞ。^6)\\n食べ物が美味しい\\nペパボの福岡インターンシップで、日報にご飯が美味かったと書かれるのはあるあるらしい。もちろん私も書いた。\\n一つ一つ紹介しているとそれだけで記事になってしまうので、写真でまとめて振り返る。\\n\\n帰りに空港でお土産をみて、明太子とごまさばを食べそびれたことに気づいた。\\nまとめ\\n上述の通り、技術を学ぶことと会社を知ることの2側面ともに得るものが多かった。\\n実は応募前は私の技術力が通用するのか不安だった。しかし、ペパボの皆さんに本当に優しく丁寧にフォローしていただいて、インターンシップ期間内に機能をリリースできた。\\nまた同じ期間に他チームへ配属されていたインターン生にもよい刺激を受けた。特に私が新しい技術分野に触れていくモチベーションに繋がった。同年代の強い人すごい、みんなすごい(小並感)。\\n次は冬にも同様の就業型インターンシップを予定しているそうなので、この業界を考えてる人にぜひ勧めたい。\\nおわりに\\nインターンシップ中に関わらせていただいたた皆さんにとてもお世話になりました。\\n特にサポーターのづっきーさんには技術面で沢山サポートしていただきました。初日緊張してパスワードを永遠にtypoしていたのが懐かしいです。\\n\\n↑パートナーさんと我々インターン生。最高の夏。\\n^1: ペパボで働く人のこと\\n^2: 正確にはペパボ協賛の技術イベントbuilderscon2019の幕割CM\\n^3: 記事中の動画を参照。buildersconのコンセプトらしい。(インターンシップとbuildersconに直接の関係はない。)\\n^4: もちろん、テストはテストコードとして書かれた動作しか保証できないので、ある程度正しい動作を保証できるようなテストを書くこと、テストで何が保証されているのかを理解しておくことが必要がある。\\n^5: ペパボが運営するオリジナルグッズの作成・販売サービス。suzuri。\\n^6: さいたまに住んでいると羽田も遠い。","guid":"hatenablog://entry/26006613576772423","categories":["internship","ペパボ"],"isoDate":"2019-10-16T01:51:00.000Z"},{"title":"セレスのインターンシップ(ハッカソン)に参加した","link":"https://basd4g.hatenablog.com/entry/ceresHackathon","pubDate":"Tue, 15 Oct 2019 12:15:00 +0900","enclosure":{"url":"https://blob.basd4g.net/oshushume.png","type":"image/png","length":"0"},"content":"<p>2019/8/7-2019/8/9の3日間、株式会社セレスの開催する<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>に参加した。</p>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%BF%A1%BC%A5%F3%A5%B7%A5%C3%A5%D7\\">インターンシップ</a>の内容は<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Web%A5%B5%A1%BC%A5%D3%A5%B9\\">Webサービス</a>開発の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%AB%A5%BD%A5%F3\\">ハッカソン</a>。お題に合わせて3日間で企画からプレゼンまでを行った。</p>\\n\\n<h2>セレスとは</h2>\\n\\n<p><a href=\\"https://ceres-inc.jp\\">株式会社セレス</a>は東京の用賀にオフィスを構えるインターネットメディア企業。「インターネット<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%DE%A1%BC%A5%B1%A5%C6%A5%A3%A5%F3%A5%B0\\">マーケティング</a>を通じて豊かな世界を実現する」を経営理念に掲げ、多数のサービスを展開している。</p>\\n\\n<p>国内最大級のポイントサイト「<a href=\\"pc.moppy.jp\\">モッピー</a>」をはじめとする<a href=\\"https://ceres-inc.jp/business/mobile/\\">モバイルサービス事業</a>の他に、仮想通貨に関する<a href=\\"https://ceres-inc.jp/business/financial/\\">フィナンシャルサービス事業</a>も手掛ける。</p>\\n\\n<h2>作ったもの</h2>\\n\\n<p>今回の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%AB%A5%BD%A5%F3\\">ハッカソン</a>のお題は「ユーザーが楽しくなる<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Web%A5%B5%A1%BC%A5%D3%A5%B9\\">Webサービス</a>をつくる」。\\nそれに合わせて<a href=\\"#%E3%82%A2%E3%82%A4%E3%83%87%E3%82%A2%E3%82%BD%E3%83%B3%E3%81%A8%E8%A8%AD%E8%A8%88\\">後述のアイデアソン</a>を通して生まれたのが「お酒酒め」。</p>\\n\\n<p>「お酒酒め」(おしゅしゅめ)とは、お酒に詳しくない人に向けて、新しいお酒に出会うことを支援する<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Web%A5%B5%A1%BC%A5%D3%A5%B9\\">Webサービス</a>。お酒をお勧め(お酒酒め)してくれることから名付けた。</p>\\n\\n<p><img src=\\"https://blob.basd4g.net/oshushume.png\\" alt=\\"お酒酒めスクリーンショット\\" /></p>\\n\\n<h2>開発の流れ</h2>\\n\\n<p>3daysのうち、1日目はア<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%C7%A5%A2\\">イデア</a>ソン、2,3日目は<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%AB%A5%BD%A5%F3\\">ハッカソン</a>を行った。</p>\\n\\n<p>チームメンバーは自分を含め4人。フロントエンド、デザイン、データベース、バックエンドを区切りとして役割分割した。自分はフロントエンドとバックエンドを中心に作業した。</p>\\n\\n<h3>ア<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%C7%A5%A2\\">イデア</a>ソンと設計</h3>\\n\\n<p>シチュエーションゲーム<a id=\\"annotation-from-1\\" href=\\"#annotation-to-1\\">^1</a>を元に突飛な文章から「楽しく感じる状況」を探していき、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%D6%A5%EC%A5%A4%A5%F3%A5%B9%A5%C8%A1%BC%A5%DF%A5%F3%A5%B0\\">ブレインストーミング</a><a id=\\"annotation-from-2\\" href=\\"#annotation-to-2\\">^2</a>を使ってア<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%C7%A5%A2\\">イデア</a>を膨らませた。その後お題に合わせてターゲットを定めて具体化した。1日目終盤は時間があったのでアプリケーションの設計まで行った。</p>\\n\\n<p>設計の際、機能が盛り沢山なことに気づく。もっともコアな機能(お酒を勧める)を残してバッサリと削除することにした。削った機能はお酒の記録や好みの絞り込み等の機能である。この選択にあとで助けられる。</p>\\n\\n<h3><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%AB%A5%BD%A5%F3\\">ハッカソン</a> - 開発</h3>\\n\\n<p>用意されたアプリケーションの土台を基に、2日間で前日に固めたア<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%C7%A5%A2\\">イデア</a>を実装していく。\\n2日目に「ユーザーにお酒をおすすめする」ロジックとページ構成の大枠を制作、3日目は細かい所の修正とデザインを詰めた。</p>\\n\\n<h3>発表</h3>\\n\\n<p>ア<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%C7%A5%A2\\">イデア</a>とビジネスデザイン、制作したアプリケーションを社員の方の前で発表した。お褒めの言葉をいただくことも、鋭い指摘をいただくこともあった。発表の準備に時間をとることができないながら、発表はそれなりにアプリケーションのことを説明できたと思う。</p>\\n\\n<p>他チームの成果発表も聞くことができた。あるチームはページ数の多い構成に果敢に挑んでいたり、あるチームはコンセプトが奇抜だったりWebRTCで映像通信していたりしていた。すごい。盛り上がったなぁ。</p>\\n\\n<h2>振り返り</h2>\\n\\n<p>結果的に勝つことが出来たのだが、勝因は1日目に機能を絞ったことにあると思う。</p>\\n\\n<p>3日間で出来ることは限られている。完成したサービスの機能としては他チームよりもシンプルだったが、機能の豊富さではなく制作した画面の完成度を高めることに注力した。デザインに手をかけたことや、UIの不具合を無くし動作の細かいところ詰めたことなど、この姿勢を評価していただけたようである。</p>\\n\\n<p><img src=\\"https://blob.basd4g.net/echoShow5.jpg\\" alt=\\"Amazon Echo Show5\\" />\\n景品で頂いたEcho Show5。<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%B9%A5%DE%A1%BC%A5%C8%A5%B9%A5%D4%A1%BC%A5%AB%A1%BC\\">スマートスピーカー</a>を買うタイミングを失っていたのでありがたい。</p>\\n\\n<h2>感じたこと</h2>\\n\\n<h3>忙しい</h3>\\n\\n<p><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%AB%A5%BD%A5%F3\\">ハッカソン</a>は忙しい。時間がない。アプリケーションを短い時間で形にするのは結構大変だった。必要なタスクを絞り込み、限られた時間をどう使うかがとても重要になる。<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%CF%A5%C3%A5%AB%A5%BD%A5%F3\\">ハッカソン</a>=ハック+マ<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%E9%A5%BD%A5%F3\\">ラソン</a>らしいけれど、どちらかというと<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%C3%BB%B5%F7%CE%A5%C1%F6\\">短距離走</a>ではないか？と思った。</p>\\n\\n<h3>設計(共通認識)のポイントを抑える</h3>\\n\\n<p>チームで開発する上で、個人で作るときと違い明確にしておかなければならないポイントがいくつかあった。例えば通信仕様や、ページUI等である。今回は常に隣で作業していたから良かったものの、違う環境であったら更に大変であっただろう。実装に没頭していると認識がずれがちなので、時間を区切って進捗報告や相談、認識合わせを挟むことを意識した。</p>\\n\\n<h3>チーム開発の良さ</h3>\\n\\n<p>自分がコード書いてないのに、新しいページが追加されて動いてる。すごい。(小並感)</p>\\n\\n<p>並行して作業を行えるだけでなく、設計方針や実装方法で詰まったときにすぐに相談できた。お互いの強みを出しあって開発することで、一人では詰まって時間が取られていただろうポイントをすぐ乗り越えられた気がした。</p>\\n\\n<h2>おわりに</h2>\\n\\n<p>メンバーとともに議論をしながらアプリケーションをつくるのは、面白いとともに刺激になる機会でした。チームのみんな、ありがとう。</p>\\n\\n<p>そしてこのような機会を設けてくださり、開発をフォローしてくださった株式会社セレスの社員の方々、3日間とてもお世話になりました。ありがとうございました。</p>\\n\\n<hr class=\\"gt-article-annotation-horizontalrule\\"/>\\n\\n\\n\\n\\n<ul class=\\"gt-article-annotation-list\\">\\n<li><a id=\\"annotation-to-1\\" href=\\"#annotation-from-1\\">^1</a>: 「いつ」「誰が」「どこで」「何をした」をそれぞれカードに書き、他人のものと混ぜて新しい文章を作るゲームのこと。</li>\\n<li><a id=\\"annotation-to-2\\" href=\\"#annotation-from-2\\">^2</a>: チームで沢山のア<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%C7%A5%A2\\">イデア</a>を出す手法。(<a href=\\"https://ja.wikipedia.org/wiki/ブレインストーミング\\">wikipedia</a>)</li>\\n</ul>\\n\\n","contentSnippet":"2019/8/7-2019/8/9の3日間、株式会社セレスの開催するインターンシップに参加した。\\nインターンシップの内容はWebサービス開発のハッカソン。お題に合わせて3日間で企画からプレゼンまでを行った。\\nセレスとは\\n株式会社セレスは東京の用賀にオフィスを構えるインターネットメディア企業。「インターネットマーケティングを通じて豊かな世界を実現する」を経営理念に掲げ、多数のサービスを展開している。\\n国内最大級のポイントサイト「モッピー」をはじめとするモバイルサービス事業の他に、仮想通貨に関するフィナンシャルサービス事業も手掛ける。\\n作ったもの\\n今回のハッカソンのお題は「ユーザーが楽しくなるWebサービスをつくる」。\\nそれに合わせて後述のアイデアソンを通して生まれたのが「お酒酒め」。\\n「お酒酒め」(おしゅしゅめ)とは、お酒に詳しくない人に向けて、新しいお酒に出会うことを支援するWebサービス。お酒をお勧め(お酒酒め)してくれることから名付けた。\\n\\n開発の流れ\\n3daysのうち、1日目はアイデアソン、2,3日目はハッカソンを行った。\\nチームメンバーは自分を含め4人。フロントエンド、デザイン、データベース、バックエンドを区切りとして役割分割した。自分はフロントエンドとバックエンドを中心に作業した。\\nアイデアソンと設計\\nシチュエーションゲーム^1を元に突飛な文章から「楽しく感じる状況」を探していき、ブレインストーミング^2を使ってアイデアを膨らませた。その後お題に合わせてターゲットを定めて具体化した。1日目終盤は時間があったのでアプリケーションの設計まで行った。\\n設計の際、機能が盛り沢山なことに気づく。もっともコアな機能(お酒を勧める)を残してバッサリと削除することにした。削った機能はお酒の記録や好みの絞り込み等の機能である。この選択にあとで助けられる。\\nハッカソン - 開発\\n用意されたアプリケーションの土台を基に、2日間で前日に固めたアイデアを実装していく。\\n2日目に「ユーザーにお酒をおすすめする」ロジックとページ構成の大枠を制作、3日目は細かい所の修正とデザインを詰めた。\\n発表\\nアイデアとビジネスデザイン、制作したアプリケーションを社員の方の前で発表した。お褒めの言葉をいただくことも、鋭い指摘をいただくこともあった。発表の準備に時間をとることができないながら、発表はそれなりにアプリケーションのことを説明できたと思う。\\n他チームの成果発表も聞くことができた。あるチームはページ数の多い構成に果敢に挑んでいたり、あるチームはコンセプトが奇抜だったりWebRTCで映像通信していたりしていた。すごい。盛り上がったなぁ。\\n振り返り\\n結果的に勝つことが出来たのだが、勝因は1日目に機能を絞ったことにあると思う。\\n3日間で出来ることは限られている。完成したサービスの機能としては他チームよりもシンプルだったが、機能の豊富さではなく制作した画面の完成度を高めることに注力した。デザインに手をかけたことや、UIの不具合を無くし動作の細かいところ詰めたことなど、この姿勢を評価していただけたようである。\\n\\n景品で頂いたEcho Show5。スマートスピーカーを買うタイミングを失っていたのでありがたい。\\n感じたこと\\n忙しい\\nハッカソンは忙しい。時間がない。アプリケーションを短い時間で形にするのは結構大変だった。必要なタスクを絞り込み、限られた時間をどう使うかがとても重要になる。ハッカソン=ハック+マラソンらしいけれど、どちらかというと短距離走ではないか？と思った。\\n設計(共通認識)のポイントを抑える\\nチームで開発する上で、個人で作るときと違い明確にしておかなければならないポイントがいくつかあった。例えば通信仕様や、ページUI等である。今回は常に隣で作業していたから良かったものの、違う環境であったら更に大変であっただろう。実装に没頭していると認識がずれがちなので、時間を区切って進捗報告や相談、認識合わせを挟むことを意識した。\\nチーム開発の良さ\\n自分がコード書いてないのに、新しいページが追加されて動いてる。すごい。(小並感)\\n並行して作業を行えるだけでなく、設計方針や実装方法で詰まったときにすぐに相談できた。お互いの強みを出しあって開発することで、一人では詰まって時間が取られていただろうポイントをすぐ乗り越えられた気がした。\\nおわりに\\nメンバーとともに議論をしながらアプリケーションをつくるのは、面白いとともに刺激になる機会でした。チームのみんな、ありがとう。\\nそしてこのような機会を設けてくださり、開発をフォローしてくださった株式会社セレスの社員の方々、3日間とてもお世話になりました。ありがとうございました。\\n^1: 「いつ」「誰が」「どこで」「何をした」をそれぞれカードに書き、他人のものと混ぜて新しい文章を作るゲームのこと。\\n^2: チームで沢山のアイデアを出す手法。(wikipedia)","guid":"hatenablog://entry/26006613576772422","categories":["Internship","セレス","ハッカソン"],"isoDate":"2019-10-15T03:15:00.000Z"},{"title":"Nuxt.js(v2.9.2)とTypeScriptの開発環境を作る。","link":"https://basd4g.hatenablog.com/entry/NuxtTsV292","pubDate":"Fri, 27 Sep 2019 12:30:00 +0900","enclosure":{"url":"https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png","type":"image/png","length":"0"},"content":"<p>Nuxt.jsとTypeScriptで開発環境を作るときのまとめ。(2019/9/5時点)</p>\\n\\n<p>お急ぎの方は、\\n記事中の作業を行ったものを<a href=\\"https://github.com/basd4g/nuxt.ts-template\\">nuxt.ts-template</a>として<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GitHub\\">GitHub</a>の<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA\\">リポジトリ</a>に上げたので、cloneないしForkして使ってほしい。</p>\\n\\n<h2>目指すもの</h2>\\n\\n<p>create nuxt-app したときと同じ環境で、下記のものが使えること。\\nすぐにNuxt.jsとTypeScriptを用いて開発を始められる環境を構築する。</p>\\n\\n<ul>\\n<li>Nuxt.js v2.9.2</li>\\n<li>TypeScript</li>\\n<li>ESLint</li>\\n<li>nuxt-property-decorator</li>\\n</ul>\\n\\n\\n<h3>nuxt-property-decorator (vue-property-decorator)</h3>\\n\\n<p>Nuxt.jsとTypeScriptを組み合わせるときは、nuxt-property-decorator(vue-property-decorator)の利用が推奨されている。<a id=\\"annotation-from-1\\" href=\\"#annotation-to-1\\">^1</a></p>\\n\\n<p>もともとのNuxt.jsとは書き方が変わる。参考文献にいくつか載せてあるので、もともとの書き方と比較しながら慣れると良さそう。<a id=\\"annotation-from-2\\" href=\\"#annotation-to-2\\">^2</a></p>\\n\\n<p>今回は最後にインストールするので、一つ前の<a href=\\"#3-eslint\\">ESLint</a>までで止まればこれを使わない環境も構築できる。</p>\\n\\n<h2>手順</h2>\\n\\n<p>大まかには次の流れで進む。\\nいくつかハマりどころがあったので、私の環境でうまく行った手順を残しておく。</p>\\n\\n<p>(特にESLintに文句を言われることが多く、最初いきあたりばったりで進めていたら沢山のパッケージをインストールしてしまった。\\nこの記事は、その後不要なものがあまり入らないようにやり直した内容の記録である。)</p>\\n\\n<ol>\\n<li>yarn create nuxt-app</li>\\n<li>TypeScriptを入れる</li>\\n<li>vue-property-decoratorを入れる</li>\\n<li>ESLintを入れる</li>\\n</ol>\\n\\n\\n<p><br><br></p>\\n\\n<h3>1. create nuxt-app</h3>\\n\\n<p>Nuxt.jsで環境構築するときにお決まりのcreate-nuxt-app。\\nyarnだと、 <code>$ yarn create nuxt-app hogehoge</code> とする。</p>\\n\\n<pre class=\\"code lang-sh\\" data-lang=\\"sh\\" data-unlink>$ yarn create nuxt-app nuxt.ts-template\\n<span class=\\"synComment\\"># yarn create v1.17.3</span>\\n<span class=\\"synComment\\"># create-nuxt-app v2.10.1</span>\\n\\n<span class=\\"synComment\\"># 今回は次のように設定した</span>\\n<span class=\\"synComment\\"># Project name, Project description, Author name は適宜</span>\\n<span class=\\"synComment\\"># package manager : Yarn</span>\\n<span class=\\"synComment\\"># UI framework : None</span>\\n<span class=\\"synComment\\"># custom server framework : None (Recommended)</span>\\n<span class=\\"synComment\\"># Nuxt.js modules :</span>\\n<span class=\\"synComment\\"># test framework : None</span>\\n<span class=\\"synComment\\"># rendering mode : Universal (SSR)</span>\\n<span class=\\"synComment\\"># development tools :</span>\\n\\n$ <span class=\\"synStatement\\">cd</span> nuxt.ts-template/\\n<span class=\\"synComment\\"># 以下全てカレントディレクトリは移動しない。編集するファイル名もnuxt.ts-template/をカレントディレクトリとして表記する。</span>\\n\\n$ yarn dev\\n<span class=\\"synComment\\"># 起動できることを確認。ブラウザからNuxt.jsのロゴが見えればオーケー。(以下の起動確認も同様。)</span>\\n</pre>\\n\\n\\n<p><br><br></p>\\n\\n<h3>2. Install TypeScript</h3>\\n\\n<p>まず、TypeScriptに関するパッケージをインストールする。</p>\\n\\n<pre class=\\"code lang-sh\\" data-lang=\\"sh\\" data-unlink>$ yarn add <span class=\\"synSpecial\\">-D</span> @nuxt/typescript-build\\n$ yarn add @nuxt/typescript-runtime @nuxt/types\\n$ <span class=\\"synStatement\\">mv</span> nuxt.config.js nuxt.config.ts\\n$ <span class=\\"synStatement\\">touch</span> tsconfig.json\\n</pre>\\n\\n\\n<p>TypeScriptに合わせて以下の設定ファイルを2つ、ソースを3つ書き換える。</p>\\n\\n<ul>\\n<li><code>package.json</code></li>\\n<li><code>tsconfig.json</code> (新たに作成)</li>\\n<li><code>nuxt.config.ts</code></li>\\n<li><code>index.vue</code></li>\\n<li><code>Logo.vue</code></li>\\n</ul>\\n\\n\\n<p><code>./package.json</code></p>\\n\\n<pre class=\\"code lang-diff\\" data-lang=\\"diff\\" data-unlink>...\\n   &quot;scripts&quot;: {\\n<span class=\\"synSpecial\\">-    &quot;dev&quot;: &quot;nuxt&quot;,</span>\\n<span class=\\"synSpecial\\">-    &quot;build&quot;: &quot;nuxt build&quot;,</span>\\n<span class=\\"synSpecial\\">-    &quot;start&quot;: &quot;nuxt start&quot;,</span>\\n<span class=\\"synSpecial\\">-    &quot;generate&quot;: &quot;nuxt generate&quot;</span>\\n<span class=\\"synIdentifier\\">+    &quot;dev&quot;: &quot;nuxt-ts&quot;,</span>\\n<span class=\\"synIdentifier\\">+    &quot;build&quot;: &quot;nuxt-ts build&quot;,</span>\\n<span class=\\"synIdentifier\\">+    &quot;start&quot;: &quot;nuxt-ts start&quot;,</span>\\n<span class=\\"synIdentifier\\">+    &quot;generate&quot;: &quot;nuxt-ts generate&quot;</span>\\n   },\\n...\\n</pre>\\n\\n\\n<p><code>./tsconfig.json</code></p>\\n\\n<pre class=\\"code lang-json\\" data-lang=\\"json\\" data-unlink><span class=\\"synSpecial\\">{</span>\\n  &quot;<span class=\\"synStatement\\">compilerOptions</span>&quot;: <span class=\\"synSpecial\\">{</span>\\n    &quot;<span class=\\"synStatement\\">target</span>&quot;: &quot;<span class=\\"synConstant\\">esnext</span>&quot;,\\n    &quot;<span class=\\"synStatement\\">module</span>&quot;: &quot;<span class=\\"synConstant\\">esnext</span>&quot;,\\n    &quot;<span class=\\"synStatement\\">moduleResolution</span>&quot;: &quot;<span class=\\"synConstant\\">node</span>&quot;,\\n    &quot;<span class=\\"synStatement\\">lib</span>&quot;: <span class=\\"synSpecial\\">[</span>\\n      &quot;<span class=\\"synConstant\\">esnext</span>&quot;,\\n      &quot;<span class=\\"synConstant\\">esnext.asynciterable</span>&quot;,\\n      &quot;<span class=\\"synConstant\\">dom</span>&quot;\\n    <span class=\\"synSpecial\\">]</span>,\\n    &quot;<span class=\\"synStatement\\">esModuleInterop</span>&quot;: <span class=\\"synConstant\\">true</span>,\\n    &quot;<span class=\\"synStatement\\">allowJs</span>&quot;: <span class=\\"synConstant\\">true</span>,\\n    &quot;<span class=\\"synStatement\\">sourceMap</span>&quot;: <span class=\\"synConstant\\">true</span>,\\n    &quot;<span class=\\"synStatement\\">strict</span>&quot;: <span class=\\"synConstant\\">true</span>,\\n    &quot;<span class=\\"synStatement\\">noEmit</span>&quot;: <span class=\\"synConstant\\">true</span>,\\n    &quot;<span class=\\"synStatement\\">baseUrl</span>&quot;: &quot;<span class=\\"synConstant\\">.</span>&quot;,\\n    &quot;<span class=\\"synStatement\\">paths</span>&quot;: <span class=\\"synSpecial\\">{</span>\\n      &quot;<span class=\\"synStatement\\">~/*</span>&quot;: <span class=\\"synSpecial\\">[</span>\\n        &quot;<span class=\\"synConstant\\">./*</span>&quot;\\n      <span class=\\"synSpecial\\">]</span>,\\n      &quot;<span class=\\"synStatement\\">@/*</span>&quot;: <span class=\\"synSpecial\\">[</span>\\n        &quot;<span class=\\"synConstant\\">./*</span>&quot;\\n      <span class=\\"synSpecial\\">]</span>\\n    <span class=\\"synSpecial\\">}</span>,\\n    &quot;<span class=\\"synStatement\\">types</span>&quot;: <span class=\\"synSpecial\\">[</span>\\n      &quot;<span class=\\"synConstant\\">@types/node</span>&quot;,\\n      &quot;<span class=\\"synConstant\\">@nuxt/types</span>&quot;\\n    <span class=\\"synSpecial\\">]</span>\\n  <span class=\\"synSpecial\\">}</span>,\\n  &quot;<span class=\\"synStatement\\">exclude</span>&quot;: <span class=\\"synSpecial\\">[</span>\\n    &quot;<span class=\\"synConstant\\">node_modules</span>&quot;\\n  <span class=\\"synSpecial\\">]</span>\\n<span class=\\"synSpecial\\">}</span>\\n</pre>\\n\\n\\n<p><code>./nuxt.config.ts</code></p>\\n\\n<pre class=\\"code lang-diff\\" data-lang=\\"diff\\" data-unlink><span class=\\"synIdentifier\\">+import {Configuration} from \'@nuxt/types\'</span>\\n\\n<span class=\\"synSpecial\\">-export default {</span>\\n<span class=\\"synIdentifier\\">+const nuxtConfig: Configuration = {</span>\\n...\\n  buildModules: [\\n<span class=\\"synIdentifier\\">+      \'@nuxt/typescript-build\'</span>\\n  ],\\n...\\n}\\n<span class=\\"synIdentifier\\">+module.exports = nuxtConfig</span>\\n</pre>\\n\\n\\n<p><code>./pages/index.vue</code></p>\\n\\n<pre class=\\"code lang-diff\\" data-lang=\\"diff\\" data-unlink><span class=\\"synSpecial\\">-&lt;script&gt;</span>\\n<span class=\\"synIdentifier\\">+&lt;script lang=&quot;ts&quot;&gt;</span>\\n</pre>\\n\\n\\n<p><code>./components/Logo.vue</code></p>\\n\\n<pre class=\\"code lang-diff\\" data-lang=\\"diff\\" data-unlink>...\\n<span class=\\"synSpecial\\">&lt;/template&gt;</span>\\n<span class=\\"synIdentifier\\">+</span>\\n<span class=\\"synIdentifier\\">+&lt;script lang=&quot;ts&quot;&gt;</span>\\n<span class=\\"synIdentifier\\">+import Vue from \'vue\'</span>\\n<span class=\\"synIdentifier\\">+export default Vue.extend({  </span>\\n<span class=\\"synIdentifier\\">+})</span>\\n<span class=\\"synIdentifier\\">+&lt;/script&gt;</span>\\n<span class=\\"synIdentifier\\">+</span>\\n<span class=\\"synSpecial\\">&lt;style&gt;</span>\\n...\\n</pre>\\n\\n\\n\\n\\n<pre class=\\"code lang-sh\\" data-lang=\\"sh\\" data-unlink>$ yarn dev\\n<span class=\\"synComment\\"># TypeScriptで動くことを確認。</span>\\n</pre>\\n\\n\\n<p><br><br></p>\\n\\n<h3>3. ESlint</h3>\\n\\n<p>ESLintと関連パッケージをインストールする。(今回はcreate nuxt-appでESLintをインストールしていないのでESLint自体もここでインストールする。)</p>\\n\\n<pre class=\\"code lang-sh\\" data-lang=\\"sh\\" data-unlink>$ yarn add eslint-config eslint\\n$ yarn add <span class=\\"synSpecial\\">-D</span> @typescript-eslint/eslint-plugin @typescript-eslint/parser @nuxtjs/eslint-config-typescript\\n$ <span class=\\"synStatement\\">touch</span> .eslintrc.js\\n</pre>\\n\\n\\n<p>ESLintの設定を以下の3ファイルに記述する。</p>\\n\\n<ul>\\n<li><code>package.json</code></li>\\n<li><code>nuxt.config.ts</code></li>\\n<li><code>.eslintrc.js</code></li>\\n</ul>\\n\\n\\n<p><code>package.json</code></p>\\n\\n<pre class=\\"code lang-diff\\" data-lang=\\"diff\\" data-unlink>...\\n  &quot;scripts&quot;: {\\n    &quot;dev&quot;: &quot;nuxt-ts&quot;,\\n    &quot;build&quot;: &quot;nuxt-ts build&quot;,\\n    &quot;start&quot;: &quot;nuxt-ts start&quot;,\\n<span class=\\"synSpecial\\">-    &quot;generate&quot;: &quot;nuxt-ts generate&quot;</span>\\n<span class=\\"synIdentifier\\">+    &quot;generate&quot;: &quot;nuxt-ts generate&quot;,</span>\\n<span class=\\"synIdentifier\\">+    &quot;lint&quot;: &quot;eslint --ext .ts,.js,.vue --ignore-path .gitignore .&quot;,</span>\\n<span class=\\"synIdentifier\\">+    &quot;lint:fix&quot;: &quot;eslint --ext .ts,.js,.vue --ignore-path .gitignore . --fix&quot;</span>\\n  },\\n...\\n</pre>\\n\\n\\n<p><code>nuxt.config.ts</code></p>\\n\\n<pre class=\\"code lang-diff\\" data-lang=\\"diff\\" data-unlink>...\\n  build: {\\n    /*\\n    ** You can extend webpack config here\\n    */\\n<span class=\\"synIdentifier\\">+    /*</span>\\n    extend (config, ctx) {\\n    }\\n<span class=\\"synIdentifier\\">+   */</span>\\n...\\n</pre>\\n\\n\\n<p><code>.eslintrc.js</code></p>\\n\\n<pre class=\\"code js\\" data-lang=\\"js\\" data-unlink>module.exports = {\\n  plugins: [&#39;@typescript-eslint&#39;],\\n  parserOptions: {\\n    parser: &#39;@typescript-eslint/parser&#39;\\n  },\\n  extends: [\\n    &#39;@nuxtjs/eslint-config-typescript&#39;\\n  ],\\n  rules: {\\n    &#39;@typescript-eslint/no-unused-vars&#39;: &#39;error&#39;\\n  }\\n}</pre>\\n\\n\\n\\n\\n<pre class=\\"code lang-sh\\" data-lang=\\"sh\\" data-unlink>$ yarn lint:fix\\n$ yarn dev\\n<span class=\\"synComment\\"># Lintが動いていることと、変わらず起動できることを確認。</span>\\n</pre>\\n\\n\\n<p><br><br></p>\\n\\n<h3>4.nuxt-property-decorator</h3>\\n\\n<p>nuxt-property-decoratorをインストールする。(vue-property-decoratorでも良いかもしれない。)</p>\\n\\n<pre class=\\"code lang-sh\\" data-lang=\\"sh\\" data-unlink>$ yarn add nuxt-property-decorator\\n</pre>\\n\\n\\n<p>nuxt-property-decoratorに合わせて2ファイルを変更する。</p>\\n\\n<ul>\\n<li><code>tsconfig.json</code> (デコレータの使用を宣言する。)</li>\\n<li><code>index.vue</code> (デコレータを使った書き方に修正する。)</li>\\n</ul>\\n\\n\\n<p><code>./tsconfig.json</code></p>\\n\\n<pre class=\\"code lang-diff\\" data-lang=\\"diff\\" data-unlink>...\\n    &quot;compilerOptions&quot;: {\\n...\\n      &quot;types&quot;: [\\n        &quot;@types/node&quot;,\\n        &quot;@nuxt/types&quot;\\n<span class=\\"synSpecial\\">-      ]</span>\\n<span class=\\"synIdentifier\\">+      ],</span>\\n<span class=\\"synIdentifier\\">+      &quot;experimentalDecorators&quot;: true</span>\\n    },\\n...\\n</pre>\\n\\n\\n<p><code>./pages/index.vue</code></p>\\n\\n<pre class=\\"code lang-diff\\" data-lang=\\"diff\\" data-unlink>...\\n<span class=\\"synSpecial\\">&lt;script lang=&quot;ts&quot;&gt;</span>\\n<span class=\\"synIdentifier\\">+import { Component, Vue } from \'vue-property-decorator\'</span>\\nimport Logo from \'~/components/Logo.vue\'\\n\\n<span class=\\"synSpecial\\">-export default {</span>\\n<span class=\\"synIdentifier\\">+@Component({</span>\\n  components: {\\n    Logo\\n  }\\n<span class=\\"synSpecial\\">-}</span>\\n<span class=\\"synIdentifier\\">+})</span>\\n<span class=\\"synIdentifier\\">+export default class Index extends Vue {</span>\\n<span class=\\"synIdentifier\\">+}</span>\\n<span class=\\"synSpecial\\">&lt;/script&gt;</span>\\n...\\n</pre>\\n\\n\\n\\n\\n<pre class=\\"code lang-sh\\" data-lang=\\"sh\\" data-unlink>$ yarn dev\\n<span class=\\"synComment\\"># デコレータを使った表記での起動を確認。</span>\\n</pre>\\n\\n\\n<p>お疲れさまでした。</p>\\n\\n<h2>参考</h2>\\n\\n<p>重要参考文献</p>\\n\\n<ol>\\n<li><a href=\\"https://qiita.com/iwata@github/items/a94c6d116a3e84911628\\">Qiita Nuxt.js 2.9でのTypeScript対応</a></li>\\n<li><a href=\\"typescript.nuxtjs.org/guide/setup.html#installation\\">Nuxt TypeScript Setup</a></li>\\n</ol>\\n\\n\\n<p>その他の参考文献</p>\\n\\n<ol>\\n<li><a href=\\"https://ja.nuxtjs.org/guide/installation/\\">Nuxt.js インストール</a> ... yarn create nuxt-app について</li>\\n<li><a href=\\"https://github.com/nuxt/eslint-config\\">GitHub eslint-config</a> ... eslint-configのセットアップ</li>\\n<li><a href=\\"https://js.studio-kingdom.com/typescript/handbook/decorators\\">デコレータ | TypeScript 日本語ハンドブック | js STUDIO</a> ... <code>experimentalDecorators</code>について</li>\\n<li><a href=\\"https://qiita.com/hako1912/items/8d9968d07748d20825f8\\">TypeScriptではじめるVueコンポーネント（vue-class-component）</a>... vue-property-decorator(nuxt-property-decorator)を使った<code>@Component</code>デコレータの書き方</li>\\n<li><a href=\\"https://crieit.net/posts/Nuxt-js-Express-TypeScript\\">Nuxt.js+ExpressのプロジェクトをTypeScript化する</a> ... nuxt-property-decoratorを使った<code>@Component</code>デコレータの書き方</li>\\n<li><a href=\\"https://qiita.com/simochee/items/e5b77af4aa36bd0f32e5\\">はじめてのvue-property-decorator</a> ... vue-property-decorator(nuxt-property-decorator)を使ったデコレータの書き方</li>\\n</ol>\\n\\n\\n<hr class=\\"gt-article-annotation-horizontalrule\\"/>\\n\\n\\n\\n\\n<ul class=\\"gt-article-annotation-list\\">\\n<li><a id=\\"annotation-to-1\\" href=\\"#annotation-from-1\\">^1</a>: <a href=\\"https://ja.nuxtjs.org/guide/typescript/\\">Nuxt.js TypeScriptサポート</a>に書かれている。(Nuxt.js v2.8までの記述のため、このページの内容のとおりではv2.9.2ではうまく行かない)</li>\\n<li><a id=\\"annotation-to-2\\" href=\\"#annotation-from-2\\">^2</a>: <a href=\\"https://github.com/kaorun343/vue-property-decorator\\">GitHub vue-property-decorator</a>に記載がある。</li>\\n</ul>\\n\\n","contentSnippet":"Nuxt.jsとTypeScriptで開発環境を作るときのまとめ。(2019/9/5時点)\\nお急ぎの方は、\\n記事中の作業を行ったものをnuxt.ts-templateとしてGitHubのリポジトリに上げたので、cloneないしForkして使ってほしい。\\n目指すもの\\ncreate nuxt-app したときと同じ環境で、下記のものが使えること。\\nすぐにNuxt.jsとTypeScriptを用いて開発を始められる環境を構築する。\\nNuxt.js v2.9.2\\nTypeScript\\nESLint\\nnuxt-property-decorator\\nnuxt-property-decorator (vue-property-decorator)\\nNuxt.jsとTypeScriptを組み合わせるときは、nuxt-property-decorator(vue-property-decorator)の利用が推奨されている。^1\\nもともとのNuxt.jsとは書き方が変わる。参考文献にいくつか載せてあるので、もともとの書き方と比較しながら慣れると良さそう。^2\\n今回は最後にインストールするので、一つ前のESLintまでで止まればこれを使わない環境も構築できる。\\n手順\\n大まかには次の流れで進む。\\nいくつかハマりどころがあったので、私の環境でうまく行った手順を残しておく。\\n(特にESLintに文句を言われることが多く、最初いきあたりばったりで進めていたら沢山のパッケージをインストールしてしまった。\\nこの記事は、その後不要なものがあまり入らないようにやり直した内容の記録である。)\\nyarn create nuxt-app\\nTypeScriptを入れる\\nvue-property-decoratorを入れる\\nESLintを入れる\\n\\n\\n\\n1. create nuxt-app\\nNuxt.jsで環境構築するときにお決まりのcreate-nuxt-app。\\nyarnだと、 $ yarn create nuxt-app hogehoge とする。\\n$ yarn create nuxt-app nuxt.ts-template\\n# yarn create v1.17.3\\n# create-nuxt-app v2.10.1\\n\\n# 今回は次のように設定した\\n# Project name, Project description, Author name は適宜\\n# package manager : Yarn\\n# UI framework : None\\n# custom server framework : None (Recommended)\\n# Nuxt.js modules :\\n# test framework : None\\n# rendering mode : Universal (SSR)\\n# development tools :\\n\\n$ cd nuxt.ts-template/\\n# 以下全てカレントディレクトリは移動しない。編集するファイル名もnuxt.ts-template/をカレントディレクトリとして表記する。\\n\\n$ yarn dev\\n# 起動できることを確認。ブラウザからNuxt.jsのロゴが見えればオーケー。(以下の起動確認も同様。)\\n\\n\\n\\n\\n\\n2. Install TypeScript\\nまず、TypeScriptに関するパッケージをインストールする。\\n$ yarn add -D @nuxt/typescript-build\\n$ yarn add @nuxt/typescript-runtime @nuxt/types\\n$ mv nuxt.config.js nuxt.config.ts\\n$ touch tsconfig.json\\n\\n\\n\\nTypeScriptに合わせて以下の設定ファイルを2つ、ソースを3つ書き換える。\\npackage.json\\ntsconfig.json (新たに作成)\\nnuxt.config.ts\\nindex.vue\\nLogo.vue\\n./package.json\\n...\\n   \\"scripts\\": {\\n-    \\"dev\\": \\"nuxt\\",\\n-    \\"build\\": \\"nuxt build\\",\\n-    \\"start\\": \\"nuxt start\\",\\n-    \\"generate\\": \\"nuxt generate\\"\\n+    \\"dev\\": \\"nuxt-ts\\",\\n+    \\"build\\": \\"nuxt-ts build\\",\\n+    \\"start\\": \\"nuxt-ts start\\",\\n+    \\"generate\\": \\"nuxt-ts generate\\"\\n   },\\n...\\n\\n\\n\\n./tsconfig.json\\n{\\n  \\"compilerOptions\\": {\\n    \\"target\\": \\"esnext\\",\\n    \\"module\\": \\"esnext\\",\\n    \\"moduleResolution\\": \\"node\\",\\n    \\"lib\\": [\\n      \\"esnext\\",\\n      \\"esnext.asynciterable\\",\\n      \\"dom\\"\\n    ],\\n    \\"esModuleInterop\\": true,\\n    \\"allowJs\\": true,\\n    \\"sourceMap\\": true,\\n    \\"strict\\": true,\\n    \\"noEmit\\": true,\\n    \\"baseUrl\\": \\".\\",\\n    \\"paths\\": {\\n      \\"~/*\\": [\\n        \\"./*\\"\\n      ],\\n      \\"@/*\\": [\\n        \\"./*\\"\\n      ]\\n    },\\n    \\"types\\": [\\n      \\"@types/node\\",\\n      \\"@nuxt/types\\"\\n    ]\\n  },\\n  \\"exclude\\": [\\n    \\"node_modules\\"\\n  ]\\n}\\n\\n\\n\\n./nuxt.config.ts\\n+import {Configuration} from \'@nuxt/types\'\\n\\n-export default {\\n+const nuxtConfig: Configuration = {\\n...\\n  buildModules: [\\n+      \'@nuxt/typescript-build\'\\n  ],\\n...\\n}\\n+module.exports = nuxtConfig\\n\\n\\n\\n./pages/index.vue\\n-<script>\\n+<script lang=\\"ts\\">\\n\\n\\n\\n./components/Logo.vue\\n...\\n</template>\\n+\\n+<script lang=\\"ts\\">\\n+import Vue from \'vue\'\\n+export default Vue.extend({  \\n+})\\n+<\/script>\\n+\\n<style>\\n...\\n\\n\\n\\n\\n\\n$ yarn dev\\n# TypeScriptで動くことを確認。\\n\\n\\n\\n\\n\\n3. ESlint\\nESLintと関連パッケージをインストールする。(今回はcreate nuxt-appでESLintをインストールしていないのでESLint自体もここでインストールする。)\\n$ yarn add eslint-config eslint\\n$ yarn add -D @typescript-eslint/eslint-plugin @typescript-eslint/parser @nuxtjs/eslint-config-typescript\\n$ touch .eslintrc.js\\n\\n\\n\\nESLintの設定を以下の3ファイルに記述する。\\npackage.json\\nnuxt.config.ts\\n.eslintrc.js\\npackage.json\\n...\\n  \\"scripts\\": {\\n    \\"dev\\": \\"nuxt-ts\\",\\n    \\"build\\": \\"nuxt-ts build\\",\\n    \\"start\\": \\"nuxt-ts start\\",\\n-    \\"generate\\": \\"nuxt-ts generate\\"\\n+    \\"generate\\": \\"nuxt-ts generate\\",\\n+    \\"lint\\": \\"eslint --ext .ts,.js,.vue --ignore-path .gitignore .\\",\\n+    \\"lint:fix\\": \\"eslint --ext .ts,.js,.vue --ignore-path .gitignore . --fix\\"\\n  },\\n...\\n\\n\\n\\nnuxt.config.ts\\n...\\n  build: {\\n    /*\\n    ** You can extend webpack config here\\n    */\\n+    /*\\n    extend (config, ctx) {\\n    }\\n+   */\\n...\\n\\n\\n\\n.eslintrc.js\\nmodule.exports = {\\n  plugins: [\'@typescript-eslint\'],\\n  parserOptions: {\\n    parser: \'@typescript-eslint/parser\'\\n  },\\n  extends: [\\n    \'@nuxtjs/eslint-config-typescript\'\\n  ],\\n  rules: {\\n    \'@typescript-eslint/no-unused-vars\': \'error\'\\n  }\\n}\\n$ yarn lint:fix\\n$ yarn dev\\n# Lintが動いていることと、変わらず起動できることを確認。\\n\\n\\n\\n\\n\\n4.nuxt-property-decorator\\nnuxt-property-decoratorをインストールする。(vue-property-decoratorでも良いかもしれない。)\\n$ yarn add nuxt-property-decorator\\n\\n\\n\\nnuxt-property-decoratorに合わせて2ファイルを変更する。\\ntsconfig.json (デコレータの使用を宣言する。)\\nindex.vue (デコレータを使った書き方に修正する。)\\n./tsconfig.json\\n...\\n    \\"compilerOptions\\": {\\n...\\n      \\"types\\": [\\n        \\"@types/node\\",\\n        \\"@nuxt/types\\"\\n-      ]\\n+      ],\\n+      \\"experimentalDecorators\\": true\\n    },\\n...\\n\\n\\n\\n./pages/index.vue\\n...\\n<script lang=\\"ts\\">\\n+import { Component, Vue } from \'vue-property-decorator\'\\nimport Logo from \'~/components/Logo.vue\'\\n\\n-export default {\\n+@Component({\\n  components: {\\n    Logo\\n  }\\n-}\\n+})\\n+export default class Index extends Vue {\\n+}\\n<\/script>\\n...\\n\\n\\n\\n\\n\\n$ yarn dev\\n# デコレータを使った表記での起動を確認。\\n\\n\\n\\nお疲れさまでした。\\n参考\\n重要参考文献\\nQiita Nuxt.js 2.9でのTypeScript対応\\nNuxt TypeScript Setup\\nその他の参考文献\\nNuxt.js インストール ... yarn create nuxt-app について\\nGitHub eslint-config ... eslint-configのセットアップ\\nデコレータ | TypeScript 日本語ハンドブック | js STUDIO ... experimentalDecoratorsについて\\nTypeScriptではじめるVueコンポーネント（vue-class-component）... vue-property-decorator(nuxt-property-decorator)を使った@Componentデコレータの書き方\\nNuxt.js+ExpressのプロジェクトをTypeScript化する ... nuxt-property-decoratorを使った@Componentデコレータの書き方\\nはじめてのvue-property-decorator ... vue-property-decorator(nuxt-property-decorator)を使ったデコレータの書き方\\n^1: Nuxt.js TypeScriptサポートに書かれている。(Nuxt.js v2.8までの記述のため、このページの内容のとおりではv2.9.2ではうまく行かない)\\n^2: GitHub vue-property-decoratorに記載がある。","guid":"hatenablog://entry/26006613576772418","categories":["Nuxt.js","TypeScript"],"isoDate":"2019-09-27T03:30:00.000Z"},{"title":"About me","link":"https://basd4g.hatenablog.com/entry/aboutMe","pubDate":"Wed, 18 Sep 2019 21:50:00 +0900","enclosure":{"url":"https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png","type":"image/png","length":"0"},"content":"<h2>自己紹介</h2>\\n\\n<p>HN: やんまー</p>\\n\\n<ul>\\n<li><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Twitter\\">Twitter</a> <a href=\\"https://twitter.com/basd4g\\">@basd4g</a></li>\\n<li><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/GitHub\\">GitHub</a> <a href=\\"https://github.com/basd4g\\">@basd4g</a></li>\\n</ul>\\n\\n\\n<p>大学の情報系学科に所属。\\nWebに興味があり、主にフロントエンド(Vue.js等)を趣味で触ってる。</p>\\n\\n<p>PCに関係ない趣味はス<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%AD%A5%E5%A1%BC%A5%D0\\">キューバ</a>ダイビングで、海が好き。</p>\\n\\n<h2>今まで作ったもの</h2>\\n\\n<h3><a href=\\"https://basd4g.github.io/PlayQueue\\">Play Queue</a> (音楽再生Webアプリ)</h3>\\n\\n<p>音楽の連続再生を目的とした、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Youtube\\">Youtube</a>再生プレイヤー。</p>\\n\\n<p>Vue.jsをフロントエンドとして、<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Youtube\\">Youtube</a> data v3 <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/API\\">API</a>, <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Youtube\\">Youtube</a> Player <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/API\\">API</a>を利用して<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Youtube\\">Youtube</a>を再生する事ができる。\\nアプリケーション内に動的変更に向く独自の再生リストをもち、動画を再生しながらリストを編集できる。</p>\\n\\n<h3><a href=\\"https://github.com/basd4g/text2pdf\\">Text2PDF</a></h3>\\n\\n<p>テキストファイルを基にPDFを生成する<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/CUI\\">CUI</a><a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/%A5%B3%A5%DE%A5%F3%A5%C9%A5%E9%A5%A4%A5%F3\\">コマンドライン</a>ツール。\\nNode.jsの標準ライブラリのみを用いてPDFを生成する。</p>\\n\\n<h3><a href=\\"https://fudemoji.me\\">筆文字ジェネレータ</a></h3>\\n\\n<p>入力した文字から毛筆で書いたような画像を生成するWebアプリケーション。\\nHTML <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/Canvas\\">Canvas</a>で動いているのが大部分。 <a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/PHP\\">PHP</a>が裏で動いている。</p>\\n\\n<h3><a href=\\"https://github.com/basd4g/green-turtle\\">green-turtle</a></h3>\\n\\n<p>このブログに使っている静的サイトジェネレータ。\\nNuxt.jsのgenerateモードを利用して動いている。\\nGitで記事管理が可能な環境を構築した。</p>\\n\\n<h2>ブログで書くこと</h2>\\n\\n<p>以上の通り<a class=\\"keyword\\" href=\\"http://d.hatena.ne.jp/keyword/JavaScript\\">JavaScript</a>をよく書くので、これに関する内容の記事が多くなると思う。</p>\\n","contentSnippet":"自己紹介\\nHN: やんまー\\nTwitter @basd4g\\nGitHub @basd4g\\n大学の情報系学科に所属。\\nWebに興味があり、主にフロントエンド(Vue.js等)を趣味で触ってる。\\nPCに関係ない趣味はスキューバダイビングで、海が好き。\\n今まで作ったもの\\nPlay Queue (音楽再生Webアプリ)\\n音楽の連続再生を目的とした、Youtube再生プレイヤー。\\nVue.jsをフロントエンドとして、Youtube data v3 API, Youtube Player APIを利用してYoutubeを再生する事ができる。\\nアプリケーション内に動的変更に向く独自の再生リストをもち、動画を再生しながらリストを編集できる。\\nText2PDF\\nテキストファイルを基にPDFを生成するCUIコマンドラインツール。\\nNode.jsの標準ライブラリのみを用いてPDFを生成する。\\n筆文字ジェネレータ\\n入力した文字から毛筆で書いたような画像を生成するWebアプリケーション。\\nHTML Canvasで動いているのが大部分。 PHPが裏で動いている。\\ngreen-turtle\\nこのブログに使っている静的サイトジェネレータ。\\nNuxt.jsのgenerateモードを利用して動いている。\\nGitで記事管理が可能な環境を構築した。\\nブログで書くこと\\n以上の通りJavaScriptをよく書くので、これに関する内容の記事が多くなると思う。","guid":"hatenablog://entry/26006613576772424","isoDate":"2019-09-18T12:50:00.000Z"}]')}});
//# sourceMappingURL=app.1586e525.js.map